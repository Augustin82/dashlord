{
	"@version": "2.11.0",
	"@generated": "Sun, 14 Nov 2021 10:34:54",
	"site":[ 
		{
			"@name": "https://anais.beta.gouv.fr",
			"@host": "anais.beta.gouv.fr",
			"@port": "443",
			"@ssl": "true",
			"alerts": [ 
				{
					"pluginid": "10038",
					"alertRef": "10038",
					"alert": "Content Security Policy (CSP) Header Not Set",
					"name": "Content Security Policy (CSP) Header Not Set",
					"riskcode": "2",
					"confidence": "3",
					"riskdesc": "Medium (High)",
					"desc": "<p>Content Security Policy (CSP) is an added layer of security that helps to detect and mitigate certain types of attacks, including Cross Site Scripting (XSS) and data injection attacks. These attacks are used for everything from data theft to site defacement or distribution of malware. CSP provides a set of standard HTTP headers that allow website owners to declare approved sources of content that browsers should be allowed to load on that page \u2014 covered types are JavaScript, CSS, HTML frames, fonts, images and embeddable objects such as Java applets, ActiveX, audio and video files.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/robots.txt",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/sitemap.xml",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						}
					],
					"count": "3",
					"solution": "<p>Ensure that your web server, application server, load balancer, etc. is configured to set the Content-Security-Policy header, to achieve optimal browser support: \"Content-Security-Policy\" for Chrome 25+, Firefox 23+ and Safari 7+, \"X-Content-Security-Policy\" for Firefox 4.0+ and Internet Explorer 10+, and \"X-WebKit-CSP\" for Chrome 14+ and Safari 6+.</p>",
					"otherinfo": "",
					"reference": "<p>https://developer.mozilla.org/en-US/docs/Web/Security/CSP/Introducing_Content_Security_Policy</p><p>https://cheatsheetseries.owasp.org/cheatsheets/Content_Security_Policy_Cheat_Sheet.html</p><p>http://www.w3.org/TR/CSP/</p><p>http://w3c.github.io/webappsec/specs/content-security-policy/csp-specification.dev.html</p><p>http://www.html5rocks.com/en/tutorials/security/content-security-policy/</p><p>http://caniuse.com/#feat=contentsecuritypolicy</p><p>http://content-security-policy.com/</p>",
					"cweid": "693",
					"wascid": "15",
					"sourceid": "1"
				},
				{
					"pluginid": "10110",
					"alertRef": "10110",
					"alert": "Dangerous JS Functions",
					"name": "Dangerous JS Functions",
					"riskcode": "1",
					"confidence": "1",
					"riskdesc": "Low (Low)",
					"desc": "<p>A dangerous JS function seems to be in use that would leave the site vulnerable.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.207c5ca289596e0532fc923572aa0378208702a1.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "bypassSecurityTrustHtml"
						}
					],
					"count": "1",
					"solution": "<p>See the references for security advice on the use of these functions.</p>",
					"otherinfo": "",
					"reference": "<p>https://angular.io/guide/security</p>",
					"cweid": "749",
					"wascid": "-1",
					"sourceid": "25"
				},
				{
					"pluginid": "10015",
					"alertRef": "10015",
					"alert": "Incomplete or No Cache-control Header Set",
					"name": "Incomplete or No Cache-control Header Set",
					"riskcode": "1",
					"confidence": "2",
					"riskdesc": "Low (Medium)",
					"desc": "<p>The cache-control header has not been set properly or is missing, allowing the browser and proxies to cache content.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr",
							"method": "GET",
							"param": "Cache-Control",
							"attack": "",
							"evidence": "no-store"
						},
						{
							"uri": "https://anais.beta.gouv.fr/robots.txt",
							"method": "GET",
							"param": "Cache-Control",
							"attack": "",
							"evidence": "no-store"
						},
						{
							"uri": "https://anais.beta.gouv.fr/sitemap.xml",
							"method": "GET",
							"param": "Cache-Control",
							"attack": "",
							"evidence": "no-store"
						}
					],
					"count": "3",
					"solution": "<p>Whenever possible ensure the cache-control HTTP header is set with no-cache, no-store, must-revalidate.</p>",
					"otherinfo": "",
					"reference": "<p>https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#web-content-caching</p><p>https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control</p>",
					"cweid": "525",
					"wascid": "13",
					"sourceid": "1"
				},
				{
					"pluginid": "10063",
					"alertRef": "10063",
					"alert": "Permissions Policy Header Not Set",
					"name": "Permissions Policy Header Not Set",
					"riskcode": "1",
					"confidence": "2",
					"riskdesc": "Low (Medium)",
					"desc": "<p>Permissions Policy Header is an added layer of security that helps to restrict from unauthorized access or usage of browser/client features by web resources. This policy ensures the user privacy by limiting or specifying the features of the browsers can be used by the web resources. Permissions Policy provides a set of standard HTTP headers that allow website owners to limit which features of browsers can be used by the page such as camera, microphone, location, full screen etc.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.207c5ca289596e0532fc923572aa0378208702a1.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es2015.f49bb84470ae61f45146.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.178ada624ff15567c9ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/robots.txt",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/runtime-es2015.b49b89920789fed5e542.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/runtime-es5.b49b89920789fed5e542.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/sitemap.xml",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						}
					],
					"count": "8",
					"solution": "<p>Ensure that your web server, application server, load balancer, etc. is configured to set the Permissions-Policy header.</p>",
					"otherinfo": "",
					"reference": "<p>https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Feature-Policy</p><p>https://developers.google.com/web/updates/2018/06/feature-policy</p><p>https://scotthelme.co.uk/a-new-security-header-feature-policy/</p><p>https://w3c.github.io/webappsec-feature-policy/</p><p>https://www.smashingmagazine.com/2018/12/feature-policy/</p>",
					"cweid": "693",
					"wascid": "15",
					"sourceid": "1"
				},
				{
					"pluginid": "10036",
					"alertRef": "10036",
					"alert": "Server Leaks Version Information via \"Server\" HTTP Response Header Field",
					"name": "Server Leaks Version Information via \"Server\" HTTP Response Header Field",
					"riskcode": "1",
					"confidence": "3",
					"riskdesc": "Low (High)",
					"desc": "<p>The web/application server is leaking version information via the \"Server\" HTTP response header. Access to such information may facilitate attackers identifying other vulnerabilities your web/application server is subject to.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.18.0"
						},
						{
							"uri": "https://anais.beta.gouv.fr/assets/images/favicon_anais.png",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.18.0"
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.207c5ca289596e0532fc923572aa0378208702a1.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.18.0"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es2015.f49bb84470ae61f45146.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.18.0"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.178ada624ff15567c9ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.18.0"
						},
						{
							"uri": "https://anais.beta.gouv.fr/robots.txt",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.18.0"
						},
						{
							"uri": "https://anais.beta.gouv.fr/runtime-es2015.b49b89920789fed5e542.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.18.0"
						},
						{
							"uri": "https://anais.beta.gouv.fr/runtime-es5.b49b89920789fed5e542.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.18.0"
						},
						{
							"uri": "https://anais.beta.gouv.fr/sitemap.xml",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.18.0"
						},
						{
							"uri": "https://anais.beta.gouv.fr/styles.3961828bc95154b9a268.css",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.18.0"
						}
					],
					"count": "10",
					"solution": "<p>Ensure that your web server, application server, load balancer, etc. is configured to suppress the \"Server\" header or provide generic details.</p>",
					"otherinfo": "",
					"reference": "<p>http://httpd.apache.org/docs/current/mod/core.html#servertokens</p><p>http://msdn.microsoft.com/en-us/library/ff648552.aspx#ht_urlscan_007</p><p>http://blogs.msdn.com/b/varunm/archive/2013/04/23/remove-unwanted-http-response-headers.aspx</p><p>http://www.troyhunt.com/2012/02/shhh-dont-let-your-response-headers.html</p>",
					"cweid": "200",
					"wascid": "13",
					"sourceid": "1"
				},
				{
					"pluginid": "10096",
					"alertRef": "10096",
					"alert": "Timestamp Disclosure - Unix",
					"name": "Timestamp Disclosure - Unix",
					"riskcode": "1",
					"confidence": "1",
					"riskdesc": "Low (Low)",
					"desc": "<p>A timestamp was disclosed by the application/web server - Unix</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr/assets/images/favicon_anais.png",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "02345678"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es2015.f49bb84470ae61f45146.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "16711680"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es2015.f49bb84470ae61f45146.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "16777216"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es2015.f49bb84470ae61f45146.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "2147483647"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.178ada624ff15567c9ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "16711680"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.178ada624ff15567c9ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "16777216"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.178ada624ff15567c9ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "2147483647"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.178ada624ff15567c9ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "62425156"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.178ada624ff15567c9ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "94906265"
						}
					],
					"count": "9",
					"solution": "<p>Manually confirm that the timestamp data is not sensitive, and that the data cannot be aggregated to disclose exploitable patterns.</p>",
					"otherinfo": "<p>02345678, which evaluates to: 1970-01-28 03:34:38</p>",
					"reference": "<p>http://projects.webappsec.org/w/page/13246936/Information%20Leakage</p>",
					"cweid": "200",
					"wascid": "13",
					"sourceid": "17"
				},
				{
					"pluginid": "10094",
					"alertRef": "10094",
					"alert": "Base64 Disclosure",
					"name": "Base64 Disclosure",
					"riskcode": "0",
					"confidence": "2",
					"riskdesc": "Informational (Medium)",
					"desc": "<p>Base64 encoded data was disclosed by the application/web server. Note: in the interests of performance not all base64 strings in the response were analyzed individually, the entire response should be looked at by the analyst/security team/developer(s).</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.207c5ca289596e0532fc923572aa0378208702a1.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es2015.f49bb84470ae61f45146.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.178ada624ff15567c9ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
						}
					],
					"count": "3",
					"solution": "<p>Manually confirm that the Base64 data does not leak sensitive information, and that the data cannot be aggregated/used to exploit other vulnerabilities.</p>",
					"otherinfo": "<p>\\x0000\\x0010\uFFFD\\x0010Q\uFFFD \uFFFD\uFFFD0\u04CFA\\x0014\uFFFDQU\uFFFDa\uFFFD\uFFFDq\u05DF\uFFFD\\x0018\uFFFD\uFFFDY\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u06EF\uFFFD\\x001c\uFFFD\uFFFD]\uFFFD\u37BB\uFFFD\u07FF</p>",
					"reference": "<p>http://projects.webappsec.org/w/page/13246936/Information%20Leakage</p>",
					"cweid": "200",
					"wascid": "13",
					"sourceid": "25"
				},
				{
					"pluginid": "10027",
					"alertRef": "10027",
					"alert": "Information Disclosure - Suspicious Comments",
					"name": "Information Disclosure - Suspicious Comments",
					"riskcode": "0",
					"confidence": "1",
					"riskdesc": "Informational (Low)",
					"desc": "<p>The response appears to contain suspicious comments which may help an attacker. Note: Matches made within script blocks or files are against the entire content not only comments.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.207c5ca289596e0532fc923572aa0378208702a1.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "Bug"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es2015.f49bb84470ae61f45146.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "select"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.178ada624ff15567c9ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "Select"
						}
					],
					"count": "3",
					"solution": "<p>Remove all comments that return information that may help an attacker and fix any underlying problems they refer to.</p>",
					"otherinfo": "<p>The following pattern was used: \\bBUG\\b and was detected in the element starting with: \"var kmt=Object.defineProperty,Imt=Object.defineProperties,Omt=Object.getOwnPropertyDescriptors,Ule=Object.getOwnPropertySymbols,\", see evidence field for the suspicious comment/snippet.</p>",
					"reference": "",
					"cweid": "200",
					"wascid": "13",
					"sourceid": "25"
				},
				{
					"pluginid": "10109",
					"alertRef": "10109",
					"alert": "Modern Web Application",
					"name": "Modern Web Application",
					"riskcode": "0",
					"confidence": "2",
					"riskdesc": "Informational (Medium)",
					"desc": "<p>The application appears to be a modern web application. If you need to explore it automatically then the Ajax Spider may well be more effective than the standard one.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "<noscript><link rel=\"stylesheet\" href=\"styles.3961828bc95154b9a268.css\"></noscript>"
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.207c5ca289596e0532fc923572aa0378208702a1.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "<a>>>0)){s=0;break}o=o+1|0}else s=0}while(0);o=0==(0|s)}else o=0;if(u=0|ve(a+1|0,0,52),s=0|x()|-15728641&e,Mt(e=(u|t)&~(e=0|ve(7,0,0|(l=3*(14-a|0)|0))),a=s&~(0|x()),i,n),s=n+(h<<3)|0,!o)return Mt((u=0|ve(1,0,0|l))|e,0|x()|a,i,s),u=s+(h<<3)|0,Mt((c=0|ve(2,0,0|l))|e,0|x()|a,i,u),u=u+(h<<3)|0,Mt((c=0|ve(3,0,0|l))|e,0|x()|a,i,u),u=u+(h<<3)|0,Mt((c=0|ve(4,0,0|l))|e,0|x()|a,i,u),u=u+(h<<3)|0,Mt((c=0|ve(5,0,0|l))|e,0|x()|a,i,u),void Mt((c=0|ve(6,0,0|l))|e,0|x()|a,i,u+(h<<3)|0);o=s+(h<<3)|0,(0|c)>6&&(we(0|s,0,8+(u=(o>>>0>(c=s+8|0)>>>0?o:c)+-1+(0-s)|0)&-8|0),s=c+(u>>>3<<3)|0),Mt((u=0|ve(2,0,0|l))|e,0|x()|a,i,s),u=s+(h<<3)|0,Mt((c=0|ve(3,0,0|l))|e,0|x()|a,i,u),u=u+(h<<3)|0,Mt((c=0|ve(4,0,0|l))|e,0|x()|a,i,u),u=u+(h<<3)|0,Mt((c=0|ve(5,0,0|l))|e,0|x()|a,i,u),Mt((c=0|ve(6,0,0|l))|e,0|x()|a,i,u+(h<<3)|0)}}function Tt(t,e){var i=0,n=0,r=0;if(r=0|Ae(0|(t|=0),0|(e|=0),45),x(),!(0|L(127&r)))return 0;r=0|Ae(0|t,0|e,52),x(),r&=15;t:do{if(r)for(n=1;;){if(i=0|Ae(0|t,0|e,3*(15-n|0)|0),x(),0|(i&=7))break t;if(!(n>>>0<r>>>0)){i=0;break}n=n+1|0}else i=0}while(0);return 0|0==(0|i)&1}function It(t,e){var i=0,n=0,r=0;if(r=0|Ae(0|(t|=0),0|(e|=0),52),x(),!(r&=15))return 0;for(n=1;;){if(i=0|Ae(0|t,0|e,3*(15-n|0)|0),x(),0|(i&=7)){n=5;break}if(!(n>>>0<r>>>0)){i=0,n=5;break}n=n+1|0}return 5==(0|n)?0|i:0}function Ot(t,e){var i=0,n=0,r=0,s=0,o=0,a=0,l=0;if(l=0|Ae(0|(t|=0),0|(e|=0),52),x(),!(l&=15))return l=t,w(0|(a=e)),0|l;for(a=1,i=0;;){n=0|ve(7,0,0|(s=3*(15-a|0)|0)),r=0|x(),o=0|Ae(0|t,0|e,0|s),x(),t=(s=0|ve(0|at(7&o),0,0|s))|t&~n,e=(o=0|x())|e&~r;t:do{if(!i)if(0==(s&n|0)&0==(o&r|0))i=0;else if(n=0|Ae(0|t,0|e,52),x(),n&=15,n){i=1;e:for(;;){switch(o=0|Ae(0|t,0|e,3*(15-i|0)|0),x(),7&o){case 1:break e;case 0:break;default:i=1;break t}if(!(i>>>0<n>>>0)){i=1;break t}i=i+1|0}for(i=1;;){if(r=0|Ae(0|t,0|e,0|(o=3*(15-i|0)|0)),x(),s=0|ve(7,0,0|o),e&=~(0|x()),t=t&~s|(o=0|ve(0|at(7&r),0,0|o)),e=0|e|x(),!(i>>>0<n>>>0)){i=1;break}i=i+1|0}}else i=1}while(0);if(!(a>>>0<l>>>0))break;a=a+1|0}return w(0|e),0|t}function Pt(t,e){var i=0,n=0,r=0,s=0,o=0;if(n=0|Ae(0|(t|=0),0|(e|=0),52),x(),!(n&=15))return n=t,w(0|(i=e)),0|n;for(i=1;o=0|Ae(0|t,0|e,0|(s=3*(15-i|0)|0)),x(),r=0|ve(7,0,0|s),e&=~(0|x()),t=(s=0|ve(0|at(7&o),0,0|s))|t&~r,e=0|x()|e,i>>>0<n>>>0;)i=i+1|0;return w(0|e),0|t}function Dt(t,e){var i=0,n=0,r=0,s=0,o=0,a=0,l=0;if(l=0|Ae(0|(t|=0),0|(e|=0),52),x(),!(l&=15))return l=t,w(0|(a=e)),0|l;for(a=1,i=0;;){n=0|ve(7,0,0|(s=3*(15-a|0)|0)),r=0|x(),o=0|Ae(0|t,0|e,0|s),x(),t=(s=0|ve(0|lt(7&o),0,0|s))|t&~n,e=(o=0|x())|e&~r;t:do{if(!i)if(0==(s&n|0)&0==(o&r|0))i=0;else if(n=0|Ae(0|t,0|e,52),x(),n&=15,n){i=1;e:for(;;){switch(o=0|Ae(0|t,0|e,3*(15-i|0)|0),x(),7&o){case 1:break e;case 0:break;default:i=1;break t}if(!(i>>>0<n>>>0)){i=1;break t}i=i+1|0}for(i=1;;){if(s=0|ve(7,0,0|(r=3*(15-i|0)|0)),o=e&~(0|x()),e=0|Ae(0|t,0|e,0|r),x(),t=t&~s|(e=0|ve(0|lt(7&e),0,0|r)),e=0|o|x(),!(i>>>0<n>>>0)){i=1;break}i=i+1|0}}else i=1}while(0);if(!(a>>>0<l>>>0))break;a=a+1|0}return w(0|e),0|t}function Rt(t,e){var i=0,n=0,r=0,s=0,o=0;if(n=0|Ae(0|(t|=0),0|(e|=0),52),x(),!(n&=15))return n=t,w(0|(i=e)),0|n;for(i=1;s=0|ve(7,0,0|(o=3*(15-i|0)|0)),r=e&~(0|x()),e=0|Ae(0|t,0|e,0|o),x(),t=(e=0|ve(0|lt(7&e),0,0|o))|t&~s,e=0|x()|r,i>>>0<n>>>0;)i=i+1|0;return w(0|e),0|t}function Ft(t){return 0|(0|(t|=0))%2}function Lt(t,e){var i,n;return t|=0,n=I,I=I+16|0,i=n,(e|=0)>>>0<=15&&2146435072!=(2146435072&r[t+4>>2]|0)&&2146435072!=(2146435072&r[t+8+4>>2]|0)?(function(t,e,i){var n,o;n=I,I=I+16|0,function(t,e,i,n){e|=0,i|=0,n|=0;var o,a=0,l=0,c=0,h=0;if(o=I,I=I+32|0,function(t,e){e|=0;var i,n,r=0;i=+u(+(r=+s[(t|=0)>>3])),r=+d(+r),s[e+16>>3]=r,n=i*+u(+(r=+s[t+8>>3])),s[e>>3]=n,r=i*+d(+r),s[e+8>>3]=r}(t|=0,l=o),r[i>>2]=0,a=+ie(15888,l),(c=+ie(15912,l))<a&&(r[i>>2]=1,a=c),(c=+ie(15936,l))<a&&(r[i>>2]=2,a=c),(c=+ie(15960,l))<a&&(r[i>>2]=3,a=c),(c=+ie(15984,l))<a&&(r[i>>2]=4,a=c),(c=+ie(16008,l))<a&&(r[i>>2]=5,a=c),(c=+ie(16032,l))<a&&(r[i>>2]=6,a=c),(c=+ie(16056,l))<a&&(r[i>>2]=7,a=c),(c=+ie(16080,l))<a&&(r[i>>2]=8,a=c),(c=+ie(16104,l))<a&&(r[i>>2]=9,a=c),(c=+ie(16128,l))<a&&(r[i>>2]=10,a=c),(c=+ie(16152,l))<a&&(r[i>>2]=11,a=c),(c=+ie(16176,l))<a&&(r[i>>2]=12,a=c),(c=+ie(16200,l))<a&&(r[i>>2]=13,a=c),(c=+ie(16224,l))<a&&(r[i>>2]=14,a=c),(c=+ie(16248,l))<a&&(r[i>>2]=15,a=c),(c=+ie(16272,l))<a&&(r[i>>2]=16,a=c),(c=+ie(16296,l))<a&&(r[i>>2]=17,a=c),(c=+ie(16320,l))<a&&(r[i>>2]=18,a=c),(c=+ie(16344,l))<a&&(r[i>>2]=19,a=c),(c=+f(+(1-.5*a)))<1e-16)return r[n>>2]=0,r[n+4>>2]=0,r[n+8>>2]=0,r[n+12>>2]=0,void(I=o);if(a=+bt((a=+s[16368+(24*(i=0|r[i>>2])|0)>>3])-+bt(+function(t,e){var i,n,r,o,a;return t|=0,a=(n=+u(+(o=+s[(e|=0)>>3])))*+d(+(r=+s[e+8>>3]-+s[t+8>>3])),i=+s[t>>3],+ +A(+a,+(+d(+o)*+u(+i)-+u(+r)*(n*+d(+i))))}(15568+(i<<4)|0,t))),h=0|Ft(e)?+bt(a+-.3334731722518321):a,a=+p(+c)/.381966011250105,(0|e)>0){l=0;do{a*=2.6457513110645907,l=l+1|0}while((0|l)!=(0|e))}c=+u(+h)*a,s[n>>3]=c,h=+d(+h)*a,s[n+8>>3]=h,I=o}(t|=0,e|=0,i|=0,o=n),function(t,e){t|=0;var i,n,o,a,c=0,h=0,u=0,d=0,p=0,f=0,m=0;r[(a=8+(e|=0)|0)>>2]=0,d=+l(+(n=+s[t>>3])),d+=.5*(p=+l(+(o=+s[t+8>>3]))/.8660254037844386),d-=+(0|(c=~~d)),p-=+(0|(t=~~p));do{if(d<.5){if(d<.3333333333333333){if(r[e>>2]=c,p<.5*(d+1)){r[e+4>>2]=t;break}r[e+4>>2]=t=t+1|0;break}if(r[e+4>>2]=t=(1&!(p<(m=1-d)))+t|0,m<=p&p<2*d){r[e>>2]=c=c+1|0;break}r[e>>2]=c;break}if(!(d<.6666666666666666)){if(r[e>>2]=c=c+1|0,p<.5*d){r[e+4>>2]=t;break}r[e+4>>2]=t=t+1|0;break}if(p<1-d){if(r[e+4>>2]=t,2*d-1<p){r[e>>2]=c;break}}else r[e+4>>2]=t=t+1|0;r[e>>2]=c=c+1|0}while(0);do{if(n<0){if(1&t){c=~~(+(0|c)-(2*(+((f=0|fe(0|c,((0|c)<0)<<31>>31|0,0|(f=(t+1|0)/2|0),((0|f)<0)<<31>>31|0))>>>0)+4294967296*+(0|x()))+1)),r[e>>2]=c;break}c=~~(+(0|c)-2*(+((f=0|fe(0|c,((0|c)<0)<<31>>31|0,0|(f=(0|t)/2|0),((0|f)<0)<<31>>31|0))>>>0)+4294967296*+(0|x()))),r[e>>2]=c;break}}while(0);f=e+4|0,o<0&&(r[e>>2]=c=c-((1|t<<1)/2|0)|0,r[f>>2]=t=0-t|0),h=t-c|0,(0|c)<0?(u=0-c|0,r[f>>2]=h,r[a>>2]=u,r[e>>2]=0,t=h,c=0):u=0,(0|t)<0&&(r[e>>2]=c=c-t|0,r[a>>2]=u=u-t|0,r[f>>2]=0,t=0),i=c-u|0,h=t-u|0,(0|u)<0&&(r[e>>2]=i,r[f>>2]=h,r[a>>2]=0,t=h,c=i,u=0),!((0|(h=(0|u)<(0|(h=(0|t)<(0|c)?t:c))?u:h))<=0)&&(r[e>>2]=c-h,r[f>>2]=t-h,r[a>>2]=u-h)}(o,i+4|0),I=n}(t,e,i),e=0|function(t,e){t|=0;var i,n=0,s=0,o=0,a=0,l=0,c=0,h=0,u=0;if(i=I,I=I+64|0,c=i+40|0,s=i+24|0,o=i+12|0,a=i,ve(0|(e|=0),0,52),n=134225919|x(),!e)return(0|r[t+4>>2])>2||(0|r[t+8>>2])>2||(0|r[t+12>>2])>2?(c=0,w(0|(l=0)),I=i,0|c):(ve(0|N(t),0,45),l=0|x()|n,c=-1,w(0|l),I=i,0|c);if(r[c>>2]=r[t>>2],r[c+4>>2]=r[t+4>>2],r[c+8>>2]=r[t+8>>2],r[c+12>>2]=r[t+12>>2],l=c+4|0,(0|e)>0)for(t=-1;r[s>>2]=r[l>>2],r[s+4>>2]=r[l+4>>2],r[s+8>>2]=r[l+8>>2],1&e?(tt(l),r[o>>2]=r[l>>2],r[o+4>>2]=r[l+4>>2],r[o+8>>2]=r[l+8>>2],it(o)):(et(l),r[o>>2]=r[l>>2],r[o+4>>2]=r[l+4>>2],r[o+8>>2]=r[l+8>>2],nt(o)),K(s,o,a),Y(a),h=0|ve(7,0,0|(u=3*(15-e|0)|0)),n&=~(0|x()),t=(u=0|ve(0|J(a),0,0|u))|t&~h,n=0|x()|n,(0|e)>1;)e=e+-1|0;else t=-1;t:do{if((0|r[l>>2])<=2&&(0|r[c+8>>2])<=2&&(0|r[c+12>>2])<=2){if(e=0|ve(0|(s=0|N(c)),0,45),e|=t,t=0|x()|-1040385&n,a=0|z(c),!(0|L(s))){if((0|a)<=0)break;for(o=0;;){if(s=0|Ae(0|e,0|t,52),x(),s&=15)for(n=1;c=0|Ae(0|e,0|t,0|(u=3*(15-n|0)|0)),x(),h=0|ve(7,0,0|u),t&=~(0|x()),e=e&~h|(u=0|ve(0|at(7&c),0,0|u)),t=0|t|x(),n>>>0<s>>>0;)n=n+1|0;if((0|(o=o+1|0))==(0|a))break t}}o=0|Ae(0|e,0|t,52),x(),o&=15;e:do{if(o){n=1;i:for(;;){switch(u=0|Ae(0|e,0|t,3*(15-n|0)|0),x(),7&u){case 1:break i;case 0:break;default:break e}if(!(n>>>0<o>>>0))break e;n=n+1|0}if(0|V(s,0|r[c>>2]))for(n=1;h=0|ve(7,0,0|(c=3*(15-n|0)|0)),u=t&~(0|x()),t=0|Ae(0|e,0|t,0|c),x(),e=e&~h|(t=0|ve(0|lt(7&t),0,0|c)),t=0|u|x(),n>>>0<o>>>0;)n=n+1|0;else for(n=1;c=0|Ae(0|e,0|t,0|(u=3*(15-n|0)|0)),x(),h=0|ve(7,0,0|u),t&=~(0|x()),e=e&~h|(u=0|ve(0|at(7&c),0,0|u)),t=0|t|x(),n>>>0<o>>>0;)n=n+1|0}}while(0);if((0|a)>0){n=0;do{e=0|Ot(e,t),t=0|x(),n=n+1|0}while((0|n)!=(0|a))}}else e=0,t=0}while(0);return u=e,w(0|(h=t)),I=i,0|u}(i,e),t=0|x()):(t=0,e=0),w(0|t),I=n,0|e}function Bt(t,e,i){var n,s=0,o=0,a=0;if(n=4+(i|=0)|0,o=0|Ae(0|(t|=0),0|(e|=0),52),x(),o&=15,a=0|Ae(0|t,0|e,45),x(),s=0==(0|o),0|L(127&a)){if(s)return 1;s=1}else{if(s)return 0;s=0==(0|r[n>>2])&&0==(0|r[i+8>>2])?0!=(0|r[i+12>>2])&1:1}for(i=1;1&i?it(n):nt(n),a=0|Ae(0|t,0|e,3*(15-i|0)|0),x(),rt(n,7&a),i>>>0<o>>>0;)i=i+1|0;return 0|s}function Nt(t,e,i){i|=0;var n,s,o=0,a=0,l=0,c=0,h=0,u=0;s=I,I=I+16|0,n=s,u=0|Ae(0|(t|=0),0|(e|=0),45),x(),u&=127;t:do{if(0!=(0|L(u))&&(l=0|Ae(0|t,0|e,52),x(),l&=15,0!=(0|l))){o=1;e:for(;;){switch(h=0|Ae(0|t,0|e,3*(15-o|0)|0),x(),7&h){case 5:break e;case 0:break;default:o=e;break t}if(!(o>>>0<l>>>0)){o=e;break t}o=o+1|0}for(a=1,o=e;c=0|ve(7,0,0|(e=3*(15-a|0)|0)),h=o&~(0|x()),o=0|Ae(0|t,0|o,0|e),x(),t=t&~c|(o=0|ve(0|lt(7&o),0,0|e)),o=0|h|x(),a>>>0<l>>>0;)a=a+1|0}else o=e}while(0);if(r[i>>2]=r[(h=7728+(28*u|0)|0)>>2],r[i+4>>2]=r[h+4>>2],r[i+8>>2]=r[h+8>>2],r[i+12>>2]=r[h+12>>2],0|Bt(t,o,i)){if(r[n>>2]=r[(c=i+4|0)>>2],r[n+4>>2]=r[c+4>>2],r[n+8>>2]=r[c+8>>2],l=0|Ae(0|t,0|o,52),x(),h=15&l,1&l?(nt(c),l=h+1|0):l=h,0|L(u)){t:do{if(h)for(e=1;;){if(a=0|Ae(0|t,0|o,3*(15-e|0)|0),x(),0|(a&=7)){o=a;break t}if(!(e>>>0<h>>>0)){o=0;break}e=e+1|0}else o=0}while(0);o=4==(0|o)&1}else o=0;if(0|At(i,l,o,0)){if(0|L(u))do{}while(0!=(0|At(i,l,0,0)));(0|l)!=(0|h)&&et(c)}else(0|l)!=(0|h)&&(r[c>>2]=r[n>>2],r[c+4>>2]=r[n+4>>2],r[c+8>>2]=r[n+8>>2]);I=s}else I=s}function zt(t,e,i){var n,s;i|=0,n=I,I=I+16|0,Nt(t|=0,e|=0,s=n),e=0|Ae(0|t,0|e,52),x(),function(t,e,i){var n,s;e|=0,i|=0,n=I,I=I+16|0,Z(4+(t|=0)|0,s=n),ft(s,0|r[t>>2],e,0,i),I=n}(s,15&e,i),I=n}function Vt(t,e,i){i|=0;var n,r,s=0,o=0;r=I,I=I+16|0,Nt(t|=0,e|=0,n=r),s=0|Ae(0|t,0|e,45),x(),s=0==(0|L(127&s)),o=0|Ae(0|t,0|e,52),x(),o&=15;t:do{if(!s){if(0|o)for(s=1;;){if(!(0==((0|ve(7,0,3*(15-s|0)|0))&t|0)&0==((0|x())&e|0)))break t;if(!(s>>>0<o>>>0))break;s=s+1|0}return mt(n,o,0,5,i),void(I=r)}}while(0);_t(n,o,0,6,i),I=r}function jt(t,e){e|=0;var i,n=0,s=0,o=0,a=0,l=0,c=0;if(ve(0|(t|=0),0,52),i=134225919|x(),(0|t)<1){s=0,n=0;do{0|L(s)&&(ve(0|s,0,45),l=0|i|x(),r[(t=e+(n<<3)|0)>>2]=-1,r[t+4>>2]=l,n=n+1|0),s=s+1|0}while(122!=(0|s))}else{l=0,n=0;do{if(0|L(l)){for(ve(0|l,0,45),s=1,o=-1,a=0|i|x();o&=~(c=0|ve(7,0,3*(15-s|0)|0)),a&=~(0|x()),(0|s)!=(0|t);)s=s+1|0;r[(c=e+(n<<3)|0)>>2]=o,r[c+4>>2]=a,n=n+1|0}l=l+1|0}while(122!=(0|l))}}function $t(t,e,i,n){var s,o=0,a=0,l=0,c=0,h=0;if(s=I,I=I+64|0,l=s,(0|(t|=0))==(0|(i|=0))&(0|(e|=0))==(0|(n|=0))|!1|134217728!=(2013265920&e|0)|!1|134217728!=(2013265920&n|0)||(o=0|Ae(0|t,0|e,52),x(),o&=15,a=0|Ae(0|i,0|n,52),x(),(0|o)!=(15&a|0)))return I=s,0;if(a=o+-1|0,o>>>0>1&&(h=0|Et(t,e,a),c=0|x(),(0|h)==(0|(a=0|Et(i,n,a)))&(0|c)==(0|x()))&&(o=0|Ae(0|t,0|e,0|(a=3*(15^o)|0)),x(),o&=7,a=0|Ae(0|i,0|n,0|a),x(),0==(0|o)|0==(0|(a&=7))||(0|r[21136+(o<<2)>>2])==(0|a)||(0|r[21168+(o<<2)>>2])==(0|a)))return I=s,1;a=(o=l)+56|0;do{r[o>>2]=0,o=o+4|0}while((0|o)<(0|a));return O(t,e,1,l),o=(0|r[(h=l)>>2])==(0|i)&&(0|r[h+4>>2])==(0|n)||(0|r[(h=l+8|0)>>2])==(0|i)&&(0|r[h+4>>2])==(0|n)||(0|r[(h=l+16|0)>>2])==(0|i)&&(0|r[h+4>>2])==(0|n)||(0|r[(h=l+24|0)>>2])==(0|i)&&(0|r[h+4>>2])==(0|n)||(0|r[(h=l+32|0)>>2])==(0|i)&&(0|r[h+4>>2])==(0|n)||(0|r[(h=l+40|0)>>2])==(0|i)&&(0|r[h+4>>2])==(0|n)?1:1&((0|r[(o=l+48|0)>>2])==(0|i)?(0|r[o+4>>2])==(0|n):0),I=s,0|o}function Ut(t,e,i){i|=0;var n,s,o,a,l=0;if(o=I,I=I+16|0,s=o,l=0|Ae(0|(t|=0),0|(e|=0),56),x(),-1==(0|(e=0|function(t,e,i){i|=0;var n=0,s=0;return n=0|Tt(t|=0,e|=0),(i+-1|0)>>>0>5||1==(0|i)&(s=0!=(0|n))?0|(i=-1):(n=0|function(t,e){var i,n,s,o=0,a=0,l=0,c=0,h=0;if(s=I,I=I+32|0,n=s,Nt(t|=0,e|=0,i=s+16|0),l=0|Ct(t,e),h=0|It(t,e),function(t,e){r[(e|=0)>>2]=r[(t=7728+(28*(t|=0)|0)|0)>>2],r[e+4>>2]=r[t+4>>2],r[e+8>>2]=r[t+8>>2],r[e+12>>2]=r[t+12>>2]}(l,n),e=0|function(t,e){t|=0;var i=0,n=0;if((e|=0)>>>0>20)return-1;do{if((0|r[11152+(216*e|0)>>2])!=(0|t))if((0|r[11152+(216*e|0)+8>>2])!=(0|t))if((0|r[11152+(216*e|0)+16>>2])!=(0|t))if((0|r[11152+(216*e|0)+24>>2])!=(0|t))if((0|r[11152+(216*e|0)+32>>2])!=(0|t))if((0|r[11152+(216*e|0)+40>>2])!=(0|t))if((0|r[11152+(216*e|0)+48>>2])!=(0|t))if((0|r[11152+(216*e|0)+56>>2])!=(0|t))if((0|r[11152+(216*e|0)+64>>2])!=(0|t))if((0|r[11152+(216*e|0)+72>>2])!=(0|t))if((0|r[11152+(216*e|0)+80>>2])!=(0|t))if((0|r[11152+(216*e|0)+88>>2])!=(0|t))if((0|r[11152+(216*e|0)+96>>2])!=(0|t))if((0|r[11152+(216*e|0)+104>>2])!=(0|t))if((0|r[11152+(216*e|0)+112>>2])!=(0|t))if((0|r[11152+(216*e|0)+120>>2])!=(0|t))if((0|r[11152+(216*e|0)+128>>2])!=(0|t)){if((0|r[11152+(216*e|0)+136>>2])!=(0|t)){if((0|r[11152+(216*e|0)+144>>2])==(0|t)){t=0,i=2,n=0;break}if((0|r[11152+(216*e|0)+152>>2])==(0|t)){t=0,i=2,n=1;break}if((0|r[11152+(216*e|0)+160>>2])==(0|t)){t=0,i=2,n=2;break}if((0|r[11152+(216*e|0)+168>>2])==(0|t)){t=1,i=2,n=0;break}if((0|r[11152+(216*e|0)+176>>2])==(0|t)){t=1,i=2,n=1;break}if((0|r[11152+(216*e|0)+184>>2])==(0|t)){t=1,i=2,n=2;break}if((0|r[11152+(216*e|0)+192>>2])==(0|t)){t=2,i=2,n=0;break}if((0|r[11152+(216*e|0)+200>>2])==(0|t)){t=2,i=2,n=1;break}if((0|r[11152+(216*e|0)+208>>2])==(0|t)){t=2,i=2,n=2;break}return-1}t=2,i=1,n=2}else t=2,i=1,n=1;else t=2,i=1,n=0;else t=1,i=1,n=2;else t=1,i=1,n=1;else t=1,i=1,n=0;else t=0,i=1,n=2;else t=0,i=1,n=1;else t=0,i=1,n=0;else t=2,i=0,n=2;else t=2,i=0,n=1;else t=2,i=0,n=0;else t=1,i=0,n=2;else t=1,i=0,n=1;else t=1,i=0,n=0;else t=0,i=0,n=2;else t=0,i=0,n=1;else t=0,i=0,n=0}while(0);return 0|r[11152+(216*e|0)+(72*i|0)+(24*t|0)+(n<<3)+4>>2]}(l,0|r[i>>2]),!(0|L(l)))return I=s,0|e;switch(0|l){case 4:t=0,o=14;break;case 14:t=1,o=14;break;case 24:t=2,o=14;break;case 38:t=3,o=14;break;case 49:t=4,o=14;break;case 58:t=5,o=14;break;case 63:t=6,o=14;break;case 72:t=7,o=14;break;case 83:t=8,o=14;break;case 97:t=9,o=14;break;case 107:t=10,o=14;break;case 117:t=11,o=14;break;default:c=0,a=0}return 14==(0|o)&&(c=0|r[22096+(24*t|0)+8>>2],a=0|r[22096+(24*t|0)+16>>2]),(0|(t=0|r[i>>2]))!=(0|r[n>>2])&&(l=0|B(l))|(0|(t=0|r[i>>2]))==(0|a)&&(e=(e+1|0)%6|0),3==(0|h)&(0|t)==(0|a)?(I=s,0|(h=(e+5|0)%6|0)):5==(0|h)&(0|t)==(0|c)?(I=s,0|(h=(e+1|0)%6|0)):(I=s,0|(h=e))}(t,e),s?0|(i=(5-n+(0|r[22384+(i<<2)>>2])|0)%5|0):0|(i=(6-n+(0|r[22416+(i<<2)>>2])|0)%6|0))}(n=(a=!0&268435456==(2013265920&e|0))?t:0,t=a?-2130706433&e|134217728:0,7&l))))return r[i>>2]=0,void(I=o);Nt(n,t,s),l=0|Ae(0|n,0|t,52),x(),l&=15,0|Tt(n,t)?mt(s,l,e,2,i):_t(s,l,e,2,i),I=o}function Ht(t){t|=0;var e,i,n=0;return(e=0|pe(1,12))||S(22691,22646,49,22704),0|(n=0|r[(i=t+4|0)>>2])?(r[(n=n+8|0)>>2]=e,r[i>>2]=e,0|e):(0|r[t>>2]&&S(22721,22646,61,22744),r[(n=t)>>2]=e,r[i>>2]=e,0|e)}function Gt(t,e){var i,n;return t|=0,e|=0,(n=0|ue(24))||S(22758,22646,78,22772),r[n>>2]=r[e>>2],r[n+4>>2]=r[e+4>>2],r[n+8>>2]=r[e+8>>2],r[n+12>>2]=r[e+12>>2],r[n+16>>2]=0,0|(i=0|r[(e=t+4|0)>>2])?(r[i+16>>2]=n,r[e>>2]=n,0|n):(0|r[t>>2]&&S(22787,22646,82,22772),r[t>>2]=n,r[e>>2]=n,0|n)}function qt(t){var e,i,n=0,o=0,a=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,y=0,b=0,w=0,x=0,C=0,k=0,E=0,M=0,T=0,I=0,O=0,P=0,D=0,R=0,F=0,L=0;if(0|r[(c=8+(t|=0)|0)>>2])return 1;if(!(a=0|r[t>>2]))return 0;n=a,o=0;do{o=o+1|0,n=0|r[n+8>>2]}while(0!=(0|n));if(o>>>0<2)return 0;(i=0|ue(o<<2))||S(22807,22646,317,22826),(e=0|ue(o<<5))||S(22848,22646,321,22826),r[t>>2]=0,r[(M=t+4|0)>>2]=0,r[c>>2]=0,o=0,R=0,E=0,g=0;t:for(;;){if(m=0|r[a>>2]){h=0,u=m;do{if(n=u,+l(+((p=+s[u+8>>3])-(d=+s[(c=(f=0==(0|(u=0|r[u+16>>2])))?m:u)+8>>3])))>3.141592653589793){L=14;break}h+=(d-p)*(+s[n>>3]+ +s[c>>3])}while(!f);if(14==(0|L)){L=0,h=0,n=m;do{h+=(+s[n>>3]+ +s[(P=0==(0|(P=0|r[(D=n+16|0)>>2]))?m:P)>>3])*(((C=+s[P+8>>3])<0?C+6.283185307179586:C)-((k=+s[n+8>>3])<0?k+6.283185307179586:k)),n=0|r[(0==(0|n)?a:D)>>2]}while(0!=(0|n))}h>0?(r[i+(R<<2)>>2]=a,R=R+1|0,c=E,n=g):L=19}else L=19;if(19==(0|L)){L=0;do{if(!o){if(g){c=M,u=g+8|0,n=a,o=t;break}if(0|r[t>>2]){L=27;break t}c=M,u=t,n=a,o=t;break}if(0|r[(n=o+8|0)>>2]){L=21;break t}if(!(o=0|pe(1,12))){L=23;break t}r[n>>2]=o,c=o+4|0,u=o,n=g}while(0);if(r[u>>2]=a,r[c>>2]=a,u=e+(E<<5)|0,f=0|r[a>>2]){for(s[(m=e+(E<<5)+8|0)>>3]=17976931348623157e292,s[(g=e+(E<<5)+24|0)>>3]=17976931348623157e292,s[u>>3]=-17976931348623157e292,s[(A=e+(E<<5)+16|0)>>3]=-17976931348623157e292,w=17976931348623157e292,x=-17976931348623157e292,c=0,v=f,p=17976931348623157e292,y=17976931348623157e292,b=-17976931348623157e292,d=-17976931348623157e292;h=+s[v>>3],k=+s[v+8>>3],C=+s[((_=0==(0|(v=0|r[v+16>>2])))?f:v)+8>>3],h<p&&(s[m>>3]=h,p=h),k<y&&(s[g>>3]=k,y=k),h>b?s[u>>3]=h:h=b,k>d&&(s[A>>3]=k,d=k),w=k>0&k<w?k:w,x=k<0&k>x?k:x,c|=+l(+(k-C))>3.141592653589793,!_;)b=h;c&&(s[A>>3]=x,s[g>>3]=w)}else r[u>>2]=0,r[u+4>>2]=0,r[u+8>>2]=0,r[u+12>>2]=0,r[u+16>>2]=0,r[u+20>>2]=0,r[u+24>>2]=0,r[u+28>>2]=0;c=E+1|0}if(a=0|r[(D=a+8|0)>>2],r[D>>2]=0,!a){L=45;break}E=c,g=n}if(21==(0|L))S(22624,22646,35,22658);else if(23==(0|L))S(22678,22646,37,22658);else if(27==(0|L))S(22721,22646,61,22744);else if(45==(0|L)){t:do{if((0|R)>0){for(D=0==(0|c),O=c<<2,P=0==(0|t),I=0,n=0;;){if(T=0|r[i+(I<<2)>>2],D)L=73;else{if(!(E=0|ue(O))){L=50;break}if(!(M=0|ue(O))){L=52;break}e:do{if(P)o=0;else{for(c=0,o=0,u=t;0|Wt(0|r[u>>2],a=e+(c<<5)|0,0|r[T>>2])?(r[E+(o<<2)>>2]=u,r[M+(o<<2)>>2]=a,_=o+1|0):_=o,u=0|r[u+8>>2];)c=c+1|0,o=_;if((0|_)>0)if(a=0|r[E>>2],1==(0|_))o=a;else for(A=0,v=-1,o=a,g=a;;){for(f=0|r[g>>2],a=0,u=0;m=(0|(c=0|r[r[E+(u<<2)>>2]>>2]))==(0|f)?a:a+(1&(0|Wt(c,0|r[M+(u<<2)>>2],0|r[f>>2])))|0,(0|(u=u+1|0))!=(0|_);)a=m;if(o=(c=(0|m)>(0|v))?g:o,(0|(a=A+1|0))==(0|_))break e;A=a,v=c?m:v,g=0|r[E+(a<<2)>>2]}else o=0}}while(0);if(de(E),de(M),o){if(a=0|r[(c=o+4|0)>>2])o=a+8|0;else if(0|r[o>>2]){L=70;break}r[o>>2]=T,r[c>>2]=T}else L=73}if(73==(0|L)){if(L=0,0|(n=0|r[T>>2]))do{M=n,n=0|r[n+16>>2],de(M)}while(0!=(0|n));de(T),n=2}if((0|(I=I+1|0))>=(0|R)){F=n;break t}}50==(0|L)?S(22863,22646,249,22882):52==(0|L)?S(22901,22646,252,22882):70==(0|L)&&S(22721,22646,61,22744)}else F=0}while(0);return de(i),de(e),0|F}return 0}function Wt(t,e,i){t|=0;var n=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0;if(!(0|H(e|=0,i|=0)&&(e=0|U(e),u=+s[i>>3],n=+s[i+8>>3],n=e&n<0?n+6.283185307179586:n,t=0|r[t>>2],t)))return 0;if(e){e=0,i=t;t:for(;;){for(;l=+s[i>>3],h=+s[i+8>>3],o=+s[(d=0==(0|(d=0|r[(i=i+16|0)>>2]))?t:d)+8>>3],l>(a=+s[d>>3])?(c=l,l=h):(c=a,a=l,l=o,o=h),u<a|u>c;)if(!(i=0|r[i>>2])){i=22;break t}if(n=(l=l<0?l+6.283185307179586:l)==n|(h=o<0?o+6.283185307179586:o)==n?n+-2220446049250313e-31:n,((h+=(u-a)/(c-a)*(l-h))<0?h+6.283185307179586:h)>n&&(e^=1),!(i=0|r[i>>2])){i=22;break}}if(22==(0|i))return 0|e}else{e=0,i=t;t:for(;;){for(;l=+s[i>>3],h=+s[i+8>>3],o=+s[(d=0==(0|(d=0|r[(i=i+16|0)>>2]))?t:d)+8>>3],l>(a=+s[d>>3])?(c=l,l=h):(c=a,a=l,l=o,o=h),u<a|u>c;)if(!(i=0|r[i>>2])){i=22;break t}if(o+(u-a)/(c-a)*(l-o)>(n=l==n|o==n?n+-2220446049250313e-31:n)&&(e^=1),!(i=0|r[i>>2])){i=22;break}}if(22==(0|i))return 0|e}return 0}function Yt(t,e,i,s,o){i|=0,s|=0,o|=0;var a,l,c,h,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,y=0;if(h=I,I=I+32|0,y=h+16|0,c=h,u=0|Ae(0|(t|=0),0|(e|=0),52),x(),u&=15,A=0|Ae(0|i,0|s,52),x(),(0|u)!=(15&A|0))return I=h,1;if(m=0|Ae(0|t,0|e,45),x(),m&=127,g=0|Ae(0|i,0|s,45),x(),A=(0|m)!=(0|(g&=127))){if(7==(0|(p=0|$(m,g))))return I=h,2;7==(0|(f=0|$(g,m)))?S(22925,22949,151,22959):(v=p,d=f)}else v=0,d=0;a=0|L(m),l=0|L(g),r[y>>2]=0,r[y+4>>2]=0,r[y+8>>2]=0,r[y+12>>2]=0;do{if(v){if(p=(0|(g=0|r[4304+(28*m|0)+(v<<2)>>2]))>0,l)if(p){m=0,f=i,p=s;do{f=0|Dt(f,p),p=0|x(),1==(0|(d=0|lt(d)))&&(d=0|lt(1)),m=m+1|0}while((0|m)!=(0|g));g=d,m=f,f=p}else g=d,m=i,f=s;else if(p){m=0,f=i,p=s;do{f=0|Rt(f,p),p=0|x(),d=0|lt(d),m=m+1|0}while((0|m)!=(0|g));g=d,m=f,f=p}else g=d,m=i,f=s;if(Bt(m,f,y),A||S(22972,22949,181,22959),(p=0!=(0|a))&(d=0!=(0|l))&&S(22999,22949,182,22959),p){if(d=0|It(t,e),0|n[22032+(7*d|0)+v>>0]){u=3;break}m=f=0|r[21200+(28*d|0)+(v<<2)>>2],_=26}else if(d){if(d=0|It(m,f),0|n[22032+(7*d|0)+g>>0]){u=4;break}m=0,f=0|r[21200+(28*g|0)+(d<<2)>>2],_=26}else d=0;if(26==(0|_))if((0|f)<=-1&&S(23030,22949,212,22959),(0|m)<=-1&&S(23053,22949,213,22959),(0|f)>0){p=y+4|0,d=0;do{ot(p),d=d+1|0}while((0|d)!=(0|f));d=m}else d=m;if(r[c>>2]=0,r[c+4>>2]=0,r[c+8>>2]=0,rt(c,v),0|u)for(;0|Ft(u)?it(c):nt(c),(0|u)>1;)u=u+-1|0;if((0|d)>0){u=0;do{ot(c),u=u+1|0}while((0|u)!=(0|d))}X(_=y+4|0,c,_),Y(_),_=50}else if(Bt(i,s,y),0!=(0|a)&0!=(0|l))if((0|g)!=(0|m)&&S(23077,22949,243,22959),d=0|It(t,e),u=0|It(i,s),0|n[22032+(7*d|0)+u>>0])u=5;else if((0|(d=0|r[21200+(28*d|0)+(u<<2)>>2]))>0){p=y+4|0,u=0;do{ot(p),u=u+1|0}while((0|u)!=(0|d));_=50}else _=50;else _=50}while(0);return 50==(0|_)&&(r[o>>2]=r[(u=y+4|0)>>2],r[o+4>>2]=r[u+4>>2],r[o+8>>2]=r[u+8>>2],u=0),I=h,0|u}function Zt(t,e,i,n){i|=0,n|=0;var s,o,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0;if(o=I,I=I+48|0,c=o+36|0,h=o+24|0,u=o+12|0,d=o,l=0|Ae(0|(t|=0),0|(e|=0),52),x(),l&=15,f=0|Ae(0|t,0|e,45),x(),s=0|L(f&=127),ve(0|l,0,52),A=134225919|x(),r[(g=n)>>2]=-1,r[g+4>>2]=A,!l)return(0|r[i>>2])>1||(0|r[i+4>>2])>1||(0|r[i+8>>2])>1||127==(0|(a=0|j(f,0|J(i))))?(I=o,0|(A=1)):(m=0|ve(0|a,0,45),g=0|x(),g|=-1040385&r[(f=n)+4>>2],r[(A=n)>>2]=r[f>>2]|m,r[A+4>>2]=g,I=o,0|(A=0));for(r[c>>2]=r[i>>2],r[c+4>>2]=r[i+4>>2],r[c+8>>2]=r[i+8>>2];r[h>>2]=r[c>>2],r[h+4>>2]=r[c+4>>2],r[h+8>>2]=r[c+8>>2],0|Ft(l)?(tt(c),r[u>>2]=r[c>>2],r[u+4>>2]=r[c+4>>2],r[u+8>>2]=r[c+8>>2],it(u)):(et(c),r[u>>2]=r[c>>2],r[u+4>>2]=r[c+4>>2],r[u+8>>2]=r[c+8>>2],nt(u)),K(h,u,d),Y(d),v=0|r[(g=n)>>2],g=0|r[g+4>>2],i=0|ve(7,0,0|(_=3*(15-l|0)|0)),g&=~(0|x()),_=0|ve(0|J(d),0,0|_),g=0|x()|g,r[(A=n)>>2]=_|v&~i,r[A+4>>2]=g,(0|l)>1;)l=l+-1|0;t:do{if((0|r[c>>2])<=1&&(0|r[c+4>>2])<=1&&(0|r[c+8>>2])<=1){d=127==(0|(h=0|j(f,l=0|J(c))))?0:0|L(h);e:do{if(l){if(s){if(c=21408+(28*(0|It(t,e))|0)+(l<<2)|0,(0|(c=0|r[c>>2]))>0){i=0;do{l=0|at(l),i=i+1|0}while((0|i)!=(0|c))}if(1==(0|l)){a=3;break t}127==(0|(i=0|j(f,l)))&&S(23104,22949,376,23134),0|L(i)?S(23147,22949,377,23134):(m=c,p=l,a=i)}else m=0,p=l,a=h;if((0|(u=0|r[4304+(28*f|0)+(p<<2)>>2]))<=-1&&S(23178,22949,384,23134),!d){if((0|m)<=-1&&S(23030,22949,417,23134),0|m){l=0,i=0|r[(c=n)>>2],c=0|r[c+4>>2];do{i=0|Pt(i,c),c=0|x(),r[(_=n)>>2]=i,r[_+4>>2]=c,l=l+1|0}while((0|l)<(0|m))}if((0|u)<=0){l=54;break}for(l=0,i=0|r[(c=n)>>2],c=0|r[c+4>>2];;)if(i=0|Pt(i,c),c=0|x(),r[(_=n)>>2]=i,r[_+4>>2]=c,(0|(l=l+1|0))==(0|u)){l=54;break e}}if(7==(0|(h=0|$(a,f)))&&S(22925,22949,393,23134),i=0|r[(l=n)>>2],l=0|r[l+4>>2],(0|u)>0){c=0;do{i=0|Pt(i,l),l=0|x(),r[(_=n)>>2]=i,r[_+4>>2]=l,c=c+1|0}while((0|c)!=(0|u))}if(i=0|It(i,l),_=0|B(a),(0|(i=0|r[(_?21824:21616)+(28*h|0)+(i<<2)>>2]))<=-1&&S(23030,22949,412,23134),i){l=0,c=0|r[(h=n)>>2],h=0|r[h+4>>2];do{c=0|Ot(c,h),h=0|x(),r[(_=n)>>2]=c,r[_+4>>2]=h,l=l+1|0}while((0|l)<(0|i));l=54}else l=54}else if(0!=(0|s)&0!=(0|d))if(_=0|It(t,e),l=n,l=21408+(28*_|0)+((0|It(0|r[l>>2],0|r[l+4>>2]))<<2)|0,l=0|r[l>>2],(0|l)<=-1&&S(23201,22949,433,23134),l){a=0,i=0|r[(c=n)>>2],c=0|r[c+4>>2];do{i=0|Pt(i,c),c=0|x(),r[(_=n)>>2]=i,r[_+4>>2]=c,a=a+1|0}while((0|a)<(0|l));a=h,l=54}else a=h,l=55;else a=h,l=54}while(0);if(54==(0|l)&&d&&(l=55),55==(0|l)&&1==(0|It(0|r[(_=n)>>2],0|r[_+4>>2]))){a=4;break}A=0|r[(_=n)>>2],_=-1040385&r[_+4>>2],v=0|ve(0|a,0,45),_=0|_|x(),r[(a=n)>>2]=A|v,r[a+4>>2]=_,a=0}else a=2}while(0);return I=o,0|a}function Xt(t,e){var i=0;if(!(e|=0))return 1;i=t|=0,t=1;do{t=0|_(0==(1&e|0)?1:i,t),e>>=1,i=0|_(i,i)}while(0!=(0|e));return 0|t}function Kt(t,e,i){t|=0;var n,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0;if(!(0|H(e|=0,i|=0))||(e=0|U(e),f=+s[i>>3],o=e&(o=+s[i+8>>3])<0?o+6.283185307179586:o,(0|(p=0|r[t>>2]))<=0))return 0;if(n=0|r[t+4>>2],e){e=0,i=-1,t=0;t:for(;;){for(d=t;u=+s[n+(d<<4)+8>>3],a=+s[n+((t=(i+2|0)%(0|p)|0)<<4)+8>>3],(c=+s[n+(d<<4)>>3])>(l=+s[n+(t<<4)>>3])?(h=c,c=u):(h=l,l=c,c=a,a=u),f<l|f>h;){if(!((0|(i=d+1|0))<(0|p))){i=22;break t}t=d,d=i,i=t}if(o=(c=c<0?c+6.283185307179586:c)==o|(u=a<0?a+6.283185307179586:a)==o?o+-2220446049250313e-31:o,((u+=(f-l)/(h-l)*(c-u))<0?u+6.283185307179586:u)>o&&(e^=1),(0|(t=d+1|0))>=(0|p)){i=22;break}i=d}if(22==(0|i))return 0|e}else{e=0,i=-1,t=0;t:for(;;){for(d=t;u=+s[n+(d<<4)+8>>3],a=+s[n+((t=(i+2|0)%(0|p)|0)<<4)+8>>3],(c=+s[n+(d<<4)>>3])>(l=+s[n+(t<<4)>>3])?(h=c,c=u):(h=l,l=c,c=a,a=u),f<l|f>h;){if(!((0|(i=d+1|0))<(0|p))){i=22;break t}t=d,d=i,i=t}if(a+(f-l)/(h-l)*(c-a)>(o=c==o|a==o?o+-2220446049250313e-31:o)&&(e^=1),(0|(t=d+1|0))>=(0|p)){i=22;break}i=d}if(22==(0|i))return 0|e}return 0}function Qt(t,e){e|=0;var i,n,o,a,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,y=0,b=0;if(!(i=0|r[(t|=0)>>2]))return r[e>>2]=0,r[e+4>>2]=0,r[e+8>>2]=0,r[e+12>>2]=0,r[e+16>>2]=0,r[e+20>>2]=0,r[e+24>>2]=0,void(r[e+28>>2]=0);if(s[(n=e+8|0)>>3]=17976931348623157e292,s[(o=e+24|0)>>3]=17976931348623157e292,s[e>>3]=-17976931348623157e292,s[(a=e+16|0)>>3]=-17976931348623157e292,!((0|i)<=0)){for(_=0|r[t+4>>2],g=17976931348623157e292,A=-17976931348623157e292,v=0,t=-1,d=17976931348623157e292,p=17976931348623157e292,m=-17976931348623157e292,h=-17976931348623157e292,y=0;f=+s[_+(y<<4)+8>>3],u=+s[_+(((0|(t=t+2|0))==(0|i)?0:t)<<4)+8>>3],(c=+s[_+(y<<4)>>3])<d&&(s[n>>3]=c,d=c),f<p&&(s[o>>3]=f,p=f),c>m?s[e>>3]=c:c=m,f>h&&(s[a>>3]=f,h=f),g=f>0&f<g?f:g,A=f<0&f>A?f:A,v|=+l(+(f-u))>3.141592653589793,(0|(t=y+1|0))!=(0|i);)b=y,m=c,y=t,t=b;!v||(s[a>>3]=A,s[o>>3]=g)}}function Jt(t,e,i){var n=0,s=0;if(!(0|Kt(t|=0,e|=0,i|=0)))return 0;if((0|r[(s=t+8|0)>>2])<=0)return 1;for(n=t+12|0,t=0;;){if(0|Kt((0|r[n>>2])+(t<<3)|0,e+((t=t+1|0)<<5)|0,i)){t=0,n=6;break}if((0|t)>=(0|r[s>>2])){t=1,n=6;break}}return 6==(0|n)?0|t:0}function te(t,e,i,n,r){var o,a,l,c,h,u,d,p=0;s[(r|=0)>>3]=(c=+s[(t|=0)>>3])+(l=+s[(e|=0)>>3]-c)*(p=((p=+s[(n|=0)>>3]-(u=+s[(i|=0)>>3]))*((a=+s[t+8>>3])-(d=+s[i+8>>3]))-(c-u)*(h=+s[n+8>>3]-d))/(l*h-(o=+s[e+8>>3]-a)*p)),s[r+8>>3]=a+o*p}function ee(t,e){return+s[(t|=0)>>3]!=+s[(e|=0)>>3]?0|(e=0):0|(e=+s[t+8>>3]==+s[e+8>>3])}function ie(t,e){var i,n,r;return+((r=+s[(t|=0)>>3]-+s[(e|=0)>>3])*r+(n=+s[t+8>>3]-+s[e+8>>3])*n+(i=+s[t+16>>3]-+s[e+16>>3])*i)}function ne(t,e,i){t|=0,i|=0;var n=0;(0|(e|=0))>0?(n=0|pe(e,4),r[t>>2]=n,n||S(23230,23253,40,23267)):r[t>>2]=0,r[t+4>>2]=e,r[t+8>>2]=0,r[t+12>>2]=i}function re(t){var e,i,n,o=0,a=0,c=0,u=0;e=4+(t|=0)|0,i=t+12|0,n=t+8|0;t:for(;;){for(a=0|r[e>>2],o=0;;){if((0|o)>=(0|a))break t;if(u=0|r[(c=0|r[t>>2])+(o<<2)>>2])break;o=o+1|0}o=c+(~~(+l(+ +h(10,+ +(15-(0|r[i>>2])|0))*(+s[u>>3]+ +s[u+8>>3]))%+(0|a))>>>0<<2)|0,a=0|r[o>>2];e:do{if(0|a){if(c=u+32|0,(0|a)==(0|u))r[o>>2]=r[c>>2];else{if(!(o=0|r[(a=a+32|0)>>2]))break;for(;(0|o)!=(0|u);)if(!(o=0|r[(a=o+32|0)>>2]))break e;r[a>>2]=r[c>>2]}de(u),r[n>>2]=(0|r[n>>2])-1}}while(0)}de(0|r[t>>2])}function se(t){var e,i=0,n=0;for(e=0|r[4+(t|=0)>>2],n=0;;){if((0|n)>=(0|e)){i=0,n=4;break}if(i=0|r[(0|r[t>>2])+(n<<2)>>2]){n=4;break}n=n+1|0}return 4==(0|n)?0|i:0}function oe(t,e){e|=0;var i=0,n=0,o=0,a=0;if(i=~~(+l(+ +h(10,+ +(15-(0|r[12+(t|=0)>>2])|0))*(+s[e>>3]+ +s[e+8>>3]))%+(0|r[t+4>>2]))>>>0,!(n=0|r[(i=(0|r[t>>2])+(i<<2)|0)>>2]))return 1;a=e+32|0;do{if((0|n)!=(0|e)){if(!(i=0|r[n+32>>2]))return 1;for(o=i;;){if((0|o)==(0|e)){o=8;break}if(!(i=0|r[o+32>>2])){i=1,o=10;break}n=o,o=i}if(8==(0|o)){r[n+32>>2]=r[a>>2];break}if(10==(0|o))return 0|i}else r[i>>2]=r[a>>2]}while(0);return de(e),r[(a=t+8|0)>>2]=(0|r[a>>2])-1,0}function ae(t,e,i){t|=0,e|=0,i|=0;var n,o=0,a=0,c=0;(n=0|ue(40))||S(23283,23253,98,23296),r[n>>2]=r[e>>2],r[n+4>>2]=r[e+4>>2],r[n+8>>2]=r[e+8>>2],r[n+12>>2]=r[e+12>>2],r[(a=n+16|0)>>2]=r[i>>2],r[a+4>>2]=r[i+4>>2],r[a+8>>2]=r[i+8>>2],r[a+12>>2]=r[i+12>>2],r[n+32>>2]=0,a=~~(+l(+ +h(10,+ +(15-(0|r[t+12>>2])|0))*(+s[e>>3]+ +s[e+8>>3]))%+(0|r[t+4>>2]))>>>0,o=0|r[(a=(0|r[t>>2])+(a<<2)|0)>>2];do{if(o){for(;!(0|wt(o,e)&&0|wt(o+16|0,i));)if(!(0|r[(o=0==(0|(a=0|r[o+32>>2]))?o:a)+32>>2])){c=10;break}if(10==(0|c)){r[o+32>>2]=n;break}return de(n),0|o}r[a>>2]=n}while(0);return r[(c=t+8|0)>>2]=1+(0|r[c>>2]),0|n}function le(t,e,i){e|=0,i|=0;var n=0,o=0;if(o=~~(+l(+ +h(10,+ +(15-(0|r[12+(t|=0)>>2])|0))*(+s[e>>3]+ +s[e+8>>3]))%+(0|r[t+4>>2]))>>>0,!(o=0|r[(0|r[t>>2])+(o<<2)>>2]))return 0;if(!i){for(t=o;;){if(0|wt(t,e)){n=10;break}if(!(t=0|r[t+32>>2])){t=0,n=10;break}}if(10==(0|n))return 0|t}for(t=o;;){if(0|wt(t,e)&&0|wt(t+16|0,i)){n=10;break}if(!(t=0|r[t+32>>2])){t=0,n=10;break}}return 10==(0|n)?0|t:0}function ce(t,e){e|=0;var i=0;if(i=~~(+l(+ +h(10,+ +(15-(0|r[12+(t|=0)>>2])|0))*(+s[e>>3]+ +s[e+8>>3]))%+(0|r[t+4>>2]))>>>0,!(t=0|r[(0|r[t>>2])+(i<<2)>>2]))return 0;for(;;){if(0|wt(t,e)){e=5;break}if(!(t=0|r[t+32>>2])){t=0,e=5;break}}return 5==(0|e)?0|t:0}function he(t){return 0|~~+function(t){return+ +xe(+(t=+t))}(t=+t)}function ue(t){t|=0;var e,i=0,n=0,s=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,y=0,b=0,w=0;e=I,I=I+16|0,f=e;do{if(t>>>0<245){if(3&(n=(p=0|r[5829])>>>(t=(u=t>>>0<11?16:t+11&-8)>>>3))|0)return(0|(a=0|r[(o=8+(s=0|r[(n=8+(t=23356+((i=(1&n^1)+t|0)<<1<<2)|0)|0)>>2])|0)>>2]))==(0|t)?r[5829]=p&~(1<<i):(r[a+12>>2]=t,r[n>>2]=a),r[s+4>>2]=3|(w=i<<3),r[(w=s+w+4|0)>>2]=1|r[w>>2],I=e,0|o;if(u>>>0>(d=0|r[5831])>>>0){if(0|n)return i=((i=n<<t&((i=2<<t)|0-i))&0-i)-1|0,(0|(n=0|r[(c=8+(a=0|r[(t=8+(i=23356+((s=((n=(i>>>=c=i>>>12&16)>>>5&8)|c|(a=(i>>>=n)>>>2&4)|(t=(i>>>=a)>>>1&2)|(s=(i>>>=t)>>>1&1))+(i>>>s)|0)<<1<<2)|0)|0)>>2])|0)>>2]))==(0|i)?r[5829]=t=p&~(1<<s):(r[n+12>>2]=i,r[t>>2]=n,t=p),l=(w=s<<3)-u|0,r[a+4>>2]=3|u,r[4+(o=a+u|0)>>2]=1|l,r[a+w>>2]=l,0|d&&(s=0|r[5834],n=23356+((i=d>>>3)<<1<<2)|0,t&(i=1<<i)?i=0|r[(t=n+8|0)>>2]:(r[5829]=t|i,i=n,t=n+8|0),r[t>>2]=s,r[i+12>>2]=s,r[s+8>>2]=i,r[s+12>>2]=n),r[5831]=l,r[5834]=o,I=e,0|c;if(a=0|r[5830]){for(n=(a&0-a)-1|0,n=h=0|r[23620+(((s=(n>>>=o=n>>>12&16)>>>5&8)|o|(l=(n>>>=s)>>>2&4)|(c=(n>>>=l)>>>1&2)|(h=(n>>>=c)>>>1&1))+(n>>>h)<<2)>>2],c=h,h=(-8&r[h+4>>2])-u|0;(t=0|r[n+16>>2])||(t=0|r[n+20>>2]);)n=t,c=(o=(l=(-8&r[t+4>>2])-u|0)>>>0<h>>>0)?t:c,h=o?l:h;if((l=c+u|0)>>>0>c>>>0){o=0|r[c+24>>2],i=0|r[c+12>>2];do{if((0|i)==(0|c)){if(!(i=0|r[(t=c+20|0)>>2])&&!(i=0|r[(t=c+16|0)>>2])){n=0;break}for(;;)if(n=0|r[(s=i+20|0)>>2])i=n,t=s;else{if(!(n=0|r[(s=i+16|0)>>2]))break;i=n,t=s}r[t>>2]=0,n=i}else r[12+(n=0|r[c+8>>2])>>2]=i,r[i+8>>2]=n,n=i}while(0);do{if(0|o){if((0|c)==(0|r[(t=23620+((i=0|r[c+28>>2])<<2)|0)>>2])){if(r[t>>2]=n,!n){r[5830]=a&~(1<<i);break}}else if(r[((0|r[(w=o+16|0)>>2])==(0|c)?w:o+20|0)>>2]=n,!n)break;r[n+24>>2]=o,0|(i=0|r[c+16>>2])&&(r[n+16>>2]=i,r[i+24>>2]=n),0|(i=0|r[c+20>>2])&&(r[n+20>>2]=i,r[i+24>>2]=n)}}while(0);return h>>>0<16?(r[c+4>>2]=3|(w=h+u|0),r[(w=c+w+4|0)>>2]=1|r[w>>2]):(r[c+4>>2]=3|u,r[l+4>>2]=1|h,r[l+h>>2]=h,0|d&&(s=0|r[5834],n=23356+((i=d>>>3)<<1<<2)|0,(i=1<<i)&p?i=0|r[(t=n+8|0)>>2]:(r[5829]=i|p,i=n,t=n+8|0),r[t>>2]=s,r[i+12>>2]=s,r[s+8>>2]=i,r[s+12>>2]=n),r[5831]=h,r[5834]=l),I=e,0|c+8}p=u}else p=u}else p=u}else if(t>>>0<=4294967231)if(u=-8&(t=t+11|0),s=0|r[5830]){o=0-u|0,h=(t>>>=8)?u>>>0>16777215?31:u>>>(7+(h=14-((c=(520192+(A=t<<(p=(t+1048320|0)>>>16&8))|0)>>>16&4)|p|(h=(245760+(A<<=c)|0)>>>16&2))+(A<<h>>>15)|0)|0)&1|h<<1:0,n=0|r[23620+(h<<2)>>2];t:do{if(n)for(t=0,c=u<<(31==(0|h)?0:25-(h>>>1)|0),a=0;;){if((l=(-8&r[n+4>>2])-u|0)>>>0<o>>>0){if(!l){t=n,o=0,A=65;break t}t=n,o=l}if(a=0==(0|(A=0|r[n+20>>2]))|(0|A)==(0|(n=0|r[n+16+(c>>>31<<2)>>2]))?a:A,!n){n=a,A=61;break}c<<=1}else n=0,t=0,A=61}while(0);if(61==(0|A)){if(0==(0|n)&0==(0|t)){if(!(t=((t=2<<h)|0-t)&s)){p=u;break}p=(t&0-t)-1|0,t=0,n=0|r[23620+(((a=(p>>>=l=p>>>12&16)>>>5&8)|l|(c=(p>>>=a)>>>2&4)|(h=(p>>>=c)>>>1&2)|(n=(p>>>=h)>>>1&1))+(p>>>n)<<2)>>2]}n?A=65:(c=t,l=o)}if(65==(0|A))for(a=n;;){if(o=(n=(p=(-8&r[a+4>>2])-u|0)>>>0<o>>>0)?p:o,t=n?a:t,(n=0|r[a+16>>2])||(n=0|r[a+20>>2]),!n){c=t,l=o;break}a=n}if(0!=(0|c)&&l>>>0<((0|r[5831])-u|0)>>>0&&(d=c+u|0)>>>0>c>>>0){a=0|r[c+24>>2],i=0|r[c+12>>2];do{if((0|i)==(0|c)){if(!(i=0|r[(t=c+20|0)>>2])&&!(i=0|r[(t=c+16|0)>>2])){i=0;break}for(;;)if(n=0|r[(o=i+20|0)>>2])i=n,t=o;else{if(!(n=0|r[(o=i+16|0)>>2]))break;i=n,t=o}r[t>>2]=0}else r[12+(w=0|r[c+8>>2])>>2]=i,r[i+8>>2]=w}while(0);do{if(a){if((0|c)==(0|r[(n=23620+((t=0|r[c+28>>2])<<2)|0)>>2])){if(r[n>>2]=i,!i){r[5830]=s&=~(1<<t);break}}else if(r[((0|r[(w=a+16|0)>>2])==(0|c)?w:a+20|0)>>2]=i,!i)break;r[i+24>>2]=a,0|(t=0|r[c+16>>2])&&(r[i+16>>2]=t,r[t+24>>2]=i),(t=0|r[c+20>>2])&&(r[i+20>>2]=t,r[t+24>>2]=i)}}while(0);t:do{if(l>>>0<16)w=l+u|0,r[c+4>>2]=3|w,w=c+w+4|0,r[w>>2]=1|r[w>>2];else{if(r[c+4>>2]=3|u,r[d+4>>2]=1|l,r[d+l>>2]=l,i=l>>>3,l>>>0<256){n=23356+(i<<1<<2)|0,(t=0|r[5829])&(i=1<<i)?i=0|r[(t=n+8|0)>>2]:(r[5829]=t|i,i=n,t=n+8|0),r[t>>2]=d,r[i+12>>2]=d,r[d+8>>2]=i,r[d+12>>2]=n;break}if(n=(i=l>>>8)?l>>>0>16777215?31:l>>>(7+(n=14-((y=(520192+(w=i<<(b=(i+1048320|0)>>>16&8))|0)>>>16&4)|b|(n=(245760+(w<<=y)|0)>>>16&2))+(w<<n>>>15)|0)|0)&1|n<<1:0,i=23620+(n<<2)|0,r[d+28>>2]=n,r[4+(t=d+16|0)>>2]=0,r[t>>2]=0,!(s&(t=1<<n))){r[5830]=s|t,r[i>>2]=d,r[d+24>>2]=i,r[d+12>>2]=d,r[d+8>>2]=d;break}i=0|r[i>>2];e:do{if((-8&r[i+4>>2]|0)!=(0|l)){for(s=l<<(31==(0|n)?0:25-(n>>>1)|0);t=0|r[(n=i+16+(s>>>31<<2)|0)>>2];){if((-8&r[t+4>>2]|0)==(0|l)){i=t;break e}s<<=1,i=t}r[n>>2]=d,r[d+24>>2]=i,r[d+12>>2]=d,r[d+8>>2]=d;break t}}while(0);r[12+(w=0|r[(b=i+8|0)>>2])>>2]=d,r[b>>2]=d,r[d+8>>2]=w,r[d+12>>2]=i,r[d+24>>2]=0}}while(0);return I=e,0|c+8}p=u}else p=u;else p=-1}while(0);if((n=0|r[5831])>>>0>=p>>>0)return t=0|r[5834],(i=n-p|0)>>>0>15?(r[5834]=w=t+p|0,r[5831]=i,r[w+4>>2]=1|i,r[t+n>>2]=i,r[t+4>>2]=3|p):(r[5831]=0,r[5834]=0,r[t+4>>2]=3|n,r[(w=t+n+4|0)>>2]=1|r[w>>2]),I=e,0|t+8;if((l=0|r[5832])>>>0>p>>>0)return r[5832]=y=l-p|0,r[5835]=b=(w=0|r[5835])+p|0,r[b+4>>2]=1|y,r[w+4>>2]=3|p,I=e,0|w+8;if(0|r[5947]?t=0|r[5949]:(r[5949]=4096,r[5948]=4096,r[5950]=-1,r[5951]=-1,r[5952]=0,r[5940]=0,r[5947]=-16&f^1431655768,t=4096),c=p+48|0,(u=(a=t+(h=p+47|0)|0)&(o=0-t|0))>>>0<=p>>>0||0|(t=0|r[5939])&&(f=(d=0|r[5937])+u|0)>>>0<=d>>>0|f>>>0>t>>>0)return I=e,0;t:do{if(4&r[5940])i=0,A=143;else{n=0|r[5835];e:do{if(n){for(s=23764;!((f=0|r[s>>2])>>>0<=n>>>0&&(f+(0|r[s+4>>2])|0)>>>0>n>>>0);){if(!(t=0|r[s+8>>2])){A=128;break e}s=t}if((i=a-l&o)>>>0<2147483647)if((0|(t=0|Se(0|i)))==((0|r[s>>2])+(0|r[s+4>>2])|0)){if(-1!=(0|t)){l=i,a=t,A=145;break t}}else s=t,A=136;else i=0}else A=128}while(0);do{if(128==(0|A))if(-1!=(0|(n=0|Se(0)))&&(g=(i=(0==((g=(m=0|r[5948])-1|0)&(i=n)|0)?0:(g+i&0-m)-i|0)+u|0)+(m=0|r[5937])|0,i>>>0>p>>>0&i>>>0<2147483647)){if(0|(f=0|r[5939])&&g>>>0<=m>>>0|g>>>0>f>>>0){i=0;break}if((0|(t=0|Se(0|i)))==(0|n)){l=i,a=n,A=145;break t}s=t,A=136}else i=0}while(0);do{if(136==(0|A)){if(n=0-i|0,!(c>>>0>i>>>0&i>>>0<2147483647&-1!=(0|s))){if(-1==(0|s)){i=0;break}l=i,a=s,A=145;break t}if((t=h-i+(t=0|r[5949])&0-t)>>>0>=2147483647){l=i,a=s,A=145;break t}if(-1==(0|Se(0|t))){Se(0|n),i=0;break}l=t+i|0,a=s,A=145;break t}}while(0);r[5940]=4|r[5940],A=143}}while(0);if((143==(0|A)&&u>>>0<2147483647?!(-1==(0|(y=0|Se(0|u)))|1^(_=(v=(g=0|Se(0))-y|0)>>>0>(p+40|0)>>>0)|y>>>0<g>>>0&-1!=(0|y)&-1!=(0|g)^1):0)&&(l=_?v:i,a=y,A=145),145==(0|A)){r[5937]=i=(0|r[5937])+l|0,i>>>0>(0|r[5938])>>>0&&(r[5938]=i),h=0|r[5835];t:do{if(h){for(i=23764;;){if((0|a)==((t=0|r[i>>2])+(n=0|r[i+4>>2])|0)){A=154;break}if(!(s=0|r[i+8>>2]))break;i=s}if(154==(0|A)&&(b=i+4|0,0==(8&r[i+12>>2]|0))&&a>>>0>h>>>0&t>>>0<=h>>>0){r[b>>2]=n+l,b=h+(y=0==(7&(y=h+8|0)|0)?0:0-y&7)|0,y=(w=(0|r[5832])+l|0)-y|0,r[5835]=b,r[5832]=y,r[b+4>>2]=1|y,r[h+w+4>>2]=40,r[5836]=r[5951];break}for(a>>>0<(0|r[5833])>>>0&&(r[5833]=a),n=a+l|0,i=23764;;){if((0|r[i>>2])==(0|n)){A=162;break}if(!(t=0|r[i+8>>2]))break;i=t}if(162==(0|A)&&0==(8&r[i+12>>2]|0)){r[i>>2]=a,r[(d=i+4|0)>>2]=(0|r[d>>2])+l,u=(d=a+(0==(7&(d=a+8|0)|0)?0:0-d&7)|0)+p|0,c=(i=n+(0==(7&(i=n+8|0)|0)?0:0-i&7)|0)-d-p|0,r[d+4>>2]=3|p;e:do{if((0|h)==(0|i))w=(0|r[5832])+c|0,r[5832]=w,r[5835]=u,r[u+4>>2]=1|w;else{if((0|r[5834])==(0|i)){r[5831]=w=(0|r[5831])+c|0,r[5834]=u,r[u+4>>2]=1|w,r[u+w>>2]=w;break}if(1==(3&(t=0|r[i+4>>2])|0)){l=-8&t,s=t>>>3;i:do{if(t>>>0<256){if((0|(n=0|r[i+12>>2]))==(0|(t=0|r[i+8>>2]))){r[5829]=r[5829]&~(1<<s);break}r[t+12>>2]=n,r[n+8>>2]=t;break}a=0|r[i+24>>2],t=0|r[i+12>>2];do{if((0|t)==(0|i)){if(t=0|r[(s=4+(n=i+16|0)|0)>>2])n=s;else if(!(t=0|r[n>>2])){t=0;break}for(;;)if(s=0|r[(o=t+20|0)>>2])t=s,n=o;else{if(!(s=0|r[(o=t+16|0)>>2]))break;t=s,n=o}r[n>>2]=0}else r[12+(w=0|r[i+8>>2])>>2]=t,r[t+8>>2]=w}while(0);if(!a)break;s=23620+((n=0|r[i+28>>2])<<2)|0;do{if((0|r[s>>2])==(0|i)){if(r[s>>2]=t,0|t)break;r[5830]=r[5830]&~(1<<n);break i}if(r[((0|r[(w=a+16|0)>>2])==(0|i)?w:a+20|0)>>2]=t,!t)break i}while(0);if(r[t+24>>2]=a,0|(s=0|r[(n=i+16|0)>>2])&&(r[t+16>>2]=s,r[s+24>>2]=t),!(n=0|r[n+4>>2]))break;r[t+20>>2]=n,r[n+24>>2]=t}while(0);i=i+l|0,o=l+c|0}else o=c;if(r[(i=i+4|0)>>2]=-2&r[i>>2],r[u+4>>2]=1|o,r[u+o>>2]=o,i=o>>>3,o>>>0<256){n=23356+(i<<1<<2)|0,(t=0|r[5829])&(i=1<<i)?i=0|r[(t=n+8|0)>>2]:(r[5829]=t|i,i=n,t=n+8|0),r[t>>2]=u,r[i+12>>2]=u,r[u+8>>2]=i,r[u+12>>2]=n;break}i=o>>>8;do{if(i){if(o>>>0>16777215){s=31;break}s=o>>>(7+(s=14-((y=(520192+(w=i<<(b=(i+1048320|0)>>>16&8))|0)>>>16&4)|b|(s=(245760+(w<<=y)|0)>>>16&2))+(w<<s>>>15)|0)|0)&1|s<<1}else s=0}while(0);if(i=23620+(s<<2)|0,r[u+28>>2]=s,r[4+(t=u+16|0)>>2]=0,r[t>>2]=0,!((t=0|r[5830])&(n=1<<s))){r[5830]=t|n,r[i>>2]=u,r[u+24>>2]=i,r[u+12>>2]=u,r[u+8>>2]=u;break}i=0|r[i>>2];i:do{if((-8&r[i+4>>2]|0)!=(0|o)){for(s=o<<(31==(0|s)?0:25-(s>>>1)|0);t=0|r[(n=i+16+(s>>>31<<2)|0)>>2];){if((-8&r[t+4>>2]|0)==(0|o)){i=t;break i}s<<=1,i=t}r[n>>2]=u,r[u+24>>2]=i,r[u+12>>2]=u,r[u+8>>2]=u;break e}}while(0);r[12+(w=0|r[(b=i+8|0)>>2])>>2]=u,r[b>>2]=u,r[u+8>>2]=w,r[u+12>>2]=i,r[u+24>>2]=0}}while(0);return I=e,0|d+8}for(i=23764;!((t=0|r[i>>2])>>>0<=h>>>0&&(w=t+(0|r[i+4>>2])|0,w>>>0>h>>>0));)i=0|r[i+8>>2];i=(t=(t=(o=w+-47|0)+(0==(7&(t=o+8|0)|0)?0:0-t&7)|0)>>>0<(o=h+16|0)>>>0?h:t)+8|0,b=a+(y=0==(7&(y=a+8|0)|0)?0:0-y&7)|0,y=(n=l+-40|0)-y|0,r[5835]=b,r[5832]=y,r[b+4>>2]=1|y,r[a+n+4>>2]=40,r[5836]=r[5951],r[(n=t+4|0)>>2]=27,r[i>>2]=r[5941],r[i+4>>2]=r[5942],r[i+8>>2]=r[5943],r[i+12>>2]=r[5944],r[5941]=a,r[5942]=l,r[5944]=0,r[5943]=i,i=t+24|0;do{b=i,r[(i=i+4|0)>>2]=7}while((b+8|0)>>>0<w>>>0);if((0|t)!=(0|h)){if(a=t-h|0,r[n>>2]=-2&r[n>>2],r[h+4>>2]=1|a,r[t>>2]=a,i=a>>>3,a>>>0<256){n=23356+(i<<1<<2)|0,(t=0|r[5829])&(i=1<<i)?i=0|r[(t=n+8|0)>>2]:(r[5829]=t|i,i=n,t=n+8|0),r[t>>2]=h,r[i+12>>2]=h,r[h+8>>2]=i,r[h+12>>2]=n;break}if(n=23620+((s=(i=a>>>8)?a>>>0>16777215?31:a>>>(7+(s=14-((y=(520192+(w=i<<(b=(i+1048320|0)>>>16&8))|0)>>>16&4)|b|(s=(245760+(w<<=y)|0)>>>16&2))+(w<<s>>>15)|0)|0)&1|s<<1:0)<<2)|0,r[h+28>>2]=s,r[h+20>>2]=0,r[o>>2]=0,!((i=0|r[5830])&(t=1<<s))){r[5830]=i|t,r[n>>2]=h,r[h+24>>2]=n,r[h+12>>2]=h,r[h+8>>2]=h;break}i=0|r[n>>2];e:do{if((-8&r[i+4>>2]|0)!=(0|a)){for(s=a<<(31==(0|s)?0:25-(s>>>1)|0);t=0|r[(n=i+16+(s>>>31<<2)|0)>>2];){if((-8&r[t+4>>2]|0)==(0|a)){i=t;break e}s<<=1,i=t}r[n>>2]=h,r[h+24>>2]=i,r[h+12>>2]=h,r[h+8>>2]=h;break t}}while(0);r[12+(w=0|r[(b=i+8|0)>>2])>>2]=h,r[b>>2]=h,r[h+8>>2]=w,r[h+12>>2]=i,r[h+24>>2]=0}}else w=0|r[5833],0==(0|w)|a>>>0<w>>>0&&(r[5833]=a),r[5941]=a,r[5942]=l,r[5944]=0,r[5838]=r[5947],r[5837]=-1,r[5842]=23356,r[5841]=23356,r[5844]=23364,r[5843]=23364,r[5846]=23372,r[5845]=23372,r[5848]=23380,r[5847]=23380,r[5850]=23388,r[5849]=23388,r[5852]=23396,r[5851]=23396,r[5854]=23404,r[5853]=23404,r[5856]=23412,r[5855]=23412,r[5858]=23420,r[5857]=23420,r[5860]=23428,r[5859]=23428,r[5862]=23436,r[5861]=23436,r[5864]=23444,r[5863]=23444,r[5866]=23452,r[5865]=23452,r[5868]=23460,r[5867]=23460,r[5870]=23468,r[5869]=23468,r[5872]=23476,r[5871]=23476,r[5874]=23484,r[5873]=23484,r[5876]=23492,r[5875]=23492,r[5878]=23500,r[5877]=23500,r[5880]=23508,r[5879]=23508,r[5882]=23516,r[5881]=23516,r[5884]=23524,r[5883]=23524,r[5886]=23532,r[5885]=23532,r[5888]=23540,r[5887]=23540,r[5890]=23548,r[5889]=23548,r[5892]=23556,r[5891]=23556,r[5894]=23564,r[5893]=23564,r[5896]=23572,r[5895]=23572,r[5898]=23580,r[5897]=23580,r[5900]=23588,r[5899]=23588,r[5902]=23596,r[5901]=23596,r[5904]=23604,r[5903]=23604,w=l+-40|0,y=a+8|0,y=0==(7&y|0)?0:0-y&7,b=a+y|0,y=w-y|0,r[5835]=b,r[5832]=y,r[b+4>>2]=1|y,r[a+w+4>>2]=40,r[5836]=r[5951]}while(0);if((i=0|r[5832])>>>0>p>>>0)return r[5832]=y=i-p|0,r[5835]=b=(w=0|r[5835])+p|0,r[b+4>>2]=1|y,r[w+4>>2]=3|p,I=e,0|w+8}return r[(w=23312)>>2]=12,I=e,0}function de(t){var e=0,i=0,n=0,s=0,o=0,a=0,l=0,c=0;if(t|=0){s=0|r[5833],c=(i=t+-8|0)+(e=-8&(t=0|r[t+-4>>2]))|0;do{if(1&t)l=i,a=i;else{if(n=0|r[i>>2],!(3&t)||(o=n+e|0,(a=i+(0-n)|0)>>>0<s>>>0))return;if((0|r[5834])==(0|a)){if(3!=(3&(e=0|r[(t=c+4|0)>>2])|0)){l=a,e=o;break}return r[5831]=o,r[t>>2]=-2&e,r[a+4>>2]=1|o,void(r[a+o>>2]=o)}if(i=n>>>3,n>>>0<256){if((0|(e=0|r[a+12>>2]))==(0|(t=0|r[a+8>>2]))){r[5829]=r[5829]&~(1<<i),l=a,e=o;break}r[t+12>>2]=e,r[e+8>>2]=t,l=a,e=o;break}s=0|r[a+24>>2],t=0|r[a+12>>2];do{if((0|t)==(0|a)){if(t=0|r[(i=4+(e=a+16|0)|0)>>2])e=i;else if(!(t=0|r[e>>2])){t=0;break}for(;;)if(i=0|r[(n=t+20|0)>>2])t=i,e=n;else{if(!(i=0|r[(n=t+16|0)>>2]))break;t=i,e=n}r[e>>2]=0}else r[12+(l=0|r[a+8>>2])>>2]=t,r[t+8>>2]=l}while(0);if(s){if((0|r[(i=23620+((e=0|r[a+28>>2])<<2)|0)>>2])==(0|a)){if(r[i>>2]=t,!t){r[5830]=r[5830]&~(1<<e),l=a,e=o;break}}else if(r[((0|r[(l=s+16|0)>>2])==(0|a)?l:s+20|0)>>2]=t,!t){l=a,e=o;break}r[t+24>>2]=s,0|(i=0|r[(e=a+16|0)>>2])&&(r[t+16>>2]=i,r[i+24>>2]=t),(e=0|r[e+4>>2])?(r[t+20>>2]=e,r[e+24>>2]=t,l=a,e=o):(l=a,e=o)}else l=a,e=o}}while(0);if(!(a>>>0>=c>>>0)&&1&(n=0|r[(t=c+4|0)>>2])){if(2&n)r[t>>2]=-2&n,r[l+4>>2]=1|e,r[a+e>>2]=e,s=e;else{if((0|r[5835])==(0|c)){if(r[5832]=c=(0|r[5832])+e|0,r[5835]=l,r[l+4>>2]=1|c,(0|l)!=(0|r[5834]))return;return r[5834]=0,void(r[5831]=0)}if((0|r[5834])==(0|c))return r[5831]=c=(0|r[5831])+e|0,r[5834]=a,r[l+4>>2]=1|c,void(r[a+c>>2]=c);s=(-8&n)+e|0,i=n>>>3;do{if(n>>>0<256){if((0|(t=0|r[c+12>>2]))==(0|(e=0|r[c+8>>2]))){r[5829]=r[5829]&~(1<<i);break}r[e+12>>2]=t,r[t+8>>2]=e;break}o=0|r[c+24>>2],t=0|r[c+12>>2];do{if((0|t)==(0|c)){if(t=0|r[(i=4+(e=c+16|0)|0)>>2])e=i;else if(!(t=0|r[e>>2])){i=0;break}for(;;)if(i=0|r[(n=t+20|0)>>2])t=i,e=n;else{if(!(i=0|r[(n=t+16|0)>>2]))break;t=i,e=n}r[e>>2]=0,i=t}else r[12+(i=0|r[c+8>>2])>>2]=t,r[t+8>>2]=i,i=t}while(0);if(0|o){if((0|r[(e=23620+((t=0|r[c+28>>2])<<2)|0)>>2])==(0|c)){if(r[e>>2]=i,!i){r[5830]=r[5830]&~(1<<t);break}}else if(r[((0|r[(n=o+16|0)>>2])==(0|c)?n:o+20|0)>>2]=i,!i)break;r[i+24>>2]=o,0|(e=0|r[(t=c+16|0)>>2])&&(r[i+16>>2]=e,r[e+24>>2]=i),0|(t=0|r[t+4>>2])&&(r[i+20>>2]=t,r[t+24>>2]=i)}}while(0);if(r[l+4>>2]=1|s,r[a+s>>2]=s,(0|l)==(0|r[5834]))return void(r[5831]=s)}if(t=s>>>3,s>>>0<256)return i=23356+(t<<1<<2)|0,(e=0|r[5829])&(t=1<<t)?t=0|r[(e=i+8|0)>>2]:(r[5829]=e|t,t=i,e=i+8|0),r[e>>2]=l,r[t+12>>2]=l,r[l+8>>2]=t,void(r[l+12>>2]=i);n=(t=s>>>8)?s>>>0>16777215?31:s>>>(7+(n=14-((o=(520192+(c=t<<(a=(t+1048320|0)>>>16&8))|0)>>>16&4)|a|(n=(245760+(c<<=o)|0)>>>16&2))+(c<<n>>>15)|0)|0)&1|n<<1:0,t=23620+(n<<2)|0,r[l+28>>2]=n,r[l+20>>2]=0,r[l+16>>2]=0,e=0|r[5830],i=1<<n;t:do{if(e&i){t=0|r[t>>2];e:do{if((-8&r[t+4>>2]|0)!=(0|s)){for(n=s<<(31==(0|n)?0:25-(n>>>1)|0);e=0|r[(i=t+16+(n>>>31<<2)|0)>>2];){if((-8&r[e+4>>2]|0)==(0|s)){t=e;break e}n<<=1,t=e}r[i>>2]=l,r[l+24>>2]=t,r[l+12>>2]=l,r[l+8>>2]=l;break t}}while(0);r[12+(c=0|r[(a=t+8|0)>>2])>>2]=l,r[a>>2]=l,r[l+8>>2]=c,r[l+12>>2]=t,r[l+24>>2]=0}else r[5830]=e|i,r[t>>2]=l,r[l+24>>2]=t,r[l+12>>2]=l,r[l+8>>2]=l}while(0);if(r[5837]=c=(0|r[5837])-1|0,!(0|c)){for(t=23772;t=0|r[t>>2];)t=t+8|0;r[5837]=-1}}}}function pe(t,e){e|=0;var i=0;return(t|=0)?(i=0|_(e,t),(e|t)>>>0>65535&&(i=(0|(i>>>0)/(t>>>0))==(0|e)?i:-1)):i=0,!(t=0|ue(i))||!(3&r[t+-4>>2])||we(0|t,0,0|i),0|t}function fe(t,e,i,n){return w(0|(n=(e|=0)-(n|=0)-((i|=0)>>>0>(t|=0)>>>0|0)>>>0)),0|t-i>>>0}function me(t){return 0|((t|=0)?31-(0|b(t^t-1))|0:32)}function ge(t,e,i,n){var s,o;return o=I,I=I+16|0,function(t,e,i,n,s){s|=0;var o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0;if(u=t|=0,a=i|=0,l=p=n|=0,!(h=c=e|=0))return o=0!=(0|s),l?o?(r[s>>2]=0|t,r[s+4>>2]=0&e,s=0,w(0|(p=0)),0|s):(s=0,w(0|(p=0)),0|s):(o&&(r[s>>2]=(u>>>0)%(a>>>0),r[s+4>>2]=0),s=(u>>>0)/(a>>>0)>>>0,w(0|(p=0)),0|s);o=0==(0|l);do{if(a){if(!o){if((o=(0|b(0|l))-(0|b(0|h))|0)>>>0<=31){a=d=o+1|0,t=u>>>(d>>>0)&(e=o-31>>31)|h<<(l=31-o|0),e&=h>>>(d>>>0),o=0,l=u<<l;break}return s?(r[s>>2]=0|t,r[s+4>>2]=c|0&e,s=0,w(0|(p=0)),0|s):(s=0,w(0|(p=0)),0|s)}if((o=a-1|0)&a|0){a=l=33+(0|b(0|a))-(0|b(0|h))|0,t=(d=32-l|0)-1>>31&h>>>((f=l-32|0)>>>0)|(h<<d|u>>>(l>>>0))&(e=f>>31),e&=h>>>(l>>>0),o=u<<(m=64-l|0)&(c=d>>31),l=(h<<m|u>>>(f>>>0))&c|u<<d&l-33>>31;break}return 0|s&&(r[s>>2]=o&u,r[s+4>>2]=0),1==(0|a)?(m=0|t,w(0|(f=c|0&e)),0|m):(f=h>>>((m=0|me(0|a))>>>0)|0,m=h<<32-m|u>>>(m>>>0)|0,w(0|f),0|m)}if(o)return 0|s&&(r[s>>2]=(h>>>0)%(a>>>0),r[s+4>>2]=0),m=(h>>>0)/(a>>>0)>>>0,w(0|(f=0)),0|m;if(!u)return 0|s&&(r[s>>2]=0,r[s+4>>2]=(h>>>0)%(l>>>0)),m=(h>>>0)/(l>>>0)>>>0,w(0|(f=0)),0|m;if(!((o=l-1|0)&l))return 0|s&&(r[s>>2]=0|t,r[s+4>>2]=o&h|0&e),f=0,m=h>>>((0|me(0|l))>>>0),w(0|f),0|m;if((o=(0|b(0|l))-(0|b(0|h))|0)>>>0<=30){a=e=o+1|0,t=h<<(l=31-o|0)|u>>>(e>>>0),e=h>>>(e>>>0),o=0,l=u<<l;break}return s?(r[s>>2]=0|t,r[s+4>>2]=c|0&e,m=0,w(0|(f=0)),0|m):(m=0,w(0|(f=0)),0|m)}while(0);if(a){h=0|function(t,e,i,n){return w((e|=0)+(n|=0)+((i=(t|=0)+(i|=0)>>>0)>>>0<t>>>0|0)>>>0|0),0|i}(0|(d=0|i),0|(u=p|0&n),-1,-1),i=0|x(),c=l,l=0;do{n=c,c=o>>>31|c<<1,o=l|o<<1,fe(0|h,0|i,0|(n=t<<1|n>>>31|0),0|(p=t>>>31|e<<1|0)),l=1&(f=(m=0|x())>>31|((0|m)<0?-1:0)<<1),t=0|fe(0|n,0|p,f&d|0,(((0|m)<0?-1:0)>>31|((0|m)<0?-1:0)<<1)&u|0),e=0|x(),a=a-1|0}while(0!=(0|a));h=c,c=0}else h=l,c=0,l=0;a=0,0|s&&(r[s>>2]=t,r[s+4>>2]=e),m=-2&(o<<1|0)|l,w(0|(f=(0|o)>>>31|(h|a)<<1|0&(a<<1|o>>>31)|c))}(t|=0,e|=0,i|=0,n|=0,s=0|o),I=o,w(0|r[s+4>>2]),0|r[s>>2]}function Ae(t,e,i){return t|=0,e|=0,(0|(i|=0))<32?(w(e>>>i|0),t>>>i|(e&(1<<i)-1)<<32-i):(w(0),e>>>i-32|0)}function ve(t,e,i){return t|=0,(0|(i|=0))<32?(w((e|=0)<<i|(t&(1<<i)-1<<32-i)>>>32-i|0),t<<i):(w(t<<i-32|0),0)}function _e(t,e){return e=+e,(t=+t)!=t?+e:e!=e?+t:+y(+t,+e)}function ye(t){return(t=+t)>=0?+a(t+.5):+v(t-.5)}function be(t,e,i){t|=0,e|=0;var s,o,a=0;if((0|(i|=0))>=8192)return E(0|t,0|e,0|i),0|t;if(o=0|t,s=t+i|0,(3&t)==(3&e)){for(;3&t;){if(!i)return 0|o;n[t>>0]=0|n[e>>0],t=t+1|0,e=e+1|0,i=i-1|0}for(a=(i=-4&s|0)-64|0;(0|t)<=(0|a);)r[t>>2]=r[e>>2],r[t+4>>2]=r[e+4>>2],r[t+8>>2]=r[e+8>>2],r[t+12>>2]=r[e+12>>2],r[t+16>>2]=r[e+16>>2],r[t+20>>2]=r[e+20>>2],r[t+24>>2]=r[e+24>>2],r[t+28>>2]=r[e+28>>2],r[t+32>>2]=r[e+32>>2],r[t+36>>2]=r[e+36>>2],r[t+40>>2]=r[e+40>>2],r[t+44>>2]=r[e+44>>2],r[t+48>>2]=r[e+48>>2],r[t+52>>2]=r[e+52>>2],r[t+56>>2]=r[e+56>>2],r[t+60>>2]=r[e+60>>2],t=t+64|0,e=e+64|0;for(;(0|t)<(0|i);)r[t>>2]=r[e>>2],t=t+4|0,e=e+4|0}else for(i=s-4|0;(0|t)<(0|i);)n[t>>0]=0|n[e>>0],n[t+1>>0]=0|n[e+1>>0],n[t+2>>0]=0|n[e+2>>0],n[t+3>>0]=0|n[e+3>>0],t=t+4|0,e=e+4|0;for(;(0|t)<(0|s);)n[t>>0]=0|n[e>>0],t=t+1|0,e=e+1|0;return 0|o}function we(t,e,i){e|=0;var s,o=0,a=0,l=0;if(s=(t|=0)+(i|=0)|0,e&=255,(0|i)>=67){for(;3&t;)n[t>>0]=e,t=t+1|0;for(l=e|e<<8|e<<16|e<<24,a=(o=-4&s|0)-64|0;(0|t)<=(0|a);)r[t>>2]=l,r[t+4>>2]=l,r[t+8>>2]=l,r[t+12>>2]=l,r[t+16>>2]=l,r[t+20>>2]=l,r[t+24>>2]=l,r[t+28>>2]=l,r[t+32>>2]=l,r[t+36>>2]=l,r[t+40>>2]=l,r[t+44>>2]=l,r[t+48>>2]=l,r[t+52>>2]=l,r[t+56>>2]=l,r[t+60>>2]=l,t=t+64|0;for(;(0|t)<(0|o);)r[t>>2]=l,t=t+4|0}for(;(0|t)<(0|s);)n[t>>0]=e,t=t+1|0;return s-i|0}function xe(t){return(t=+t)>=0?+a(t+.5):+v(t-.5)}function Se(t){var e,i,n;return t|=0,n=0|k(),(0|t)>0&(0|(e=(i=0|r[o>>2])+t|0))<(0|i)|(0|e)<0?(T(0|e),C(12),-1):(0|e)>(0|n)&&!(0|M(0|e))?(C(12),-1):(r[o>>2]=e,0|i)}return{___uremdi3:ge,_bitshift64Lshr:Ae,_bitshift64Shl:ve,_calloc:pe,_cellAreaKm2:function(t,e){var i,n,s,o=0;if(s=I,I=I+192|0,n=s,zt(t|=0,e|=0,i=s+168|0),Vt(t,e,n),(0|(e=0|r[n>>2]))>0){if(o=+St(n+8|0,n+8+((1!=(0|e)&1)<<4)|0,i)+0,1!=(0|e)){t=1;do{o+=+St(n+8+(t<<4)|0,n+8+(((0|(t=t+1|0))%(0|e)|0)<<4)|0,i)}while((0|t)<(0|e))}}else o=0;return I=s,6371.007180918475*o*6371.007180918475},_cellAreaM2:function(t,e){var i,n,s,o=0;if(s=I,I=I+192|0,n=s,zt(t|=0,e|=0,i=s+168|0),Vt(t,e,n),(0|(e=0|r[n>>2]))>0){if(o=+St(n+8|0,n+8+((1!=(0|e)&1)<<4)|0,i)+0,1!=(0|e)){t=1;do{o+=+St(n+8+(t<<4)|0,n+8+(((0|(t=t+1|0))%(0|e)|0)<<4)|0,i)}while((0|t)<(0|e))}}else o=0;return I=s,6371.007180918475*o*6371.007180918475*1e3*1e3},_cellAreaRads2:function(t,e){var i,n,s,o=0;if(s=I,I=I+192|0,n=s,zt(t|=0,e|=0,i=s+168|0),Vt(t,e,n),(0|(e=0|r[n>>2]))<=0)return I=s,+(o=0);if(o=+St(n+8|0,n+8+((1!=(0|e)&1)<<4)|0,i)+0,1==(0|e))return I=s,+o;t=1;do{o+=+St(n+8+(t<<4)|0,n+8+(((0|(t=t+1|0))%(0|e)|0)<<4)|0,i)}while((0|t)<(0|e));return I=s,+o},_compact:function(t,e,i){e|=0;var n,s=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,y=0,b=0,w=0,S=0,C=0,k=0;if(!(i|=0))return 0;if(s=0|r[(o=t|=0)>>2],!0&0==(15728640&(o=0|r[o+4>>2])|0)){if((0|i)<=0||(r[(C=e)>>2]=s,r[C+4>>2]=o,1==(0|i)))return 0;s=1;do{S=0|r[4+(w=t+(s<<3)|0)>>2],r[(C=e+(s<<3)|0)>>2]=r[w>>2],r[C+4>>2]=S,s=s+1|0}while((0|s)!=(0|i));return 0}if(!(S=0|ue(w=i<<3)))return-3;if(be(0|S,0|t,0|w),!(n=0|pe(i,8)))return de(S),-3;s=i;t:for(;;){y=0|Ae(0|(d=0|r[(l=S)>>2]),0|(l=0|r[l+4>>2]),52),x(),b=(y&=15)-1|0,_=(0|s)>0;e:do{if(_){if(v=((0|s)<0)<<31>>31,g=0|ve(0|b,0,52),A=0|x(),b>>>0>15)for(o=0,t=d,i=l;;){if(!(0==(0|t)&0==(0|i))){if(a=0|Ae(0|t,0|i,52),x(),c=(0|(a&=15))<(0|b),a=(0|a)==(0|b),i=0|ge(0|(u=c?0:a?t:0),0|(t=c?0:a?i:0),0|s,0|v),x(),0==(0|(h=0|r[(c=a=n+(i<<3)|0)>>2]))&0==(0|(c=0|r[c+4>>2])))i=u;else for(g=0,m=i,f=c,i=u;;){if((0|g)>(0|s)){C=41;break t}if((0|h)==(0|i)&(-117440513&f|0)==(0|t)){u=0|Ae(0|h,0|f,56),x(),p=1+(u&=7)|0,A=0|Ae(0|h,0|f,45),x();i:do{if(0|L(127&A)){if(h=0|Ae(0|h,0|f,52),x(),!(h&=15)){c=6;break}for(c=1;;){if(!(0==((A=0|ve(7,0,3*(15-c|0)|0))&i|0)&0==((0|x())&t|0))){c=7;break i}if(!(c>>>0<h>>>0)){c=6;break}c=c+1|0}}else c=7}while(0);if((u+2|0)>>>0>c>>>0){C=51;break t}A=0|ve(0|p,0,56),t=0|x()|-117440513&t,r[(c=a)>>2]=0,r[c+4>>2]=0,c=m,i|=A}else c=(m+1|0)%(0|s)|0;if(0==(0|(h=0|r[(f=a=n+(c<<3)|0)>>2]))&0==(0|(f=0|r[f+4>>2])))break;g=g+1|0,m=c}r[(A=a)>>2]=i,r[A+4>>2]=t}if((0|(o=o+1|0))>=(0|s))break e;t=0|r[(i=S+(o<<3)|0)>>2],i=0|r[i+4>>2]}for(o=0,t=d,i=l;;){if(!(0==(0|t)&0==(0|i))){if(c=0|Ae(0|t,0|i,52),x(),(0|(c&=15))>=(0|b)){if((0|c)!=(0|b)&&(t|=g,i=-15728641&i|A,c>>>0>=y>>>0)){a=b;do{m=0|ve(7,0,3*(14-a|0)|0),a=a+1|0,t|=m,i=0|x()|i}while(a>>>0<c>>>0)}}else t=0,i=0;if(c=0|ge(0|t,0|i,0|s,0|v),x(),!(0==(0|(u=0|r[(h=a=n+(c<<3)|0)>>2]))&0==(0|(h=0|r[h+4>>2]))))for(m=0;;){if((0|m)>(0|s)){C=41;break t}if((0|u)==(0|t)&(-117440513&h|0)==(0|i)){p=0|Ae(0|u,0|h,56),x(),f=1+(p&=7)|0,k=0|Ae(0|u,0|h,45),x();i:do{if(0|L(127&k)){if(u=0|Ae(0|u,0|h,52),x(),!(u&=15)){h=6;break}for(h=1;;){if(!(0==((k=0|ve(7,0,3*(15-h|0)|0))&t|0)&0==((0|x())&i|0))){h=7;break i}if(!(h>>>0<u>>>0)){h=6;break}h=h+1|0}}else h=7}while(0);if((p+2|0)>>>0>h>>>0){C=51;break t}k=0|ve(0|f,0,56),i=0|x()|-117440513&i,r[(f=a)>>2]=0,r[f+4>>2]=0,t|=k}else c=(c+1|0)%(0|s)|0;if(0==(0|(u=0|r[(h=a=n+(c<<3)|0)>>2]))&0==(0|(h=0|r[h+4>>2])))break;m=m+1|0}r[(k=a)>>2]=t,r[k+4>>2]=i}if((0|(o=o+1|0))>=(0|s))break e;t=0|r[(i=S+(o<<3)|0)>>2],i=0|r[i+4>>2]}}}while(0);if((s+5|0)>>>0<11){C=99;break}if(!(A=0|pe((0|s)/6|0,8))){C=58;break}e:do{if(_){m=0,f=0;do{if(!(0==(0|(o=0|r[(t=c=n+(m<<3)|0)>>2]))&0==(0|(t=0|r[t+4>>2])))){h=0|Ae(0|o,0|t,56),x(),i=1+(h&=7)|0,u=-117440513&t,k=0|Ae(0|o,0|t,45),x();i:do{if(0|L(127&k)){if(p=0|Ae(0|o,0|t,52),x(),0|(p&=15))for(a=1;;){if(!(0==(o&(k=0|ve(7,0,3*(15-a|0)|0))|0)&0==(u&(0|x())|0)))break i;if(!(a>>>0<p>>>0))break;a=a+1|0}o|=t=0|ve(0|i,0,56),t=0|x()|u,r[(i=c)>>2]=o,r[i+4>>2]=t,i=h+2|0}}while(0);7==(0|i)&&(r[(k=A+(f<<3)|0)>>2]=o,r[k+4>>2]=-117440513&t,f=f+1|0)}m=m+1|0}while((0|m)!=(0|s));if(_){if(g=((0|s)<0)<<31>>31,p=0|ve(0|b,0,52),m=0|x(),b>>>0>15)for(t=0,o=0;;){do{if(!(0==(0|d)&0==(0|l))){for(h=0|Ae(0|d,0|l,52),x(),a=(0|(h&=15))<(0|b),h=(0|h)==(0|b),a=0|ge(0|(c=a?0:h?d:0),0|(h=a?0:h?l:0),0|s,0|g),x(),i=0;;){if((0|i)>(0|s)){C=98;break t}if((-117440513&(u=0|r[4+(k=n+(a<<3)|0)>>2])|0)==(0|h)&&(0|r[k>>2])==(0|c)){C=70;break}if((0|r[(k=n+((a=(a+1|0)%(0|s)|0)<<3)|0)>>2])==(0|c)&&(0|r[k+4>>2])==(0|h))break;i=i+1|0}if(70==(0|C)&&(C=0,!0&100663296==(117440512&u|0)))break;r[(k=e+(o<<3)|0)>>2]=d,r[k+4>>2]=l,o=o+1|0}}while(0);if((0|(t=t+1|0))>=(0|s)){s=f;break e}d=0|r[(l=S+(t<<3)|0)>>2],l=0|r[l+4>>2]}for(t=0,o=0;;){do{if(!(0==(0|d)&0==(0|l))){if(h=0|Ae(0|d,0|l,52),x(),(0|(h&=15))>=(0|b))if((0|h)!=(0|b))if(i=d|p,a=-15728641&l|m,h>>>0<y>>>0)h=a;else{c=b;do{k=0|ve(7,0,3*(14-c|0)|0),c=c+1|0,i|=k,a=0|x()|a}while(c>>>0<h>>>0);h=a}else i=d,h=l;else i=0,h=0;for(c=0|ge(0|i,0|h,0|s,0|g),x(),a=0;;){if((0|a)>(0|s)){C=98;break t}if((-117440513&(u=0|r[4+(k=n+(c<<3)|0)>>2])|0)==(0|h)&&(0|r[k>>2])==(0|i)){C=93;break}if((0|r[(k=n+((c=(c+1|0)%(0|s)|0)<<3)|0)>>2])==(0|i)&&(0|r[k+4>>2])==(0|h))break;a=a+1|0}if(93==(0|C)&&(C=0,!0&100663296==(117440512&u|0)))break;r[(k=e+(o<<3)|0)>>2]=d,r[k+4>>2]=l,o=o+1|0}}while(0);if((0|(t=t+1|0))>=(0|s)){s=f;break e}d=0|r[(l=S+(t<<3)|0)>>2],l=0|r[l+4>>2]}}else o=0,s=f}else o=0,s=0}while(0);if(we(0|n,0,0|w),be(0|S,0|A,s<<3|0),de(A),!s)break;e=e+(o<<3)|0}return 41==(0|C)?(de(S),de(n),0|(k=-1)):51==(0|C)?(de(S),de(n),0|(k=-2)):58==(0|C)?(de(S),de(n),0|(k=-3)):98==(0|C)?(de(A),de(S),de(n),0|(k=-1)):(99==(0|C)&&be(0|e,0|S,s<<3|0),de(S),de(n),0|(k=0))},_destroyLinkedPolygon:function(t){var e=0,i=0,n=0,s=0;if(t|=0)for(n=1;;){if(0|(e=0|r[t>>2]))do{if(0|(i=0|r[e>>2]))do{s=i,i=0|r[i+16>>2],de(s)}while(0!=(0|i));s=e,e=0|r[e+8>>2],de(s)}while(0!=(0|e));if(e=t,t=0|r[t+8>>2],n||de(e),!t)break;n=0}},_edgeLengthKm:function(t){return+ +s[20752+((t|=0)<<3)>>3]},_edgeLengthM:function(t){return+ +s[20880+((t|=0)<<3)>>3]},_emscripten_replace_memory:function(t){return n=new Int8Array(t),new Uint8Array(t),r=new Int32Array(t),new Float32Array(t),s=new Float64Array(t),i=t,!0},_exactEdgeLengthKm:function(t,e){var i,n,o=0,a=0,l=0,h=0,p=0,f=0;if(n=I,I=I+176|0,Ut(t|=0,e|=0,i=n),(0|(t=0|r[i>>2]))<=1)return I=n,+(l=0);e=t+-1|0,t=0,o=0,a=+s[i+8>>3],l=+s[i+16>>3];do{p=a,h=l,h=(f=+d(.5*((a=+s[i+8+((t=t+1|0)<<4)>>3])-p)))*f+(h=+d(.5*((l=+s[i+8+(t<<4)+8>>3])-h)))*(+u(+p)*+u(+a)*h),o+=2*+A(+ +c(+h),+ +c(+(1-h)))}while((0|t)!=(0|e));return I=n,+(f=6371.007180918475*o)},_exactEdgeLengthM:function(t,e){var i,n,o=0,a=0,l=0,h=0,p=0,f=0;if(n=I,I=I+176|0,Ut(t|=0,e|=0,i=n),(0|(t=0|r[i>>2]))<=1)return I=n,+(l=0);e=t+-1|0,t=0,o=0,a=+s[i+8>>3],l=+s[i+16>>3];do{p=a,h=l,h=(f=+d(.5*((a=+s[i+8+((t=t+1|0)<<4)>>3])-p)))*f+(h=+d(.5*((l=+s[i+8+(t<<4)+8>>3])-h)))*(+u(+p)*+u(+a)*h),o+=2*+A(+ +c(+h),+ +c(+(1-h)))}while((0|t)!=(0|e));return I=n,+(f=6371.007180918475*o*1e3)},_exactEdgeLengthRads:function(t,e){var i,n,o=0,a=0,l=0,h=0,p=0,f=0;if(n=I,I=I+176|0,Ut(t|=0,e|=0,i=n),(0|(t=0|r[i>>2]))<=1)return I=n,+(l=0);e=t+-1|0,t=0,o=0,a=+s[i+8>>3],l=+s[i+16>>3];do{p=a,h=l,h=(f=+d(.5*((a=+s[i+8+((t=t+1|0)<<4)>>3])-p)))*f+(h=+d(.5*((l=+s[i+8+(t<<4)+8>>3])-h)))*(+u(+a)*+u(+p)*h),o+=2*+A(+ +c(+h),+ +c(+(1-h)))}while((0|t)<(0|e));return I=n,+o},_experimentalH3ToLocalIj:function(t,e,i,n,s){var o,a;return s|=0,a=I,I=I+16|0,(t=0|Yt(t|=0,e|=0,i|=0,n|=0,o=a))||(function(t,e){var i;r[(e|=0)>>2]=(0|r[(t|=0)>>2])-(i=0|r[t+8>>2]),r[e+4>>2]=(0|r[t+4>>2])-i}(o,s),t=0),I=a,0|t},_experimentalLocalIjToH3:function(t,e,i,n){var s,o;return t|=0,e|=0,n|=0,s=I,I=I+16|0,function(t,e){var i,n,s,o=0,a=0,l=0;r[(e|=0)>>2]=a=0|r[(t|=0)>>2],r[(n=e+4|0)>>2]=t=0|r[t+4>>2],r[(s=e+8|0)>>2]=0,o=t-a|0,(0|a)<0?(t=0-a|0,r[n>>2]=o,r[s>>2]=t,r[e>>2]=0,a=0):(o=t,t=0),(0|o)<0&&(r[e>>2]=a=a-o|0,r[s>>2]=t=t-o|0,r[n>>2]=0,o=0),i=a-t|0,l=o-t|0,(0|t)<0?(r[e>>2]=i,r[n>>2]=l,r[s>>2]=0,o=l,l=i,t=0):l=a,!((0|(a=(0|t)<(0|(a=(0|o)<(0|l)?o:l))?t:a))<=0)&&(r[e>>2]=l-a,r[n>>2]=o-a,r[s>>2]=t-a)}(i|=0,o=s),n=0|Zt(t,e,o,n),I=s,0|n},_free:de,_geoToH3:Lt,_getDestinationH3IndexFromUnidirectionalEdge:function(t,e){t|=0;var i,n=0,s=0;return i=I,I=I+16|0,n=i,!0&268435456==(2013265920&(e|=0)|0)?(s=0|Ae(0|t,0|e,56),x(),r[n>>2]=0,n=0|R(t,-2130706433&e|134217728,7&s,n),e=0|x(),w(0|e),I=i,0|n):(n=0,w(0|(e=0)),I=i,0|n)},_getH3IndexesFromUnidirectionalEdge:function(t,e,i){t|=0;var n,s,o,a,l=0;o=I,I=I+16|0,n=o,s=-2130706433&(e|=0)|134217728,r[(l=i|=0)>>2]=(a=!0&268435456==(2013265920&e|0))?t:0,r[l+4>>2]=a?s:0,a?(e=0|Ae(0|t,0|e,56),x(),r[n>>2]=0,t=0|R(t,s,7&e,n),e=0|x()):(t=0,e=0),r[(l=i+8|0)>>2]=t,r[l+4>>2]=e,I=o},_getH3UnidirectionalEdge:function(t,e,i,n){var s,o,a=0,l=0,c=0,h=0,u=0;if(o=I,I=I+16|0,s=o,!(0|$t(t|=0,e|=0,i|=0,n|=0)))return h=0,w(0|(c=0)),I=o,0|h;for(c=-2130706433&e,a=(a=0==(0|Tt(t,e)))?1:2;r[s>>2]=0,l=a+1|0,!((0|(u=0|R(t,e,a,s)))==(0|i)&(0|x())==(0|n));){if(!(l>>>0<7)){a=0,t=0,h=6;break}a=l}return 6==(0|h)?(w(0|a),I=o,0|t):(u=0|ve(0|a,0,56),h=0|c|x()|268435456,u|=t,w(0|h),I=o,0|u)},_getH3UnidirectionalEdgeBoundary:Ut,_getH3UnidirectionalEdgesFromHexagon:function(t,e,i){i|=0;var n,s=0;n=0==(0|Tt(t|=0,e|=0)),e&=-2130706433,r[(s=i)>>2]=n?t:0,r[s+4>>2]=n?285212672|e:0,r[(s=i+8|0)>>2]=t,r[s+4>>2]=301989888|e,r[(s=i+16|0)>>2]=t,r[s+4>>2]=318767104|e,r[(s=i+24|0)>>2]=t,r[s+4>>2]=335544320|e,r[(s=i+32|0)>>2]=t,r[s+4>>2]=352321536|e,r[(i=i+40|0)>>2]=t,r[i+4>>2]=369098752|e},_getOriginH3IndexFromUnidirectionalEdge:function(t,e){var i;return t|=0,w(0|((i=!0&268435456==(2013265920&(e|=0)|0))?-2130706433&e|134217728:0)),0|(i?t:0)},_getPentagonIndexes:jt,_getRes0Indexes:function(t){t|=0;var e=0,i=0,n=0;e=0;do{ve(0|e,0,45),n=134225919|x(),r[(i=t+(e<<3)|0)>>2]=-1,r[i+4>>2]=n,e=e+1|0}while(122!=(0|e))},_h3Distance:function(t,e,i,n){var r,s,o;return i|=0,n|=0,o=I,I=I+32|0,s=o,t=0==(0|Yt(t|=0,e|=0,t,e,r=o+12|0))&&0==(0|Yt(t,e,i,n,s))?0|ut(r,s):-1,I=o,0|t},_h3GetBaseCell:Ct,_h3GetFaces:function t(e,i,n){n|=0;var s,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0;s=I,I=I+128|0,d=s+112|0,l=s+96|0,p=s,a=0|Ae(0|(e|=0),0|(i|=0),52),x(),r[d>>2]=h=15&a,c=0|Ae(0|e,0|i,45),x(),c&=127;t:do{if(0|L(c)){if(0|h)for(o=1;;){if(!(0==((u=0|ve(7,0,3*(15-o|0)|0))&e|0)&0==((0|x())&i|0))){a=0;break t}if(!(o>>>0<h>>>0))break;o=o+1|0}if(!(1&a))return u=0|ve(h+1|0,0,52),p=0|x()|-15728641&i,t((u|e)&~(d=0|ve(7,0,3*(14-h|0)|0)),p&~(0|x()),n),void(I=s);a=1}else a=0}while(0);Nt(e,i,l),a?(gt(l,d,p),u=5):(yt(l,d,p),u=6);t:do{if(0|L(c))if(h)for(o=1;;){if(!(0==((c=0|ve(7,0,3*(15-o|0)|0))&e|0)&0==((0|x())&i|0))){o=8;break t}if(!(o>>>0<h>>>0)){o=20;break}o=o+1|0}else o=20;else o=8}while(0);if(we(0|n,-1,0|o),a){a=0;do{for(vt(l=p+(a<<4)|0,0|r[d>>2]),l=0|r[l>>2],o=0;!(-1==(0|(h=0|r[(c=n+(o<<2)|0)>>2]))|(0|h)==(0|l));)o=o+1|0;r[c>>2]=l,a=a+1|0}while((0|a)!=(0|u))}else{a=0;do{for(At(l=p+(a<<4)|0,0|r[d>>2],0,1),l=0|r[l>>2],o=0;!(-1==(0|(h=0|r[(c=n+(o<<2)|0)>>2]))|(0|h)==(0|l));)o=o+1|0;r[c>>2]=l,a=a+1|0}while((0|a)!=(0|u))}I=s},_h3GetResolution:function(t,e){return e=0|Ae(0|(t|=0),0|(e|=0),52),x(),15&e|0},_h3IndexesAreNeighbors:$t,_h3IsPentagon:Tt,_h3IsResClassIII:function(t,e){return e=0|Ae(0|(t|=0),0|(e|=0),52),x(),1&e|0},_h3IsValid:kt,_h3Line:function(t,e,i,n,s){i|=0,n|=0,s|=0;var o,a=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,y=0,b=0,w=0,x=0,S=0;if(o=I,I=I+48|0,c=o+12|0,x=o,0==(0|Yt(t|=0,e|=0,t,e,a=o+24|0))&&0==(0|Yt(t,e,i,n,c))){if((0|(w=0|ut(a,c)))<0)return I=o,0|w;for(r[a>>2]=0,r[a+4>>2]=0,r[a+8>>2]=0,r[c>>2]=0,r[c+4>>2]=0,r[c+8>>2]=0,Yt(t,e,t,e,a),Yt(t,e,i,n,c),dt(a),dt(c),w?(b=a,i=p=0|r[a>>2],n=f=0|r[(_=a+4|0)>>2],a=m=0|r[(y=a+8|0)>>2],A=+((0|r[c>>2])-p|0)/(g=+(0|w)),v=+((0|r[c+4>>2])-f|0)/g,g=+((0|r[c+8>>2])-m|0)/g):(_=n=a+4|0,y=m=a+8|0,b=a,i=0|r[a>>2],n=0|r[n>>2],a=0|r[m>>2],A=0,v=0,g=0),r[x>>2]=i,r[(m=x+4|0)>>2]=n,r[(f=x+8|0)>>2]=a,p=0;;){S=A*(u=+(0|p))+ +(0|i),h=v*u+ +(0|r[_>>2]),u=g*u+ +(0|r[y>>2]),n=~~+ye(+S),c=~~+ye(+h),i=~~+ye(+u),S=+l(+(+(0|n)-S)),h=+l(+(+(0|c)-h)),u=+l(+(+(0|i)-u));do{if(!(S>h&S>u)){if(d=0-n|0,h>u){a=d-i|0;break}a=c,i=d-c|0;break}n=0-(c+i)|0,a=c}while(0);if(r[x>>2]=n,r[m>>2]=a,r[f>>2]=i,pt(x),Zt(t,e,x,s+(p<<3)|0),(0|p)==(0|w))break;p=p+1|0,i=0|r[b>>2]}return I=o,0}return I=o,-1},_h3LineSize:function(t,e,i,n){var r,s,o;return i|=0,n|=0,o=I,I=I+32|0,s=o,t=0==(0|Yt(t|=0,e|=0,t,e,r=o+12|0))&&0==(0|Yt(t,e,i,n,s))?0|ut(r,s):-1,I=o,(t>>>31^1)+t|0},_h3SetToLinkedGeo:function(t,e,i){i|=0;var n,s,o,a=0;if(o=I,I=I+32|0,n=o,function(t,e,i){t|=0,i|=0;var n,s,o=0,a=0,l=0,c=0,h=0;if(s=I,I=I+176|0,n=s,(0|(e|=0))<1)return ne(i,0,0),void(I=s);c=0|Ae(0|r[(c=t)>>2],0|r[c+4>>2],52),x(),ne(i,(0|e)>6?e:6,15&c),c=0;do{if(Vt(0|r[(o=t+(c<<3)|0)>>2],0|r[o+4>>2],n),(0|(o=0|r[n>>2]))>0){h=0;do{l=n+8+(h<<4)|0,(a=0|le(i,o=n+8+(((0|(h=h+1|0))%(0|o)|0)<<4)|0,l))?oe(i,a):ae(i,l,o),o=0|r[n>>2]}while((0|h)<(0|o))}c=c+1|0}while((0|c)!=(0|e));I=s}(t|=0,e|=0,s=o+16|0),r[i>>2]=0,r[i+4>>2]=0,r[i+8>>2]=0,!(t=0|se(s)))return qt(i),re(s),void(I=o);do{e=0|Ht(i);do{Gt(e,t),r[n>>2]=r[(a=t+16|0)>>2],r[n+4>>2]=r[a+4>>2],r[n+8>>2]=r[a+8>>2],r[n+12>>2]=r[a+12>>2],oe(s,t),t=0|ce(s,n)}while(0!=(0|t));t=0|se(s)}while(0!=(0|t));qt(i),re(s),I=o},_h3ToCenterChild:function(t,e,i){i|=0;var n=0,r=0;if(n=0|Ae(0|(t|=0),0|(e|=0),52),x(),(0|i)<16&(0|(n&=15))<=(0|i)){if((0|n)!=(0|i)&&(t|=r=0|ve(0|i,0,52),e=0|x()|-15728641&e,(0|n)<(0|i)))do{r=0|ve(7,0,3*(14-n|0)|0),n=n+1|0,t&=~r,e&=~(0|x())}while((0|n)<(0|i))}else e=0,t=0;return w(0|e),0|t},_h3ToChildren:Mt,_h3ToGeo:zt,_h3ToGeoBoundary:Vt,_h3ToParent:Et,_h3UnidirectionalEdgeIsValid:function(t,e){var i=0;if(!(!0&268435456==(2013265920&(e|=0)|0)))return 0;switch(i=0|Ae(0|(t|=0),0|e,56),x(),7&i){case 0:case 7:return 0}return!0&16777216==(117440512&e|0)&0!=(0|Tt(t,i=-2130706433&e|134217728))?0|(i=0):0|(i=0|kt(t,i))},_hexAreaKm2:function(t){return+ +s[20496+((t|=0)<<3)>>3]},_hexAreaM2:function(t){return+ +s[20624+((t|=0)<<3)>>3]},_hexRing:function(t,e,i,n){t|=0,e|=0,n|=0;var s,o=0,a=0,l=0,c=0,h=0,u=0,d=0;if(s=I,I=I+16|0,d=s,!(i|=0))return r[(d=n)>>2]=t,r[d+4>>2]=e,I=s,0;r[d>>2]=0;t:do{if(0|Tt(t,e))t=1;else{if(a=(0|i)>0){o=0,u=t;do{if(0==(0|(u=0|R(u,e,4,d)))&0==(0|(e=0|x()))){t=2;break t}if(o=o+1|0,0|Tt(u,e)){t=1;break t}}while((0|o)<(0|i));if(r[(h=n)>>2]=u,r[h+4>>2]=e,h=i+-1|0,a){a=0,l=1,o=u,t=e;do{if(0==(0|(o=0|R(o,t,2,d)))&0==(0|(t=0|x()))){t=2;break t}if(r[(c=n+(l<<3)|0)>>2]=o,r[c+4>>2]=t,l=l+1|0,0|Tt(o,t)){t=1;break t}a=a+1|0}while((0|a)<(0|i));c=0,a=l;do{if(0==(0|(o=0|R(o,t,3,d)))&0==(0|(t=0|x()))){t=2;break t}if(r[(l=n+(a<<3)|0)>>2]=o,r[l+4>>2]=t,a=a+1|0,0|Tt(o,t)){t=1;break t}c=c+1|0}while((0|c)<(0|i));l=0;do{if(0==(0|(o=0|R(o,t,1,d)))&0==(0|(t=0|x()))){t=2;break t}if(r[(c=n+(a<<3)|0)>>2]=o,r[c+4>>2]=t,a=a+1|0,0|Tt(o,t)){t=1;break t}l=l+1|0}while((0|l)<(0|i));l=0;do{if(0==(0|(o=0|R(o,t,5,d)))&0==(0|(t=0|x()))){t=2;break t}if(r[(c=n+(a<<3)|0)>>2]=o,r[c+4>>2]=t,a=a+1|0,0|Tt(o,t)){t=1;break t}l=l+1|0}while((0|l)<(0|i));l=0;do{if(0==(0|(o=0|R(o,t,4,d)))&0==(0|(t=0|x()))){t=2;break t}if(r[(c=n+(a<<3)|0)>>2]=o,r[c+4>>2]=t,a=a+1|0,0|Tt(o,t)){t=1;break t}l=l+1|0}while((0|l)<(0|i));for(l=0;;){if(0==(0|(o=0|R(o,t,6,d)))&0==(0|(t=0|x()))){t=2;break t}if((0|l)!=(0|h)){if(r[(c=n+(a<<3)|0)>>2]=o,r[c+4>>2]=t,0|Tt(o,t)){t=1;break t}a=a+1|0}if((0|(l=l+1|0))>=(0|i)){l=u,a=e;break}}}else l=u,o=u,a=e,t=e}else r[(l=n)>>2]=t,r[l+4>>2]=e,l=t,o=t,a=e,t=e;t=1&((0|l)!=(0|o)|(0|a)!=(0|t))}}while(0);return I=s,0|t},_i64Subtract:fe,_kRing:O,_kRingDistances:function(t,e,i,n,r){var s=0;if(0|P(t|=0,e|=0,i|=0,n|=0,r|=0)){if(we(0|n,0,(s=1+(0|_(3*i|0,i+1|0))|0)<<3|0),0|r)return we(0|r,0,s<<2|0),void D(t,e,i,n,r,s,0);(r=0|pe(s,4))&&(D(t,e,i,n,r,s,0),de(r))}},_llvm_minnum_f64:_e,_llvm_round_f64:ye,_malloc:ue,_maxFaceCount:function(t,e){var i=0,n=0;if(n=0|Ae(0|(t|=0),0|(e|=0),45),x(),!(0|L(127&n)))return 2;if(n=0|Ae(0|t,0|e,52),x(),!(n&=15))return 5;for(i=1;;){if(!(0==((0|ve(7,0,3*(15-i|0)|0))&t|0)&0==((0|x())&e|0))){i=2,t=6;break}if(!(i>>>0<n>>>0)){i=5,t=6;break}i=i+1|0}return 6==(0|t)?0|i:0},_maxH3ToChildrenSize:function(t,e,i){return i|=0,t=0|Ae(0|(t|=0),0|(e|=0),52),x(),(0|i)<16&(0|(t&=15))<=(0|i)?0|(i=0|Xt(7,i-t|0)):0|(i=0)},_maxKringSize:function(t){return 1+(0|_(3*(t|=0)|0,t+1|0))|0},_maxPolyfillSize:function(t,e){e|=0;var i,n=0,s=0,o=0,a=0,l=0;if(i=I,I=I+48|0,o=i+8|0,a=0|r[4+(l=t|=0)>>2],r[(n=s=i)>>2]=r[l>>2],r[n+4>>2]=a,Qt(s,o),o=0|G(o,e),e=0|r[s>>2],(0|(s=0|r[t+8>>2]))<=0)return I=i,0|(l=(a=(0|o)<(0|(l=e)))?l:o)+12;n=0|r[t+12>>2],t=0;do{e=(0|r[n+(t<<3)>>2])+e|0,t=t+1|0}while((0|t)<(0|s));return I=i,0|(l=(l=(0|o)<(0|e))?e:o)+12},_maxUncompactSize:function(t,e,i){t|=0;var n=0,s=0,o=0,a=0;if((0|(e|=0))<=0)return 0;if((0|(i|=0))>=16){for(n=0;;){if(!(0==(0|r[(a=t+(n<<3)|0)>>2])&0==(0|r[a+4>>2]))){n=-1,s=13;break}if((0|(n=n+1|0))>=(0|e)){n=0,s=13;break}}if(13==(0|s))return 0|n}n=0,a=0;t:for(;;){o=0|r[(s=t+(a<<3)|0)>>2],s=0|r[s+4>>2];do{if(!(0==(0|o)&0==(0|s))){if(s=0|Ae(0|o,0|s,52),x(),(0|(s&=15))>(0|i)){n=-1,s=13;break t}if((0|s)==(0|i)){n=n+1|0;break}n=(0|Xt(7,i-s|0))+n|0;break}}while(0);if((0|(a=a+1|0))>=(0|e)){s=13;break}}return 13==(0|s)?0|n:0},_memcpy:be,_memset:we,_numHexagons:function(t){var e;return t=0|r[(e=21008+((t|=0)<<3)|0)>>2],w(0|r[e+4>>2]),0|t},_pentagonIndexCount:function(){return 12},_pointDistKm:xt,_pointDistM:function(t,e){var i,n,r,o=0;return o=(r=+d(.5*((n=+s[(e|=0)>>3])-(i=+s[(t|=0)>>3]))))*r+(o=+d(.5*(+s[e+8>>3]-+s[t+8>>3])))*(+u(+n)*+u(+i)*o),2*+A(+ +c(+o),+ +c(+(1-o)))*6371.007180918475*1e3},_pointDistRads:function(t,e){var i,n,r,o=0;return o=(r=+d(.5*((n=+s[(e|=0)>>3])-(i=+s[(t|=0)>>3]))))*r+(o=+d(.5*(+s[e+8>>3]-+s[t+8>>3])))*(+u(+n)*+u(+i)*o),2*+A(+ +c(+o),+ +c(+(1-o)))},_polyfill:function(t,e,i){var n,o=0,a=0,c=0,h=0,u=0;if(n=I,I=I+48|0,o=n+8|0,a=n,0|function(t,e,i){e|=0,i|=0;var n,o,a,c,h,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,y=0,b=0,w=0,C=0,k=0,E=0,M=0,T=0,O=0,R=0,L=0,B=0,N=0,z=0,V=0,j=0;if(h=I,I=I+112|0,o=h+80|0,g=h+72|0,a=h,c=h+56|0,(j=0|ue(32+(r[(A=8+(t|=0)|0)>>2]<<5)|0))||S(22848,22448,800,22456),function(t,e){e|=0;var i=0,n=0,o=0,a=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,y=0,b=0,w=0,x=0,S=0,C=0,k=0;if(A=0|r[(t|=0)>>2]){if(s[(v=e+8|0)>>3]=17976931348623157e292,s[(_=e+24|0)>>3]=17976931348623157e292,s[e>>3]=-17976931348623157e292,s[(y=e+16|0)>>3]=-17976931348623157e292,(0|A)>0){for(o=0|r[t+4>>2],m=17976931348623157e292,g=-17976931348623157e292,n=0,i=-1,u=17976931348623157e292,d=17976931348623157e292,f=-17976931348623157e292,c=-17976931348623157e292,b=0;p=+s[o+(b<<4)+8>>3],h=+s[o+(((0|(C=i+2|0))==(0|A)?0:C)<<4)+8>>3],(a=+s[o+(b<<4)>>3])<u&&(s[v>>3]=a,u=a),p<d&&(s[_>>3]=p,d=p),a>f?s[e>>3]=a:a=f,p>c&&(s[y>>3]=p,c=p),m=p>0&p<m?p:m,g=p<0&p>g?p:g,n|=+l(+(p-h))>3.141592653589793,(0|(i=b+1|0))!=(0|A);)C=b,f=a,b=i,i=C;n&&(s[y>>3]=g,s[_>>3]=m)}}else r[e>>2]=0,r[e+4>>2]=0,r[e+8>>2]=0,r[e+12>>2]=0,r[e+16>>2]=0,r[e+20>>2]=0,r[e+24>>2]=0,r[e+28>>2]=0;if(!((0|(i=0|r[(C=t+8|0)>>2]))<=0)){S=t+12|0,x=0;do{if(n=x,_=e+((x=x+1|0)<<5)|0,y=0|r[(o=0|r[S>>2])+(n<<3)>>2]){if(s[(b=e+(x<<5)+8|0)>>3]=17976931348623157e292,s[(t=e+(x<<5)+24|0)>>3]=17976931348623157e292,s[_>>3]=-17976931348623157e292,s[(w=e+(x<<5)+16|0)>>3]=-17976931348623157e292,(0|y)>0){for(A=0|r[o+(n<<3)+4>>2],m=17976931348623157e292,g=-17976931348623157e292,o=0,n=-1,v=0,u=17976931348623157e292,d=17976931348623157e292,p=-17976931348623157e292,c=-17976931348623157e292;f=+s[A+(v<<4)+8>>3],h=+s[A+(((0|(n=n+2|0))==(0|y)?0:n)<<4)+8>>3],(a=+s[A+(v<<4)>>3])<u&&(s[b>>3]=a,u=a),f<d&&(s[t>>3]=f,d=f),a>p?s[_>>3]=a:a=p,f>c&&(s[w>>3]=f,c=f),m=f>0&f<m?f:m,g=f<0&f>g?f:g,o|=+l(+(f-h))>3.141592653589793,(0|(n=v+1|0))!=(0|y);)k=v,v=n,p=a,n=k;o&&(s[w>>3]=g,s[t>>3]=m)}}else r[_>>2]=0,r[_+4>>2]=0,r[_+8>>2]=0,r[_+12>>2]=0,r[_+16>>2]=0,r[_+20>>2]=0,r[_+24>>2]=0,r[_+28>>2]=0,i=0|r[C>>2]}while((0|x)<(0|i))}}(t,j),u=0|r[(p=t)+4>>2],r[(m=g)>>2]=r[p>>2],r[m+4>>2]=u,Qt(g,o),m=0|G(o,e),u=0|r[g>>2],(0|(p=0|r[A>>2]))>0){f=0|r[t+12>>2],d=0;do{u=(0|r[f+(d<<3)>>2])+u|0,d=d+1|0}while((0|d)!=(0|p))}if(d=0|pe(n=(m=(0|m)<(0|u)?u:m)+12|0,8),v=0|pe(n,8),r[o>>2]=0,V=0|r[(z=t)+4>>2],r[(u=g)>>2]=r[z>>2],r[u+4>>2]=V,0|(u=0|F(g,n,e,o,d,v)))return de(d),de(v),de(j),I=h,0|u;t:do{if((0|r[A>>2])>0){for(p=t+12|0,u=0;f=0|F((0|r[p>>2])+(u<<3)|0,n,e,o,d,v),u=u+1|0,!(0|f);)if((0|u)>=(0|r[A>>2]))break t;return de(d),de(v),de(j),I=h,0|f}}while(0);(0|m)>-12&&we(0|v,0,((0|n)>1?n:1)<<3|0);t:do{if((0|r[o>>2])>0){V=((0|n)<0)<<31>>31,O=d,R=v,L=d,B=d,N=v,z=d,u=d,k=d,E=v,M=v,T=v,d=v;e:for(;;){for(C=0|r[o>>2],b=0,w=0,p=0;;){m=(f=a)+56|0;do{r[f>>2]=0,f=f+4|0}while((0|f)<(0|m));if(0|P(g=0|r[(e=O+(b<<3)|0)>>2],e=0|r[e+4>>2],1,a,0)){m=(f=a)+56|0;do{r[f>>2]=0,f=f+4|0}while((0|f)<(0|m));0|(f=0|pe(7,4))&&(D(g,e,1,a,f,7,0),de(f))}y=0;do{v=0|r[(_=a+(y<<3)|0)>>2],_=0|r[_+4>>2];i:do{if(!(0==(0|v)&0==(0|_))){if(g=0|ge(0|v,0|_,0|n,0|V),x(),!(0==(0|(e=0|r[(m=f=i+(g<<3)|0)>>2]))&0==(0|(m=0|r[m+4>>2]))))for(A=0;;){if((0|A)>(0|n))break e;if((0|e)==(0|v)&(0|m)==(0|_))break i;if(0==(0|(e=0|r[(m=f=i+((g=(g+1|0)%(0|n)|0)<<3)|0)>>2]))&0==(0|(m=0|r[m+4>>2])))break;A=A+1|0}0==(0|v)&0==(0|_)||(zt(v,_,c),0|Jt(t,j,c)&&(r[(A=f)>>2]=v,r[A+4>>2]=_,r[(A=R+(p<<3)|0)>>2]=v,r[A+4>>2]=_,p=p+1|0))}}while(0);y=y+1|0}while(y>>>0<7);if((0|(w=w+1|0))>=(0|C))break;b=b+1|0}if((0|C)>0&&we(0|L,0,C<<3|0),r[o>>2]=p,!((0|p)>0))break t;v=d,_=T,y=z,b=M,w=E,C=R,d=k,T=u,M=B,E=L,k=v,u=_,z=N,N=y,B=b,L=w,R=O,O=C}return de(B),de(N),de(j),I=h,-1}u=v}while(0);return de(j),de(d),de(u),I=h,0}(t|=0,e|=0,i|=0)){if(c=0|r[(u=t)+4>>2],r[(h=a)>>2]=r[u>>2],r[h+4>>2]=c,Qt(a,o),h=0|G(o,e),e=0|r[a>>2],(0|(c=0|r[t+8>>2]))>0){a=0|r[t+12>>2],o=0;do{e=(0|r[a+(o<<3)>>2])+e|0,o=o+1|0}while((0|o)!=(0|c))}(0|(e=(0|h)<(0|e)?e:h))<=-12||we(0|i,0,8+(((0|(u=e+11|0))>0?u:0)<<3)|0),I=n}else I=n},_res0IndexCount:function(){return 122},_round:xe,_sbrk:Se,_sizeOfCoordIJ:function(){return 8},_sizeOfGeoBoundary:function(){return 168},_sizeOfGeoCoord:function(){return 16},_sizeOfGeoPolygon:function(){return 16},_sizeOfGeofence:function(){return 8},_sizeOfH3Index:function(){return 8},_sizeOfLinkedGeoPolygon:function(){return 12},_uncompact:function(t,e,i,n,s){t|=0,i|=0,n|=0;var o=0,a=0,l=0,c=0,h=0,u=0;if((0|(e|=0))<=0)return 0;if((0|(s|=0))>=16){for(o=0;;){if(!(0==(0|r[(u=t+(o<<3)|0)>>2])&0==(0|r[u+4>>2]))){o=14;break}if((0|(o=o+1|0))>=(0|e)){a=0,o=16;break}}if(14==(0|o))return 0|((0|n)>0?-2:-1);if(16==(0|o))return 0|a}o=0,u=0;t:for(;;){a=0|r[(l=h=t+(u<<3)|0)>>2],l=0|r[l+4>>2];do{if(!(0==(0|a)&0==(0|l))){if((0|o)>=(0|n)){a=-1,o=16;break t}if(c=0|Ae(0|a,0|l,52),x(),(0|(c&=15))>(0|s)){a=-2,o=16;break t}if((0|c)==(0|s)){r[(h=i+(o<<3)|0)>>2]=a,r[h+4>>2]=l,o=o+1|0;break}if((0|(a=(0|Xt(7,s-c|0))+o|0))>(0|n)){a=-1,o=16;break t}Mt(0|r[h>>2],0|r[h+4>>2],s,i+(o<<3)|0),o=a}}while(0);if((0|(u=u+1|0))>=(0|e)){a=0,o=16;break}}return 16==(0|o)?0|a:0},establishStackSpace:function(t,e){I=t|=0},stackAlloc:function(t){var e;return e=I,I=15+(I=I+(t|=0)|0)&-16,0|e},stackRestore:function(t){I=t|=0},stackSave:function(){return 0|I}}}({Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},{a:at,b:function(t){c=t},c:h,d:function(t,e,i,n){at(\"Assertion failed: \"+w(t)+\", at: \"+[e?w(e):\"unknown filename\",i,n?w(n):\"unknown function\"])},e:function(t){return i.___errno_location&&(v[i.___errno_location()>>2]=t),t},f:G,g:function(t,e,i){g.set(g.subarray(e,e+i),t)},h:function(t){var e=G(),i=2130706432;if(t>i)return!1;for(var n=Math.max(e,16777216);n<t;)n=n<=536870912?x(2*n,16777216):Math.min(x((3*n+2147483648)/4,16777216),i);return!!q(n)},i:function(t){at(\"OOM\")},j:function(t){return t},k:U,l:q,m:H,n:function(){var t=H();return i.extraStackTrace&&(t+=\"\\n\"+i.extraStackTrace()),U(t)},o:24032,p:24016},f),Q=(i.___uremdi3=K.___uremdi3,i._bitshift64Lshr=K._bitshift64Lshr,i._bitshift64Shl=K._bitshift64Shl,i._calloc=K._calloc,i._cellAreaKm2=K._cellAreaKm2,i._cellAreaM2=K._cellAreaM2,i._cellAreaRads2=K._cellAreaRads2,i._compact=K._compact,i._destroyLinkedPolygon=K._destroyLinkedPolygon,i._edgeLengthKm=K._edgeLengthKm,i._edgeLengthM=K._edgeLengthM,i._emscripten_replace_memory=K._emscripten_replace_memory),J=(i._exactEdgeLengthKm=K._exactEdgeLengthKm,i._exactEdgeLengthM=K._exactEdgeLengthM,i._exactEdgeLengthRads=K._exactEdgeLengthRads,i._experimentalH3ToLocalIj=K._experimentalH3ToLocalIj,i._experimentalLocalIjToH3=K._experimentalLocalIjToH3,i._free=K._free,i._geoToH3=K._geoToH3,i._getDestinationH3IndexFromUnidirectionalEdge=K._getDestinationH3IndexFromUnidirectionalEdge,i._getH3IndexesFromUnidirectionalEdge=K._getH3IndexesFromUnidirectionalEdge,i._getH3UnidirectionalEdge=K._getH3UnidirectionalEdge,i._getH3UnidirectionalEdgeBoundary=K._getH3UnidirectionalEdgeBoundary,i._getH3UnidirectionalEdgesFromHexagon=K._getH3UnidirectionalEdgesFromHexagon,i._getOriginH3IndexFromUnidirectionalEdge=K._getOriginH3IndexFromUnidirectionalEdge,i._getPentagonIndexes=K._getPentagonIndexes,i._getRes0Indexes=K._getRes0Indexes,i._h3Distance=K._h3Distance,i._h3GetBaseCell=K._h3GetBaseCell,i._h3GetFaces=K._h3GetFaces,i._h3GetResolution=K._h3GetResolution,i._h3IndexesAreNeighbors=K._h3IndexesAreNeighbors,i._h3IsPentagon=K._h3IsPentagon,i._h3IsResClassIII=K._h3IsResClassIII,i._h3IsValid=K._h3IsValid,i._h3Line=K._h3Line,i._h3LineSize=K._h3LineSize,i._h3SetToLinkedGeo=K._h3SetToLinkedGeo,i._h3ToCenterChild=K._h3ToCenterChild,i._h3ToChildren=K._h3ToChildren,i._h3ToGeo=K._h3ToGeo,i._h3ToGeoBoundary=K._h3ToGeoBoundary,i._h3ToParent=K._h3ToParent,i._h3UnidirectionalEdgeIsValid=K._h3UnidirectionalEdgeIsValid,i._hexAreaKm2=K._hexAreaKm2,i._hexAreaM2=K._hexAreaM2,i._hexRing=K._hexRing,i._i64Subtract=K._i64Subtract,i._kRing=K._kRing,i._kRingDistances=K._kRingDistances,i._llvm_minnum_f64=K._llvm_minnum_f64,i._llvm_round_f64=K._llvm_round_f64,i._malloc=K._malloc,i._maxFaceCount=K._maxFaceCount,i._maxH3ToChildrenSize=K._maxH3ToChildrenSize,i._maxKringSize=K._maxKringSize,i._maxPolyfillSize=K._maxPolyfillSize,i._maxUncompactSize=K._maxUncompactSize,i._memcpy=K._memcpy,i._memset=K._memset,i._numHexagons=K._numHexagons,i._pentagonIndexCount=K._pentagonIndexCount,i._pointDistKm=K._pointDistKm,i._pointDistM=K._pointDistM,i._pointDistRads=K._pointDistRads,i._polyfill=K._polyfill,i._res0IndexCount=K._res0IndexCount,i._round=K._round,i._sbrk=K._sbrk,i._sizeOfCoordIJ=K._sizeOfCoordIJ,i._sizeOfGeoBoundary=K._sizeOfGeoBoundary,i._sizeOfGeoCoord=K._sizeOfGeoCoord,i._sizeOfGeoPolygon=K._sizeOfGeoPolygon,i._sizeOfGeofence=K._sizeOfGeofence,i._sizeOfH3Index=K._sizeOfH3Index,i._sizeOfLinkedGeoPolygon=K._sizeOfLinkedGeoPolygon,i._uncompact=K._uncompact,i.establishStackSpace=K.establishStackSpace,i.stackAlloc=K.stackAlloc),tt=i.stackRestore=K.stackRestore,et=i.stackSave=K.stackSave;if(i.asm=K,i.cwrap=function(t,e,i,n){var r=(i=i||[]).every(function(t){return\"number\"===t});return\"string\"!==e&&r&&!n?d(t):function(){return p(t,e,i,arguments)}},i.setValue=function(t,e,i,n){switch(\"*\"===(i=i||\"i8\").charAt(i.length-1)&&(i=\"i32\"),i){case\"i1\":case\"i8\":m[t>>0]=e;break;case\"i16\":A[t>>1]=e;break;case\"i32\":v[t>>2]=e;break;case\"i64\":z=[e>>>0,(N=e,+O(N)>=1?N>0?(0|R(+D(N/4294967296),4294967295))>>>0:~~+P((N-+(~~N>>>0))/4294967296)>>>0:0)],v[t>>2]=z[0],v[t+4>>2]=z[1];break;case\"float\":_[t>>2]=e;break;case\"double\":y[t>>3]=e;break;default:at(\"invalid type for setValue: \"+i)}},i.getValue=function(t,e,i){switch(\"*\"===(e=e||\"i8\").charAt(e.length-1)&&(e=\"i32\"),e){case\"i1\":case\"i8\":return m[t>>0];case\"i16\":return A[t>>1];case\"i32\":case\"i64\":return v[t>>2];case\"float\":return _[t>>2];case\"double\":return y[t>>3];default:at(\"invalid type for getValue: \"+e)}return null},i.getTempRet0=h,V){$(V)||(Z=V,V=i.locateFile?i.locateFile(Z,o):o+Z),F++,i.monitorRunDependencies&&i.monitorRunDependencies(F);var it=function(t){t.byteLength&&(t=new Uint8Array(t)),g.set(t,8),i.memoryInitializerRequest&&delete i.memoryInitializerRequest.response,function(t){if(F--,i.monitorRunDependencies&&i.monitorRunDependencies(F),0==F&&(null!==L&&(clearInterval(L),L=null),B)){var e=B;B=null,e()}}()},nt=function(){r(V,it,function(){throw\"could not load memory initializer \"+V})},rt=Y(V);if(rt)it(rt.buffer);else if(i.memoryInitializerRequest){var st=function(){var t=i.memoryInitializerRequest,e=t.response;if(200!==t.status&&0!==t.status){var n=Y(i.memoryInitializerRequestURL);if(!n)return console.warn(\"a problem seems to have happened with Module.memoryInitializerRequest, status: \"+t.status+\", retrying \"+V),void nt();e=n.buffer}it(e)};i.memoryInitializerRequest.response?setTimeout(st,0):i.memoryInitializerRequest.addEventListener(\"load\",st)}else nt()}function ot(t){function e(){X||(X=!0,!u&&(k(M),k(T),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for(\"function\"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)t=i.postRun.shift(),I.unshift(t);var t;k(I)}()))}t=t||s,F>0||(function(){if(i.preRun)for(\"function\"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)t=i.preRun.shift(),E.unshift(t);var t;k(E)}(),F>0)||(i.setStatus?(i.setStatus(\"Running...\"),setTimeout(function(){setTimeout(function(){i.setStatus(\"\")},1),e()},1)):e())}function at(t){throw i.onAbort&&i.onAbort(t),a(t+=\"\"),l(t),u=!0,\"abort(\"+t+\"). Build with -s ASSERTIONS=1 for more info.\"}if(B=function t(){X||ot(),X||(B=t)},i.run=ot,i.abort=at,i.preInit)for(\"function\"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return ot(),t}(\"object\"==typeof EU?EU:{}),MU=\"number\",TU={};[[\"sizeOfH3Index\",MU],[\"sizeOfGeoCoord\",MU],[\"sizeOfGeoBoundary\",MU],[\"sizeOfGeoPolygon\",MU],[\"sizeOfGeofence\",MU],[\"sizeOfLinkedGeoPolygon\",MU],[\"sizeOfCoordIJ\",MU],[\"h3IsValid\",MU,[MU,MU]],[\"geoToH3\",MU,[MU,MU,MU]],[\"h3ToGeo\",null,[MU,MU,MU]],[\"h3ToGeoBoundary\",null,[MU,MU,MU]],[\"maxKringSize\",MU,[MU]],[\"kRing\",null,[MU,MU,MU,MU]],[\"kRingDistances\",null,[MU,MU,MU,MU,MU]],[\"hexRing\",null,[MU,MU,MU,MU]],[\"maxPolyfillSize\",MU,[MU,MU]],[\"polyfill\",null,[MU,MU,MU]],[\"h3SetToLinkedGeo\",null,[MU,MU,MU]],[\"destroyLinkedPolygon\",null,[MU]],[\"compact\",MU,[MU,MU,MU]],[\"uncompact\",MU,[MU,MU,MU,MU,MU]],[\"maxUncompactSize\",MU,[MU,MU,MU]],[\"h3IsPentagon\",MU,[MU,MU]],[\"h3IsResClassIII\",MU,[MU,MU]],[\"h3GetBaseCell\",MU,[MU,MU]],[\"h3GetResolution\",MU,[MU,MU]],[\"maxFaceCount\",MU,[MU,MU]],[\"h3GetFaces\",null,[MU,MU,MU]],[\"h3ToParent\",MU,[MU,MU,MU]],[\"h3ToChildren\",null,[MU,MU,MU,MU]],[\"h3ToCenterChild\",MU,[MU,MU,MU]],[\"maxH3ToChildrenSize\",MU,[MU,MU,MU]],[\"h3IndexesAreNeighbors\",MU,[MU,MU,MU,MU]],[\"getH3UnidirectionalEdge\",MU,[MU,MU,MU,MU]],[\"getOriginH3IndexFromUnidirectionalEdge\",MU,[MU,MU]],[\"getDestinationH3IndexFromUnidirectionalEdge\",MU,[MU,MU]],[\"h3UnidirectionalEdgeIsValid\",MU,[MU,MU]],[\"getH3IndexesFromUnidirectionalEdge\",null,[MU,MU,MU]],[\"getH3UnidirectionalEdgesFromHexagon\",null,[MU,MU,MU]],[\"getH3UnidirectionalEdgeBoundary\",null,[MU,MU,MU]],[\"h3Distance\",MU,[MU,MU,MU,MU]],[\"h3Line\",MU,[MU,MU,MU,MU,MU]],[\"h3LineSize\",MU,[MU,MU,MU,MU]],[\"experimentalH3ToLocalIj\",MU,[MU,MU,MU,MU,MU]],[\"experimentalLocalIjToH3\",MU,[MU,MU,MU,MU]],[\"hexAreaM2\",MU,[MU]],[\"hexAreaKm2\",MU,[MU]],[\"edgeLengthM\",MU,[MU]],[\"edgeLengthKm\",MU,[MU]],[\"pointDistM\",MU,[MU,MU]],[\"pointDistKm\",MU,[MU,MU]],[\"pointDistRads\",MU,[MU,MU]],[\"cellAreaM2\",MU,[MU,MU]],[\"cellAreaKm2\",MU,[MU,MU]],[\"cellAreaRads2\",MU,[MU,MU]],[\"exactEdgeLengthM\",MU,[MU,MU]],[\"exactEdgeLengthKm\",MU,[MU,MU]],[\"exactEdgeLengthRads\",MU,[MU,MU]],[\"numHexagons\",MU,[MU]],[\"getRes0Indexes\",null,[MU]],[\"res0IndexCount\",MU],[\"getPentagonIndexes\",null,[MU,MU]],[\"pentagonIndexCount\",MU]].forEach(function(t){TU[t[0]]=EU.cwrap.apply(EU,t)});var IU=TU.sizeOfH3Index(),OU=TU.sizeOfGeoCoord(),PU=TU.sizeOfGeoBoundary(),DU=TU.sizeOfGeoPolygon(),RU=TU.sizeOfGeofence();TU.sizeOfLinkedGeoPolygon(),TU.sizeOfCoordIJ();var FU=/[^0-9a-fA-F]/;function LU(t){if(Array.isArray(t)&&2===t.length&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(\"string\"!=typeof t||FU.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),16);return[parseInt(t.substring(t.length-8),16),e]}function BU(t){if(t>=0)return t.toString(16);var e=zU(8,(t&=2147483647).toString(16));return(parseInt(e[0],16)+8).toString(16)+e.substring(1)}function NU(t,e){return BU(e)+zU(8,BU(t))}function zU(t,e){for(var i=t-e.length,n=\"\",r=0;r<i;r++)n+=\"0\";return n+e}function VU(t,e,i){for(var n=t.length,r=EU._calloc(n,OU),s=i?1:0,o=i?0:1,a=0;a<2*n;a+=2)EU.HEAPF64.set([t[a/2][s],t[a/2][o]].map(nH),r/8+a);return EU.HEAPU32.set([n,r],e/4),e}function jU(t){var e=function(t){return[t,EU.getTempRet0()]}(t),i=e[1];return i?NU(e[0],i):null}function $U(t,e){void 0===e&&(e=0);var i=EU.getValue(t+4*e*2,\"i32\"),n=EU.getValue(t+4*(2*e+1),\"i32\");return n?NU(i,n):null}function UU(t,e){for(var i=[],n=0;n<e;n++){var r=$U(t,n);null!==r&&i.push(r)}return i}function HU(t){return function(t){return 180*t/Math.PI}(EU.getValue(t,\"double\"))}function GU(t){return[HU(t),HU(t+8)]}function qU(t){return[HU(t+8),HU(t)]}function WU(t,e,i){for(var n=EU.getValue(t,\"i32\"),r=t+8,s=[],o=e?qU:GU,a=0;a<2*n;a+=2)s.push(o(r+8*a));return i&&s.push(s[0]),s}function YU(t){var e=EU._malloc(OU),i=LU(t);TU.h3ToGeo(i[0],i[1],e);var n=GU(e);return EU._free(e),n}function ZU(t,e){var i=EU._malloc(PU),n=LU(t);TU.h3ToGeoBoundary(n[0],n[1],i);var r=WU(i,e,e);return EU._free(i),r}function XU(t,e){var i=LU(t);return jU(TU.h3ToParent(i[0],i[1],e))}function KU(t,e,i){if(function(t){if(\"number\"!=typeof t||t<0||t>15||Math.floor(t)!==t)throw new Error(\"Invalid resolution: \"+t)}(e),i=Boolean(i),0===t.length||0===t[0].length)return[];\"number\"==typeof t[0][0]&&(t=[t]);var n=function(t,e){var i,n=t.length-1,r=EU._calloc(DU),s=0+RU,o=s+4;if(VU(t[0],r+0,e),n>0){i=EU._calloc(n,RU);for(var a=0;a<n;a++)VU(t[a+1],i+RU*a,e)}return EU.setValue(r+s,n,\"i32\"),EU.setValue(r+o,i,\"i32\"),r}(t,i),r=TU.maxPolyfillSize(n,e),s=EU._calloc(r,IU);TU.polyfill(n,e,s);var o=UU(s,r);return EU._free(s),function(t){var e=0+RU,i=e+4;EU._free(EU.getValue(t+0+4,\"i8*\"));var n=EU.getValue(t+e,\"i32\");if(n>0){for(var r=EU.getValue(t+i,\"i32\"),s=0;s<n;s++)EU._free(EU.getValue(r+RU*s+4,\"i8*\"));EU._free(r)}EU._free(t)}(n),o}function QU(t){var e=LU(t);return jU(TU.getOriginH3IndexFromUnidirectionalEdge(e[0],e[1]))}function JU(t){var e=LU(t);return jU(TU.getDestinationH3IndexFromUnidirectionalEdge(e[0],e[1]))}function tH(t){var e=LU(t);return Boolean(TU.h3UnidirectionalEdgeIsValid(e[0],e[1]))}function eH(t){var e=LU(t),i=e[0],n=e[1],r=EU._calloc(2,IU);TU.getH3IndexesFromUnidirectionalEdge(i,n,r);var s=UU(r,2);return EU._free(r),s}function iH(t,e){var i=EU._malloc(PU),n=LU(t);TU.getH3UnidirectionalEdgeBoundary(n[0],n[1],i);var r=WU(i,e);return EU._free(i),r}function nH(t){return t*Math.PI/180}function rH(t){let e=null;const i=t.map(t=>{const i=g$(ZU(t,!0),e);return e=i[i.length-1],i}).map(t=>t.reduce((t,e)=>(e[0]<t.minLongitude&&(t.minLongitude=e[0]),e[0]>t.maxLongitude&&(t.maxLongitude=e[0]),e[1]<t.minLatitude&&(t.minLatitude=e[1]),e[1]>t.maxLatitude&&(t.maxLatitude=e[1]),t),{minLongitude:Number.MAX_SAFE_INTEGER,maxLongitude:Number.MIN_SAFE_INTEGER,minLatitude:Number.MAX_SAFE_INTEGER,maxLatitude:Number.MIN_SAFE_INTEGER})).reduce((t,e)=>(e.minLongitude<t.minLongitude&&(t.minLongitude=e.minLongitude),e.maxLongitude>t.maxLongitude&&(t.maxLongitude=e.maxLongitude),e.minLatitude<t.minLatitude&&(t.minLatitude=e.minLatitude),e.maxLatitude>t.maxLatitude&&(t.maxLatitude=e.maxLatitude),t),{minLongitude:Number.MAX_SAFE_INTEGER,maxLongitude:Number.MIN_SAFE_INTEGER,minLatitude:Number.MAX_SAFE_INTEGER,maxLatitude:Number.MIN_SAFE_INTEGER});return[...Qz([i.minLongitude,i.minLatitude]),...Qz([i.maxLongitude,i.maxLatitude])]}function sH(t){const e=+`0x${t.substr(1)}`;return[Math.round(e/65536)/256,Math.round(e/256%256)/256,Math.round(e%256)/256]}function oH(t){const e=+`0x${t.substr(1)}`;return[Math.round(e/65536),Math.round(e/256%256),Math.round(e%256)]}function aH(t,e){const i=+`0x${t.substr(1)}`,n=Math.min(Math.max(Math.round(i/65536)-e,0),255).toString(16),r=Math.min(Math.max(Math.round(i/256%256)-e,0),255).toString(16),s=Math.min(Math.max(Math.round(i%256)-e,0),255).toString(16);return`#${[1===n.length?`0${n}`:n,1===r.length?`0${r}`:r,1===s.length?`0${s}`:s].join(\"\")}`}let lH=(()=>{class t{constructor(t){this.workerService=t,this.zones$=new Zp([]),this.zonesById={},this.selectedZone$=new Zp(null)}setZones(t){this.zonesById=t.reduce((t,e)=>(t[e.id]=e,t),{}),this.zones$.next(t)}refreshZones(){return Vp(this,void 0,void 0,function*(){const t=yield this.workerService.zones.list();return this.setZones(t),t})}clear(){this.zones$.next([])}createZone(t){return Vp(this,void 0,void 0,function*(){const e=yield this.workerService.zones.create(t);return yield this.refreshZones(),e})}updateZone(t){return Vp(this,void 0,void 0,function*(){yield this.workerService.zones.update(t),yield this.refreshZones()})}deleteZone(t){return Vp(this,void 0,void 0,function*(){yield this.workerService.zones.delete(t),yield this.refreshZones()})}}return t.\\u0275fac=function(e){return new(e||t)(En(iU))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const cH=[\"#ffffff\",[255,255,255]];let hH=(()=>{class t{constructor(t,e,i,n){this.mapConfigService=t,this.mapService=e,this.workerService=i,this.zonesService=n,this.alertRules$=new Zp([]),this.selectedAlertRuleId$=new Zp(null),this.selectedAlertRule$=new Zp(null),this.alertRulesNamesByZoneId={},this.alertRuleColorsById={},this.alertRules$.subscribe(t=>{this.alertRulesNamesByZoneId=t.reduce((t,e)=>{var i,n;const r=null===(i=e.criteria.zone)||void 0===i?void 0:i.zones;(null==r?void 0:r.length)&&r.forEach(i=>{let n=t[i.id];n||(n=t[i.id]=[]),n.push(e.name)});const s=null===(n=e.criteria.passageInZone)||void 0===n?void 0:n.passages;return(null==s?void 0:s.length)&&s.forEach(i=>{let n=t[i.zone.id];n||(n=t[i.zone.id]=[]),n.push(e.name)}),t},{}),this.alertRuleColorsById=t.reduce((t,e)=>(t[e.id]=[e.color,oH(e.color)],t),{})})}setAlertRules(t){this.alertRules$.next(t)}refreshAlertRules(){return Vp(this,void 0,void 0,function*(){const t=(yield this.workerService.alertRules.list()).map(t=>CU(t,this.zonesService.zonesById));return this.setAlertRules(t),t})}clear(){this.alertRules$.next([])}selectAlertRule(t){return Vp(this,void 0,void 0,function*(){this.selectedAlertRuleId$.next(t);const e=CU(yield this.workerService.alertRules.get(t),this.zonesService.zonesById);if(!this.selectedAlertRule$.value||e.id!==this.selectedAlertRule$.value.id){const t=function(t){return[].concat(t.criteria.passageInZone.enable?t.criteria.passageInZone.passages.flatMap(t=>t.zone.h3indexes):[]).concat(t.criteria.zone.enable?t.criteria.zone.zones.flatMap(t=>t.h3indexes):[])}(e);this.mapService.hasBooted$.value?t.length>0&&this.mapService.fitOn(rH(t)):(this.mapService.resetToDefaultView(),t.length>0&&setTimeout(()=>{this.mapService.fitOn(rH(t),0)},50))}return this.selectedAlertRule$.next(e),e})}deselectAlertRule(){this.selectedAlertRuleId$.next(null),this.selectedAlertRule$.next(null)}updateAlertRulesFilter(t){this.mapConfigService.updateAlertRulesFilter(t)}createAlertRule(t){return Vp(this,void 0,void 0,function*(){const e=yield this.workerService.alertRules.create(kU(t));return yield this.refreshAlertRules(),e})}updateAlertRule(t){return Vp(this,void 0,void 0,function*(){yield this.workerService.alertRules.update(kU(t)),yield this.refreshAlertRules()})}deleteAlertRule(t){return Vp(this,void 0,void 0,function*(){yield this.workerService.alertRules.delete(t),yield this.refreshAlertRules()})}getAlertRuleColor(t){return this.alertRuleColorsById[t]||cH}}return t.\\u0275fac=function(e){return new(e||t)(En(k$),En(T$),En(iU),En(lH))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),uH=(()=>{class t{constructor(){this.alerts$=new Zp([])}updateAlerts(t){this.alerts$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const dH=[{key:\"LineString\",name:\"Ligne\"},{key:\"Point\",name:\"Point\"},{key:\"Polygon\",name:\"Zone\"}];var pH=(()=>(function(t){t.Aircraft=\"aircraft\",t.AircraftPosition=\"aircraft-position\",t.Alert=\"alert\",t.Annotation=\"annotation\",t.Event=\"event\",t.Ship=\"ship\",t.ShipPosition=\"ship-position\",t.H3Element=\"h3element\"}(pH||(pH={})),pH))();let fH=(()=>{class t{constructor(t){this.workerService=t,this.annotations$=new Zp([]),this.editedAnnotation$=new Zp(null),this.editedAnnotationGeomType$=new Zp(\"Point\"),this.editedAnnotation$.pipe(wf(1),pf(t=>t&&!!t.geom),E(t=>t.geom.type),Cf()).subscribe(t=>{this.editedAnnotationGeomType$.next(t)})}setAnnotations(t){this.annotations$.next(t)}refreshAnnotations(){return Vp(this,void 0,void 0,function*(){const t=yield this.workerService.annotations.list();return this.setAnnotations(t),t})}clear(){this.annotations$.next([])}createNewAnnotation(t){const e={kind:pH.Annotation,name:\"\",description:\"\",color:\"#c3267d\",geom:t};t&&(e.lon=t.coordinates[0],e.lat=t.coordinates[1]),this.editedAnnotation$.next(e)}updateEditedAnnotationGeom(t){const e=this.editedAnnotation$.value;e.geom=t,this.editedAnnotation$.next(e)}editAnnotation(t){this.editedAnnotation$.next(Uj(t))}refreshEditedAnnotation(){this.editedAnnotation$.next(this.editedAnnotation$.value)}cancelEditing(){this.editedAnnotation$.next(null),this.annotations$.next(this.annotations$.value)}saveEditedAnnotation(){return Vp(this,void 0,void 0,function*(){const t=this.editedAnnotation$.value;t.id?yield this.workerService.annotations.update(t):yield this.workerService.annotations.create(t),yield this.refreshAnnotations(),this.editedAnnotation$.next(null)})}deleteAnnotation(t){return Vp(this,void 0,void 0,function*(){yield this.workerService.annotations.delete(t),yield this.refreshAnnotations()})}}return t.\\u0275fac=function(e){return new(e||t)(En(iU))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),mH=(()=>{class t{constructor(){this.drawingZoneMode$=new Zp(!1),this.drawingZoneHexagonsCache={},this.hexagons$=new Zp([]),this.selectHexagon$=new S,this.selectHexagon$.subscribe(t=>{this.drawingZoneHexagonsCache[t]?(TB({category:\"app\",message:\"drawing: unselect-hexagon\"}),delete this.drawingZoneHexagonsCache[t]):(TB({category:\"app\",message:\"drawing: select-hexagon\"}),this.drawingZoneHexagonsCache[t]=!0),this.updateZones(Object.keys(this.drawingZoneHexagonsCache))})}updateZones(t){(0!==t.length||0!==this.hexagons$.value.length)&&this.hexagons$.next(t)}clearZones(){this.updateZones([])}editZone(t){return this.drawingZoneMode$.next(!0),this.drawingZoneHexagonsCache={},t.forEach(t=>{this.drawingZoneHexagonsCache[t]=!0}),this.hexagons$.next(t),this.hexagons$}stopEditingZone(){this.drawingZoneMode$.next(!1),this.clearZones()}selectHexagon(t){this.selectHexagon$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const gH=[{label:\"Perte signal AIS\",color:aH(\"#ff272d\",20)},{label:\"Changement d'informations\",color:aH(\"#e1cf15\",20)},{label:\"Spoofing\",color:aH(\"#ff29ff\",20)},{label:\"Position tr\\xe8s \\xe9loign\\xe9e\",color:aH(\"#0623c9\",20)},{label:\"Position d\\xe9cal\\xe9e\",color:aH(\"#a07149\",20)},{label:\"Entr\\xe9e/Sortie de zone\",color:aH(\"#78f48b\",20)},{label:\"Route erratique\",color:aH(\"#f78851\",20)},{label:\"Transbordement\",color:aH(\"#5910d0\",20)}],AH=[{key:1,label:\"Perte signal AIS\",color:\"#ff272d\"},{key:101,label:\"Modification infos navire\",color:\"#e1cf15\"},{key:102,label:\"IMO invalide\",color:\"#ff29ff\"},{key:103,label:\"Callsign invalide\",color:\"#ff29ff\"},{key:110,label:\"Spoofing\",color:\"#ff29ff\"},{key:201,label:\"Modification infos voyage\",color:\"#e1cf15\"},{key:301,label:\"Position tr\\xe8s \\xe9loign\\xe9e\",color:\"#0623c9\"},{key:302,label:\"Modification statut\",color:\"#e1cf15\"},{key:307,label:\"Position d\\xe9cal\\xe9e\",color:\"#a07149\"},{key:401,label:\"Entr\\xe9e zone\",color:\"#78f48b\"},{key:402,label:\"Sortie zone\",color:\"#78f48b\"},{key:403,label:\"Route erratique\",color:\"#f78851\"},{key:404,label:\"Transbordement\",color:\"#5910d0\"}];AH.forEach(t=>{t.textColor=aH(t.color,20)});const vH=AH.reduce((t,e)=>(t[e.key]=e.label,t),{}),_H=AH.reduce((t,e)=>(t[e.key]=e,t),{});var yH=(()=>(function(t){t[t.AISCommLoss=1]=\"AISCommLoss\",t[t.ShipIdChanged=101]=\"ShipIdChanged\",t[t.InvalidImo=102]=\"InvalidImo\",t[t.InvalidCallsign=103]=\"InvalidCallsign\",t[t.Spoofing=110]=\"Spoofing\",t[t.VoyageChanged=201]=\"VoyageChanged\",t[t.VoyageDestination=202]=\"VoyageDestination\",t[t.VoyageETA=203]=\"VoyageETA\",t[t.PositionDubious=301]=\"PositionDubious\",t[t.StatusChanged=302]=\"StatusChanged\",t[t.VectorCheck=307]=\"VectorCheck\",t[t.MoveZoneEntry=401]=\"MoveZoneEntry\",t[t.MoveZoneExit=402]=\"MoveZoneExit\",t[t.MoveErratic=403]=\"MoveErratic\",t[t.MoveMeetingAtSea=404]=\"MoveMeetingAtSea\"}(yH||(yH={})),yH))();class bH{constructor(t,e,i,n){this.bufferTimeSpan=t,this.bufferCreationInterval=e,this.maxBufferSize=i,this.scheduler=n}call(t,e){return e.subscribe(new xH(t,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))}}class wH{constructor(){this.buffer=[]}}class xH extends m{constructor(t,e,i,n,r){super(t),this.bufferTimeSpan=e,this.bufferCreationInterval=i,this.maxBufferSize=n,this.scheduler=r,this.contexts=[];const s=this.openContext();if(this.timespanOnly=null==i||i<0,this.timespanOnly)this.add(s.closeAction=r.schedule(SH,e,{subscriber:this,context:s,bufferTimeSpan:e}));else{const t={bufferTimeSpan:e,bufferCreationInterval:i,subscriber:this,scheduler:r};this.add(s.closeAction=r.schedule(kH,e,{subscriber:this,context:s})),this.add(r.schedule(CH,i,t))}}_next(t){const e=this.contexts,i=e.length;let n;for(let r=0;r<i;r++){const i=e[r],s=i.buffer;s.push(t),s.length==this.maxBufferSize&&(n=i)}n&&this.onBufferFull(n)}_error(t){this.contexts.length=0,super._error(t)}_complete(){const{contexts:t,destination:e}=this;for(;t.length>0;){const i=t.shift();e.next(i.buffer)}super._complete()}_unsubscribe(){this.contexts=null}onBufferFull(t){this.closeContext(t);const e=t.closeAction;if(e.unsubscribe(),this.remove(e),!this.closed&&this.timespanOnly){t=this.openContext();const e=this.bufferTimeSpan;this.add(t.closeAction=this.scheduler.schedule(SH,e,{subscriber:this,context:t,bufferTimeSpan:e}))}}openContext(){const t=new wH;return this.contexts.push(t),t}closeContext(t){this.destination.next(t.buffer);const e=this.contexts;(e?e.indexOf(t):-1)>=0&&e.splice(e.indexOf(t),1)}}function SH(t){const e=t.subscriber,i=t.context;i&&e.closeContext(i),e.closed||(t.context=e.openContext(),t.context.closeAction=this.schedule(t,t.bufferTimeSpan))}function CH(t){const{bufferCreationInterval:e,bufferTimeSpan:i,subscriber:n,scheduler:r}=t,s=n.openContext();n.closed||(n.add(s.closeAction=r.schedule(kH,i,{subscriber:n,context:s})),this.schedule(t,e))}function kH(t){const{subscriber:e,context:i}=t;e.closeContext(i)}function EH(t,e){const i=t.findIndex(e);return-1!==i?t.slice(i):[]}function MH(t){return t.routerState.snapshot.url.startsWith(\"/fleets/\")?t.routerState.snapshot.url.substring(0,44):\"\"}let TH=(()=>{class t{constructor(){this.events$=new Zp([])}clear(){this.events$.next([])}updateEvents(t){this.events$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),IH=(()=>{class t{constructor(){this.trails$=new Zp([])}clear(){this.trails$.next([])}updateTrails(t){this.trails$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),OH=(()=>{class t{constructor(){this.active$=new Zp(!1)}toggleMeasureMode(){this.active$.next(!this.active$.value)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();function PH(t,e){if(e.length<t)throw new TypeError(t+\" argument\"+(t>1?\"s\":\"\")+\" required, but only \"+e.length+\" present\")}function DH(t){return PH(1,arguments),t instanceof Date||\"object\"==typeof t&&\"[object Date]\"===Object.prototype.toString.call(t)}function RH(t){PH(1,arguments);var e=Object.prototype.toString.call(t);return t instanceof Date||\"object\"==typeof t&&\"[object Date]\"===e?new Date(t.getTime()):\"number\"==typeof t||\"[object Number]\"===e?new Date(t):((\"string\"==typeof t||\"[object String]\"===e)&&\"undefined\"!=typeof console&&(console.warn(\"Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule\"),console.warn((new Error).stack)),new Date(NaN))}function FH(t){if(PH(1,arguments),!DH(t)&&\"number\"!=typeof t)return!1;var e=RH(t);return!isNaN(Number(e))}var LH={lessThanXSeconds:{one:\"less than a second\",other:\"less than {{count}} seconds\"},xSeconds:{one:\"1 second\",other:\"{{count}} seconds\"},halfAMinute:\"half a minute\",lessThanXMinutes:{one:\"less than a minute\",other:\"less than {{count}} minutes\"},xMinutes:{one:\"1 minute\",other:\"{{count}} minutes\"},aboutXHours:{one:\"about 1 hour\",other:\"about {{count}} hours\"},xHours:{one:\"1 hour\",other:\"{{count}} hours\"},xDays:{one:\"1 day\",other:\"{{count}} days\"},aboutXWeeks:{one:\"about 1 week\",other:\"about {{count}} weeks\"},xWeeks:{one:\"1 week\",other:\"{{count}} weeks\"},aboutXMonths:{one:\"about 1 month\",other:\"about {{count}} months\"},xMonths:{one:\"1 month\",other:\"{{count}} months\"},aboutXYears:{one:\"about 1 year\",other:\"about {{count}} years\"},xYears:{one:\"1 year\",other:\"{{count}} years\"},overXYears:{one:\"over 1 year\",other:\"over {{count}} years\"},almostXYears:{one:\"almost 1 year\",other:\"almost {{count}} years\"}};function BH(t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.width?String(e.width):t.defaultWidth,n=t.formats[i]||t.formats[t.defaultWidth];return n}}var NH={date:BH({formats:{full:\"EEEE, MMMM do, y\",long:\"MMMM do, y\",medium:\"MMM d, y\",short:\"MM/dd/yyyy\"},defaultWidth:\"full\"}),time:BH({formats:{full:\"h:mm:ss a zzzz\",long:\"h:mm:ss a z\",medium:\"h:mm:ss a\",short:\"h:mm a\"},defaultWidth:\"full\"}),dateTime:BH({formats:{full:\"{{date}} 'at' {{time}}\",long:\"{{date}} 'at' {{time}}\",medium:\"{{date}}, {{time}}\",short:\"{{date}}, {{time}}\"},defaultWidth:\"full\"})},zH={lastWeek:\"'last' eeee 'at' p\",yesterday:\"'yesterday at' p\",today:\"'today at' p\",tomorrow:\"'tomorrow at' p\",nextWeek:\"eeee 'at' p\",other:\"P\"};function VH(t){return function(e,i){var n,r=i||{};if(\"formatting\"===(r.context?String(r.context):\"standalone\")&&t.formattingValues){var s=t.defaultFormattingWidth||t.defaultWidth,o=r.width?String(r.width):s;n=t.formattingValues[o]||t.formattingValues[s]}else{var a=t.defaultWidth,l=r.width?String(r.width):t.defaultWidth;n=t.values[l]||t.values[a]}return n[t.argumentCallback?t.argumentCallback(e):e]}}function jH(t){return function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.width,r=n&&t.matchPatterns[n]||t.matchPatterns[t.defaultMatchWidth],s=e.match(r);if(!s)return null;var o,a=s[0],l=n&&t.parsePatterns[n]||t.parsePatterns[t.defaultParseWidth],c=Array.isArray(l)?UH(l,function(t){return t.test(a)}):$H(l,function(t){return t.test(a)});o=t.valueCallback?t.valueCallback(c):c,o=i.valueCallback?i.valueCallback(o):o;var h=e.slice(a.length);return{value:o,rest:h}}}function $H(t,e){for(var i in t)if(t.hasOwnProperty(i)&&e(t[i]))return i}function UH(t,e){for(var i=0;i<t.length;i++)if(e(t[i]))return i}function HH(t){return function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.match(t.matchPattern);if(!n)return null;var r=n[0],s=e.match(t.parsePattern);if(!s)return null;var o=t.valueCallback?t.valueCallback(s[0]):s[0];o=i.valueCallback?i.valueCallback(o):o;var a=e.slice(r.length);return{value:o,rest:a}}}var GH={code:\"en-US\",formatDistance:function(t,e,i){var n,r=LH[t];return n=\"string\"==typeof r?r:1===e?r.one:r.other.replace(\"{{count}}\",e.toString()),null!=i&&i.addSuffix?i.comparison&&i.comparison>0?\"in \"+n:n+\" ago\":n},formatLong:NH,formatRelative:function(t,e,i,n){return zH[t]},localize:{ordinalNumber:function(t,e){var i=Number(t),n=i%100;if(n>20||n<10)switch(n%10){case 1:return i+\"st\";case 2:return i+\"nd\";case 3:return i+\"rd\"}return i+\"th\"},era:VH({values:{narrow:[\"B\",\"A\"],abbreviated:[\"BC\",\"AD\"],wide:[\"Before Christ\",\"Anno Domini\"]},defaultWidth:\"wide\"}),quarter:VH({values:{narrow:[\"1\",\"2\",\"3\",\"4\"],abbreviated:[\"Q1\",\"Q2\",\"Q3\",\"Q4\"],wide:[\"1st quarter\",\"2nd quarter\",\"3rd quarter\",\"4th quarter\"]},defaultWidth:\"wide\",argumentCallback:function(t){return t-1}}),month:VH({values:{narrow:[\"J\",\"F\",\"M\",\"A\",\"M\",\"J\",\"J\",\"A\",\"S\",\"O\",\"N\",\"D\"],abbreviated:[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],wide:[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"]},defaultWidth:\"wide\"}),day:VH({values:{narrow:[\"S\",\"M\",\"T\",\"W\",\"T\",\"F\",\"S\"],short:[\"Su\",\"Mo\",\"Tu\",\"We\",\"Th\",\"Fr\",\"Sa\"],abbreviated:[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],wide:[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},defaultWidth:\"wide\"}),dayPeriod:VH({values:{narrow:{am:\"a\",pm:\"p\",midnight:\"mi\",noon:\"n\",morning:\"morning\",afternoon:\"afternoon\",evening:\"evening\",night:\"night\"},abbreviated:{am:\"AM\",pm:\"PM\",midnight:\"midnight\",noon:\"noon\",morning:\"morning\",afternoon:\"afternoon\",evening:\"evening\",night:\"night\"},wide:{am:\"a.m.\",pm:\"p.m.\",midnight:\"midnight\",noon:\"noon\",morning:\"morning\",afternoon:\"afternoon\",evening:\"evening\",night:\"night\"}},defaultWidth:\"wide\",formattingValues:{narrow:{am:\"a\",pm:\"p\",midnight:\"mi\",noon:\"n\",morning:\"in the morning\",afternoon:\"in the afternoon\",evening:\"in the evening\",night:\"at night\"},abbreviated:{am:\"AM\",pm:\"PM\",midnight:\"midnight\",noon:\"noon\",morning:\"in the morning\",afternoon:\"in the afternoon\",evening:\"in the evening\",night:\"at night\"},wide:{am:\"a.m.\",pm:\"p.m.\",midnight:\"midnight\",noon:\"noon\",morning:\"in the morning\",afternoon:\"in the afternoon\",evening:\"in the evening\",night:\"at night\"}},defaultFormattingWidth:\"wide\"})},match:{ordinalNumber:HH({matchPattern:/^(\\d+)(th|st|nd|rd)?/i,parsePattern:/\\d+/i,valueCallback:function(t){return parseInt(t,10)}}),era:jH({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\\.?\\s?c\\.?|b\\.?\\s?c\\.?\\s?e\\.?|a\\.?\\s?d\\.?|c\\.?\\s?e\\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:\"wide\",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:\"any\"}),quarter:jH({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:\"wide\",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:\"any\",valueCallback:function(t){return t+1}}),month:jH({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:\"wide\",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:\"any\"}),day:jH({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:\"wide\",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:\"any\"}),dayPeriod:jH({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\\.?\\s?m\\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:\"any\",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:\"any\"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function qH(t){if(null===t||!0===t||!1===t)return NaN;var e=Number(t);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function WH(t,e){PH(2,arguments);var i=RH(t).getTime(),n=qH(e);return new Date(i+n)}function YH(t,e){PH(2,arguments);var i=qH(e);return WH(t,-i)}function ZH(t,e){for(var i=t<0?\"-\":\"\",n=Math.abs(t).toString();n.length<e;)n=\"0\"+n;return i+n}var XH=function(t,e){var i=t.getUTCFullYear(),n=i>0?i:1-i;return ZH(\"yy\"===e?n%100:n,e.length)},KH=function(t,e){var i=t.getUTCMonth();return\"M\"===e?String(i+1):ZH(i+1,2)},QH=function(t,e){return ZH(t.getUTCDate(),e.length)},JH=function(t,e){return ZH(t.getUTCHours()%12||12,e.length)},tG=function(t,e){return ZH(t.getUTCHours(),e.length)},eG=function(t,e){return ZH(t.getUTCMinutes(),e.length)},iG=function(t,e){return ZH(t.getUTCSeconds(),e.length)},nG=function(t,e){var i=e.length,n=t.getUTCMilliseconds();return ZH(Math.floor(n*Math.pow(10,i-3)),e.length)};function rG(t){PH(1,arguments);var e=1,i=RH(t),n=i.getUTCDay(),r=(n<e?7:0)+n-e;return i.setUTCDate(i.getUTCDate()-r),i.setUTCHours(0,0,0,0),i}function sG(t){PH(1,arguments);var e=RH(t),i=e.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(i+1,0,4),n.setUTCHours(0,0,0,0);var r=rG(n),s=new Date(0);s.setUTCFullYear(i,0,4),s.setUTCHours(0,0,0,0);var o=rG(s);return e.getTime()>=r.getTime()?i+1:e.getTime()>=o.getTime()?i:i-1}function oG(t){PH(1,arguments);var e=sG(t),i=new Date(0);i.setUTCFullYear(e,0,4),i.setUTCHours(0,0,0,0);var n=rG(i);return n}function aG(t){PH(1,arguments);var e=RH(t),i=rG(e).getTime()-oG(e).getTime();return Math.round(i/6048e5)+1}function lG(t,e){PH(1,arguments);var i=e||{},n=i.locale,r=n&&n.options&&n.options.weekStartsOn,s=null==r?0:qH(r),o=null==i.weekStartsOn?s:qH(i.weekStartsOn);if(!(o>=0&&o<=6))throw new RangeError(\"weekStartsOn must be between 0 and 6 inclusively\");var a=RH(t),l=a.getUTCDay(),c=(l<o?7:0)+l-o;return a.setUTCDate(a.getUTCDate()-c),a.setUTCHours(0,0,0,0),a}function cG(t,e){PH(1,arguments);var i=RH(t,e),n=i.getUTCFullYear(),r=e||{},s=r.locale,o=s&&s.options&&s.options.firstWeekContainsDate,a=null==o?1:qH(o),l=null==r.firstWeekContainsDate?a:qH(r.firstWeekContainsDate);if(!(l>=1&&l<=7))throw new RangeError(\"firstWeekContainsDate must be between 1 and 7 inclusively\");var c=new Date(0);c.setUTCFullYear(n+1,0,l),c.setUTCHours(0,0,0,0);var h=lG(c,e),u=new Date(0);u.setUTCFullYear(n,0,l),u.setUTCHours(0,0,0,0);var d=lG(u,e);return i.getTime()>=h.getTime()?n+1:i.getTime()>=d.getTime()?n:n-1}function hG(t,e){PH(1,arguments);var i=e||{},n=i.locale,r=n&&n.options&&n.options.firstWeekContainsDate,s=null==r?1:qH(r),o=null==i.firstWeekContainsDate?s:qH(i.firstWeekContainsDate),a=cG(t,e),l=new Date(0);l.setUTCFullYear(a,0,o),l.setUTCHours(0,0,0,0);var c=lG(l,e);return c}function uG(t,e){PH(1,arguments);var i=RH(t),n=lG(i,e).getTime()-hG(i,e).getTime();return Math.round(n/6048e5)+1}function dG(t,e){var i=t>0?\"-\":\"+\",n=Math.abs(t),r=Math.floor(n/60),s=n%60;if(0===s)return i+String(r);var o=e||\"\";return i+String(r)+o+ZH(s,2)}function pG(t,e){return t%60==0?(t>0?\"-\":\"+\")+ZH(Math.abs(t)/60,2):fG(t,e)}function fG(t,e){var i=e||\"\",n=t>0?\"-\":\"+\",r=Math.abs(t);return n+ZH(Math.floor(r/60),2)+i+ZH(r%60,2)}var mG={G:function(t,e,i){var n=t.getUTCFullYear()>0?1:0;switch(e){case\"G\":case\"GG\":case\"GGG\":return i.era(n,{width:\"abbreviated\"});case\"GGGGG\":return i.era(n,{width:\"narrow\"});case\"GGGG\":default:return i.era(n,{width:\"wide\"})}},y:function(t,e,i){if(\"yo\"===e){var n=t.getUTCFullYear();return i.ordinalNumber(n>0?n:1-n,{unit:\"year\"})}return XH(t,e)},Y:function(t,e,i,n){var r=cG(t,n),s=r>0?r:1-r;return\"YY\"===e?ZH(s%100,2):\"Yo\"===e?i.ordinalNumber(s,{unit:\"year\"}):ZH(s,e.length)},R:function(t,e){return ZH(sG(t),e.length)},u:function(t,e){return ZH(t.getUTCFullYear(),e.length)},Q:function(t,e,i){var n=Math.ceil((t.getUTCMonth()+1)/3);switch(e){case\"Q\":return String(n);case\"QQ\":return ZH(n,2);case\"Qo\":return i.ordinalNumber(n,{unit:\"quarter\"});case\"QQQ\":return i.quarter(n,{width:\"abbreviated\",context:\"formatting\"});case\"QQQQQ\":return i.quarter(n,{width:\"narrow\",context:\"formatting\"});case\"QQQQ\":default:return i.quarter(n,{width:\"wide\",context:\"formatting\"})}},q:function(t,e,i){var n=Math.ceil((t.getUTCMonth()+1)/3);switch(e){case\"q\":return String(n);case\"qq\":return ZH(n,2);case\"qo\":return i.ordinalNumber(n,{unit:\"quarter\"});case\"qqq\":return i.quarter(n,{width:\"abbreviated\",context:\"standalone\"});case\"qqqqq\":return i.quarter(n,{width:\"narrow\",context:\"standalone\"});case\"qqqq\":default:return i.quarter(n,{width:\"wide\",context:\"standalone\"})}},M:function(t,e,i){var n=t.getUTCMonth();switch(e){case\"M\":case\"MM\":return KH(t,e);case\"Mo\":return i.ordinalNumber(n+1,{unit:\"month\"});case\"MMM\":return i.month(n,{width:\"abbreviated\",context:\"formatting\"});case\"MMMMM\":return i.month(n,{width:\"narrow\",context:\"formatting\"});case\"MMMM\":default:return i.month(n,{width:\"wide\",context:\"formatting\"})}},L:function(t,e,i){var n=t.getUTCMonth();switch(e){case\"L\":return String(n+1);case\"LL\":return ZH(n+1,2);case\"Lo\":return i.ordinalNumber(n+1,{unit:\"month\"});case\"LLL\":return i.month(n,{width:\"abbreviated\",context:\"standalone\"});case\"LLLLL\":return i.month(n,{width:\"narrow\",context:\"standalone\"});case\"LLLL\":default:return i.month(n,{width:\"wide\",context:\"standalone\"})}},w:function(t,e,i,n){var r=uG(t,n);return\"wo\"===e?i.ordinalNumber(r,{unit:\"week\"}):ZH(r,e.length)},I:function(t,e,i){var n=aG(t);return\"Io\"===e?i.ordinalNumber(n,{unit:\"week\"}):ZH(n,e.length)},d:function(t,e,i){return\"do\"===e?i.ordinalNumber(t.getUTCDate(),{unit:\"date\"}):QH(t,e)},D:function(t,e,i){var n=function(t){PH(1,arguments);var e=RH(t),i=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var n=e.getTime();return Math.floor((i-n)/864e5)+1}(t);return\"Do\"===e?i.ordinalNumber(n,{unit:\"dayOfYear\"}):ZH(n,e.length)},E:function(t,e,i){var n=t.getUTCDay();switch(e){case\"E\":case\"EE\":case\"EEE\":return i.day(n,{width:\"abbreviated\",context:\"formatting\"});case\"EEEEE\":return i.day(n,{width:\"narrow\",context:\"formatting\"});case\"EEEEEE\":return i.day(n,{width:\"short\",context:\"formatting\"});case\"EEEE\":default:return i.day(n,{width:\"wide\",context:\"formatting\"})}},e:function(t,e,i,n){var r=t.getUTCDay(),s=(r-n.weekStartsOn+8)%7||7;switch(e){case\"e\":return String(s);case\"ee\":return ZH(s,2);case\"eo\":return i.ordinalNumber(s,{unit:\"day\"});case\"eee\":return i.day(r,{width:\"abbreviated\",context:\"formatting\"});case\"eeeee\":return i.day(r,{width:\"narrow\",context:\"formatting\"});case\"eeeeee\":return i.day(r,{width:\"short\",context:\"formatting\"});case\"eeee\":default:return i.day(r,{width:\"wide\",context:\"formatting\"})}},c:function(t,e,i,n){var r=t.getUTCDay(),s=(r-n.weekStartsOn+8)%7||7;switch(e){case\"c\":return String(s);case\"cc\":return ZH(s,e.length);case\"co\":return i.ordinalNumber(s,{unit:\"day\"});case\"ccc\":return i.day(r,{width:\"abbreviated\",context:\"standalone\"});case\"ccccc\":return i.day(r,{width:\"narrow\",context:\"standalone\"});case\"cccccc\":return i.day(r,{width:\"short\",context:\"standalone\"});case\"cccc\":default:return i.day(r,{width:\"wide\",context:\"standalone\"})}},i:function(t,e,i){var n=t.getUTCDay(),r=0===n?7:n;switch(e){case\"i\":return String(r);case\"ii\":return ZH(r,e.length);case\"io\":return i.ordinalNumber(r,{unit:\"day\"});case\"iii\":return i.day(n,{width:\"abbreviated\",context:\"formatting\"});case\"iiiii\":return i.day(n,{width:\"narrow\",context:\"formatting\"});case\"iiiiii\":return i.day(n,{width:\"short\",context:\"formatting\"});case\"iiii\":default:return i.day(n,{width:\"wide\",context:\"formatting\"})}},a:function(t,e,i){var n=t.getUTCHours()/12>=1?\"pm\":\"am\";switch(e){case\"a\":case\"aa\":return i.dayPeriod(n,{width:\"abbreviated\",context:\"formatting\"});case\"aaa\":return i.dayPeriod(n,{width:\"abbreviated\",context:\"formatting\"}).toLowerCase();case\"aaaaa\":return i.dayPeriod(n,{width:\"narrow\",context:\"formatting\"});case\"aaaa\":default:return i.dayPeriod(n,{width:\"wide\",context:\"formatting\"})}},b:function(t,e,i){var n,r=t.getUTCHours();switch(n=12===r?\"noon\":0===r?\"midnight\":r/12>=1?\"pm\":\"am\",e){case\"b\":case\"bb\":return i.dayPeriod(n,{width:\"abbreviated\",context:\"formatting\"});case\"bbb\":return i.dayPeriod(n,{width:\"abbreviated\",context:\"formatting\"}).toLowerCase();case\"bbbbb\":return i.dayPeriod(n,{width:\"narrow\",context:\"formatting\"});case\"bbbb\":default:return i.dayPeriod(n,{width:\"wide\",context:\"formatting\"})}},B:function(t,e,i){var n,r=t.getUTCHours();switch(n=r>=17?\"evening\":r>=12?\"afternoon\":r>=4?\"morning\":\"night\",e){case\"B\":case\"BB\":case\"BBB\":return i.dayPeriod(n,{width:\"abbreviated\",context:\"formatting\"});case\"BBBBB\":return i.dayPeriod(n,{width:\"narrow\",context:\"formatting\"});case\"BBBB\":default:return i.dayPeriod(n,{width:\"wide\",context:\"formatting\"})}},h:function(t,e,i){if(\"ho\"===e){var n=t.getUTCHours()%12;return 0===n&&(n=12),i.ordinalNumber(n,{unit:\"hour\"})}return JH(t,e)},H:function(t,e,i){return\"Ho\"===e?i.ordinalNumber(t.getUTCHours(),{unit:\"hour\"}):tG(t,e)},K:function(t,e,i){var n=t.getUTCHours()%12;return\"Ko\"===e?i.ordinalNumber(n,{unit:\"hour\"}):ZH(n,e.length)},k:function(t,e,i){var n=t.getUTCHours();return 0===n&&(n=24),\"ko\"===e?i.ordinalNumber(n,{unit:\"hour\"}):ZH(n,e.length)},m:function(t,e,i){return\"mo\"===e?i.ordinalNumber(t.getUTCMinutes(),{unit:\"minute\"}):eG(t,e)},s:function(t,e,i){return\"so\"===e?i.ordinalNumber(t.getUTCSeconds(),{unit:\"second\"}):iG(t,e)},S:function(t,e){return nG(t,e)},X:function(t,e,i,n){var r=(n._originalDate||t).getTimezoneOffset();if(0===r)return\"Z\";switch(e){case\"X\":return pG(r);case\"XXXX\":case\"XX\":return fG(r);case\"XXXXX\":case\"XXX\":default:return fG(r,\":\")}},x:function(t,e,i,n){var r=(n._originalDate||t).getTimezoneOffset();switch(e){case\"x\":return pG(r);case\"xxxx\":case\"xx\":return fG(r);case\"xxxxx\":case\"xxx\":default:return fG(r,\":\")}},O:function(t,e,i,n){var r=(n._originalDate||t).getTimezoneOffset();switch(e){case\"O\":case\"OO\":case\"OOO\":return\"GMT\"+dG(r,\":\");case\"OOOO\":default:return\"GMT\"+fG(r,\":\")}},z:function(t,e,i,n){var r=(n._originalDate||t).getTimezoneOffset();switch(e){case\"z\":case\"zz\":case\"zzz\":return\"GMT\"+dG(r,\":\");case\"zzzz\":default:return\"GMT\"+fG(r,\":\")}},t:function(t,e,i,n){return ZH(Math.floor((n._originalDate||t).getTime()/1e3),e.length)},T:function(t,e,i,n){return ZH((n._originalDate||t).getTime(),e.length)}};function gG(t,e){switch(t){case\"P\":return e.date({width:\"short\"});case\"PP\":return e.date({width:\"medium\"});case\"PPP\":return e.date({width:\"long\"});case\"PPPP\":default:return e.date({width:\"full\"})}}function AG(t,e){switch(t){case\"p\":return e.time({width:\"short\"});case\"pp\":return e.time({width:\"medium\"});case\"ppp\":return e.time({width:\"long\"});case\"pppp\":default:return e.time({width:\"full\"})}}var vG={p:AG,P:function(t,e){var i,n=t.match(/(P+)(p+)?/),r=n[1],s=n[2];if(!s)return gG(t,e);switch(r){case\"P\":i=e.dateTime({width:\"short\"});break;case\"PP\":i=e.dateTime({width:\"medium\"});break;case\"PPP\":i=e.dateTime({width:\"long\"});break;case\"PPPP\":default:i=e.dateTime({width:\"full\"})}return i.replace(\"{{date}}\",gG(r,e)).replace(\"{{time}}\",AG(s,e))}};function _G(t){var e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),t.getTime()-e.getTime()}var yG=[\"D\",\"DD\"],bG=[\"YY\",\"YYYY\"];function wG(t){return-1!==yG.indexOf(t)}function xG(t){return-1!==bG.indexOf(t)}function SG(t,e,i){if(\"YYYY\"===t)throw new RangeError(\"Use `yyyy` instead of `YYYY` (in `\".concat(e,\"`) for formatting years to the input `\").concat(i,\"`; see: https://git.io/fxCyr\"));if(\"YY\"===t)throw new RangeError(\"Use `yy` instead of `YY` (in `\".concat(e,\"`) for formatting years to the input `\").concat(i,\"`; see: https://git.io/fxCyr\"));if(\"D\"===t)throw new RangeError(\"Use `d` instead of `D` (in `\".concat(e,\"`) for formatting days of the month to the input `\").concat(i,\"`; see: https://git.io/fxCyr\"));if(\"DD\"===t)throw new RangeError(\"Use `dd` instead of `DD` (in `\".concat(e,\"`) for formatting days of the month to the input `\").concat(i,\"`; see: https://git.io/fxCyr\"))}var CG=/[yYQqMLwIdDecihHKkms]o|(\\w)\\1*|''|'(''|[^'])+('|$)|./g,kG=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,EG=/^'([^]*?)'?$/,MG=/''/g,TG=/[a-zA-Z]/;function IG(t,e,i){PH(2,arguments);var n=String(e),r=i||{},s=r.locale||GH,o=s.options&&s.options.firstWeekContainsDate,a=null==o?1:qH(o),l=null==r.firstWeekContainsDate?a:qH(r.firstWeekContainsDate);if(!(l>=1&&l<=7))throw new RangeError(\"firstWeekContainsDate must be between 1 and 7 inclusively\");var c=s.options&&s.options.weekStartsOn,h=null==c?0:qH(c),u=null==r.weekStartsOn?h:qH(r.weekStartsOn);if(!(u>=0&&u<=6))throw new RangeError(\"weekStartsOn must be between 0 and 6 inclusively\");if(!s.localize)throw new RangeError(\"locale must contain localize property\");if(!s.formatLong)throw new RangeError(\"locale must contain formatLong property\");var d=RH(t);if(!FH(d))throw new RangeError(\"Invalid time value\");var p=_G(d),f=YH(d,p),m={firstWeekContainsDate:l,weekStartsOn:u,locale:s,_originalDate:d},g=n.match(kG).map(function(t){var e=t[0];return\"p\"===e||\"P\"===e?(0,vG[e])(t,s.formatLong,m):t}).join(\"\").match(CG).map(function(i){if(\"''\"===i)return\"'\";var n=i[0];if(\"'\"===n)return OG(i);var o=mG[n];if(o)return!r.useAdditionalWeekYearTokens&&xG(i)&&SG(i,e,t),!r.useAdditionalDayOfYearTokens&&wG(i)&&SG(i,e,t),o(f,i,s.localize,m);if(n.match(TG))throw new RangeError(\"Format string contains an unescaped latin alphabet character `\"+n+\"`\");return i}).join(\"\");return g}function OG(t){return t.match(EG)[1].replace(MG,\"'\")}const PG=86400;function DG(t){if(t<0)return`/!\\\\ Dur\\xe9e n\\xe9gative ${DG(-t)}`;if(t<60)return\"moins d'une minute\";const e=Math.floor(t/PG),i=Math.floor(t%PG/3600),n=Math.floor(t%3600/60),r=[];return e>=1&&r.push(`${e} jour${e>1?\"s\":\"\"}`),i>=1&&r.push(`${i} heure${i>1?\"s\":\"\"}`),r.length<2&&0!==n&&r.push(`${n} minute${n>1?\"s\":\"\"}`),`${r.join(\", \")}`}function RG(t){if(t<0)return`/!\\\\ Dur\\xe9e n\\xe9gative ${RG(-t)}`;if(t<60)return\"< 1m\";const e=Math.floor(t/PG),i=Math.floor(t%PG/3600),n=Math.floor(t%3600/60),r=[];return e>=1&&r.push(`${e}j`),i>=1&&r.push(`${i}h`),r.length<2&&0!==n&&r.push(`${n}m`),`${r.join(\" \")}`}function FG(t){return Math.floor(t.getTime()/1e3)}function LG(t){return IG(t,\"dd/MM/yyyy\")}function BG(t){return new Date(t).toISOString().substr(0,19)}let NG=(()=>{class t{constructor(){this.active$=new Zp(!1),this.selectedPIM$=new Zp(null),this.nextStartDate$=new Zp(FG(new Date)),this.nextSpeed$=new Zp(10)}togglePIMMode(){this.active$.next(!this.active$.value)}selectPIM(t){this.selectedPIM$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const zG=xU.reduce((t,e)=>(t[e.flag]=e,t),{}),VG={flag:\"undefined\",iso2:\"undefined\",iso3:\"undefined\",name:\"Inconnu\",searchValue:\"\"};function jG(t){return function(t){var e;return null!==(e=zG[t])&&void 0!==e?e:VG}(t)}const $G=Object.entries({201:[\"AL\",\"ALB\",\"\",\"Albania\"],202:[\"AD\",\"AND\",\"\",\"Andorra\"],203:[\"AT\",\"AUT\",\"\",\"Austria\"],204:[\"PT\",\"PRT\",\"PT-20\",\"Azores\"],205:[\"BE\",\"BEL\",\"\",\"Belgium\"],206:[\"BY\",\"BLR\",\"\",\"Belarus\"],207:[\"BG\",\"BGR\",\"\",\"Bulgaria\"],208:[\"VA\",\"VAT\",\"\",\"Vatican City State\"],209:[\"CY\",\"CYP\",\"\",\"Cyprus\"],210:[\"CY\",\"CYP\",\"\",\"Cyprus\"],211:[\"DE\",\"DEU\",\"\",\"Germany\"],212:[\"CY\",\"CYP\",\"\",\"Cyprus\"],213:[\"GE\",\"GEO\",\"\",\"Georgia\"],214:[\"MD\",\"MDA\",\"\",\"Moldova\"],215:[\"MT\",\"MLT\",\"\",\"Malta\"],216:[\"AM\",\"ARM\",\"\",\"Armenia\"],218:[\"DE\",\"DEU\",\"\",\"Germany\"],219:[\"DK\",\"DNK\",\"\",\"Denmark\"],220:[\"DK\",\"DNK\",\"\",\"Denmark\"],224:[\"ES\",\"ESP\",\"\",\"Spain\"],225:[\"ES\",\"ESP\",\"\",\"Spain\"],226:[\"FR\",\"FRA\",\"\",\"France\"],227:[\"FR\",\"FRA\",\"\",\"France\"],228:[\"FR\",\"FRA\",\"\",\"France\"],229:[\"MT\",\"MLT\",\"\",\"Malta\"],230:[\"FI\",\"FIN\",\"\",\"Finland\"],231:[\"FO\",\"FRO\",\"\",\"Faroe Islands\"],232:[\"GB\",\"GBR\",\"\",\"United Kingdom\"],233:[\"GB\",\"GBR\",\"\",\"United Kingdom\"],234:[\"GB\",\"GBR\",\"\",\"United Kingdom\"],235:[\"GB\",\"GBR\",\"\",\"United Kingdom\"],236:[\"GI\",\"GIB\",\"\",\"Gibraltar\"],237:[\"GR\",\"GRC\",\"\",\"Greece\"],238:[\"HR\",\"HRV\",\"\",\"Croatia\"],239:[\"GR\",\"GRC\",\"\",\"Greece\"],240:[\"GR\",\"GRC\",\"\",\"Greece\"],241:[\"GR\",\"GRC\",\"\",\"Greece\"],242:[\"MA\",\"MAR\",\"\",\"Morocco\"],243:[\"HU\",\"HUN\",\"\",\"Hungary\"],244:[\"NL\",\"NLD\",\"\",\"Netherlands\"],245:[\"NL\",\"NLD\",\"\",\"Netherlands\"],246:[\"NL\",\"NLD\",\"\",\"Netherlands\"],247:[\"IT\",\"ITA\",\"\",\"Italy\"],248:[\"MT\",\"MLT\",\"\",\"Malta\"],249:[\"MT\",\"MLT\",\"\",\"Malta\"],250:[\"IE\",\"IRL\",\"\",\"Ireland\"],251:[\"IS\",\"ISL\",\"\",\"Iceland\"],252:[\"LI\",\"LIE\",\"\",\"Liechtenstein\"],253:[\"LU\",\"LUX\",\"\",\"Luxembourg\"],254:[\"MC\",\"MCO\",\"\",\"Monaco\"],255:[\"PT\",\"PRT\",\"PT-30\",\"Madeira\"],256:[\"MT\",\"MLT\",\"\",\"Malta\"],257:[\"NO\",\"NOR\",\"\",\"Norway\"],258:[\"NO\",\"NOR\",\"\",\"Norway\"],259:[\"NO\",\"NOR\",\"\",\"Norway\"],261:[\"PL\",\"POL\",\"\",\"Poland\"],262:[\"ME\",\"MNE\",\"\",\"Montenegro\"],263:[\"PT\",\"PRT\",\"\",\"Portugal\"],264:[\"RO\",\"ROU\",\"\",\"Romania\"],265:[\"SE\",\"SWE\",\"\",\"Sweden\"],266:[\"SE\",\"SWE\",\"\",\"Sweden\"],267:[\"SK\",\"SVK\",\"\",\"Slovak Republic\"],268:[\"SM\",\"SMR\",\"\",\"San Marino\"],269:[\"CH\",\"CHE\",\"\",\"Switzerland\"],270:[\"CZ\",\"CZE\",\"\",\"Czech Republic\"],271:[\"TR\",\"TUR\",\"\",\"Turkey\"],272:[\"UA\",\"UKR\",\"\",\"Ukraine\"],273:[\"RU\",\"RUS\",\"\",\"Russia\"],274:[\"MK\",\"MKD\",\"\",\"Macedonia\"],275:[\"LV\",\"LVA\",\"\",\"Latvia\"],276:[\"EE\",\"EST\",\"\",\"Estonia\"],277:[\"LT\",\"LTU\",\"\",\"Lithuania\"],278:[\"SI\",\"SVN\",\"\",\"Slovenia\"],279:[\"RS\",\"SRB\",\"\",\"Serbia\"],301:[\"AI\",\"AIA\",\"\",\"Anguilla\"],303:[\"US\",\"USA\",\"US-AK\",\"Alaska\"],304:[\"AG\",\"ATG\",\"\",\"Antigua and Barbuda\"],305:[\"AG\",\"ATG\",\"\",\"Antigua and Barbuda\"],306:[\"CW\",\"CUW\",\"\",\"Antilles\"],307:[\"AW\",\"ABW\",\"\",\"Aruba\"],308:[\"BS\",\"BHS\",\"\",\"Bahamas\"],309:[\"BS\",\"BHS\",\"\",\"Bahamas\"],310:[\"BM\",\"BMU\",\"\",\"Bermuda\"],311:[\"BS\",\"BMU\",\"\",\"Bahamas\"],312:[\"BZ\",\"BLZ\",\"\",\"Belize\"],314:[\"BB\",\"BRB\",\"\",\"Barbados\"],316:[\"CA\",\"CAN\",\"\",\"Canada\"],319:[\"KY\",\"CYM\",\"\",\"Cayman Islands\"],321:[\"CR\",\"CRI\",\"\",\"Costa Rica\"],323:[\"CU\",\"CUB\",\"\",\"Cuba\"],325:[\"DM\",\"DMA\",\"\",\"Dominica\"],327:[\"DO\",\"DOM\",\"\",\"Dominican Republic\"],329:[\"GP\",\"GLP\",\"\",\"Guadeloupe\"],330:[\"GD\",\"GRD\",\"\",\"Grenada\"],331:[\"GL\",\"GRL\",\"\",\"Greenland\"],332:[\"GT\",\"GTM\",\"\",\"Guatemala\"],335:[\"HN\",\"HND\",\"\",\"Honduras\"],336:[\"HT\",\"HTI\",\"\",\"Haiti\"],338:[\"US\",\"USA\",\"\",\"United States of America\"],339:[\"JM\",\"JAM\",\"\",\"Jamaica\"],341:[\"KN\",\"KNA\",\"\",\"Saint Kitts and Nevis\"],343:[\"LC\",\"LCA\",\"\",\"Saint Lucia\"],345:[\"MX\",\"MEX\",\"\",\"Mexico\"],347:[\"MQ\",\"MTQ\",\"\",\"Martinique\"],348:[\"MS\",\"MSR\",\"\",\"Montserrat\"],350:[\"NI\",\"NIC\",\"\",\"Nicaragua\"],351:[\"PA\",\"PAN\",\"\",\"Panama\"],352:[\"PA\",\"PAN\",\"\",\"Panama\"],353:[\"PA\",\"PAN\",\"\",\"Panama\"],354:[\"PA\",\"PAN\",\"\",\"Panama\"],355:[\"PA\",\"PAN\",\"\",\"Panama\"],356:[\"PA\",\"PAN\",\"\",\"Panama\"],357:[\"PA\",\"PAN\",\"\",\"Panama\"],358:[\"PR\",\"PRI\",\"\",\"Puerto Rico\"],359:[\"SV\",\"SLV\",\"\",\"El Salvador\"],361:[\"PM\",\"SPM\",\"\",\"Saint Pierre and Miquelon\"],362:[\"TT\",\"TTO\",\"\",\"Trinidad and Tobago\"],364:[\"TC\",\"TCA\",\"\",\"Turks and Caicos Islands\"],366:[\"US\",\"USA\",\"\",\"United States of America\"],367:[\"US\",\"USA\",\"\",\"United States of America\"],368:[\"US\",\"USA\",\"\",\"United States of America\"],369:[\"US\",\"USA\",\"\",\"United States of America\"],370:[\"PA\",\"PAN\",\"\",\"Panama\"],371:[\"PA\",\"PAN\",\"\",\"Panama\"],372:[\"PA\",\"PAN\",\"\",\"Panama\"],373:[\"PA\",\"PAN\",\"\",\"Panama\"],374:[\"PA\",\"PAN\",\"\",\"Panama\"],375:[\"VC\",\"VCT\",\"\",\"Saint Vincent and the Grenadines\"],376:[\"VC\",\"VCT\",\"\",\"Saint Vincent and the Grenadines\"],377:[\"VC\",\"VCT\",\"\",\"Saint Vincent and the Grenadines\"],378:[\"VG\",\"VGB\",\"\",\"British Virgin Islands\"],379:[\"VI\",\"VIR\",\"\",\"United States Virgin Islands\"],401:[\"AF\",\"AFG\",\"\",\"Afghanistan\"],403:[\"SA\",\"SAU\",\"\",\"Saudi Arabia\"],405:[\"BD\",\"BGD\",\"\",\"Bangladesh\"],408:[\"BH\",\"BHR\",\"\",\"Bahrain\"],410:[\"BT\",\"BTN\",\"\",\"Bhutan\"],412:[\"CN\",\"CHN\",\"\",\"China\"],413:[\"CN\",\"CHN\",\"\",\"China\"],414:[\"CN\",\"CHN\",\"\",\"China\"],416:[\"TW\",\"TWN\",\"\",\"Taiwan\"],417:[\"LK\",\"LKA\",\"\",\"Sri Lanka\"],419:[\"IN\",\"IND\",\"\",\"India\"],422:[\"IR\",\"IRN\",\"\",\"Iran\"],423:[\"AZ\",\"AZE\",\"\",\"Azerbaijan\"],425:[\"IQ\",\"IRQ\",\"\",\"Iraq\"],428:[\"IL\",\"ISR\",\"\",\"Israel\"],431:[\"JP\",\"JPN\",\"\",\"Japan\"],432:[\"JP\",\"JPN\",\"\",\"Japan\"],434:[\"TM\",\"TKM\",\"\",\"Turkmenistan\"],436:[\"KZ\",\"KAZ\",\"\",\"Kazakhstan\"],437:[\"UZ\",\"UZB\",\"\",\"Uzbekistan\"],438:[\"JO\",\"JOR\",\"\",\"Jordan\"],440:[\"KR\",\"KOR\",\"\",\"Korea\"],441:[\"KR\",\"KOR\",\"\",\"Korea\"],443:[\"PS\",\"PSE\",\"\",\"State of Palestine\"],445:[\"KP\",\"PRK\",\"\",\"Democratic People's Republic of Korea\"],447:[\"KW\",\"KWT\",\"\",\"Kuwait\"],450:[\"LB\",\"LBN\",\"\",\"Lebanon\"],451:[\"KG\",\"KGZ\",\"\",\"Kyrgyz Republic\"],453:[\"MO\",\"MAC\",\"\",\"Macao\"],455:[\"MV\",\"MDV\",\"\",\"Maldives\"],457:[\"MN\",\"MNG\",\"\",\"Mongolia\"],459:[\"NP\",\"NPL\",\"\",\"Nepal\"],461:[\"OM\",\"OMN\",\"\",\"Oman\"],463:[\"PK\",\"PAK\",\"\",\"Pakistan\"],466:[\"QA\",\"QAT\",\"\",\"Qatar (State of)\"],468:[\"SY\",\"SYR\",\"\",\"Syrian Arab Republic\"],470:[\"AE\",\"ARE\",\"\",\"United Arab Emirates\"],472:[\"TJ\",\"TJK\",\"\",\"Tajikistan\"],473:[\"YE\",\"YEM\",\"\",\"Yemen\"],475:[\"YE\",\"YEM\",\"\",\"Yemen\"],477:[\"HK\",\"HKG\",\"\",\"Hong Kong\"],478:[\"BA\",\"BIH\",\"\",\"Bosnia and Herzegovina\"],501:[\"FR\",\"FRA\",\"AQ\",\"Adelie Land\"],503:[\"AU\",\"AUS\",\"\",\"Australia\"],506:[\"MM\",\"MMR\",\"\",\"Myanmar\"],508:[\"BN\",\"BRN\",\"\",\"Brunei Darussalam\"],510:[\"FM\",\"FSM\",\"\",\"Micronesia\"],511:[\"PW\",\"PLW\",\"\",\"Palau\"],512:[\"NZ\",\"NZL\",\"\",\"New Zealand\"],514:[\"KH\",\"KHM\",\"\",\"Cambodia\"],515:[\"KH\",\"KHM\",\"\",\"Cambodia\"],516:[\"CX\",\"CXR\",\"\",\"Christmas Island\"],518:[\"CK\",\"COK\",\"\",\"Cook Islands\"],520:[\"FJ\",\"FJI\",\"\",\"Fiji\"],523:[\"CC\",\"CCK\",\"\",\"Cocos (Keeling) Islands\"],525:[\"ID\",\"IDN\",\"\",\"Indonesia\"],529:[\"KI\",\"KIR\",\"\",\"Kiribati\"],531:[\"LA\",\"LAO\",\"\",\"Lao People's Democratic Republic\"],533:[\"MY\",\"MYS\",\"\",\"Malaysia\"],536:[\"MP\",\"MNP\",\"\",\"Northern Mariana Islands\"],538:[\"MH\",\"MHL\",\"\",\"Marshall Islands\"],540:[\"NC\",\"NCL\",\"\",\"New Caledonia\"],542:[\"NU\",\"NIU\",\"\",\"Niue\"],544:[\"NR\",\"NRU\",\"\",\"Nauru\"],546:[\"PF\",\"PYF\",\"\",\"French Polynesia\"],548:[\"PH\",\"PHL\",\"\",\"Philippines\"],553:[\"PG\",\"PNG\",\"\",\"Papua New Guinea\"],555:[\"PN\",\"PCN\",\"\",\"Pitcairn Island\"],557:[\"SB\",\"SLB\",\"\",\"Solomon Islands\"],559:[\"AS\",\"ASM\",\"\",\"American Samoa\"],561:[\"WS\",\"WSM\",\"\",\"Samoa\"],563:[\"SG\",\"SGP\",\"\",\"Singapore\"],564:[\"SG\",\"SGP\",\"\",\"Singapore\"],565:[\"SG\",\"SGP\",\"\",\"Singapore\"],566:[\"SG\",\"SGP\",\"\",\"Singapore\"],567:[\"TH\",\"THA\",\"\",\"Thailand\"],570:[\"TO\",\"TON\",\"\",\"Tonga\"],572:[\"TV\",\"TUV\",\"\",\"Tuvalu\"],574:[\"VN\",\"VNM\",\"\",\"Viet Nam\"],576:[\"VU\",\"VUT\",\"\",\"Vanuatu\"],577:[\"VU\",\"VUT\",\"\",\"Vanuatu\"],578:[\"WF\",\"WLF\",\"\",\"Wallis and Futuna Islands\"],601:[\"ZA\",\"ZAF\",\"\",\"South Africa\"],603:[\"AO\",\"AGO\",\"\",\"Angola\"],605:[\"DZ\",\"DZA\",\"\",\"Algeria\"],607:[\"FR\",\"FRA\",\"TF\",\"Saint Paul and Amsterdam Islands\"],608:[\"GB\",\"GBR\",\"AC\",\"Ascension Island\"],609:[\"BI\",\"BDI\",\"\",\"Burundi\"],610:[\"BJ\",\"BEN\",\"\",\"Benin\"],611:[\"BW\",\"BWA\",\"\",\"Botswana\"],612:[\"CF\",\"CAF\",\"\",\"Central African Republic\"],613:[\"CM\",\"CMR\",\"\",\"Cameroon\"],615:[\"CG\",\"COG\",\"\",\"Congo\"],616:[\"KM\",\"COM\",\"\",\"Comoros\"],617:[\"CV\",\"CPV\",\"\",\"Cabo Verde\"],618:[\"FR\",\"FRA\",\"TF\",\"Crozet Archipelago\"],619:[\"CI\",\"CIV\",\"\",\"Ivory Coast\"],620:[\"KM\",\"COM\",\"\",\"Comoros\"],621:[\"DJ\",\"DJI\",\"\",\"Djibouti\"],622:[\"EG\",\"EGY\",\"\",\"Egypt\"],624:[\"ET\",\"ETH\",\"\",\"Ethiopia\"],625:[\"ER\",\"ERI\",\"\",\"Eritrea\"],626:[\"GA\",\"GAB\",\"\",\"Gabonese Republic\"],627:[\"GH\",\"GHA\",\"\",\"Ghana\"],629:[\"GM\",\"GMB\",\"\",\"Gambia\"],630:[\"GW\",\"GNB\",\"\",\"Guinea-Bissau\"],631:[\"GQ\",\"GNQ\",\"\",\"Equatorial Guinea\"],632:[\"GN\",\"GIN\",\"\",\"Guinea\"],633:[\"BF\",\"BFA\",\"\",\"Burkina Faso\"],634:[\"KE\",\"KEN\",\"\",\"Kenya\"],635:[\"FR\",\"FRA\",\"TF\",\"Kerguelen Islands\"],636:[\"LR\",\"LBR\",\"\",\"Liberia\"],637:[\"LR\",\"LBR\",\"\",\"Liberia\"],638:[\"SS\",\"SSD\",\"\",\"South Sudan\"],642:[\"LY\",\"LBY\",\"\",\"Libya\"],644:[\"LS\",\"LSO\",\"\",\"Lesotho\"],645:[\"MU\",\"MUS\",\"\",\"Mauritius\"],647:[\"MG\",\"MDG\",\"\",\"Madagascar\"],649:[\"ML\",\"MLI\",\"\",\"Mali\"],650:[\"MZ\",\"MOZ\",\"\",\"Mozambique\"],654:[\"MR\",\"MRT\",\"\",\"Mauritania\"],655:[\"MW\",\"MWI\",\"\",\"Malawi\"],656:[\"NE\",\"NER\",\"\",\"Niger\"],657:[\"NG\",\"NGA\",\"\",\"Nigeria\"],659:[\"NA\",\"NAM\",\"\",\"Namibia\"],660:[\"RE\",\"REU\",\"\",\"Reunion\"],661:[\"RW\",\"RWA\",\"\",\"Rwanda\"],662:[\"SD\",\"SDN\",\"\",\"Sudan\"],663:[\"SN\",\"SEN\",\"\",\"Senegal\"],664:[\"SC\",\"SYC\",\"\",\"Seychelles\"],665:[\"SH\",\"SHN\",\"\",\"Saint Helena\"],666:[\"SO\",\"SOM\",\"\",\"Somali Democratic Republic\"],667:[\"SL\",\"SLE\",\"\",\"Sierra Leone\"],668:[\"ST\",\"STP\",\"\",\"Sao Tome and Principe\"],669:[\"SZ\",\"SWZ\",\"\",\"Swaziland\"],670:[\"TD\",\"TCD\",\"\",\"Chad\"],671:[\"TG\",\"TGO\",\"\",\"Togolese Republic\"],672:[\"TN\",\"TUN\",\"\",\"Tunisian Republic\"],674:[\"TZ\",\"TZA\",\"\",\"Tanzania\"],675:[\"UG\",\"UGA\",\"\",\"Uganda\"],676:[\"CD\",\"COD\",\"\",\"Democratic Republic of the Congo\"],677:[\"TZ\",\"TZA\",\"\",\"Tanzania\"],678:[\"ZM\",\"ZMB\",\"\",\"Zambia\"],679:[\"ZW\",\"ZWE\",\"\",\"Zimbabwe\"],701:[\"AR\",\"ARG\",\"\",\"Argentine Republic\"],710:[\"BR\",\"BRA\",\"\",\"Brazil\"],720:[\"BO\",\"BOL\",\"\",\"Bolivia\"],725:[\"CL\",\"CHL\",\"\",\"Chile\"],730:[\"CO\",\"COL\",\"\",\"Colombia\"],735:[\"EC\",\"ECU\",\"\",\"Ecuador\"],740:[\"FK\",\"FLK\",\"\",\"Falkland Islands\"],745:[\"GF\",\"GUF\",\"\",\"Guiana\"],750:[\"GY\",\"GUY\",\"\",\"Guyana\"],755:[\"PY\",\"PRY\",\"\",\"Paraguay\"],760:[\"PE\",\"PER\",\"\",\"Peru\"],765:[\"SR\",\"SUR\",\"\",\"Suriname\"],770:[\"UY\",\"URY\",\"\",\"Uruguay\"],775:[\"VE\",\"VEN\",\"\",\"Venezuela\"]}).reduce((t,[e,[i]])=>(t[e]=i.toLowerCase(),t),{});Object.values(xU).reduce((t,e)=>(t[e.iso3.toLocaleLowerCase()]=e.iso2,t),{});const UG=[{key:\"cargo\",label:\"Marchandises\",aisTypes:[\"cargo\"],color:\"#78f48b\"},{key:\"tanker\",label:\"Mati\\xe8res dangereuses\",aisTypes:[\"tanker\"],color:\"#ff272d\"},{key:\"passenger\",label:\"Passagers\",aisTypes:[\"passenger\"],color:\"#0623c9\"},{key:\"submarine\",label:\"Travaux sous-marins\",aisTypes:[\"towing\",\"dredger\",\"diving\",\"tug\"],color:\"#9a460f\"},{key:\"fishing\",label:\"P\\xeache\",aisTypes:[\"fishing\"],color:\"#f78851\"},{key:\"leisure\",label:\"Plaisance\",aisTypes:[\"sailing\",\"leisure\"],color:\"#ff29ff\"},{key:\"military\",label:\"Militaire\",aisTypes:[\"military\"],color:\"#5910d0\"},{key:\"other\",label:\"Autre\",aisTypes:[\"other\"],color:\"#e1cf15\"},{key:\"default\",label:\"Non sp\\xe9cifi\\xe9\",aisTypes:[\"unspecified\"],color:\"#cccccc\"}];function HG(t,e){var i,n,r;let s=!1;if(t.colorResultTimestamp=0,!e.colorModeShipType)if(e.isMissingColorFilterConfiguration||e.frozenTimestamp)s=!0;else{let i=0;if(e.alertRules.length>0){const n=t.lastAlerts.find(t=>e.alertRules.includes(t.rule_id));n&&(i=n.timestamp)}let n=0;if(e.eventTypes.length>0){const i=t.lastEvents.find(t=>e.eventTypes.includes(t.type));i&&(n=i.timestamp)}t.colorResultTimestamp=Math.max(i,n),s=t.colorResultTimestamp>=e.absoluteMinimumTimestamp}t.stationary=t.stationary||t.sog&&parseFloat(t.sog)<1,t.visible=t.selected||(!e.restrictedShips.size||e.restrictedShips.has(t.mmsi))&&t.timestamp>=e.absoluteVisibilityThresholdTimestamp&&(!e.shipTypes.length||!!e.shipTypesCache[t.cargo])&&(!e.shipFlags.length||!!e.shipFlagsCache[t.country.flag])&&(!e.shipDestinations.length||t.destination&&e.shipDestinations.some(e=>t.destination.includes(e)))&&(!e.shipDepartures.length||t.departure&&e.shipDepartures.some(e=>t.departure.includes(e)))&&(!e.shipStatus.length||e.shipStatus.includes(t.status))&&(!e.shipSpeed||e.shipSpeed.min<=t.numberSog&&t.numberSog<=e.shipSpeed.max)&&(!e.shipLength||e.shipLength.min<=t.length&&t.length<=e.shipLength.max)&&(!e.shipWidth||e.shipWidth.min<=t.width&&t.width<=e.shipWidth.max)&&(!e.shipDraught||e.shipDraught.min<=t.numberDraught&&t.numberDraught<=e.shipDraught.max)&&(!e.shipYearofbuild||e.shipYearofbuild.min<=t.yearofbuild&&t.yearofbuild<=e.shipYearofbuild.max||e.shipYearofbuildIncludeNulls&&0===t.yearofbuild)&&(!e.shipCourse||(e.shipCourse.min<e.shipCourse.max?e.shipCourse.min<=t.numberCog&&t.numberCog<=e.shipCourse.max:e.shipCourse.min<=t.numberCog||t.numberCog<=e.shipCourse.max))&&(!e.fleets.length||e.fleetsShipsCache.includes(t.mmsi))&&(!e.shipIdentifier.length||(null===(i=t.name)||void 0===i?void 0:i.includes(e.shipIdentifier))||(null===(n=t.mmsi)||void 0===n?void 0:n.includes(e.shipIdentifier))||(null===(r=t.imo)||void 0===r?void 0:r.includes(e.shipIdentifier)))&&(e.colorModeShipType||e.colorModeAllShips||e.colorModeResultsOnly&&s)&&(0===e.selectedShips.size||e.frozenTimestamp>0||!e.selectedShips.has(t.mmsi)),t.transparent=t.timestamp<=e.absoluteTransparencyThresholdTimestamp}function GG(t){return[t.mmsi,t.imo,t.callsign,Qj(t.name),t.country.flag,t.cargo,t.shipType.key,t.length,t.width,t.draught,Qj(t.destination),Qj(t.departure),t.eta]}function qG(t,e,i){if(i)for(;t.positionIndex>0&&t.positions[t.positionIndex].timestamp>e;)t.positionIndex--;else for(;t.positionIndex<t.positions.length-1&&t.positions[t.positionIndex+1].timestamp<e;)t.positionIndex++;const n=t.positions[t.positionIndex],r=e<=t.positions[0].timestamp||t.positionIndex===t.positions.length-1;t.visible=!r,t.position=r?[n.lon,n.lat]:function(t,e,i){const n=(i-t.timestamp)/(e.timestamp-t.timestamp);return[t.lon+(e.lon-t.lon)*n,t.lat+(e.lat-t.lat)*n]}(n,t.positions[t.positionIndex+1],e),t.course=n.course,t.speed=n.speed}UG.forEach(t=>{t.rgbColor=sH(t.color),t.textColor=aH(t.color,20)}),UG.reduce((t,e)=>(t[e.key]=e,t),{}),UG.flatMap(t=>t.aisTypes.map(e=>[e,t])).reduce((t,[e,i])=>(t[e]=i,t),{});const WG=[1,2,5,10,20,30];let YG=(()=>{class t{constructor(t){this.workerService=t,this.active$=new Zp(!1),this.startTimestamp$=new Zp(0),this.duration$=new Zp(0),this.shipsByMMSI$=new Zp(null),this.animationTimestamp$=new Zp(0),this.paused$=new Zp(!0),this.reverseMode$=new Zp(!1),this.animationSpeed$=new Zp(10),this.lastFrameMs=0,this.viewExtent=null,this.animate=t=>{const e=this.animationTimestamp$.value+(this.reverseMode$.value?-1:1)*this.animationSpeed$.value*(t-this.lastFrameMs)*.006;this.lastFrameMs=t;const i=this.reverseMode$.value;Object.values(this.shipsByMMSI$.value).forEach(t=>{qG(t,e,i)}),this.animationTimestamp$.next(e),this.reverseMode$.value?e-this.minTimestamp<900&&(this.minTimestamp=this.minTimestamp-this.duration$.value,this.loadChunk(this.minTimestamp,this.duration$.value)):this.maxTimestamp-e<900&&(this.loadChunk(this.maxTimestamp,this.duration$.value),this.maxTimestamp=this.maxTimestamp+this.duration$.value),this.animationFrameTimeout=requestAnimationFrame(this.animate)},this.paused$.subscribe(t=>{t?cancelAnimationFrame(this.animationFrameTimeout):requestAnimationFrame(t=>{this.lastFrameMs=t,this.animationFrameTimeout=requestAnimationFrame(this.animate)})})}enterPlaybackMode(){this.active$.next(!0)}exitPlaybackMode(){cancelAnimationFrame(this.animationFrameTimeout),this.shipsByMMSI$.next(null),this.active$.next(!1)}loadPlayback(t,e){return Vp(this,void 0,void 0,function*(){this.startTimestamp$.next(t),this.duration$.next(e),this.minTimestamp=t-e,this.maxTimestamp=t+e,this.paused$.next(!0),this.reverseMode$.next(!1),this.shipsByMMSI$.next({}),yield Promise.all([this.loadChunk(t-e,e),this.loadChunk(t,e)]),Object.values(this.shipsByMMSI$.value).forEach(e=>{qG(e,t,!1)}),this.animationTimestamp$.next(t)})}reinitiate(){this.animationTimestamp$.next(this.startTimestamp$.value)}loadChunk(t,e){return Vp(this,void 0,void 0,function*(){const i=yield this.workerService.ships.getShipsPlaybackAtBboxAndTimestamp(this.viewExtent,t,e),n=this.shipsByMMSI$.value;console.time(\"assemble chunk\");const r=this.reverseMode$.value;i.forEach(t=>{if(n[t.mmsi]){const e=n[t.mmsi];e.positions=e.positions.concat(t.positions).sort((t,e)=>t.timestamp-e.timestamp),e.positionIndex=r?e.positions.length-1:0;const i=e.positions,s=i.length-1;for(let t=0;t<s;t++)if(i[t].chunkEnd){const e=[i[t].lon,i[t].lat],n=[i[t+1].lon,i[t+1].lat];i[t].course=(2*Math.PI+Math.PI/2-y$(e,n))%(2*Math.PI),i[t].speed=Math.round(10*b$(e,n,i[t+1].timestamp-i[t].timestamp))/10}}else n[t.mmsi]=t});const s=this.animationTimestamp$.value,o=this.reverseMode$.value;Object.values(n).forEach(t=>{qG(t,s,o)}),console.timeEnd(\"assemble chunk\"),this.shipsByMMSI$.next(n)})}togglePause(){this.paused$.next(!this.paused$.value)}toggleReverseMode(){this.reverseMode$.next(!this.reverseMode$.value)}updateSpeed(t){const e=WG.indexOf(this.animationSpeed$.value);\"-\"===t?e>0&&this.animationSpeed$.next(WG[e-1]):e<WG.length-1&&this.animationSpeed$.next(WG[e+1])}updateViewBox(t){this.viewExtent=t}}return t.\\u0275fac=function(e){return new(e||t)(En(iU))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const ZG=[-1165201.47,4946429.48,1168528.74,6341728.49];let XG=(()=>{class t{constructor(t,e){this.mapService=t,this.mapConfigService=e,this.isConfiguringZonex$=new Zp(!1),this.selectedZonex=[]}enterConfigurationMode(){this.isConfiguringZonex$.next(!0),this.mapService.fitOn(ZG),this.selectedZonex=[...this.mapConfigService.displayedZonex$.value]}saveConfiguration(){this.mapConfigService.updateDisplayedZonex(this.selectedZonex),this.cancelConfiguration()}cancelConfiguration(){this.isConfiguringZonex$.next(!1),this.selectedZonex=[]}toggleSelection(t){const e=this.selectedZonex.indexOf(t);-1!==e?this.selectedZonex.splice(e,1):this.selectedZonex.push(t)}}return t.\\u0275fac=function(e){return new(e||t)(En(T$),En(k$))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),KG=(()=>{class t{constructor(t,e,i,n,r,s,o,a,l,c,h){this.alertsService=t,this.alertRulesService=e,this.annotationService=i,this.drawingService=n,this.historyService=r,this.mapConfigService=s,this.measureService=o,this.pimService=a,this.playbackService=l,this.routeService=c,this.zonexService=h,this.coordinateSystem$=new Zp(kj.find(t=>\"dms\"===t.key));const u=this.routeService.route$.pipe(E(t=>\"/zones\"===t),Cf()),d=this.routeService.route$.pipe(E(t=>\"/moves\"===t),Cf()),p=this.routeService.route$.pipe(E(t=>\"/ports\"===t),Cf()),f=this.routeService.route$.pipe(E(t=>t.startsWith(\"/alerts/rules/\")),Cf()),m=this.routeService.route$.pipe(E(t=>\"/annotations\"===t),Cf());this.mustHideEntities$=LT([u,f,this.playbackService.active$,this.zonexService.isConfiguringZonex$]).pipe(E(([t,e,i,n])=>t||e||i||n),Cf()),this.minimumZoom$=LT([this.historyService.timestamp$.pipe(E(t=>!!t)),this.mapConfigService.limitMinimumZoom$,this.alertRulesService.selectedAlertRuleId$,u,d]).pipe(E(([t,e,i,n,r])=>t?7:i||n?2.5:r?5:e?6:2.5),Cf()),this.featuresSelectable$=LT([d,this.annotationService.editedAnnotation$.pipe(E(t=>!!t)),this.drawingService.drawingZoneMode$,this.measureService.active$,this.pimService.active$,this.zonexService.isConfiguringZonex$]).pipe(E(([t,e,i,n,r,s])=>!(t||e||i||n||r||s)),Cf()),this.showShipsLayer$=LT([this.mapConfigService.showShipsLayer$,this.mustHideEntities$.pipe(cf(500))]).pipe(E(([t,e])=>t&&!e),Cf()),this.showAircraftsLayer$=LT([this.mapConfigService.showAircraftsLayer$,this.mustHideEntities$.pipe(cf(500))]).pipe(E(([t,e])=>t&&!e),Cf()),this.showAnnotationsLayer$=LT([this.mapConfigService.showAnnotationsLayer$,m,this.annotationService.editedAnnotation$.pipe(E(t=>!!t)),this.zonexService.isConfiguringZonex$]).pipe(E(([t,e,i,n])=>(t||e||i)&&!n),Cf()),this.showPortsLayer$=LT([this.mapConfigService.showPortsLayer$,p]).pipe(E(([t,e])=>t||e),Cf()),this.selectableHexagons$=this.drawingService.drawingZoneMode$.pipe(Cf()),this.showHexagonsLayer$=LT([this.selectableHexagons$,this.mapConfigService.showHexagonsLayer$,d]).pipe(E(([t,e,i])=>t||e&&!i),Cf()),this.showEdgesLayer$=d.pipe(Cf()),this.showTrailsLayer$=LT([this.mapConfigService.showTrailsLayer$,this.mustHideEntities$]).pipe(E(([t,e])=>t&&!e),Cf()),this.showSelectionMarkers$=this.mustHideEntities$.pipe(E(t=>!t),Cf()),this.showEntitiesSelections$=LT([this.mapConfigService.enableMultiSelectionMode$,this.mustHideEntities$]).pipe(E(([t,e])=>t&&!e),Cf()),this.showAlertsLayer$=LT([this.alertsService.alerts$,this.mustHideEntities$]).pipe(E(([t,e])=>t.length>0||!e),Cf()),this.showEventsLayer$=this.showAlertsLayer$,this.mapConfigService.coordinateSystem$.subscribe(t=>{this.coordinateSystem$.next(kj.find(e=>e.key===t))})}}return t.\\u0275fac=function(e){return new(e||t)(En(uH),En(hH),En(fH),En(mH),En(R$),En(k$),En(OH),En(NG),En(YG),En(F$),En(XG))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();function QG(t){return new Promise((e,i)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>i(t.error)})}let JG;function tq(){return JG||(JG=function(t,e){const i=function(){var t;return!navigator.userAgentData&&/Safari\\//.test(navigator.userAgent)&&!/Chrom(e|ium)\\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var i=function(){return indexedDB.databases().finally(e)};t=setInterval(i,100),i()}).finally(function(){return clearInterval(t)}):Promise.resolve()}().then(()=>{const t=indexedDB.open(\"keyval-store\");return t.onupgradeneeded=()=>t.result.createObjectStore(e),QG(t)});return(t,n)=>i.then(i=>n(i.transaction(e,t).objectStore(e)))}(0,\"keyval\")),JG}function eq(t,e=tq()){return e(\"readonly\",e=>QG(e.get(t)))}function iq(t,e,i=tq()){return i(\"readwrite\",i=>(i.put(e,t),QG(i.transaction)))}class nq{constructor(t){this.config=t,this.progress=new Zp(null),this.progress$=this.progress.asObservable(),this.incrementCounter=()=>{this.progress.value.progressCounter++,this.progress.value.progressPercentage=this.progress.value.progressCounter/this.progress.value.stepTotal*100,this.progress.next(this.progress.value)}}execute(t){var e;return Vp(this,void 0,void 0,function*(){this.progress.next({numberOfSteps:this.config.numberOfSteps,stepTitle:t.title,stepTotal:t.total,stepNumber:this.progress.value?(null===(e=this.progress.value)||void 0===e?void 0:e.stepNumber)+1:this.config.initialStep?this.config.initialStep:1,progressCounter:0,progressPercentage:0}),yield t.action(this.incrementCounter)})}}const rq=\"offline-config\",sq=\"offline-user-data\";var oq=i(3845);function aq(t,e){const i=new Blob([JSON.stringify(t,null,2)],{type:\"application/json\"});cq(URL.createObjectURL(i),e)}function lq(t,e,i){const n=new Blob([t],{type:i});cq(URL.createObjectURL(n),e)}function cq(t,e){const i=document.createElement(\"a\");document.body.appendChild(i),i.type=\"hidden\",i.href=t,i.download=e,i.target=\"_blank\",i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)}function hq(t){return Vp(this,void 0,void 0,function*(){return new Promise(e=>{const i=new FileReader;i.addEventListener(\"loadend\",()=>{e(i.result)}),i.readAsText(t,\"utf-8\")})})}let uq=(()=>{class t{constructor(t,e,i){this.historyService=t,this.mapConfigService=e,this.uiService=i}registerVisibleAircraftsCallback(t){this.getVisibleAircraftsFn=t}registerVisibleShipsCallback(t){this.getVisibleShipsFn=t}exportVisiblePositions(){let t=this.historyService.timestamp$.value;0===t&&(t=FG(new Date));const e=IG(1e3*t,\"yyyy-MM-dd'T'HH-mm-ss\");let i=!1;const n=this.mapConfigService.showShipsLayer$.value;if(n){const t=this.getVisibleShipsFn();t.length&&(i=!0,lq(function(t){return[[\"timestamp\",\"lon\",\"lat\",\"hdms\",\"mmsi\",\"imo\",\"callsign\",\"name\",\"flag\",\"cargo\",\"type\",\"length\",\"width\",\"draught\",\"destination\",\"departure\",\"eta\"].join(\",\"),...t.map(t=>function(t){return[BG(1e3*t.timestamp),t.lon,t.lat,t.hdms,...GG(t)]}(t).join(\",\"))].join(\"\\n\")}(t),`anais-pistes-ships-${e}.csv`,\"text/csv\"))}const r=this.mapConfigService.showAircraftsLayer$.value;if(r){const t=this.getVisibleAircraftsFn();t.length&&(i=!0,lq(function(t){return[[\"icao\",\"callsign\",\"squawk\",\"timestamp\",\"lon\",\"lat\",\"hdms\",\"altitude\"].join(\",\"),...t.map(t=>function(t){return[t.icao,t.callsign,t.squawk,BG(t.timestamp),t.lon,t.lat,Sj([t.lon,t.lat]),t.altitude]}(t).join(\",\"))].join(\"\\n\")}(t),`anais-pistes-aircrafts-${e}.csv`,\"text/csv\"))}if(!i){const t=[n&&\"navire\",r&&\"a\\xe9ronef\"].filter(t=>!!t).join(\" ou \")||\"navire ou a\\xe9ronef\";this.uiService.error(`La vue courante ne contient aucun ${t}`)}}getEntitiesInExtent(t){const e=[];return this.mapConfigService.showShipsLayer$.value&&e.push(...this.getVisibleShipsFn(t)),this.mapConfigService.showAircraftsLayer$.value&&e.push(...this.getVisibleAircraftsFn(t)),e}}return t.\\u0275fac=function(e){return new(e||t)(En(R$),En(k$),En(AU))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const dq=[\"assets/images/2016mtln170_003.jpg\",\"assets/images/adsbexchange-icon.png\",\"assets/images/aircraft.png\",\"assets/images/alert-dubious-move.svg\",\"assets/images/alert-erratic-route.svg\",\"assets/images/alert-no-position.svg\",\"assets/images/alert-transhipment.svg\",\"assets/images/anchor.svg\",\"assets/images/arrow-chevron.png\",\"assets/images/danger.svg\",\"assets/images/favicon_anais.png\",\"assets/images/favicon_anais.svg\",\"assets/images/filter.svg\",\"assets/images/flag-undefined.svg\",\"assets/images/fleets.svg\",\"assets/images/flightradar24-icon.png\",\"assets/images/glitter-star.png\",\"assets/images/help-firefox-mixed-content-tutorial.png\",\"assets/images/hexagon.svg\",\"assets/images/layers.svg\",\"assets/images/lifeline.png\",\"assets/images/lloyds-icon.png\",\"assets/images/login_background.jpg\",\"assets/images/logo_anais.png\",\"assets/images/logo_anais.svg\",\"assets/images/logo_fabnum.png\",\"assets/images/marinetraffic-icon.png\",\"assets/images/point.png\",\"assets/images/port.png\",\"assets/images/ship.png\",\"assets/images/tchap-logo.png\",\"assets/images/tooltips-mini.svg\",\"assets/images/tooltips.svg\",\"assets/images/trail-detailed.svg\",\"assets/images/trail-simple.svg\",\"assets/images/zones.svg\"],pq=[\"assets/geo/Limite_3milles_peche_WGS84_EPSG4326.geojson\",\"assets/geo/Limite_6milles_bande_cotiere_peche_WGS84_EPSG4326.geojson\",\"assets/geo/Delim_accord_WGS84.geojson\",\"assets/geo/Lignes_base_droites_WGS84.geojson\",\"assets/geo/Lim_ext_MT_WGS84.geojson\",\"assets/geo/Lim_ext_PC_WGS84.geojson\",\"assets/geo/Lim_ext_ZC_WGS84.geojson\",\"assets/geo/Lim_ext_ZEE_WGS84.geojson\",\"assets/geo/Lim_sans_accord_WGS84.geojson\",\"assets/geo/mrcc_2020-08-03.geojson\",\"assets/geo/sar_2020-08-03.geojson\",\"assets/geo/french-srr.geojson\",\"assets/geo/UK_12M_Limit.geojson\",\"assets/geo/UK_6M_Limit.geojson\",\"assets/geo/zonex.atlan.2021.geojson\",\"assets/geo/zonex.atlan.tirs.2021.corrected.geojson\",\"assets/geo/zonex.med.corrected.geojson\"];let fq=(()=>{class t{constructor(t,e,i,n,r,s,o){this.alertRulesService=t,this.authenticationService=e,this.exportService=i,this.mapConfigService=n,this.mapService=r,this.uiService=s,this.workerService=o,this.setupActive$=new Zp(!1),this.loading=!1,this.viewExtent$=new Zp(null),this.downloadProgress$=new Zp(null),this.offlineConfig$=new Zp(null),this.isOffline$=new Zp(!1),this.invalidIndexedDB=!1,this.offlineConfig$.subscribe(t=>{this.isOffline$.next(!!t)})}init(){var t;return Vp(this,void 0,void 0,function*(){const e=!!(null===(t=null==navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller);let i;if(e&&(i=yield new Promise((t,e)=>{const i=new MessageChannel;navigator.serviceWorker.controller.postMessage(\"state:info\",[i.port2]),i.port1.onmessage=e=>{t(e.data),i.port1.close()},setTimeout(e,5e3)})),e&&\"setup\"===i)return;try{this.offlineUserData=yield eq(sq)}catch(r){return void(this.invalidIndexedDB=!0)}const n=yield eq(rq);if(e&&\"ready\"===i&&n&&this.offlineUserData)return this.offlineConfig$.next(n),this.workerService.setOffline(!0),yield this.workerService.offline.loadFromIDB(),void this.mapService.hasBooted$.pipe(wf(1),pf(t=>t),_P(),I$(0)).subscribe(()=>{this.workerService.offline.triggerShipFeed()});e||n||this.offlineUserData?(yield this.exitOfflineMode(),yield $j(5e3)):this.workerService.setOffline(!1)})}getOfflineData(){return this.offlineUserData}enterSetupMode(){this.setupActive$.next(!0),this.mapConfigService.showShipsLayer$.value||this.mapConfigService.toggleShipsLayer()}exitSetupMode(){this.setupActive$.next(!1)}loadOfflineData(t){var e,i;return Vp(this,void 0,void 0,function*(){try{this.loading=!0;const e=this.mapConfigService.baseLayer$.value.source,i=e.getTileUrlFunction(),n=e.getTilePixelRatio(),r=this.mapService.view$.value.projection,s=e.getTileGrid(),o=s.getZForResolution(this.mapService.view$.value.resolution),a=rV(this.viewExtent$.value,\"EPSG:4326\",\"EPSG:3857\"),l=this.exportService.getVisibleShipsFn(a).map(t=>t.mmsi),c=yield this.workerService.ships.getLatestTimestamp(),h={extent:this.viewExtent$.value,mercatorExtent:a,minZoom:o,maxZoom:t.maxZoom,startTimestamp:c-t.timeRange,endTimestamp:c,includeAdditionalLayers:t.includeAdditionalLayers,includeTrails:t.includeTrails,includeEvents:t.includeEvents,includeAlerts:t.includeAlerts,includeLloydsInfos:t.includeLloydsInfos,shipFilter:Uj(this.mapConfigService.shipFilter$.value)};if(yield this.workerService.application.logUserActivity(\"offline-load\",Object.assign(Object.assign({},t),{zoomLevels:1+t.maxZoom-o,shipsCount:l.length})),this.mapConfigService.showAircraftsLayer$.value&&this.mapConfigService.toggleAircraftsLayer(),!(\"serviceWorker\"in navigator))throw new Error(\"Services workers non support\\xe9s par votre navigateur. Mode hors-ligne non disponible.\");yield navigator.serviceWorker.register(\"/service-worker.js\",{scope:\"/\"}),yield $j(500),navigator.serviceWorker.controller.postMessage(\"state:setup\"),yield $j(50),this.workerService.setOffline(!0),this.offlineConfig$.next(h);const u=new nq({numberOfSteps:2+(h.includeAdditionalLayers?1:0)+(h.includeTrails?1:0)+(h.includeEvents?1:0)+(h.includeAlerts?1:0)+(h.includeLloydsInfos?1:0)});let d;u.progress$.subscribe(t=>{this.downloadProgress$.next(t)}),yield u.execute({title:\"T\\xe9l\\xe9chargement des modules ANAIS\",total:dq.length+1,action:t=>Vp(this,void 0,void 0,function*(){d=yield function(t){return Vp(this,void 0,void 0,function*(){return new Promise((t,e)=>{const i=document.createElement(\"iframe\");i.onload=()=>{t(i)},i.onerror=e,i.src=\"/__offline-assets\",document.body.appendChild(i)})})}(),t(),yield Promise.all(dq.map(e=>Vp(this,void 0,void 0,function*(){yield fetch(e),t()})))})});const[p,f,m]=yield Promise.all([this.workerService.annotations.list(),this.workerService.fleets.list(),this.workerService.zones.list()]);yield iq(sq,{rules:this.alertRulesService.alertRules$.value,annotations:p,fleets:f,zones:m,user:this.authenticationService.user$.value});const g=[];for(let t=o;t<=h.maxZoom;t++)s.forEachTileCoord(a,t,t=>{const s=i.call(e,t,n,r);g.push(s)});yield u.execute({title:\"T\\xe9l\\xe9chargement des tuiles de carte\",total:g.length,action:t=>Vp(this,void 0,void 0,function*(){yield Promise.all(g.map(e=>Vp(this,void 0,void 0,function*(){yield function(t){return Vp(this,void 0,void 0,function*(){return new Promise((e,i)=>{const n=new Image;n.crossOrigin=\"Anonymous\",n.onload=e,n.onerror=i,n.src=t,n.remove()})})}(e),t()})))})}),h.includeAdditionalLayers&&(yield u.execute({title:\"T\\xe9l\\xe9chargement des couches additionnelles\",total:pq.length,action:t=>Vp(this,void 0,void 0,function*(){yield Promise.all(pq.map(e=>Vp(this,void 0,void 0,function*(){yield fetch(e),t()})))})})),yield this.workerService.offline.initialize(h,l,X$(t=>{this.downloadProgress$.next(t)})),yield iq(rq,h),d.remove(),navigator.serviceWorker.controller.postMessage(\"state:ready\"),yield $j(50)}catch(n){throw this.offlineConfig$.next(null),this.workerService.setOffline(!1),null===(i=null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller)||void 0===i||i.postMessage(\"state:disabled\"),n}finally{this.downloadProgress$.next(null),this.loading=!1}})}updateOfflineData(){return Vp(this,void 0,void 0,function*(){this.loading=!0;const t=this.offlineConfig$.value,e=t.endTimestamp;t.endTimestamp=yield this.workerService.ships.getLatestTimestamp();try{yield this.workerService.application.logUserActivity(\"offline-update\",{interval:t.endTimestamp-e}),this.offlineConfig$.next(t),yield this.workerService.offline.update(t.endTimestamp,X$(t=>{this.downloadProgress$.next(t)})),yield iq(rq,t)}catch(i){throw t.endTimestamp=e,this.offlineConfig$.next(t),i}finally{this.downloadProgress$.next(null),this.loading=!1}})}exitOfflineMode(){var t,e;return Vp(this,void 0,void 0,function*(){yield function(t=tq()){return t(\"readwrite\",t=>(t.clear(),QG(t.transaction)))}(),null===(e=null===(t=navigator.serviceWorker)||void 0===t?void 0:t.controller)||void 0===e||e.postMessage(\"unregister\"),this.workerService.setOffline(!1)})}updateViewBox(t){this.viewExtent$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)(En(hH),En(nU),En(uq),En(k$),En(T$),En(AU),En(iU))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();function mq(t=0,e=lf){return(!eg(t)||t<0)&&(t=0),(!e||\"function\"!=typeof e.schedule)&&(e=lf),new _(i=>(i.add(e.schedule(gq,t,{subscriber:i,counter:0,period:t})),i))}function gq(t){const{subscriber:e,counter:i,period:n}=t;e.next(i),this.schedule({subscriber:e,counter:i+1,period:n},n)}let Aq=(()=>{class t{constructor(){this.userAFK$=new Zp(!1),document.addEventListener(\"visibilitychange\",()=>{\"visible\"===document.visibilityState?(clearTimeout(this.afkTimeout),this.userAFK$.next(!1)):this.afkTimeout=setTimeout(()=>{this.userAFK$.next(!0)},9e5)})}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),vq=(()=>{class t{constructor(t,e,i,n,r){this.authenticationService=t,this.mapConfigService=e,this.historyService=i,this.offlineService=n,this.visibilityService=r,this.refresh$=new S,this.pause$=new Zp(!1),this.tap=()=>{this.refreshTimer&&this.refreshTimer.unsubscribe(),this.refreshTimer=mq(this.mapConfigService.shipRefreshInterval$.value).pipe(pf(()=>this.authenticationService.isAuthenticated()),pf(()=>!this.pause$.value),pf(()=>!this.visibilityService.userAFK$.value),pf(()=>0===this.historyService.timestamp$.value)).subscribe(()=>{this.refresh$.next()})},this.offlineService.isOffline$.subscribe(t=>{this.setPause(t)}),this.mapConfigService.shipRefreshInterval$.subscribe(()=>{this.tap()}),this.pause$.subscribe(t=>{t||(this.tap(),this.refresh$.next())})}destroy(){this.setPause(!1),this.refreshTimer.unsubscribe()}togglePause(){this.pause$.next(!this.pause$.value)}setPause(t){this.pause$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)(En(nU),En(k$),En(R$),En(fq),En(Aq))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),_q=(()=>{class t{constructor(t,e){this.configService=t,this.refreshTimerService=e,this.timeRange$=new Zp(null),this.reset(),this.refreshTimerService.refresh$.subscribe(()=>{this.refresh()})}reset(){this.timeRange$.next(m$[this.configService.defaultTimeRange].refresh())}refresh(){this.timeRange$.value.isCustom||this.timeRange$.next(this.timeRange$.value.refresh())}updateTimeRange(t){this.timeRange$.next(t.refresh())}setCustom(t,e){this.timeRange$.next(this.timeRange$.value.setCustom(t,e))}setRelative(t){this.timeRange$.next(this.timeRange$.value.setRelative(t))}goBackward(){this.timeRange$.next(this.timeRange$.value.shift(-this.timeRange$.value.value/2))}goForward(){this.timeRange$.next(this.timeRange$.value.shift(this.timeRange$.value.value/2))}extendBackward(){this.timeRange$.next(this.timeRange$.value.extend(-this.timeRange$.value.value/2))}extendForward(){this.timeRange$.next(this.timeRange$.value.extend(this.timeRange$.value.value/2))}}return t.\\u0275fac=function(e){return new(e||t)(En(C$),En(vq))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),yq=(()=>{class t{constructor(t,e,i,n,r,s){this.historyService=t,this.mapConfigService=e,this.offlineService=i,this.timeRangeService=n,this.workerService=r,this.zonesService=s,this.shipsInView$=new Zp([]),this.shipsInViewCount$=new Zp(0),this.shipsCount$=new Zp(0)}fetchShip(t,e){return Vp(this,void 0,void 0,function*(){let i;if(this.offlineService.isOffline$.value)i=yield this.workerService.offline.getShipDetail(t);else{i=yield this.workerService.ships.getShip(t);let n=null!=e?e:this.timeRangeService.timeRange$.value;if(!n.isCustom){const t=this.historyService.timestamp$.value;n=n.setRelative(t>0?t:i.timestamp)}Object.assign(i,yield this.workerService.ships.getShipDetails(t,n,this.mapConfigService.detailedShipTraces$.value,this.mapConfigService.debugH3Trace$.value,!!dj.portCallsEnable))}return i.trail.forEach(t=>{t.ship=i}),i.h3Trace.elements.forEach(t=>{t.ship=i}),i.events=i.events.filter(t=>t.type!==yH.MoveZoneEntry&&t.type!==yH.MoveZoneExit||!!this.zonesService.zonesById[t.data.zone]),i})}}return t.\\u0275fac=function(e){return new(e||t)(En(R$),En(k$),En(fq),En(_q),En(iU),En(lH))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),bq=(()=>{class t{constructor(t,e,i,n,r,s,o,a,l,c,h,u){this.ngZone=t,this.router=e,this.errorHandler=i,this.alertRulesService=n,this.eventsLayerService=r,this.h3TracesLayerService=s,this.mapConfigService=o,this.mapStateService=a,this.offlineService=l,this.shipsService=c,this.timeRangeService=h,this.workerService=u,this.entities$=new Zp([]),this.openEntity$=new Zp(null),this.alerts$=new Zp([]),this.trails$=new Zp([]),this.mustHideEntities=!1,this.shipsMaxTimestamp=0,this.mapStateService.mustHideEntities$.subscribe(t=>{this.mustHideEntities=t}),this.entities$.pipe(E(t=>t.filter(t=>!!t.entity))).subscribe(t=>{const e=[],i=[],n=[],r=[];t.forEach(t=>{var s,o,a;t.type===pH.Aircraft?e.push(t.entity.trace):t.type===pH.Ship&&(n.push(...null!==(s=t.entity.alerts)&&void 0!==s?s:[]),r.push(...null!==(o=t.entity.events)&&void 0!==o?o:[]),e.push(t.entity.trail),i.push(null!==(a=t.entity.h3Trace)&&void 0!==a?a:[]))}),n.forEach(t=>{const[e,i]=this.alertRulesService.getAlertRuleColor(t.rule_id);t.color=e,t.rgbVecColor=i}),this.alerts$.next(n),this.eventsLayerService.updateEvents(r),this.trails$.next(e),this.h3TracesLayerService.updateTrails(i)}),q(this.mapConfigService.detailedShipTraces$.pipe(wf(1)),this.timeRangeService.timeRange$.pipe(ag(),pf(([t,e])=>t.key!==e.key||\"custom\"===t.key))).pipe(pf(()=>!this.mustHideEntities)).subscribe(()=>Vp(this,void 0,void 0,function*(){yield Promise.all(this.entities$.value.map(t=>Vp(this,void 0,void 0,function*(){yield this.fetchEntity(t.type,t.id)})))})),this.timeRangeService.timeRange$.pipe(ag(),pf(([t,e])=>t.key===e.key&&\"custom\"!==t.key),hg(()=>Vp(this,void 0,void 0,function*(){return this.workerService.ships.getLatestTimestamp()})),pf(t=>t!==this.shipsMaxTimestamp&&this.entities$.value.length>0)).subscribe(t=>Vp(this,void 0,void 0,function*(){const e=new d$({key:\"custom\",isCustom:!0,start:this.shipsMaxTimestamp-900,end:t});this.shipsMaxTimestamp=t,yield Promise.all(this.entities$.value.map(t=>Vp(this,void 0,void 0,function*(){yield this.fetchEntity(t.type,t.id,e)})))})),this.mapConfigService.enableMultiSelectionMode$.subscribe(t=>{t||(this.openEntity$.value?this.entities$.next([this.openEntity$.value]):this.entities$.value.length>1&&this.entities$.next([this.entities$.value[0]]))})}clear(){this.entities$.next([])}selectShip(t){this.toggleSelection(pH.Ship,t)}selectAircraft(t){this.toggleSelection(pH.Aircraft,t)}openEntity(t,e){const i=this.entities$.value.find(i=>i.type===t&&i.id===e);i?this.openEntity$.next(i):(this.toggleSelection(t,e),this.openEntity$.next(this.entities$.value[this.entities$.value.length-1]))}closeOpenEntity(){this.openEntity$.next(null),this.mapConfigService.enableMultiSelectionMode$.value||this.entities$.next([])}toggleSelection(t,e){var i;let n=this.entities$.value;const r=n.findIndex(t=>t.id===e);if(-1===r){TB({category:\"app\",message:`select-entity: ${t}`});const i={type:t,id:e,entity:null};this.mapConfigService.enableMultiSelectionMode$.value||(n=[],this.ngZone.run(()=>{const i=MH(this.router);this.router.navigateByUrl(`${i}/${t}s/${e}`)})),(()=>{Vp(this,void 0,void 0,function*(){this.entities$.value.every(t=>t.type!==pH.Ship)&&!this.offlineService.isOffline$.value&&(this.shipsMaxTimestamp=yield this.workerService.ships.getLatestTimestamp()),yield this.fetchEntity(t,e)})})(),n.push(i)}else{if(TB({category:\"app\",message:`unselect-entity: ${t}`}),n[r].id===(null===(i=this.openEntity$.value)||void 0===i?void 0:i.id)){const t=MH(this.router)||\"/\";this.router.navigateByUrl(t)}n.splice(r,1)}this.entities$.next(n)}addToSelection(t,e){-1===this.entities$.value.findIndex(t=>t.id===e)&&this.toggleSelection(t,e)}fetchEntity(t,e,i){var n;return Vp(this,void 0,void 0,function*(){let r=null,s=null;try{if(t===pH.Ship){r=yield this.shipsService.fetchShip(e,i);const s=null===(n=this.entities$.value.find(i=>i.type===t&&i.id===e))||void 0===n?void 0:n.entity;i&&s&&(r.alerts=r.alerts.concat(EH(s.alerts,t=>t.start<i.start)),r.events=r.events.concat(EH(s.events,t=>t.timestamp<i.start)),r.portCalls=r.portCalls.concat(EH(s.portCalls,t=>t.start<i.start)),r.trail=r.trail.concat(EH(s.trail,t=>t.timestamp<i.start)))}else t===pH.Aircraft&&(r=yield this.workerService.aircrafts.getAircraftDetails(e))}catch(o){o.name===OB.Unauthorized&&this.errorHandler.handleError(o),s=o.message.includes(`GetTrip ERROR : ${e} dont find`)?`L'a\\xe9ronef ${e} est inconnu. Il a d\\xfb atterrir ou son signal n'est plus capt\\xe9 depuis plus de 5 minutes.`:\"not found\"===o.message?`Le navire ${e} est inconnu.`:o.message}this.updateEntity(t,e,r,s)})}updateEntity(t,e,i,n){const r=this.entities$.value.findIndex(i=>i.type===t&&i.id===e);if(-1===r)return;const s=Object.assign(Object.assign({},this.entities$.value[r]),{entity:i,error:n});this.entities$.value[r]=s,this.entities$.next(this.entities$.value);const o=this.openEntity$.value;o&&o.type===t&&o.id===e&&this.openEntity$.next(s)}}return t.\\u0275fac=function(e){return new(e||t)(En(tu),En(XR),En(Pr),En(hH),En(TH),En(IH),En(k$),En(KG),En(fq),En(yq),En(_q),En(iU))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();class wq{constructor(t){this.closingNotifier=t}call(t,e){return e.subscribe(new xq(t,this.closingNotifier))}}class xq extends z{constructor(t,e){super(t),this.buffer=[],this.add(V(e,new N(this)))}_next(t){this.buffer.push(t)}notifyNext(){const t=this.buffer;this.buffer=[],this.destination.next(t)}}let Sq=(()=>{class t{constructor(t){this.mapStateService=t,this.hoveredAircraft$=new Zp(null),this.hoveredAlert$=new Zp(null),this.hoveredAnnotation$=new Zp(null),this.hoveredEvent$=new Zp(null),this.hoveredShip$=new Zp(null),this.hoveredAircraftPosition$=new Zp(null),this.hoveredShipPosition$=new Zp(null),this.hoveredH3Element$=new Zp(null),this.pinnedEntitiesTooltips$=new Zp([]),this.pinEvents$=new S,this.displayedEntity$=LT([this.hoveredAircraft$.pipe(Cf()),this.hoveredAlert$.pipe(Cf()),this.hoveredEvent$.pipe(Cf()),this.hoveredShip$.pipe(Cf()),this.hoveredAircraftPosition$.pipe(Cf()),this.hoveredShipPosition$.pipe(Cf()),this.hoveredAnnotation$.pipe(Cf((t,e)=>null===e&&t===e)),this.hoveredH3Element$.pipe(Cf())]).pipe(E(([t,e,i,n,r,s,o,a])=>{var l,c,h,u,d,p,f;return null!==(f=null!==(p=null!==(d=null!==(u=null!==(h=null!==(c=null!==(l=null!=e?e:i)&&void 0!==l?l:t)&&void 0!==c?c:n)&&void 0!==h?h:r)&&void 0!==u?u:s)&&void 0!==d?d:o)&&void 0!==p?p:a)&&void 0!==f?f:null}),Jp(t=>{t&&(t.hdms=this.mapStateService.coordinateSystem$.value.format([t.lon,t.lat]))})),this.pinEvents$.pipe(function(t){return function(e){return e.lift(new wq(t))}}(this.pinEvents$.pipe(cf(50))),E(t=>{var e,i,n,r,s,o;return null!==(o=null!==(s=null!==(r=null!==(n=null!==(i=null!==(e=t.find(t=>t.kind===pH.Alert))&&void 0!==e?e:t.find(t=>t.kind===pH.Event))&&void 0!==i?i:t.find(t=>t.kind===pH.Ship))&&void 0!==n?n:t.find(t=>t.kind===pH.AircraftPosition))&&void 0!==r?r:t.find(t=>t.kind===pH.ShipPosition))&&void 0!==s?s:t.find(t=>t.kind===pH.Annotation))&&void 0!==o?o:t.find(t=>t.kind===pH.H3Element)}),pf(t=>!!t)).subscribe(t=>{t.kind===pH.Annotation?t=Uj(t):t.hdms=this.mapStateService.coordinateSystem$.value.format([t.lon,t.lat]),this.pinnedEntitiesTooltips$.value.push({lon:t.lon,lat:t.lat,positioning:\"bottom-left\",entity:t}),this.pinnedEntitiesTooltips$.next(this.pinnedEntitiesTooltips$.value)})}hoverEntity(t,e){switch(t){case pH.Aircraft:e&&(e.kind=pH.Aircraft),this.hoveredAircraft$.next(e);break;case pH.Alert:e&&(e.kind=pH.Alert),this.hoveredAlert$.next(e);break;case pH.Annotation:e&&(e.kind=pH.Annotation),this.hoveredAnnotation$.next(e);break;case pH.Event:e&&(e.kind=pH.Event),this.hoveredEvent$.next(e);break;case pH.Ship:this.hoveredShip$.next(e);break;case pH.AircraftPosition:e&&(e.kind=pH.AircraftPosition),this.hoveredAircraftPosition$.next(e);break;case pH.ShipPosition:e&&(e.kind=pH.ShipPosition),this.hoveredShipPosition$.next(e);break;case pH.H3Element:e&&(e.kind=pH.H3Element),this.hoveredH3Element$.next(e);break;default:throw new Error(\"Entit\\xe9 inconnue\")}}clearPinnedEntities(){this.pinnedEntitiesTooltips$.next([])}pinEntity(t){this.pinEvents$.next(t)}unpinTooltip(t){this.pinnedEntitiesTooltips$.next(this.pinnedEntitiesTooltips$.value.filter(e=>e!==t))}}return t.\\u0275fac=function(e){return new(e||t)(En(KG))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Cq=(()=>{class t{constructor(t,e,i){this.ngZone=t,this.selectionService=e,this.tooltipsService=i,this.selectAlertFeature$=new S,this.selectEventFeature$=new S,this.selectEventItem$=new S,this.mapClickEvents$=new S,this.ngZone.runOutsideAngular(()=>{this.mapClickEvents$.pipe(function(t){let e=arguments.length,i=lf;k(arguments[arguments.length-1])&&(i=arguments[arguments.length-1],e--);let n=null;e>=2&&(n=arguments[1]);let r=Number.POSITIVE_INFINITY;return e>=3&&(r=arguments[2]),function(e){return e.lift(new bH(t,n,r,i))}}(16),E(t=>{var e,i,n,r,s,o,a;return null!==(a=null!==(o=null!==(s=null!==(r=null!==(n=null!==(i=null!==(e=t.find(t=>t.kind===pH.Alert))&&void 0!==e?e:t.find(t=>t.kind===pH.Event))&&void 0!==i?i:t.find(t=>t.kind===pH.Aircraft))&&void 0!==n?n:t.find(t=>t.kind===pH.Ship))&&void 0!==r?r:t.find(t=>t.kind===pH.AircraftPosition))&&void 0!==s?s:t.find(t=>t.kind===pH.ShipPosition))&&void 0!==o?o:t.find(t=>t.kind===pH.Annotation))&&void 0!==a?a:t.find(t=>t.kind===pH.H3Element)}),pf(t=>!!t)).subscribe(t=>{switch(TB({category:\"app\",message:`map-click: ${t.kind}`}),t.kind){case pH.Aircraft:this.selectionService.selectAircraft(t.icao);break;case pH.AircraftPosition:this.tooltipsService.pinEntity(t);break;case pH.Alert:this.selectAlertFeature$.next(t),this.tooltipsService.pinEntity(t);break;case pH.Annotation:this.tooltipsService.pinEntity(t);break;case pH.Event:this.selectEventFeature$.next(t),this.tooltipsService.pinEntity(t);break;case pH.Ship:this.selectionService.selectShip(t.mmsi);break;case pH.ShipPosition:case pH.H3Element:this.tooltipsService.pinEntity(t);break;default:throw new Error(\"Entit\\xe9 inconnue\")}})})}clickOnEntity(t,e){switch(t){case pH.Aircraft:e.kind=pH.Aircraft,this.mapClickEvents$.next(e);break;case pH.AircraftPosition:e.kind=pH.AircraftPosition,this.mapClickEvents$.next(e);break;case pH.Alert:e.kind=pH.Alert,this.mapClickEvents$.next(e);break;case pH.Annotation:e.kind=pH.Annotation,this.mapClickEvents$.next(e);break;case pH.Event:e.kind=pH.Event,this.mapClickEvents$.next(e);break;case pH.Ship:this.mapClickEvents$.next(e);break;case pH.ShipPosition:e.kind=pH.ShipPosition,this.mapClickEvents$.next(e);break;case pH.H3Element:e.kind=pH.H3Element,this.mapClickEvents$.next(e);break;default:throw new Error(\"Entit\\xe9 inconnue\")}}}return t.\\u0275fac=function(e){return new(e||t)(En(tu),En(bq),En(Sq))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),kq=(()=>{class t{constructor(){this.zones$=new Zp([])}clear(){this.zones$.next([])}updateZones(t){this.zones$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Eq=(()=>{class t{constructor(t,e,i,n,r,s){this.interactionsService=t,this.mapService=e,this.tooltipsService=i,this.workerService=n,this.zonesLayerService=r,this.zonesService=s,this.transhipmentTrail$=new Zp(null),this.interactionsService.selectEventItem$.subscribe(t=>{this.mapService.pingLocation([t.lon,t.lat]),this.mapService.centerOnLonLat([t.lon,t.lat])}),this.interactionsService.selectEventFeature$.subscribe(t=>{this.tooltipsService.pinEntity(t)}),q(this.interactionsService.selectEventFeature$,this.interactionsService.selectEventItem$).subscribe(t=>{if(!t)return;let e=!1,i=!1;switch(t.type){case yH.PositionDubious:{this.mapService.pingLocation([t.data.lon,t.data.lat]);const i=l$.New(t.lon,t.lat,t.lon,t.lat);i.addPoint(t.data.lon,t.data.lat),this.mapService.fitOn(i.toExtent()),e=!0;break}case yH.MoveZoneEntry:case yH.MoveZoneExit:{const i=this.zonesService.zonesById[t.data.zone];this.zonesLayerService.updateZones([i]),this.mapService.fitOn(rH(i.h3indexes)),e=!0;break}case yH.MoveMeetingAtSea:this.viewTranshipment(t.data.mmsi,t.timestamp),i=!0}i||this.hideTranshipment(),e||this.zonesLayerService.clear()})}viewTranshipment(t,e){return Vp(this,void 0,void 0,function*(){const i=yield this.workerService.ships.getShipTrail(t,e-86400,e+86400);this.transhipmentTrail$.next(i)})}hideTranshipment(){this.transhipmentTrail$.value&&this.transhipmentTrail$.next(null)}}return t.\\u0275fac=function(e){return new(e||t)(En(Cq),En(T$),En(Sq),En(iU),En(kq),En(lH))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Mq=(()=>{class t{constructor(t,e){this.configService=t,this.mapConfigService=e,this.configurations$=new Zp([]),this.activeConfigurationName$=new Zp(\"\"),this.activeConfiguration$=new Zp(null),this.dirtyActiveConfiguration$=new Zp(!1),this.loadConfig(),LT([this.configurations$,this.activeConfigurationName$]).pipe(wf(1),cf(300)).subscribe(()=>{this.saveConfig()}),LT([this.configurations$,this.activeConfigurationName$]).subscribe(([t,e])=>{this.activeConfiguration$.next(e?t.find(t=>t.name===e):null)}),this.activeConfiguration$.pipe(wf(1),Cf()).subscribe(t=>{this.mapConfigService.updateBatch(t?t.filters:e$())}),this.activeConfiguration$.subscribe(t=>{var e;this.dirtyActiveConfiguration$.next(!1),null===(e=this.dirtyWatch)||void 0===e||e.unsubscribe(),t&&(this.dirtyWatch=this.mapConfigService.shipFilter$.pipe(E(t=>i$(t)),Cf(n$),wf(1)).subscribe(()=>{this.dirtyActiveConfiguration$.next(!0)}))})}loadConfig(){const t=this.configService.filterConfigurations;t&&(Zj(t.configurations)&&(t.configurations.forEach(t=>{t.filters=Object.assign({},e$(),t.filters)}),this.configurations$.next(t.configurations)),Zj(t.activeConfigurationName)&&this.activeConfigurationName$.next(t.activeConfigurationName))}saveConfig(){this.configService.set(\"filterConfigurations\",{configurations:this.configurations$.value,activeConfigurationName:this.activeConfigurationName$.value})}selectConfiguration(t){this.activeConfigurationName$.next(t)}importConfiguration(t){t.filters=Object.assign({},e$(),t.filters),this.configurations$.next([...this.configurations$.value,t].sort((t,e)=>t.name<=e.name?-1:1))}createConfiguration(t){this.configurations$.next([...this.configurations$.value,{name:t,filters:i$(this.mapConfigService.shipFilter$.value)}].sort((t,e)=>t.name<=e.name?-1:1))}renameConfiguration(t,e){const i=this.configurations$.value.findIndex(e=>e.name===t),n=this.configurations$.value.findIndex(t=>t.name===e);if(-1===i)throw new Error(\"Configuration non trouv\\xe9e\");if(-1!==n&&n!==i)throw new Error(\"La configuration existe d\\xe9j\\xe0\");const[r]=this.configurations$.value.splice(i,1);r.name=e,this.configurations$.next([...this.configurations$.value,r].sort((t,e)=>t.name<=e.name?-1:1)),this.selectConfiguration(e)}updateConfiguration(t){const e=this.configurations$.value.findIndex(e=>e.name===t.name);if(-1===e)throw new Error(\"Configuration non trouv\\xe9e\");this.configurations$.value.splice(e,1),this.configurations$.next([...this.configurations$.value,t].sort((t,e)=>t.name<=e.name?-1:1))}deleteConfiguration(t){this.configurations$.next(this.configurations$.value.filter(e=>e.name!==t)),this.activeConfigurationName$.next(null)}clear(){this.configurations$.next([]),this.activeConfigurationName$.next(null)}clearMapFilters(){this.mapConfigService.resetShipFilter()}updateActiveConfigurationFilters(){if(!this.activeConfigurationName$.value)throw new Error(\"Aucune configuration active\");this.updateConfiguration({name:this.activeConfigurationName$.value,filters:i$(this.mapConfigService.shipFilter$.value)})}}return t.\\u0275fac=function(e){return new(e||t)(En(C$),En(k$))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Tq=(()=>{class t{constructor(t,e,i,n,r,s){this.alertRulesService=t,this.mapConfigService=e,this.offlineService=i,this.timeRangeService=n,this.uiService=r,this.workerService=s,this.fleets$=new Zp([]),this.fleetsById={},this.selectedFleet$=new Zp(null),this.selectingFleet=!1,this.fleetAlerts$=new Zp([]),this.fleetTrails$=new Zp([]),this.displayFleetTrail$=new Zp(!1),this.toggleDisplayFleetTrails=()=>Vp(this,void 0,void 0,function*(){if(!this.displayFleetTrail$.value){let t;const e=this.timeRangeService.timeRange$.value;if(e.end-e.start>=2592e3?t=\"L'intervalle demand\\xe9 est cons\\xe9quent\":this.selectedFleet$.value.ships.length>=200&&(t=\"La flotte contient beaucoup de navires\"),t&&!(yield this.uiService.confirmAsync({title:\"Confirmation\",message:`${t} et pourrait ralentir le serveur. \\xcates-vous s\\xfbr de vouloir effectuer l'action ?`})))return}if(this.displayFleetTrail$.next(!this.displayFleetTrail$.value),this.displayFleetTrail$.value){const t=this.timeRangeService.timeRange$.value,e=yield this.workerService.fleets.getFleetTrails(this.selectedFleet$.value.id,t.start,t.end,this.mapConfigService.detailedShipTraces$.value),i=this.selectedFleet$.value.ships.reduce((t,e)=>(t[e.mmsi]=e,t),{}),n=Object.entries(e).map(([t,e])=>e.map(e=>(e.ship=i[t],e)));this.fleetTrails$.next(n)}else this.fleetTrails$.next([])}),this.fleets$.subscribe(()=>{this.updateFleetsShipsCache(this.mapConfigService.shipFilter$.value.fleets)}),this.mapConfigService.detailedShipTraces$.subscribe(()=>Vp(this,void 0,void 0,function*(){this.selectedFleet$.value&&(yield this.selectFleet(this.selectedFleet$.value.id))}))}setFleets(t){this.fleetsById=t.reduce((t,e)=>(t[e.id]=e,t),{}),this.fleets$.next(t)}refreshFleets(){return Vp(this,void 0,void 0,function*(){const t=yield this.workerService.fleets.list();return this.setFleets(t),t})}clear(){this.fleets$.next([])}selectFleet(t){return Vp(this,void 0,void 0,function*(){this.selectingFleet=!0;const e=this.timeRangeService.timeRange$.value;let i,n;if(this.offlineService.isOffline$.value){const e=this.fleets$.value.find(e=>e.id===t);if(!e)throw new Error(\"Flotte inconnue\");[i,n]=yield Promise.all([this.workerService.offline.getFleet(e),this.workerService.offline.getFleetAlerts(e.ships.map(t=>t.mmsi))])}else[i,n]=yield Promise.all([this.workerService.fleets.get(t),this.workerService.fleets.getFleetAlerts(t,e.start,e.end)]);return this.selectedFleet$.next(i),n.forEach(t=>{const[e,i]=this.alertRulesService.getAlertRuleColor(t.rule_id);t.color=e,t.rgbVecColor=i}),this.fleetAlerts$.next(n),this.selectingFleet=!1,{fleet:i,trailsByMMSI:void 0,alerts:n}})}deselectFleet(){this.selectedFleet$.next(null),this.fleetAlerts$.next([]),this.fleetTrails$.next([]),this.displayFleetTrail$.next(!1)}createFleet(t){return Vp(this,void 0,void 0,function*(){const e=yield this.workerService.fleets.create(t);return yield this.refreshFleets(),e})}updateFleet(t){return Vp(this,void 0,void 0,function*(){yield this.workerService.fleets.update(t),yield this.refreshFleets()})}deleteFleet(t){return Vp(this,void 0,void 0,function*(){yield this.workerService.fleets.delete(t),yield this.refreshFleets()})}updateFleetsFilter(t){this.updateFleetsShipsCache(t),this.mapConfigService.updateFleetsFilter(t)}updateFleetsShipsCache(t){this.mapConfigService.shipFilter$.value.fleetsShipsCache=this.fleets$.value.filter(e=>t.includes(e.id)).flatMap(t=>t.ships.map(t=>t.mmsi))}resetDisplayFleetTrails(){this.displayFleetTrail$.next(!1),this.fleetTrails$.next([])}}return t.\\u0275fac=function(e){return new(e||t)(En(hH),En(k$),En(fq),En(_q),En(AU),En(iU))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Iq=(()=>{class t{constructor(){this.initialized$=new Zp(!1)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Oq=(()=>{class t{constructor(t,e,i){this.appInitService=t,this.mapStateService=e,this.workerService=i,this.ports$=new Zp([]),this.appInitService.initialized$.pipe(pf(t=>t)).subscribe(()=>{this.mapStateService.showPortsLayer$.pipe(pf(t=>t),_P()).subscribe(()=>Vp(this,void 0,void 0,function*(){this.ports$.next(yield this.workerService.ports.listPorts())}))})}}return t.\\u0275fac=function(e){return new(e||t)(En(Iq),En(KG),En(iU))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Pq=(()=>{class t{constructor(t,e,i,n,r,s,o,a,l,c,h,u,d,p,f,m,g){this.alertRulesService=t,this.alertsService=e,this.annotationsService=i,this.drawingService=n,this.eventsService=r,this.filterConfigurationsService=s,this.fleetsService=o,this.historyService=a,this.interactionsService=l,this.mapService=c,this.mapConfigService=h,this.offlineService=u,this.portsService=d,this.timeRangeService=p,this.uiService=f,this.workerService=m,this.zonesService=g,this.initialized=!1}init(){return Vp(this,void 0,void 0,function*(){yield this.workerService.view.reset();const t=this.offlineService.getOfflineData();t?(this.fleetsService.setFleets(t.fleets),this.zonesService.setZones(t.zones),this.annotationsService.setAnnotations(t.annotations),this.alertRulesService.setAlertRules(t.rules)):(yield Promise.all([this.fleetsService.refreshFleets(),this.zonesService.refreshZones(),this.annotationsService.refreshAnnotations()]),yield this.alertRulesService.refreshAlertRules()),this.initialized=!0})}destroy(){this.alertRulesService.clear(),this.fleetsService.clear(),this.zonesService.clear(),this.filterConfigurationsService.clear(),this.mapConfigService.clear(),this.drawingService.clearZones(),this.zonesService.clear(),this.annotationsService.clear(),this.initialized=!1}}return t.\\u0275fac=function(e){return new(e||t)(En(hH),En(uH),En(fH),En(mH),En(Eq),En(Mq),En(Tq),En(R$),En(Cq),En(T$),En(k$),En(fq),En(Oq),En(_q),En(AU),En(iU),En(lH))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Dq=(()=>{class t{constructor(t,e,i,n){this.authenticationService=t,this.initializationService=e,this.uiService=i,this.router=n}canActivateChild(t,e){return Vp(this,void 0,void 0,function*(){return this.authenticationService.isAuthenticated()?(this.initializationService.initialized||(yield this.initializationService.init()),!0):(this.uiService.error(\"Vous devez \\xeatre authentifi\\xe9\"),yield this.router.navigateByUrl(`/login?redirect=${e.url}`),!1)})}}return t.\\u0275fac=function(e){return new(e||t)(En(nU),En(Pq),En(AU),En(XR))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Rq=(()=>{class t{constructor(t){this.offlineService=t}canDeactivate(){return!this.offlineService.loading}}return t.\\u0275fac=function(e){return new(e||t)(En(fq))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Fq=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-about-dialog\"]],decls:122,vars:0,consts:[[\"mat-dialog-title\",\"\",1,\"d-flex\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Fermer le panneau\",3,\"mat-dialog-close\"],[\"href\",\"https://beta.gouv.fr/startups/anais.html\"],[\"href\",\"https://beta.gouv.fr/apropos/\"],[1,\"about-dialog__faq-title\"],[1,\"about-dialog__faq\"],[\"href\",\"https://beta.gouv.fr/startups/sepia.html\"],[\"href\",\"/3rdpartylicenses.txt\"],[\"href\",\"https://www.marineregions.org/\"],[\"href\",\"https://doi.org/10.14284/386\"]],template:function(t,e){1&t&&(Pa(0,\"h1\",0),bl(1,\" \\xc0 propos d'ANAIS \"),Ra(2,\"div\",1),Pa(3,\"button\",2),Pa(4,\"mat-icon\"),bl(5,\"close\"),Da(),Da(),Da(),Pa(6,\"div\"),Pa(7,\"h3\"),bl(8,\"ANAIS comme Analyse des Incoh\\xe9rences de Situation maritime\"),Da(),Pa(9,\"p\"),bl(10,\" C'est un projet men\\xe9 en \\xab start-up d'\\xc9tat \\xbb, cr\\xe9\\xe9 par la Marine et pour la Marine, avec le soutien de l'Agence de l'Innovation de D\\xe9fense et de la fabrique num\\xe9rique. \"),Da(),Pa(11,\"p\"),bl(12,\" La vocation premi\\xe8re d'ANAIS est d'apporter un service op\\xe9rationnel sans limite de licence, au plus proche du besoin op\\xe9rationnel. \"),Da(),Pa(13,\"p\"),bl(14,\" L'objectif est d'avoir la main sur les d\\xe9veloppements. Il n'y a pas de logique commerciale ni contractuelle, ni de licence. \"),Da(),Pa(15,\"p\"),bl(16,\" Nous allons faire \\xe9voluer ANAIS au plus pr\\xe8s des besoins des utilisateurs et rajouter au fur et \\xe0 mesure des id\\xe9es, des donn\\xe9es et des algorithmes. \"),Da(),Pa(17,\"p\"),bl(18,\" ANAIS est \\xe0 utiliser en compl\\xe9ment des outils commerciaux. \"),Da(),Pa(19,\"div\"),bl(20,\" Pour plus d'informations, vous pouvez consulter la \"),Pa(21,\"a\",3),bl(22,\"fiche produit sur beta.gouv\"),Da(),bl(23,\" ou bien obtenir plus d'informations sur la \"),Pa(24,\"a\",4),bl(25,\"m\\xe9thode de d\\xe9veloppement beta.gouv\"),Da(),bl(26,\". \"),Da(),Pa(27,\"h3\",5),bl(28,\"Questions r\\xe9currentes\"),Da(),Pa(29,\"div\",6),Pa(30,\"div\"),Pa(31,\"h4\"),bl(32,\"Quels sont les navigateurs compatibles ?\"),Da(),bl(33,\" Nous visons \\xe0 rendre ANAIS compatible avec Chrome >= 56 et Firefox >= 52 (version utilis\\xe9e sur intradef). Il est recommand\\xe9 d'utiliser des versions \"),Pa(34,\"strong\"),bl(35,\"r\\xe9centes\"),Da(),bl(36,\" de navigateurs afin de profiter des derni\\xe8res optimisations de performance. \"),Ra(37,\"br\"),Pa(38,\"strong\"),bl(39,\"Internet Explorer et Edge ne sont pas test\\xe9s et ne sont probablement pas compatibles.\"),Da(),Da(),Pa(40,\"div\"),Pa(41,\"h4\"),bl(42,\"Compatibilit\\xe9 ISPT ?\"),Da(),bl(43,\" ANAIS fonctionne sur le r\\xe9seau intradef avec les PC ISPT \\xe0 condition d'autoriser le d\\xe9blocage des serveurs utilis\\xe9s par ANAIS : \"),Pa(44,\"em\"),bl(45,\"anais.beta.gouv.fr\"),Da(),bl(46,\" et tous les serveurs en \"),Pa(47,\"em\"),bl(48,\"*.anais.beta.gouv.fr\"),Da(),bl(49,\". \"),Da(),Pa(50,\"div\"),Pa(51,\"h4\"),bl(52,\"Quelles sont les donn\\xe9es utilis\\xe9es ? D'o\\xf9 viennent-elles ?\"),Da(),bl(53,\" Les donn\\xe9es AIS proviennent de 2 fournisseurs : l'agence europ\\xe9enne de s\\xe9curit\\xe9 maritime (EMSA) avec le flux IMDATE (EMSA's Integrated Maritime Data Environment (IMDatE)) et CLS (couverture mondiale). \"),Ra(54,\"br\"),bl(55,\" Les donn\\xe9es ADS-B des a\\xe9ronefs de notre partenaire \"),Pa(56,\"a\",7),bl(57,\"SEPIA\"),Da(),bl(58,\" : ADSBHub, ELia-AF-Gao-1, ELia-AF-Gossi-1, ELia-AF-Niamey-2, FlightRadar24, Ghost, Glidernet, RTB. \"),Da(),Pa(59,\"div\"),Pa(60,\"h4\"),bl(61,\"\\xc0 quoi servent les r\\xe8gles d'alertes ?\"),Da(),bl(62,\" Les r\\xe8gles d'alertes permettent de configurer des crit\\xe8res et des filtres afin de lever des alertes sur des comportements bien pr\\xe9cis. Par exemple, un transbordement dans une zone. Le but des alertes est de notifier l'utilisateur automatiquement quand un comportement suspect est d\\xe9tect\\xe9. \"),Da(),Pa(63,\"div\"),Pa(64,\"h4\"),bl(65,\"Il semble y avoir des faux-positifs sur les \\xe9v\\xe9nements !\"),Da(),bl(66,\" La d\\xe9tection automatique des transbordements et routes erratiques est complexe. Nous essayons d'optimiser les algorithmes afin de g\\xe9rer au mieux les cas particuliers. Nous pr\\xe9voyons notamment d'exclure les zones de port car les \\xe9v\\xe9nements dans les ports sont non pertinents. \"),Da(),Pa(67,\"div\"),Pa(68,\"h4\"),bl(69,\"Les performances sont mauvaises ! Je passe mon temps \\xe0 attendre...\"),Da(),bl(70,\" Nous faisons notre maximum afin d'am\\xe9liorer les performances du syst\\xe8me. N'h\\xe9sitez-pas \\xe0 nous contacter pour qu'on puisse trouver un moyen d'adapter ANAIS \\xe0 votre usage. \"),Da(),Pa(71,\"div\"),Pa(72,\"h4\"),bl(73,\"Confidentialit\\xe9\"),Da(),bl(74,\" La connexion au serveur utilise le protocole HTTPS (TLS 1.2) et un certificat Let's Encrypt. Les serveurs et la bases de donn\\xe9es sont h\\xe9berg\\xe9s chez OVH. \"),Da(),Pa(75,\"div\"),Pa(76,\"h4\"),bl(77,\"J'ai des id\\xe9es d'am\\xe9liorations !\"),Da(),bl(78,\" L'\\xe9quipe derri\\xe8re ANAIS est ouverte \\xe0 toute remarque et proposition d'am\\xe9lioration. Elle se r\\xe9serve n\\xe9anmoins le droit de prioriser et d'adapter les fonctionnalit\\xe9s afin de r\\xe9pondre \\xe0 la majorit\\xe9 des utilisateurs. Vous pouvez utiliser le chat pour dialoguer directement avec l'\\xe9quipe. \"),Da(),Pa(79,\"div\"),Pa(80,\"h4\"),bl(81,\"Je suis dans un navire / avion et j'ai un d\\xe9bit internet trop petit pour ANAIS\"),Da(),bl(82,\" Nous avons travaill\\xe9 et travaillons toujours pour optimiser au maximum l'utilisation du d\\xe9bit. Ainsi, nous avons ajout\\xe9 des param\\xe8tres afin de limiter l'utilisation de la bande passante en environnement contraint. Ces param\\xe8tres sont accessibles via le menu \"),Pa(83,\"em\"),bl(84,\"Param\\xe8tres\"),Da(),bl(85,\". \"),Pa(86,\"ul\"),Pa(87,\"li\"),bl(88,\"Activer la \"),Pa(89,\"em\"),bl(90,\"Restriction de carte\"),Da(),bl(91,\" afin de ne charger qu'une zone pr\\xe9d\\xe9finie de la surface du globe\"),Da(),Pa(92,\"li\"),bl(93,\"Augmenter l'\"),Pa(94,\"em\"),bl(95,\"intervalle de rafraichissement des derni\\xe8res positions des navires\"),Da(),Da(),Pa(96,\"li\"),bl(97,\"Augmenter la \"),Pa(98,\"em\"),bl(99,\"p\\xe9riode de temps par d\\xe9faut\"),Da(),bl(100,\" pour les traces que l'on r\\xe9cup\\xe8re quand on consulte une fiche navire\"),Da(),Pa(101,\"li\"),bl(102,\"Activer la \"),Pa(103,\"em\"),bl(104,\"limite de zoom minimum\"),Da(),bl(105,\" afin de ne pas charger trop de navires d'un coup\"),Da(),Da(),Da(),Da(),Pa(106,\"h3\",5),bl(107,\"Outils Open Source\"),Da(),Pa(108,\"p\"),bl(109,\" Ce projet se base enti\\xe8rement sur des outils open source dont les licences sont visibles \\xe0 cet \"),Pa(110,\"a\",8),bl(111,\"endroit\"),Da(),bl(112,\". \"),Da(),Pa(113,\"p\"),bl(114,\" Autres cr\\xe9dits :\"),Ra(115,\"br\"),bl(116,\" - Flanders Marine Institute (2019). Maritime Boundaries Geodatabase: Maritime Boundaries and Exclusive Economic Zones (200NM), version 11. Available online at \"),Pa(117,\"a\",9),bl(118,\"https://www.marineregions.org/\"),Da(),bl(119,\". \"),Pa(120,\"a\",10),bl(121,\"https://doi.org/10.14284/386\"),Da(),Da(),Da())},directives:[$C,vb,jC,Yk],styles:[\".about-dialog__faq-title[_ngcontent-%COMP%]{margin-top:32px}.about-dialog__faq[_ngcontent-%COMP%]{display:grid;grid-gap:1em;grid-template-columns:1fr 1fr}\"]}),t})(),Lq=(()=>{class t{constructor(){this.subscriptions=[],this.eventListeners=[]}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.eventListeners.forEach(OV)}ensureMandatoryInputParams(...t){t.forEach(t=>{if(void 0===this[t])throw new Error(`Missing input property '${t}'`)})}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t}),t})(),Bq=(()=>{class t extends Lq{constructor(t,e,i,n,r){super(),this.titleService=t,this.router=e,this.dialog=i,this.mapService=n,this.routeService=r}ngOnInit(){this.titleService.setTitle(\"\\xc0 propos - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.dialogRef||this.createDialog()}createDialog(){this.dialogRef=this.dialog.open(Fq,{height:\"90vh\",width:\"90vw\",maxWidth:\"90vw\",closeOnNavigation:!0}),this.dialogRef.afterClosed().subscribe((t=!0)=>Vp(this,void 0,void 0,function*(){if(t){const t=this.routeService.previousUrl||\"\";yield this.router.navigateByUrl(t)}}))}}return t.\\u0275fac=function(e){return new(e||t)(Ta(zp),Ta(XR),Ta(zC),Ta(T$),Ta(F$))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-about-loader\"]],features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})();const Nq=[\"*\",[[\"mat-toolbar-row\"]]],zq=[\"*\",\"mat-toolbar-row\"],Vq=by(class{constructor(t){this._elementRef=t}});let jq=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,selectors:[[\"mat-toolbar-row\"]],hostAttrs:[1,\"mat-toolbar-row\"],exportAs:[\"matToolbarRow\"]}),t})(),$q=(()=>{class t extends Vq{constructor(t,e,i){super(t),this._platform=e,this._document=i}ngAfterViewInit(){this._platform.isBrowser&&(this._checkToolbarMixedModes(),this._toolbarRows.changes.subscribe(()=>this._checkToolbarMixedModes()))}_checkToolbarMixedModes(){}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(Vf),Ta(Du))},t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-toolbar\"]],contentQueries:function(t,e,i){if(1&t&&Eh(i,jq,5),2&t){let t;Ch(t=Mh())&&(e._toolbarRows=t)}},hostAttrs:[1,\"mat-toolbar\"],hostVars:4,hostBindings:function(t,e){2&t&&ll(\"mat-toolbar-multiple-rows\",e._toolbarRows.length>0)(\"mat-toolbar-single-row\",0===e._toolbarRows.length)},inputs:{color:\"color\"},exportAs:[\"matToolbar\"],features:[Vo],ngContentSelectors:zq,decls:2,vars:0,template:function(t,e){1&t&&(Za(Nq),Xa(0),Xa(1,1))},styles:[\".cdk-high-contrast-active .mat-toolbar{outline:solid 1px}.mat-toolbar-row,.mat-toolbar-single-row{display:flex;box-sizing:border-box;padding:0 16px;width:100%;flex-direction:row;align-items:center;white-space:nowrap}.mat-toolbar-multiple-rows{display:flex;box-sizing:border-box;flex-direction:column;width:100%}\\n\"],encapsulation:2,changeDetection:0}),t})(),Uq=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({imports:[[_y],_y]}),t})(),Hq=(()=>{class t{constructor(){this._vertical=!1,this._inset=!1}get vertical(){return this._vertical}set vertical(t){this._vertical=Of(t)}get inset(){return this._inset}set inset(t){this._inset=Of(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-divider\"]],hostAttrs:[\"role\",\"separator\",1,\"mat-divider\"],hostVars:7,hostBindings:function(t,e){2&t&&(ta(\"aria-orientation\",e.vertical?\"vertical\":\"horizontal\"),ll(\"mat-divider-vertical\",e.vertical)(\"mat-divider-horizontal\",!e.vertical)(\"mat-divider-inset\",e.inset))},inputs:{vertical:\"vertical\",inset:\"inset\"},decls:0,vars:0,template:function(t,e){},styles:[\".mat-divider{display:block;margin:0;border-top-width:1px;border-top-style:solid}.mat-divider.mat-divider-vertical{border-top:0;border-right-width:1px;border-right-style:solid}.mat-divider.mat-divider-inset{margin-left:80px}[dir=rtl] .mat-divider.mat-divider-inset{margin-left:auto;margin-right:80px}\\n\"],encapsulation:2,changeDetection:0}),t})(),Gq=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({imports:[[_y],_y]}),t})(),qq=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-admin-page\"]],decls:23,vars:2,consts:[[1,\"page\"],[\"color\",\"primary\"],[1,\"mat-h1\",\"ma-0\",\"pr-3\"],[\"mat-button\",\"\",\"routerLink\",\"/\"],[3,\"vertical\"],[\"mat-button\",\"\",\"routerLink\",\"/admin/users\"],[1,\"mr-2\"],[\"mat-button\",\"\",\"routerLink\",\"/admin/maintenance\"],[1,\"page__content\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"mat-toolbar\",1),Pa(2,\"div\",2),bl(3,\"Administration ANAIS\"),Da(),Pa(4,\"button\",3),Pa(5,\"mat-icon\"),bl(6,\"chevron_left\"),Da(),Pa(7,\"span\"),bl(8,\"Retour \\xe0 l'interface\"),Da(),Da(),Ra(9,\"mat-divider\",4),Pa(10,\"button\",5),Pa(11,\"mat-icon\",6),bl(12,\"supervisor_account\"),Da(),Pa(13,\"span\"),bl(14,\"Utilisateurs\"),Da(),Da(),Ra(15,\"mat-divider\",4),Pa(16,\"button\",7),Pa(17,\"mat-icon\",6),bl(18,\"build\"),Da(),Pa(19,\"span\"),bl(20,\"Maintenance\"),Da(),Da(),Da(),Pa(21,\"div\",8),Ra(22,\"router-outlet\"),Da(),Da()),2&t&&(Ss(9),Ia(\"vertical\",!0),Ss(6),Ia(\"vertical\",!0))},directives:[$q,vb,QR,Yk,Hq,iF],styles:[\".page[_ngcontent-%COMP%]{height:100%;max-height:100vh;overflow:auto}.page__content[_ngcontent-%COMP%]{max-width:960px;padding:16px;margin:0 auto}\"]}),t})();var Wq=(()=>(function(t){t.Planned=\"info\",t.InProgress=\"in_progress\"}(Wq||(Wq={})),Wq))();const Yq=[\"input\"],Zq=function(t){return{enterDuration:t}},Xq=[\"*\"],Kq=new Qi(\"mat-radio-default-options\",{providedIn:\"root\",factory:function(){return{color:\"accent\"}}});let Qq=0;const Jq={provide:Cb,useExisting:ot(()=>nW),multi:!0};class tW{constructor(t,e){this.source=t,this.value=e}}const eW=new Qi(\"MatRadioGroup\");let iW=(()=>{class t{constructor(t){this._changeDetector=t,this._value=null,this._name=\"mat-radio-group-\"+Qq++,this._selected=null,this._isInitialized=!1,this._labelPosition=\"after\",this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=()=>{},this.onTouched=()=>{},this.change=new ph}get name(){return this._name}set name(t){this._name=t,this._updateRadioButtonNames()}get labelPosition(){return this._labelPosition}set labelPosition(t){this._labelPosition=\"before\"===t?\"before\":\"after\",this._markRadiosForCheck()}get value(){return this._value}set value(t){this._value!==t&&(this._value=t,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}_checkSelectedRadioButton(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}get selected(){return this._selected}set selected(t){this._selected=t,this.value=t?t.value:null,this._checkSelectedRadioButton()}get disabled(){return this._disabled}set disabled(t){this._disabled=Of(t),this._markRadiosForCheck()}get required(){return this._required}set required(t){this._required=Of(t),this._markRadiosForCheck()}ngAfterContentInit(){this._isInitialized=!0}_touch(){this.onTouched&&this.onTouched()}_updateRadioButtonNames(){this._radios&&this._radios.forEach(t=>{t.name=this.name,t._markForCheck()})}_updateSelectedRadioFromValue(){this._radios&&(null===this._selected||this._selected.value!==this._value)&&(this._selected=null,this._radios.forEach(t=>{t.checked=this.value===t.value,t.checked&&(this._selected=t)}))}_emitChangeEvent(){this._isInitialized&&this.change.emit(new tW(this._selected,this._value))}_markRadiosForCheck(){this._radios&&this._radios.forEach(t=>t._markForCheck())}writeValue(t){this.value=t,this._changeDetector.markForCheck()}registerOnChange(t){this._controlValueAccessorChangeFn=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t,this._changeDetector.markForCheck()}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Cc))},t.\\u0275dir=Xt({type:t,inputs:{name:\"name\",labelPosition:\"labelPosition\",value:\"value\",selected:\"selected\",disabled:\"disabled\",required:\"required\",color:\"color\"},outputs:{change:\"change\"}}),t})(),nW=(()=>{class t extends iW{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"mat-radio-group\"]],contentQueries:function(t,e,i){if(1&t&&Eh(i,aW,5),2&t){let t;Ch(t=Mh())&&(e._radios=t)}},hostAttrs:[\"role\",\"radiogroup\",1,\"mat-radio-group\"],exportAs:[\"matRadioGroup\"],features:[Gl([Jq,{provide:eW,useExisting:t}]),Vo]}),t})();class rW{constructor(t){this._elementRef=t}}const sW=wy(xy(rW));let oW=(()=>{class t extends sW{constructor(t,e,i,n,r,s,o,a){super(e),this._changeDetector=i,this._focusMonitor=n,this._radioDispatcher=r,this._providerOverride=o,this._uniqueId=\"mat-radio-\"+ ++Qq,this.id=this._uniqueId,this.change=new ph,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this.radioGroup=t,this._noopAnimations=\"NoopAnimations\"===s,a&&(this.tabIndex=Pf(a,0)),this._removeUniqueSelectionListener=r.listen((t,e)=>{t!==this.id&&e===this.name&&(this.checked=!1)})}get checked(){return this._checked}set checked(t){const e=Of(t);this._checked!==e&&(this._checked=e,e&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!e&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),e&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(t){this._value!==t&&(this._value=t,null!==this.radioGroup&&(this.checked||(this.checked=this.radioGroup.value===t),this.checked&&(this.radioGroup.selected=this)))}get labelPosition(){return this._labelPosition||this.radioGroup&&this.radioGroup.labelPosition||\"after\"}set labelPosition(t){this._labelPosition=t}get disabled(){return this._disabled||null!==this.radioGroup&&this.radioGroup.disabled}set disabled(t){this._setDisabled(Of(t))}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(t){this._required=Of(t)}get color(){return this._color||this.radioGroup&&this.radioGroup.color||this._providerOverride&&this._providerOverride.color||\"accent\"}set color(t){this._color=t}get inputId(){return`${this.id||this._uniqueId}-input`}focus(t,e){e?this._focusMonitor.focusVia(this._inputElement,e,t):this._inputElement.nativeElement.focus(t)}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{!t&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_emitChangeEvent(){this.change.emit(new tW(this,this._value))}_isRippleDisabled(){return this.disableRipple||this.disabled}_onInputClick(t){t.stopPropagation()}_onInputInteraction(t){if(t.stopPropagation(),!this.checked&&!this.disabled){const t=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),t&&this.radioGroup._emitChangeEvent())}}_setDisabled(t){this._disabled!==t&&(this._disabled=t,this._changeDetector.markForCheck())}}return t.\\u0275fac=function(e){return new(e||t)(Ta(iW),Ta(Jl),Ta(Cc),Ta(Bm),Ta(Mg),Ta(String),Ta(void 0),Ta(String))},t.\\u0275dir=Xt({type:t,viewQuery:function(t,e){if(1&t&&kh(Yq,5),2&t){let t;Ch(t=Mh())&&(e._inputElement=t.first)}},inputs:{id:\"id\",checked:\"checked\",value:\"value\",labelPosition:\"labelPosition\",disabled:\"disabled\",required:\"required\",color:\"color\",name:\"name\",ariaLabel:[\"aria-label\",\"ariaLabel\"],ariaLabelledby:[\"aria-labelledby\",\"ariaLabelledby\"],ariaDescribedby:[\"aria-describedby\",\"ariaDescribedby\"]},outputs:{change:\"change\"},features:[Vo]}),t})(),aW=(()=>{class t extends oW{constructor(t,e,i,n,r,s,o,a){super(t,e,i,n,r,s,o,a)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(eW,8),Ta(Jl),Ta(Cc),Ta(Bm),Ta(Mg),Ta(sy,8),Ta(Kq,8),Wi(\"tabindex\"))},t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-radio-button\"]],hostAttrs:[1,\"mat-radio-button\"],hostVars:17,hostBindings:function(t,e){1&t&&$a(\"focus\",function(){return e._inputElement.nativeElement.focus()}),2&t&&(ta(\"tabindex\",null)(\"id\",e.id)(\"aria-label\",null)(\"aria-labelledby\",null)(\"aria-describedby\",null),ll(\"mat-radio-checked\",e.checked)(\"mat-radio-disabled\",e.disabled)(\"_mat-animation-noopable\",e._noopAnimations)(\"mat-primary\",\"primary\"===e.color)(\"mat-accent\",\"accent\"===e.color)(\"mat-warn\",\"warn\"===e.color))},inputs:{disableRipple:\"disableRipple\",tabIndex:\"tabIndex\"},exportAs:[\"matRadioButton\"],features:[Vo],ngContentSelectors:Xq,decls:13,vars:20,consts:[[1,\"mat-radio-label\"],[\"label\",\"\"],[1,\"mat-radio-container\"],[1,\"mat-radio-outer-circle\"],[1,\"mat-radio-inner-circle\"],[\"type\",\"radio\",1,\"mat-radio-input\",\"cdk-visually-hidden\",3,\"id\",\"checked\",\"disabled\",\"tabIndex\",\"required\",\"change\",\"click\"],[\"input\",\"\"],[\"mat-ripple\",\"\",1,\"mat-radio-ripple\",\"mat-focus-indicator\",3,\"matRippleTrigger\",\"matRippleDisabled\",\"matRippleCentered\",\"matRippleRadius\",\"matRippleAnimation\"],[1,\"mat-ripple-element\",\"mat-radio-persistent-ripple\"],[1,\"mat-radio-label-content\"],[2,\"display\",\"none\"]],template:function(t,e){if(1&t&&(Za(),Pa(0,\"label\",0,1),Pa(2,\"span\",2),Ra(3,\"span\",3),Ra(4,\"span\",4),Pa(5,\"input\",5,6),$a(\"change\",function(t){return e._onInputInteraction(t)})(\"click\",function(t){return e._onInputClick(t)}),Da(),Pa(7,\"span\",7),Ra(8,\"span\",8),Da(),Da(),Pa(9,\"span\",9),Pa(10,\"span\",10),bl(11,\"\\xa0\"),Da(),Xa(12),Da(),Da()),2&t){const t=ra(1);ta(\"for\",e.inputId),Ss(5),Ia(\"id\",e.inputId)(\"checked\",e.checked)(\"disabled\",e.disabled)(\"tabIndex\",e.tabIndex)(\"required\",e.required),ta(\"name\",e.name)(\"value\",e.value)(\"aria-label\",e.ariaLabel)(\"aria-labelledby\",e.ariaLabelledby)(\"aria-describedby\",e.ariaDescribedby),Ss(2),Ia(\"matRippleTrigger\",t)(\"matRippleDisabled\",e._isRippleDisabled())(\"matRippleCentered\",!0)(\"matRippleRadius\",20)(\"matRippleAnimation\",Jc(18,Zq,e._noopAnimations?0:150)),Ss(2),ll(\"mat-radio-label-before\",\"before\"==e.labelPosition)}},directives:[Xy],styles:[\".mat-radio-button{display:inline-block;-webkit-tap-highlight-color:transparent;outline:0}.mat-radio-label{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;display:inline-flex;align-items:center;white-space:nowrap;vertical-align:middle;width:100%}.mat-radio-container{box-sizing:border-box;display:inline-block;position:relative;width:20px;height:20px;flex-shrink:0}.mat-radio-outer-circle{box-sizing:border-box;display:block;height:20px;left:0;position:absolute;top:0;transition:border-color ease 280ms;width:20px;border-width:2px;border-style:solid;border-radius:50%}._mat-animation-noopable .mat-radio-outer-circle{transition:none}.mat-radio-inner-circle{border-radius:50%;box-sizing:border-box;display:block;height:20px;left:0;position:absolute;top:0;opacity:0;transition:transform ease 280ms,background-color ease 280ms,opacity linear 1ms 280ms;width:20px;transform:scale(0.001);-webkit-print-color-adjust:exact;color-adjust:exact}.mat-radio-checked .mat-radio-inner-circle{transform:scale(0.5);opacity:1;transition:transform ease 280ms,background-color ease 280ms}.cdk-high-contrast-active .mat-radio-checked .mat-radio-inner-circle{border:solid 10px}._mat-animation-noopable .mat-radio-inner-circle{transition:none}.mat-radio-label-content{-webkit-user-select:auto;-moz-user-select:auto;-ms-user-select:auto;user-select:auto;display:inline-block;order:0;line-height:inherit;padding-left:8px;padding-right:0}[dir=rtl] .mat-radio-label-content{padding-right:8px;padding-left:0}.mat-radio-label-content.mat-radio-label-before{order:-1;padding-left:0;padding-right:8px}[dir=rtl] .mat-radio-label-content.mat-radio-label-before{padding-right:0;padding-left:8px}.mat-radio-disabled,.mat-radio-disabled .mat-radio-label{cursor:default}.mat-radio-button .mat-radio-ripple{position:absolute;left:calc(50% - 20px);top:calc(50% - 20px);height:40px;width:40px;z-index:1;pointer-events:none}.mat-radio-button .mat-radio-ripple .mat-ripple-element:not(.mat-radio-persistent-ripple){opacity:.16}.mat-radio-persistent-ripple{width:100%;height:100%;transform:none;top:0;left:0}.mat-radio-container:hover .mat-radio-persistent-ripple{opacity:.04}.mat-radio-button:not(.mat-radio-disabled).cdk-keyboard-focused .mat-radio-persistent-ripple,.mat-radio-button:not(.mat-radio-disabled).cdk-program-focused .mat-radio-persistent-ripple{opacity:.12}.mat-radio-persistent-ripple,.mat-radio-disabled .mat-radio-container:hover .mat-radio-persistent-ripple{opacity:0}@media(hover: none){.mat-radio-container:hover .mat-radio-persistent-ripple{display:none}}.mat-radio-input{bottom:0;left:50%}.cdk-high-contrast-active .mat-radio-button:not(.mat-radio-disabled).cdk-keyboard-focused .mat-radio-ripple,.cdk-high-contrast-active .mat-radio-button:not(.mat-radio-disabled).cdk-program-focused .mat-radio-ripple{outline:solid 3px}.cdk-high-contrast-active .mat-radio-disabled{opacity:.5}\\n\"],encapsulation:2,changeDetection:0}),t})(),lW=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({imports:[[Ky,_y],_y]}),t})(),cW=(()=>{class t{constructor(t){this.viewContainerRef=t}ngOnInit(){const t=this.viewContainerRef.element.nativeElement;t.addEventListener(\"click\",()=>Vp(this,void 0,void 0,function*(){const e=Date.now();t.disabled=!0,t.style.width=`${t.offsetWidth}px`,t.style.height=`${t.offsetHeight}px`;const i=t.children[0].innerHTML;t.children[0].innerHTML='\\n<mat-spinner role=\"progressbar\" mode=\"indeterminate\" class=\"async-button\">\\n  <svg class=\"async-button__svg\" preserveAspectRatio=\"xMidYMid meet\" focusable=\"false\" viewBox=\"0 0 16.4 16.4\">\\n    <circle class=\"async-button__circle\" cx=\"50%\" cy=\"50%\" r=\"7\">\\n    </circle>\\n  </svg>\\n</mat-spinner>';try{yield this.action()}finally{const n=Date.now()-e;n<300&&(yield $j(300-n)),t.children[0].innerHTML=i,t.style.width=\"\",t.style.height=\"\",t.disabled=!1}}))}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Bc))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"app-async-action\",\"\"]],inputs:{action:[\"app-async-action\",\"action\"]}}),t})();const hW=[\"class\",\"page\"];function uW(t,e){if(1&t&&(Pa(0,\"div\"),bl(1),Pa(2,\"button\",11),bl(3,\"Terminer\"),Da(),Da()),2&t){const t=Wa();Ss(1),Sl(\" Maintenance active \",t.maintenance.message,\" - \",t.maintenance.type,\" \"),Ss(1),Ia(\"app-async-action\",t.removeMaintenance)}}function dW(t,e){1&t&&(Pa(0,\"div\"),bl(1,\" Aucune maintenance active\\n\"),Da())}function pW(t,e){1&t&&(Pa(0,\"mat-error\"),bl(1,\"Le message est obligatoire\"),Da())}let fW=(()=>{class t{constructor(t,e,i){this.formBuilder=t,this.workerService=e,this.authenticationService=i,this.AppMaintenanceType=Wq,this.setMaintenance=()=>Vp(this,void 0,void 0,function*(){this.maintenanceForm.valid&&(yield this.workerService.application.enableMaintenanceMode({message:this.maintenanceForm.controls.message.value,type:this.maintenanceForm.controls.type.value}),yield this.workerService.application.refreshHealthState())}),this.removeMaintenance=()=>Vp(this,void 0,void 0,function*(){yield this.workerService.application.disableMaintenanceMode(),yield this.workerService.application.refreshHealthState()})}ngOnInit(){return Vp(this,void 0,void 0,function*(){this.maintenanceForm=this.formBuilder.group({message:[\"\",[Rb.required]],type:[Wq.Planned,[Rb.required]]}),this.workerService.applicationHealth$.subscribe(t=>{this.maintenance=null==t?void 0:t.maintenance})})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(vx),Ta(iU),Ta(nU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-maintenance\",8,\"page\"]],attrs:hW,decls:22,vars:8,consts:[[1,\"mat-h1\"],[4,\"ngIf\"],[1,\"mat-h2\",\"mt-3\"],[3,\"formGroup\"],[1,\"d-block\"],[\"matInput\",\"\",\"placeholder\",\"...\",\"formControlName\",\"message\",\"required\",\"\"],[1,\"d-flex\"],[1,\"mr-2\"],[\"formControlName\",\"type\"],[\"color\",\"primary\",3,\"value\"],[\"mat-raised-button\",\"\",\"color\",\"primary\",1,\"mt-2\",3,\"app-async-action\",\"disabled\"],[\"mat-raised-button\",\"\",\"color\",\"primary\",3,\"app-async-action\"]],template:function(t,e){1&t&&(Pa(0,\"h1\",0),bl(1,\"Maintenance\"),Da(),na(2,uW,4,3,\"div\",1),na(3,dW,2,0,\"div\",1),Pa(4,\"h2\",2),bl(5,\"D\\xe9finir un message de maintenance\"),Da(),Pa(6,\"form\",3),Pa(7,\"mat-form-field\",4),Pa(8,\"mat-label\"),bl(9,\"Message\"),Da(),Ra(10,\"input\",5),na(11,pW,2,0,\"mat-error\",1),Da(),Pa(12,\"div\",6),Pa(13,\"label\",7),bl(14,\"Type :\"),Da(),Pa(15,\"mat-radio-group\",8),Pa(16,\"mat-radio-button\",9),bl(17,\"Planifi\\xe9e (message informatif seulement)\"),Da(),Pa(18,\"mat-radio-button\",9),bl(19,\"En cours (d\\xe9connecte l'API de la base de donn\\xe9es)\"),Da(),Da(),Da(),Pa(20,\"button\",10),bl(21,\"D\\xe9finir\"),Da(),Da()),2&t&&(Ss(2),Ia(\"ngIf\",e.maintenance),Ss(1),Ia(\"ngIf\",!e.maintenance),Ss(3),Ia(\"formGroup\",e.maintenanceForm),Ss(5),Ia(\"ngIf\",e.maintenanceForm.get(\"message\").hasError(\"required\")),Ss(5),Ia(\"value\",e.AppMaintenanceType.Planned),Ss(2),Ia(\"value\",e.AppMaintenanceType.InProgress),Ss(2),Ia(\"app-async-action\",e.setMaintenance)(\"disabled\",!e.maintenanceForm.valid))},directives:[Bd,jw,lw,Zw,tS,Hx,hS,Mb,aw,ix,hx,nW,aW,vb,cW,Nx],styles:[\".mat-radio-button[_ngcontent-%COMP%]{display:block;margin-bottom:.5em}\"]}),t})();const mW=[\"mat-sort-header\",\"\"];function gW(t,e){if(1&t){const t=Na();Pa(0,\"div\",3),$a(\"@arrowPosition.start\",function(){return Fe(t),Wa()._disableViewStateAnimation=!0})(\"@arrowPosition.done\",function(){return Fe(t),Wa()._disableViewStateAnimation=!1}),Ra(1,\"div\",4),Pa(2,\"div\",5),Ra(3,\"div\",6),Ra(4,\"div\",7),Ra(5,\"div\",8),Da(),Da()}if(2&t){const t=Wa();Ia(\"@arrowOpacity\",t._getArrowViewState())(\"@arrowPosition\",t._getArrowViewState())(\"@allowChildren\",t._getArrowDirectionState()),Ss(2),Ia(\"@indicator\",t._getArrowDirectionState()),Ss(1),Ia(\"@leftPointer\",t._getArrowDirectionState()),Ss(1),Ia(\"@rightPointer\",t._getArrowDirectionState())}}const AW=[\"*\"],vW=new Qi(\"MAT_SORT_DEFAULT_OPTIONS\"),_W=Cy(yy(class{}));let yW=(()=>{class t extends _W{constructor(t){super(),this._defaultOptions=t,this.sortables=new Map,this._stateChanges=new S,this.start=\"asc\",this._direction=\"\",this.sortChange=new ph}get direction(){return this._direction}set direction(t){this._direction=t}get disableClear(){return this._disableClear}set disableClear(t){this._disableClear=Of(t)}register(t){this.sortables.set(t.id,t)}deregister(t){this.sortables.delete(t.id)}sort(t){this.active!=t.id?(this.active=t.id,this.direction=t.start?t.start:this.start):this.direction=this.getNextSortDirection(t),this.sortChange.emit({active:this.active,direction:this.direction})}getNextSortDirection(t){var e,i,n;if(!t)return\"\";const r=null!==(i=null!==(e=null==t?void 0:t.disableClear)&&void 0!==e?e:this.disableClear)&&void 0!==i?i:!!(null===(n=this._defaultOptions)||void 0===n?void 0:n.disableClear);let s=function(t,e){let i=[\"asc\",\"desc\"];return\"desc\"==t&&i.reverse(),e||i.push(\"\"),i}(t.start||this.start,r),o=s.indexOf(this.direction)+1;return o>=s.length&&(o=0),s[o]}ngOnInit(){this._markInitialized()}ngOnChanges(){this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete()}}return t.\\u0275fac=function(e){return new(e||t)(Ta(vW,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matSort\",\"\"]],hostAttrs:[1,\"mat-sort\"],inputs:{disabled:[\"matSortDisabled\",\"disabled\"],start:[\"matSortStart\",\"start\"],direction:[\"matSortDirection\",\"direction\"],disableClear:[\"matSortDisableClear\",\"disableClear\"],active:[\"matSortActive\",\"active\"]},outputs:{sortChange:\"matSortChange\"},exportAs:[\"matSort\"],features:[Vo,ce]}),t})();const bW=gy.ENTERING+\" \"+my.STANDARD_CURVE,wW={indicator:bA(\"indicator\",[CA(\"active-asc, asc\",SA({transform:\"translateY(0px)\"})),CA(\"active-desc, desc\",SA({transform:\"translateY(10px)\"})),EA(\"active-asc <=> active-desc\",wA(bW))]),leftPointer:bA(\"leftPointer\",[CA(\"active-asc, asc\",SA({transform:\"rotate(-45deg)\"})),CA(\"active-desc, desc\",SA({transform:\"rotate(45deg)\"})),EA(\"active-asc <=> active-desc\",wA(bW))]),rightPointer:bA(\"rightPointer\",[CA(\"active-asc, asc\",SA({transform:\"rotate(45deg)\"})),CA(\"active-desc, desc\",SA({transform:\"rotate(-45deg)\"})),EA(\"active-asc <=> active-desc\",wA(bW))]),arrowOpacity:bA(\"arrowOpacity\",[CA(\"desc-to-active, asc-to-active, active\",SA({opacity:1})),CA(\"desc-to-hint, asc-to-hint, hint\",SA({opacity:.54})),CA(\"hint-to-desc, active-to-desc, desc, hint-to-asc, active-to-asc, asc, void\",SA({opacity:0})),EA(\"* => asc, * => desc, * => active, * => hint, * => void\",wA(\"0ms\")),EA(\"* <=> *\",wA(bW))]),arrowPosition:bA(\"arrowPosition\",[EA(\"* => desc-to-hint, * => desc-to-active\",wA(bW,kA([SA({transform:\"translateY(-25%)\"}),SA({transform:\"translateY(0)\"})]))),EA(\"* => hint-to-desc, * => active-to-desc\",wA(bW,kA([SA({transform:\"translateY(0)\"}),SA({transform:\"translateY(25%)\"})]))),EA(\"* => asc-to-hint, * => asc-to-active\",wA(bW,kA([SA({transform:\"translateY(25%)\"}),SA({transform:\"translateY(0)\"})]))),EA(\"* => hint-to-asc, * => active-to-asc\",wA(bW,kA([SA({transform:\"translateY(0)\"}),SA({transform:\"translateY(-25%)\"})]))),CA(\"desc-to-hint, asc-to-hint, hint, desc-to-active, asc-to-active, active\",SA({transform:\"translateY(0)\"})),CA(\"hint-to-desc, active-to-desc, desc\",SA({transform:\"translateY(-25%)\"})),CA(\"hint-to-asc, active-to-asc, asc\",SA({transform:\"translateY(25%)\"}))]),allowChildren:bA(\"allowChildren\",[EA(\"* <=> *\",[TA(\"@*\",MA(),{optional:!0})])])};let xW=(()=>{class t{constructor(){this.changes=new S}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=ft({factory:function(){return new t},token:t,providedIn:\"root\"}),t})();const SW={provide:xW,deps:[[new Rn,new Ln,xW]],useFactory:function(t){return t||new xW}},CW=yy(class{});let kW=(()=>{class t extends CW{constructor(t,e,i,n,r,s){super(),this._intl=t,this._changeDetectorRef=e,this._sort=i,this._columnDef=n,this._focusMonitor=r,this._elementRef=s,this._showIndicatorHint=!1,this._viewState={},this._arrowDirection=\"\",this._disableViewStateAnimation=!1,this.arrowPosition=\"after\",this._handleStateChanges()}get disableClear(){return this._disableClear}set disableClear(t){this._disableClear=Of(t)}ngOnInit(){!this.id&&this._columnDef&&(this.id=this._columnDef.name),this._updateArrowDirection(),this._setAnimationTransitionState({toState:this._isSorted()?\"active\":this._arrowDirection}),this._sort.register(this)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{const e=!!t;e!==this._showIndicatorHint&&(this._setIndicatorHintVisible(e),this._changeDetectorRef.markForCheck())})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._sort.deregister(this),this._rerenderSubscription.unsubscribe()}_setIndicatorHintVisible(t){this._isDisabled()&&t||(this._showIndicatorHint=t,this._isSorted()||(this._updateArrowDirection(),this._setAnimationTransitionState(this._showIndicatorHint?{fromState:this._arrowDirection,toState:\"hint\"}:{fromState:\"hint\",toState:this._arrowDirection})))}_setAnimationTransitionState(t){this._viewState=t||{},this._disableViewStateAnimation&&(this._viewState={toState:t.toState})}_toggleOnInteraction(){this._sort.sort(this),(\"hint\"===this._viewState.toState||\"active\"===this._viewState.toState)&&(this._disableViewStateAnimation=!0)}_handleClick(){this._isDisabled()||this._sort.sort(this)}_handleKeydown(t){!this._isDisabled()&&(32===t.keyCode||13===t.keyCode)&&(t.preventDefault(),this._toggleOnInteraction())}_isSorted(){return this._sort.active==this.id&&(\"asc\"===this._sort.direction||\"desc\"===this._sort.direction)}_getArrowDirectionState(){return`${this._isSorted()?\"active-\":\"\"}${this._arrowDirection}`}_getArrowViewState(){const t=this._viewState.fromState;return(t?`${t}-to-`:\"\")+this._viewState.toState}_updateArrowDirection(){this._arrowDirection=this._isSorted()?this._sort.direction:this.start||this._sort.start}_isDisabled(){return this._sort.disabled||this.disabled}_getAriaSortAttribute(){return this._isSorted()?\"asc\"==this._sort.direction?\"ascending\":\"descending\":\"none\"}_renderArrow(){return!this._isDisabled()||this._isSorted()}_handleStateChanges(){this._rerenderSubscription=q(this._sort.sortChange,this._sort._stateChanges,this._intl.changes).subscribe(()=>{this._isSorted()&&(this._updateArrowDirection(),(\"hint\"===this._viewState.toState||\"active\"===this._viewState.toState)&&(this._disableViewStateAnimation=!0),this._setAnimationTransitionState({fromState:this._arrowDirection,toState:\"active\"}),this._showIndicatorHint=!1),!this._isSorted()&&this._viewState&&\"active\"===this._viewState.toState&&(this._disableViewStateAnimation=!1,this._setAnimationTransitionState({fromState:\"active\",toState:this._arrowDirection})),this._changeDetectorRef.markForCheck()})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(xW),Ta(Cc),Ta(yW,8),Ta(\"MAT_SORT_HEADER_COLUMN_DEF\",8),Ta(Bm),Ta(Jl))},t.\\u0275cmp=Ht({type:t,selectors:[[\"\",\"mat-sort-header\",\"\"]],hostAttrs:[1,\"mat-sort-header\"],hostVars:3,hostBindings:function(t,e){1&t&&$a(\"click\",function(){return e._handleClick()})(\"keydown\",function(t){return e._handleKeydown(t)})(\"mouseenter\",function(){return e._setIndicatorHintVisible(!0)})(\"mouseleave\",function(){return e._setIndicatorHintVisible(!1)}),2&t&&(ta(\"aria-sort\",e._getAriaSortAttribute()),ll(\"mat-sort-header-disabled\",e._isDisabled()))},inputs:{disabled:\"disabled\",arrowPosition:\"arrowPosition\",disableClear:\"disableClear\",id:[\"mat-sort-header\",\"id\"],start:\"start\"},exportAs:[\"matSortHeader\"],features:[Vo],attrs:mW,ngContentSelectors:AW,decls:4,vars:6,consts:[[\"role\",\"button\",1,\"mat-sort-header-container\",\"mat-focus-indicator\"],[1,\"mat-sort-header-content\"],[\"class\",\"mat-sort-header-arrow\",4,\"ngIf\"],[1,\"mat-sort-header-arrow\"],[1,\"mat-sort-header-stem\"],[1,\"mat-sort-header-indicator\"],[1,\"mat-sort-header-pointer-left\"],[1,\"mat-sort-header-pointer-right\"],[1,\"mat-sort-header-pointer-middle\"]],template:function(t,e){1&t&&(Za(),Pa(0,\"div\",0),Pa(1,\"div\",1),Xa(2),Da(),na(3,gW,6,6,\"div\",2),Da()),2&t&&(ll(\"mat-sort-header-sorted\",e._isSorted())(\"mat-sort-header-position-before\",\"before\"==e.arrowPosition),ta(\"tabindex\",e._isDisabled()?null:0),Ss(3),Ia(\"ngIf\",e._renderArrow()))},directives:[Bd],styles:[\".mat-sort-header-container{display:flex;cursor:pointer;align-items:center;letter-spacing:normal;outline:0}[mat-sort-header].cdk-keyboard-focused .mat-sort-header-container,[mat-sort-header].cdk-program-focused .mat-sort-header-container{border-bottom:solid 1px currentColor}.mat-sort-header-disabled .mat-sort-header-container{cursor:default}.mat-sort-header-content{text-align:center;display:flex;align-items:center}.mat-sort-header-position-before{flex-direction:row-reverse}.mat-sort-header-arrow{height:12px;width:12px;min-width:12px;position:relative;display:flex;opacity:0}.mat-sort-header-arrow,[dir=rtl] .mat-sort-header-position-before .mat-sort-header-arrow{margin:0 0 0 6px}.mat-sort-header-position-before .mat-sort-header-arrow,[dir=rtl] .mat-sort-header-arrow{margin:0 6px 0 0}.mat-sort-header-stem{background:currentColor;height:10px;width:2px;margin:auto;display:flex;align-items:center}.cdk-high-contrast-active .mat-sort-header-stem{width:0;border-left:solid 2px}.mat-sort-header-indicator{width:100%;height:2px;display:flex;align-items:center;position:absolute;top:0;left:0}.mat-sort-header-pointer-middle{margin:auto;height:2px;width:2px;background:currentColor;transform:rotate(45deg)}.cdk-high-contrast-active .mat-sort-header-pointer-middle{width:0;height:0;border-top:solid 2px;border-left:solid 2px}.mat-sort-header-pointer-left,.mat-sort-header-pointer-right{background:currentColor;width:6px;height:2px;position:absolute;top:0}.cdk-high-contrast-active .mat-sort-header-pointer-left,.cdk-high-contrast-active .mat-sort-header-pointer-right{width:0;height:0;border-left:solid 6px;border-top:solid 2px}.mat-sort-header-pointer-left{transform-origin:right;left:0}.mat-sort-header-pointer-right{transform-origin:left;right:0}\\n\"],encapsulation:2,data:{animation:[wW.indicator,wW.leftPointer,wW.rightPointer,wW.arrowOpacity,wW.arrowPosition,wW.allowChildren]},changeDetection:0}),t})(),EW=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({providers:[SW],imports:[[Jd,_y]]}),t})();const MW=[[[\"caption\"]],[[\"colgroup\"],[\"col\"]]],TW=[\"caption\",\"colgroup, col\"];function IW(t){return class extends t{constructor(...t){super(...t),this._sticky=!1,this._hasStickyChanged=!1}get sticky(){return this._sticky}set sticky(t){const e=this._sticky;this._sticky=Of(t),this._hasStickyChanged=e!==this._sticky}hasStickyChanged(){const t=this._hasStickyChanged;return this._hasStickyChanged=!1,t}resetStickyChanged(){this._hasStickyChanged=!1}}}const OW=new Qi(\"CDK_TABLE\");let PW=(()=>{class t{constructor(t){this.template=t}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Ic))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkCellDef\",\"\"]]}),t})(),DW=(()=>{class t{constructor(t){this.template=t}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Ic))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkHeaderCellDef\",\"\"]]}),t})(),RW=(()=>{class t{constructor(t){this.template=t}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Ic))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkFooterCellDef\",\"\"]]}),t})();class FW{}const LW=IW(FW);let BW=(()=>{class t extends LW{constructor(t){super(),this._table=t,this._stickyEnd=!1}get name(){return this._name}set name(t){this._setNameInput(t)}get stickyEnd(){return this._stickyEnd}set stickyEnd(t){const e=this._stickyEnd;this._stickyEnd=Of(t),this._hasStickyChanged=e!==this._stickyEnd}_updateColumnCssClassName(){this._columnCssClassName=[`cdk-column-${this.cssClassFriendlyName}`]}_setNameInput(t){t&&(this._name=t,this.cssClassFriendlyName=t.replace(/[^a-z0-9_-]/gi,\"-\"),this._updateColumnCssClassName())}}return t.\\u0275fac=function(e){return new(e||t)(Ta(OW,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkColumnDef\",\"\"]],contentQueries:function(t,e,i){if(1&t&&(Eh(i,PW,5),Eh(i,DW,5),Eh(i,RW,5)),2&t){let t;Ch(t=Mh())&&(e.cell=t.first),Ch(t=Mh())&&(e.headerCell=t.first),Ch(t=Mh())&&(e.footerCell=t.first)}},inputs:{sticky:\"sticky\",name:[\"cdkColumnDef\",\"name\"],stickyEnd:\"stickyEnd\"},features:[Gl([{provide:\"MAT_SORT_HEADER_COLUMN_DEF\",useExisting:t}]),Vo]}),t})();class NW{constructor(t,e){const i=e.nativeElement.classList;for(const n of t._columnCssClassName)i.add(n)}}let zW=(()=>{class t extends NW{constructor(t,e){super(t,e)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(BW),Ta(Jl))},t.\\u0275dir=Xt({type:t,selectors:[[\"cdk-header-cell\"],[\"th\",\"cdk-header-cell\",\"\"]],hostAttrs:[\"role\",\"columnheader\",1,\"cdk-header-cell\"],features:[Vo]}),t})(),VW=(()=>{class t extends NW{constructor(t,e){var i;if(super(t,e),1===(null===(i=t._table)||void 0===i?void 0:i._elementRef.nativeElement.nodeType)){const i=t._table._elementRef.nativeElement.getAttribute(\"role\");e.nativeElement.setAttribute(\"role\",\"grid\"===i||\"treegrid\"===i?\"gridcell\":\"cell\")}}}return t.\\u0275fac=function(e){return new(e||t)(Ta(BW),Ta(Jl))},t.\\u0275dir=Xt({type:t,selectors:[[\"cdk-cell\"],[\"td\",\"cdk-cell\",\"\"]],hostAttrs:[1,\"cdk-cell\"],features:[Vo]}),t})();class jW{constructor(){this.tasks=[],this.endTasks=[]}}const $W=new Qi(\"_COALESCED_STYLE_SCHEDULER\");let UW=(()=>{class t{constructor(t){this._ngZone=t,this._currentSchedule=null,this._destroyed=new S}schedule(t){this._createScheduleIfNeeded(),this._currentSchedule.tasks.push(t)}scheduleEnd(t){this._createScheduleIfNeeded(),this._currentSchedule.endTasks.push(t)}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_createScheduleIfNeeded(){this._currentSchedule||(this._currentSchedule=new jW,this._getScheduleObservable().pipe(Mf(this._destroyed)).subscribe(()=>{for(;this._currentSchedule.tasks.length||this._currentSchedule.endTasks.length;){const t=this._currentSchedule;this._currentSchedule=new jW;for(const e of t.tasks)e();for(const e of t.endTasks)e()}this._currentSchedule=null}))}_getScheduleObservable(){return this._ngZone.isStable?B(Promise.resolve(void 0)):this._ngZone.onStable.pipe(_f(1))}}return t.\\u0275fac=function(e){return new(e||t)(En(tu))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac}),t})(),HW=(()=>{class t{constructor(t,e){this.template=t,this._differs=e}ngOnChanges(t){if(!this._columnsDiffer){const e=t.columns&&t.columns.currentValue||[];this._columnsDiffer=this._differs.find(e).create(),this._columnsDiffer.diff(e)}}getColumnsDiff(){return this._columnsDiffer.diff(this.columns)}extractCellTemplate(t){return this instanceof WW?t.headerCell.template:this instanceof XW?t.footerCell.template:t.cell.template}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Ic),Ta(vc))},t.\\u0275dir=Xt({type:t,features:[ce]}),t})();class GW extends HW{}const qW=IW(GW);let WW=(()=>{class t extends qW{constructor(t,e,i){super(t,e),this._table=i}ngOnChanges(t){super.ngOnChanges(t)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Ic),Ta(vc),Ta(OW,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkHeaderRowDef\",\"\"]],inputs:{columns:[\"cdkHeaderRowDef\",\"columns\"],sticky:[\"cdkHeaderRowDefSticky\",\"sticky\"]},features:[Vo,ce]}),t})();class YW extends HW{}const ZW=IW(YW);let XW=(()=>{class t extends ZW{constructor(t,e,i){super(t,e),this._table=i}ngOnChanges(t){super.ngOnChanges(t)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Ic),Ta(vc),Ta(OW,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkFooterRowDef\",\"\"]],inputs:{columns:[\"cdkFooterRowDef\",\"columns\"],sticky:[\"cdkFooterRowDefSticky\",\"sticky\"]},features:[Vo,ce]}),t})(),KW=(()=>{class t extends HW{constructor(t,e,i){super(t,e),this._table=i}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Ic),Ta(vc),Ta(OW,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkRowDef\",\"\"]],inputs:{columns:[\"cdkRowDefColumns\",\"columns\"],when:[\"cdkRowDefWhen\",\"when\"]},features:[Vo]}),t})(),QW=(()=>{class t{constructor(e){this._viewContainer=e,t.mostRecentCellOutlet=this}ngOnDestroy(){t.mostRecentCellOutlet===this&&(t.mostRecentCellOutlet=null)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Bc))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkCellOutlet\",\"\"]]}),t.mostRecentCellOutlet=null,t})(),JW=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Ht({type:t,selectors:[[\"cdk-header-row\"],[\"tr\",\"cdk-header-row\",\"\"]],hostAttrs:[\"role\",\"row\",1,\"cdk-header-row\"],decls:1,vars:0,consts:[[\"cdkCellOutlet\",\"\"]],template:function(t,e){1&t&&Ba(0,0)},directives:[QW],encapsulation:2}),t})(),tY=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Ht({type:t,selectors:[[\"cdk-row\"],[\"tr\",\"cdk-row\",\"\"]],hostAttrs:[\"role\",\"row\",1,\"cdk-row\"],decls:1,vars:0,consts:[[\"cdkCellOutlet\",\"\"]],template:function(t,e){1&t&&Ba(0,0)},directives:[QW],encapsulation:2}),t})(),eY=(()=>{class t{constructor(t){this.templateRef=t}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Ic))},t.\\u0275dir=Xt({type:t,selectors:[[\"ng-template\",\"cdkNoDataRow\",\"\"]]}),t})();const iY=[\"top\",\"bottom\",\"left\",\"right\"];class nY{constructor(t,e,i,n,r=!0,s=!0,o){this._isNativeHtmlTable=t,this._stickCellCss=e,this.direction=i,this._coalescedStyleScheduler=n,this._isBrowser=r,this._needsPositionStickyOnElement=s,this._positionListener=o,this._cachedCellWidths=[],this._borderCellCss={top:`${e}-border-elem-top`,bottom:`${e}-border-elem-bottom`,left:`${e}-border-elem-left`,right:`${e}-border-elem-right`}}clearStickyPositioning(t,e){const i=[];for(const n of t)if(n.nodeType===n.ELEMENT_NODE){i.push(n);for(let t=0;t<n.children.length;t++)i.push(n.children[t])}this._coalescedStyleScheduler.schedule(()=>{for(const t of i)this._removeStickyStyle(t,e)})}updateStickyColumns(t,e,i,n=!0){if(!t.length||!this._isBrowser||!e.some(t=>t)&&!i.some(t=>t))return void(this._positionListener&&(this._positionListener.stickyColumnsUpdated({sizes:[]}),this._positionListener.stickyEndColumnsUpdated({sizes:[]})));const r=t[0],s=r.children.length,o=this._getCellWidths(r,n),a=this._getStickyStartColumnPositions(o,e),l=this._getStickyEndColumnPositions(o,i),c=e.lastIndexOf(!0),h=i.indexOf(!0);this._coalescedStyleScheduler.schedule(()=>{const n=\"rtl\"===this.direction,r=n?\"right\":\"left\",u=n?\"left\":\"right\";for(const o of t)for(let t=0;t<s;t++){const n=o.children[t];e[t]&&this._addStickyStyle(n,r,a[t],t===c),i[t]&&this._addStickyStyle(n,u,l[t],t===h)}this._positionListener&&(this._positionListener.stickyColumnsUpdated({sizes:-1===c?[]:o.slice(0,c+1).map((t,i)=>e[i]?t:null)}),this._positionListener.stickyEndColumnsUpdated({sizes:-1===h?[]:o.slice(h).map((t,e)=>i[e+h]?t:null).reverse()}))})}stickRows(t,e,i){if(!this._isBrowser)return;const n=\"bottom\"===i?t.slice().reverse():t,r=\"bottom\"===i?e.slice().reverse():e,s=[],o=[],a=[];for(let c=0,h=0;c<n.length;c++){if(!r[c])continue;s[c]=h;const t=n[c];a[c]=this._isNativeHtmlTable?Array.from(t.children):[t];const e=t.getBoundingClientRect().height;h+=e,o[c]=e}const l=r.lastIndexOf(!0);this._coalescedStyleScheduler.schedule(()=>{var t,e;for(let o=0;o<n.length;o++){if(!r[o])continue;const t=s[o],e=o===l;for(const n of a[o])this._addStickyStyle(n,i,t,e)}\"top\"===i?null===(t=this._positionListener)||void 0===t||t.stickyHeaderRowsUpdated({sizes:o,offsets:s,elements:a}):null===(e=this._positionListener)||void 0===e||e.stickyFooterRowsUpdated({sizes:o,offsets:s,elements:a})})}updateStickyFooterContainer(t,e){if(!this._isNativeHtmlTable)return;const i=t.querySelector(\"tfoot\");this._coalescedStyleScheduler.schedule(()=>{e.some(t=>!t)?this._removeStickyStyle(i,[\"bottom\"]):this._addStickyStyle(i,\"bottom\",0,!1)})}_removeStickyStyle(t,e){for(const i of e)t.style[i]=\"\",t.classList.remove(this._borderCellCss[i]);iY.some(i=>-1===e.indexOf(i)&&t.style[i])?t.style.zIndex=this._getCalculatedZIndex(t):(t.style.zIndex=\"\",this._needsPositionStickyOnElement&&(t.style.position=\"\"),t.classList.remove(this._stickCellCss))}_addStickyStyle(t,e,i,n){t.classList.add(this._stickCellCss),n&&t.classList.add(this._borderCellCss[e]),t.style[e]=`${i}px`,t.style.zIndex=this._getCalculatedZIndex(t),this._needsPositionStickyOnElement&&(t.style.cssText+=\"position: -webkit-sticky; position: sticky; \")}_getCalculatedZIndex(t){const e={top:100,bottom:10,left:1,right:1};let i=0;for(const n of iY)t.style[n]&&(i+=e[n]);return i?`${i}`:\"\"}_getCellWidths(t,e=!0){if(!e&&this._cachedCellWidths.length)return this._cachedCellWidths;const i=[],n=t.children;for(let r=0;r<n.length;r++)i.push(n[r].getBoundingClientRect().width);return this._cachedCellWidths=i,i}_getStickyStartColumnPositions(t,e){const i=[];let n=0;for(let r=0;r<t.length;r++)e[r]&&(i[r]=n,n+=t[r]);return i}_getStickyEndColumnPositions(t,e){const i=[];let n=0;for(let r=t.length;r>0;r--)e[r]&&(i[r]=n,n+=t[r]);return i}}const rY=new Qi(\"CDK_SPL\");let sY=(()=>{class t{constructor(t,e){this.viewContainer=t,this.elementRef=e}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Bc),Ta(Jl))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"rowOutlet\",\"\"]]}),t})(),oY=(()=>{class t{constructor(t,e){this.viewContainer=t,this.elementRef=e}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Bc),Ta(Jl))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"headerRowOutlet\",\"\"]]}),t})(),aY=(()=>{class t{constructor(t,e){this.viewContainer=t,this.elementRef=e}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Bc),Ta(Jl))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"footerRowOutlet\",\"\"]]}),t})(),lY=(()=>{class t{constructor(t,e){this.viewContainer=t,this.elementRef=e}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Bc),Ta(Jl))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"noDataRowOutlet\",\"\"]]}),t})(),cY=(()=>{class t{constructor(t,e,i,n,r,s,o,a,l,c,h){this._differs=t,this._changeDetectorRef=e,this._elementRef=i,this._dir=r,this._platform=o,this._viewRepeater=a,this._coalescedStyleScheduler=l,this._viewportRuler=c,this._stickyPositioningListener=h,this._onDestroy=new S,this._columnDefsByName=new Map,this._customColumnDefs=new Set,this._customRowDefs=new Set,this._customHeaderRowDefs=new Set,this._customFooterRowDefs=new Set,this._headerRowDefChanged=!0,this._footerRowDefChanged=!0,this._stickyColumnStylesNeedReset=!0,this._forceRecalculateCellWidths=!0,this._cachedRenderRowsMap=new Map,this.stickyCssClass=\"cdk-table-sticky\",this.needsPositionStickyOnElement=!0,this._isShowingNoDataRow=!1,this._multiTemplateDataRows=!1,this._fixedLayout=!1,this.contentChanged=new ph,this.viewChange=new Zp({start:0,end:Number.MAX_VALUE}),n||this._elementRef.nativeElement.setAttribute(\"role\",\"table\"),this._document=s,this._isNativeHtmlTable=\"TABLE\"===this._elementRef.nativeElement.nodeName}get trackBy(){return this._trackByFn}set trackBy(t){this._trackByFn=t}get dataSource(){return this._dataSource}set dataSource(t){this._dataSource!==t&&this._switchDataSource(t)}get multiTemplateDataRows(){return this._multiTemplateDataRows}set multiTemplateDataRows(t){this._multiTemplateDataRows=Of(t),this._rowOutlet&&this._rowOutlet.viewContainer.length&&(this._forceRenderDataRows(),this.updateStickyColumnStyles())}get fixedLayout(){return this._fixedLayout}set fixedLayout(t){this._fixedLayout=Of(t),this._forceRecalculateCellWidths=!0,this._stickyColumnStylesNeedReset=!0}ngOnInit(){this._setupStickyStyler(),this._isNativeHtmlTable&&this._applyNativeTableSections(),this._dataDiffer=this._differs.find([]).create((t,e)=>this.trackBy?this.trackBy(e.dataIndex,e.data):e),this._viewportRuler.change().pipe(Mf(this._onDestroy)).subscribe(()=>{this._forceRecalculateCellWidths=!0})}ngAfterContentChecked(){this._cacheRowDefs(),this._cacheColumnDefs();const t=this._renderUpdatedColumns()||this._headerRowDefChanged||this._footerRowDefChanged;this._stickyColumnStylesNeedReset=this._stickyColumnStylesNeedReset||t,this._forceRecalculateCellWidths=t,this._headerRowDefChanged&&(this._forceRenderHeaderRows(),this._headerRowDefChanged=!1),this._footerRowDefChanged&&(this._forceRenderFooterRows(),this._footerRowDefChanged=!1),this.dataSource&&this._rowDefs.length>0&&!this._renderChangeSubscription?this._observeRenderChanges():this._stickyColumnStylesNeedReset&&this.updateStickyColumnStyles(),this._checkStickyStates()}ngOnDestroy(){this._rowOutlet.viewContainer.clear(),this._noDataRowOutlet.viewContainer.clear(),this._headerRowOutlet.viewContainer.clear(),this._footerRowOutlet.viewContainer.clear(),this._cachedRenderRowsMap.clear(),this._onDestroy.next(),this._onDestroy.complete(),Cg(this.dataSource)&&this.dataSource.disconnect(this)}renderRows(){this._renderRows=this._getAllRenderRows();const t=this._dataDiffer.diff(this._renderRows);if(!t)return this._updateNoDataRow(),void this.contentChanged.next();const e=this._rowOutlet.viewContainer;this._viewRepeater.applyChanges(t,e,(t,e,i)=>this._getEmbeddedViewArgs(t.item,i),t=>t.item.data,t=>{1===t.operation&&t.context&&this._renderCellTemplateForItem(t.record.item.rowDef,t.context)}),this._updateRowIndexContext(),t.forEachIdentityChange(t=>{e.get(t.currentIndex).context.$implicit=t.item.data}),this._updateNoDataRow(),this.updateStickyColumnStyles(),this.contentChanged.next()}addColumnDef(t){this._customColumnDefs.add(t)}removeColumnDef(t){this._customColumnDefs.delete(t)}addRowDef(t){this._customRowDefs.add(t)}removeRowDef(t){this._customRowDefs.delete(t)}addHeaderRowDef(t){this._customHeaderRowDefs.add(t),this._headerRowDefChanged=!0}removeHeaderRowDef(t){this._customHeaderRowDefs.delete(t),this._headerRowDefChanged=!0}addFooterRowDef(t){this._customFooterRowDefs.add(t),this._footerRowDefChanged=!0}removeFooterRowDef(t){this._customFooterRowDefs.delete(t),this._footerRowDefChanged=!0}setNoDataRow(t){this._customNoDataRow=t}updateStickyHeaderRowStyles(){const t=this._getRenderedRows(this._headerRowOutlet),e=this._elementRef.nativeElement.querySelector(\"thead\");e&&(e.style.display=t.length?\"\":\"none\");const i=this._headerRowDefs.map(t=>t.sticky);this._stickyStyler.clearStickyPositioning(t,[\"top\"]),this._stickyStyler.stickRows(t,i,\"top\"),this._headerRowDefs.forEach(t=>t.resetStickyChanged())}updateStickyFooterRowStyles(){const t=this._getRenderedRows(this._footerRowOutlet),e=this._elementRef.nativeElement.querySelector(\"tfoot\");e&&(e.style.display=t.length?\"\":\"none\");const i=this._footerRowDefs.map(t=>t.sticky);this._stickyStyler.clearStickyPositioning(t,[\"bottom\"]),this._stickyStyler.stickRows(t,i,\"bottom\"),this._stickyStyler.updateStickyFooterContainer(this._elementRef.nativeElement,i),this._footerRowDefs.forEach(t=>t.resetStickyChanged())}updateStickyColumnStyles(){const t=this._getRenderedRows(this._headerRowOutlet),e=this._getRenderedRows(this._rowOutlet),i=this._getRenderedRows(this._footerRowOutlet);(this._isNativeHtmlTable&&!this._fixedLayout||this._stickyColumnStylesNeedReset)&&(this._stickyStyler.clearStickyPositioning([...t,...e,...i],[\"left\",\"right\"]),this._stickyColumnStylesNeedReset=!1),t.forEach((t,e)=>{this._addStickyColumnStyles([t],this._headerRowDefs[e])}),this._rowDefs.forEach(t=>{const i=[];for(let n=0;n<e.length;n++)this._renderRows[n].rowDef===t&&i.push(e[n]);this._addStickyColumnStyles(i,t)}),i.forEach((t,e)=>{this._addStickyColumnStyles([t],this._footerRowDefs[e])}),Array.from(this._columnDefsByName.values()).forEach(t=>t.resetStickyChanged())}_getAllRenderRows(){const t=[],e=this._cachedRenderRowsMap;this._cachedRenderRowsMap=new Map;for(let i=0;i<this._data.length;i++){let n=this._data[i];const r=this._getRenderRowsForData(n,i,e.get(n));this._cachedRenderRowsMap.has(n)||this._cachedRenderRowsMap.set(n,new WeakMap);for(let e=0;e<r.length;e++){let i=r[e];const n=this._cachedRenderRowsMap.get(i.data);n.has(i.rowDef)?n.get(i.rowDef).push(i):n.set(i.rowDef,[i]),t.push(i)}}return t}_getRenderRowsForData(t,e,i){return this._getRowDefs(t,e).map(n=>{const r=i&&i.has(n)?i.get(n):[];if(r.length){const t=r.shift();return t.dataIndex=e,t}return{data:t,rowDef:n,dataIndex:e}})}_cacheColumnDefs(){this._columnDefsByName.clear(),hY(this._getOwnDefs(this._contentColumnDefs),this._customColumnDefs).forEach(t=>{this._columnDefsByName.has(t.name),this._columnDefsByName.set(t.name,t)})}_cacheRowDefs(){this._headerRowDefs=hY(this._getOwnDefs(this._contentHeaderRowDefs),this._customHeaderRowDefs),this._footerRowDefs=hY(this._getOwnDefs(this._contentFooterRowDefs),this._customFooterRowDefs),this._rowDefs=hY(this._getOwnDefs(this._contentRowDefs),this._customRowDefs);const t=this._rowDefs.filter(t=>!t.when);this._defaultRowDef=t[0]}_renderUpdatedColumns(){const t=(t,e)=>t||!!e.getColumnsDiff(),e=this._rowDefs.reduce(t,!1);e&&this._forceRenderDataRows();const i=this._headerRowDefs.reduce(t,!1);i&&this._forceRenderHeaderRows();const n=this._footerRowDefs.reduce(t,!1);return n&&this._forceRenderFooterRows(),e||i||n}_switchDataSource(t){this._data=[],Cg(this.dataSource)&&this.dataSource.disconnect(this),this._renderChangeSubscription&&(this._renderChangeSubscription.unsubscribe(),this._renderChangeSubscription=null),t||(this._dataDiffer&&this._dataDiffer.diff([]),this._rowOutlet.viewContainer.clear()),this._dataSource=t}_observeRenderChanges(){if(!this.dataSource)return;let t;Cg(this.dataSource)?t=this.dataSource.connect(this):function(t){return!!t&&(t instanceof _||\"function\"==typeof t.lift&&\"function\"==typeof t.subscribe)}(this.dataSource)?t=this.dataSource:Array.isArray(this.dataSource)&&(t=Xp(this.dataSource)),this._renderChangeSubscription=t.pipe(Mf(this._onDestroy)).subscribe(t=>{this._data=t||[],this.renderRows()})}_forceRenderHeaderRows(){this._headerRowOutlet.viewContainer.length>0&&this._headerRowOutlet.viewContainer.clear(),this._headerRowDefs.forEach((t,e)=>this._renderRow(this._headerRowOutlet,t,e)),this.updateStickyHeaderRowStyles()}_forceRenderFooterRows(){this._footerRowOutlet.viewContainer.length>0&&this._footerRowOutlet.viewContainer.clear(),this._footerRowDefs.forEach((t,e)=>this._renderRow(this._footerRowOutlet,t,e)),this.updateStickyFooterRowStyles()}_addStickyColumnStyles(t,e){const i=Array.from(e.columns||[]).map(t=>this._columnDefsByName.get(t)),n=i.map(t=>t.sticky),r=i.map(t=>t.stickyEnd);this._stickyStyler.updateStickyColumns(t,n,r,!this._fixedLayout||this._forceRecalculateCellWidths)}_getRenderedRows(t){const e=[];for(let i=0;i<t.viewContainer.length;i++){const n=t.viewContainer.get(i);e.push(n.rootNodes[0])}return e}_getRowDefs(t,e){if(1==this._rowDefs.length)return[this._rowDefs[0]];let i=[];if(this.multiTemplateDataRows)i=this._rowDefs.filter(i=>!i.when||i.when(e,t));else{let n=this._rowDefs.find(i=>i.when&&i.when(e,t))||this._defaultRowDef;n&&i.push(n)}return i}_getEmbeddedViewArgs(t,e){return{templateRef:t.rowDef.template,context:{$implicit:t.data},index:e}}_renderRow(t,e,i,n={}){const r=t.viewContainer.createEmbeddedView(e.template,n,i);return this._renderCellTemplateForItem(e,n),r}_renderCellTemplateForItem(t,e){for(let i of this._getCellTemplates(t))QW.mostRecentCellOutlet&&QW.mostRecentCellOutlet._viewContainer.createEmbeddedView(i,e);this._changeDetectorRef.markForCheck()}_updateRowIndexContext(){const t=this._rowOutlet.viewContainer;for(let e=0,i=t.length;e<i;e++){const n=t.get(e).context;n.count=i,n.first=0===e,n.last=e===i-1,n.even=e%2==0,n.odd=!n.even,this.multiTemplateDataRows?(n.dataIndex=this._renderRows[e].dataIndex,n.renderIndex=e):n.index=this._renderRows[e].dataIndex}}_getCellTemplates(t){return t&&t.columns?Array.from(t.columns,e=>{const i=this._columnDefsByName.get(e);return t.extractCellTemplate(i)}):[]}_applyNativeTableSections(){const t=this._document.createDocumentFragment(),e=[{tag:\"thead\",outlets:[this._headerRowOutlet]},{tag:\"tbody\",outlets:[this._rowOutlet,this._noDataRowOutlet]},{tag:\"tfoot\",outlets:[this._footerRowOutlet]}];for(const i of e){const e=this._document.createElement(i.tag);e.setAttribute(\"role\",\"rowgroup\");for(const t of i.outlets)e.appendChild(t.elementRef.nativeElement);t.appendChild(e)}this._elementRef.nativeElement.appendChild(t)}_forceRenderDataRows(){this._dataDiffer.diff([]),this._rowOutlet.viewContainer.clear(),this.renderRows()}_checkStickyStates(){const t=(t,e)=>t||e.hasStickyChanged();this._headerRowDefs.reduce(t,!1)&&this.updateStickyHeaderRowStyles(),this._footerRowDefs.reduce(t,!1)&&this.updateStickyFooterRowStyles(),Array.from(this._columnDefsByName.values()).reduce(t,!1)&&(this._stickyColumnStylesNeedReset=!0,this.updateStickyColumnStyles())}_setupStickyStyler(){this._stickyStyler=new nY(this._isNativeHtmlTable,this.stickyCssClass,this._dir?this._dir.value:\"ltr\",this._coalescedStyleScheduler,this._platform.isBrowser,this.needsPositionStickyOnElement,this._stickyPositioningListener),(this._dir?this._dir.change:Xp()).pipe(Mf(this._onDestroy)).subscribe(t=>{this._stickyStyler.direction=t,this.updateStickyColumnStyles()})}_getOwnDefs(t){return t.filter(t=>!t._table||t._table===this)}_updateNoDataRow(){const t=this._customNoDataRow||this._noDataRow;if(t){const e=0===this._rowOutlet.viewContainer.length;if(e!==this._isShowingNoDataRow){const i=this._noDataRowOutlet.viewContainer;e?i.createEmbeddedView(t.templateRef):i.clear(),this._isShowingNoDataRow=e}}}}return t.\\u0275fac=function(e){return new(e||t)(Ta(vc),Ta(Cc),Ta(Jl),Wi(\"role\"),Ta(xg,8),Ta(Du),Ta(Vf),Ta(Tg),Ta($W),Ta(Pg),Ta(rY,12))},t.\\u0275cmp=Ht({type:t,selectors:[[\"cdk-table\"],[\"table\",\"cdk-table\",\"\"]],contentQueries:function(t,e,i){if(1&t&&(Eh(i,eY,5),Eh(i,BW,5),Eh(i,KW,5),Eh(i,WW,5),Eh(i,XW,5)),2&t){let t;Ch(t=Mh())&&(e._noDataRow=t.first),Ch(t=Mh())&&(e._contentColumnDefs=t),Ch(t=Mh())&&(e._contentRowDefs=t),Ch(t=Mh())&&(e._contentHeaderRowDefs=t),Ch(t=Mh())&&(e._contentFooterRowDefs=t)}},viewQuery:function(t,e){if(1&t&&(kh(sY,7),kh(oY,7),kh(aY,7),kh(lY,7)),2&t){let t;Ch(t=Mh())&&(e._rowOutlet=t.first),Ch(t=Mh())&&(e._headerRowOutlet=t.first),Ch(t=Mh())&&(e._footerRowOutlet=t.first),Ch(t=Mh())&&(e._noDataRowOutlet=t.first)}},hostAttrs:[1,\"cdk-table\"],hostVars:2,hostBindings:function(t,e){2&t&&ll(\"cdk-table-fixed-layout\",e.fixedLayout)},inputs:{trackBy:\"trackBy\",dataSource:\"dataSource\",multiTemplateDataRows:\"multiTemplateDataRows\",fixedLayout:\"fixedLayout\"},outputs:{contentChanged:\"contentChanged\"},exportAs:[\"cdkTable\"],features:[Gl([{provide:OW,useExisting:t},{provide:Tg,useClass:kg},{provide:$W,useClass:UW},{provide:rY,useValue:null}])],ngContentSelectors:TW,decls:6,vars:0,consts:[[\"headerRowOutlet\",\"\"],[\"rowOutlet\",\"\"],[\"noDataRowOutlet\",\"\"],[\"footerRowOutlet\",\"\"]],template:function(t,e){1&t&&(Za(MW),Xa(0),Xa(1,1),Ba(2,0),Ba(3,1),Ba(4,2),Ba(5,3))},directives:[oY,sY,lY,aY],styles:[\".cdk-table-fixed-layout{table-layout:fixed}\\n\"],encapsulation:2}),t})();function hY(t,e){return t.concat(Array.from(e))}let uY=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({imports:[[Rg]]}),t})();const dY=[[[\"caption\"]],[[\"colgroup\"],[\"col\"]]],pY=[\"caption\",\"colgroup, col\"];let fY=(()=>{class t extends cY{constructor(){super(...arguments),this.stickyCssClass=\"mat-table-sticky\",this.needsPositionStickyOnElement=!1}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-table\"],[\"table\",\"mat-table\",\"\"]],hostAttrs:[1,\"mat-table\"],hostVars:2,hostBindings:function(t,e){2&t&&ll(\"mat-table-fixed-layout\",e.fixedLayout)},exportAs:[\"matTable\"],features:[Gl([{provide:Tg,useClass:kg},{provide:cY,useExisting:t},{provide:OW,useExisting:t},{provide:$W,useClass:UW},{provide:rY,useValue:null}]),Vo],ngContentSelectors:pY,decls:6,vars:0,consts:[[\"headerRowOutlet\",\"\"],[\"rowOutlet\",\"\"],[\"noDataRowOutlet\",\"\"],[\"footerRowOutlet\",\"\"]],template:function(t,e){1&t&&(Za(dY),Xa(0),Xa(1,1),Ba(2,0),Ba(3,1),Ba(4,2),Ba(5,3))},directives:[oY,sY,lY,aY],styles:['mat-table{display:block}mat-header-row{min-height:56px}mat-row,mat-footer-row{min-height:48px}mat-row,mat-header-row,mat-footer-row{display:flex;border-width:0;border-bottom-width:1px;border-style:solid;align-items:center;box-sizing:border-box}mat-row::after,mat-header-row::after,mat-footer-row::after{display:inline-block;min-height:inherit;content:\"\"}mat-cell:first-of-type,mat-header-cell:first-of-type,mat-footer-cell:first-of-type{padding-left:24px}[dir=rtl] mat-cell:first-of-type:not(:only-of-type),[dir=rtl] mat-header-cell:first-of-type:not(:only-of-type),[dir=rtl] mat-footer-cell:first-of-type:not(:only-of-type){padding-left:0;padding-right:24px}mat-cell:last-of-type,mat-header-cell:last-of-type,mat-footer-cell:last-of-type{padding-right:24px}[dir=rtl] mat-cell:last-of-type:not(:only-of-type),[dir=rtl] mat-header-cell:last-of-type:not(:only-of-type),[dir=rtl] mat-footer-cell:last-of-type:not(:only-of-type){padding-right:0;padding-left:24px}mat-cell,mat-header-cell,mat-footer-cell{flex:1;display:flex;align-items:center;overflow:hidden;word-wrap:break-word;min-height:inherit}table.mat-table{border-spacing:0}tr.mat-header-row{height:56px}tr.mat-row,tr.mat-footer-row{height:48px}th.mat-header-cell{text-align:left}[dir=rtl] th.mat-header-cell{text-align:right}th.mat-header-cell,td.mat-cell,td.mat-footer-cell{padding:0;border-bottom-width:1px;border-bottom-style:solid}th.mat-header-cell:first-of-type,td.mat-cell:first-of-type,td.mat-footer-cell:first-of-type{padding-left:24px}[dir=rtl] th.mat-header-cell:first-of-type:not(:only-of-type),[dir=rtl] td.mat-cell:first-of-type:not(:only-of-type),[dir=rtl] td.mat-footer-cell:first-of-type:not(:only-of-type){padding-left:0;padding-right:24px}th.mat-header-cell:last-of-type,td.mat-cell:last-of-type,td.mat-footer-cell:last-of-type{padding-right:24px}[dir=rtl] th.mat-header-cell:last-of-type:not(:only-of-type),[dir=rtl] td.mat-cell:last-of-type:not(:only-of-type),[dir=rtl] td.mat-footer-cell:last-of-type:not(:only-of-type){padding-right:0;padding-left:24px}.mat-table-sticky{position:-webkit-sticky !important;position:sticky !important}.mat-table-fixed-layout{table-layout:fixed}\\n'],encapsulation:2}),t})(),mY=(()=>{class t extends PW{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matCellDef\",\"\"]],features:[Gl([{provide:PW,useExisting:t}]),Vo]}),t})(),gY=(()=>{class t extends DW{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matHeaderCellDef\",\"\"]],features:[Gl([{provide:DW,useExisting:t}]),Vo]}),t})(),AY=(()=>{class t extends BW{get name(){return this._name}set name(t){this._setNameInput(t)}_updateColumnCssClassName(){super._updateColumnCssClassName(),this._columnCssClassName.push(`mat-column-${this.cssClassFriendlyName}`)}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matColumnDef\",\"\"]],inputs:{sticky:\"sticky\",name:[\"matColumnDef\",\"name\"]},features:[Gl([{provide:BW,useExisting:t},{provide:\"MAT_SORT_HEADER_COLUMN_DEF\",useExisting:t}]),Vo]}),t})(),vY=(()=>{class t extends zW{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"mat-header-cell\"],[\"th\",\"mat-header-cell\",\"\"]],hostAttrs:[\"role\",\"columnheader\",1,\"mat-header-cell\"],features:[Vo]}),t})(),_Y=(()=>{class t extends VW{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"mat-cell\"],[\"td\",\"mat-cell\",\"\"]],hostAttrs:[\"role\",\"gridcell\",1,\"mat-cell\"],features:[Vo]}),t})(),yY=(()=>{class t extends WW{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matHeaderRowDef\",\"\"]],inputs:{columns:[\"matHeaderRowDef\",\"columns\"],sticky:[\"matHeaderRowDefSticky\",\"sticky\"]},features:[Gl([{provide:WW,useExisting:t}]),Vo]}),t})(),bY=(()=>{class t extends KW{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matRowDef\",\"\"]],inputs:{columns:[\"matRowDefColumns\",\"columns\"],when:[\"matRowDefWhen\",\"when\"]},features:[Gl([{provide:KW,useExisting:t}]),Vo]}),t})(),wY=(()=>{class t extends JW{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-header-row\"],[\"tr\",\"mat-header-row\",\"\"]],hostAttrs:[\"role\",\"row\",1,\"mat-header-row\"],exportAs:[\"matHeaderRow\"],features:[Gl([{provide:JW,useExisting:t}]),Vo],decls:1,vars:0,consts:[[\"cdkCellOutlet\",\"\"]],template:function(t,e){1&t&&Ba(0,0)},directives:[QW],encapsulation:2}),t})(),xY=(()=>{class t extends tY{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-row\"],[\"tr\",\"mat-row\",\"\"]],hostAttrs:[\"role\",\"row\",1,\"mat-row\"],exportAs:[\"matRow\"],features:[Gl([{provide:tY,useExisting:t}]),Vo],decls:1,vars:0,consts:[[\"cdkCellOutlet\",\"\"]],template:function(t,e){1&t&&Ba(0,0)},directives:[QW],encapsulation:2}),t})(),SY=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({imports:[[uY,_y],_y]}),t})();class CY extends class extends class{}{constructor(t=[]){super(),this._renderData=new Zp([]),this._filter=new Zp(\"\"),this._internalPageChanges=new S,this._renderChangesSubscription=null,this.sortingDataAccessor=(t,e)=>{const i=t[e];if(Df(i)){const t=Number(i);return t<9007199254740991?t:i}return i},this.sortData=(t,e)=>{const i=e.active,n=e.direction;return i&&\"\"!=n?t.sort((t,e)=>{let r=this.sortingDataAccessor(t,i),s=this.sortingDataAccessor(e,i);const o=typeof r,a=typeof s;o!==a&&(\"number\"===o&&(r+=\"\"),\"number\"===a&&(s+=\"\"));let l=0;return null!=r&&null!=s?r>s?l=1:r<s&&(l=-1):null!=r?l=1:null!=s&&(l=-1),l*(\"asc\"==n?1:-1)}):t},this.filterPredicate=(t,e)=>{const i=Object.keys(t).reduce((e,i)=>e+t[i]+\"\\u25ec\",\"\").toLowerCase(),n=e.trim().toLowerCase();return-1!=i.indexOf(n)},this._data=new Zp(t),this._updateChangeSubscription()}get data(){return this._data.value}set data(t){this._data.next(t),this._renderChangesSubscription||this._filterData(t)}get filter(){return this._filter.value}set filter(t){this._filter.next(t),this._renderChangesSubscription||this._filterData(this.data)}get sort(){return this._sort}set sort(t){this._sort=t,this._updateChangeSubscription()}get paginator(){return this._paginator}set paginator(t){this._paginator=t,this._updateChangeSubscription()}_updateChangeSubscription(){var t;const e=this._sort?q(this._sort.sortChange,this._sort.initialized):Xp(null),i=this._paginator?q(this._paginator.page,this._internalPageChanges,this._paginator.initialized):Xp(null),n=LT([this._data,this._filter]).pipe(E(([t])=>this._filterData(t))),r=LT([n,e]).pipe(E(([t])=>this._orderData(t))),s=LT([r,i]).pipe(E(([t])=>this._pageData(t)));null===(t=this._renderChangesSubscription)||void 0===t||t.unsubscribe(),this._renderChangesSubscription=s.subscribe(t=>this._renderData.next(t))}_filterData(t){return this.filteredData=null==this.filter||\"\"===this.filter?t:t.filter(t=>this.filterPredicate(t,this.filter)),this.paginator&&this._updatePaginator(this.filteredData.length),this.filteredData}_orderData(t){return this.sort?this.sortData(t.slice(),this.sort):t}_pageData(t){if(!this.paginator)return t;const e=this.paginator.pageIndex*this.paginator.pageSize;return t.slice(e,e+this.paginator.pageSize)}_updatePaginator(t){Promise.resolve().then(()=>{const e=this.paginator;if(e&&(e.length=t,e.pageIndex>0)){const t=Math.ceil(e.length/e.pageSize)-1||0,i=Math.min(e.pageIndex,t);i!==e.pageIndex&&(e.pageIndex=i,this._internalPageChanges.next())}})}connect(){return this._renderChangesSubscription||this._updateChangeSubscription(),this._renderData}disconnect(){var t;null===(t=this._renderChangesSubscription)||void 0===t||t.unsubscribe(),this._renderChangesSubscription=null}}{}function kY(t,e){if(1&t&&(Pa(0,\"div\"),bl(1),Da()),2&t){const t=e.$implicit;Ss(1),Sl(\" \",t.email,\" - \",t.status,\" \")}}let EY=(()=>{class t extends Lq{constructor(t,e){super(),this.data=t,this.workerService=e,this.workFinished=!1}ngOnInit(){this.accountsStatuses=this.data.emails.map(t=>({email:t,status:\"En attente\"})),Promise.all(this.accountsStatuses.map(t=>Vp(this,void 0,void 0,function*(){try{yield this.workerService.users.create({email:t.email,profile:this.data.profile}),t.status=\"OK\"}catch(e){console.log(\"err\",t.email,e),t.status=e.message.includes('duplicate key value violates unique constraint \"user_email_key\"')?\"D\\xe9j\\xe0 pr\\xe9sent\":`KO : ${null==e?void 0:e.message}`}}))).finally(()=>{this.workFinished=!0})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(RC),Ta(iU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-create-users-dialog\"]],features:[Vo],decls:11,vars:3,consts:[[1,\"d-flex\"],[1,\"dialog-title\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Fermer la fen\\xeatre\",3,\"disabled\",\"mat-dialog-close\"],[1,\"dialog-content\"],[4,\"ngFor\",\"ngForOf\"],[\"mat-button\",\"\",\"title\",\"Fermer la fen\\xeatre\",1,\"d-block-center\",\"mt-3\",3,\"disabled\",\"mat-dialog-close\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"h1\",1),bl(2,\" Cr\\xe9ation de comptes utilisateurs \"),Da(),Ra(3,\"div\",2),Pa(4,\"button\",3),Pa(5,\"mat-icon\"),bl(6,\"close\"),Da(),Da(),Da(),Pa(7,\"div\",4),na(8,kY,2,2,\"div\",5),Pa(9,\"button\",6),bl(10,\" Fermer la fen\\xeatre \"),Da(),Da()),2&t&&(Ss(4),Ia(\"disabled\",!e.workFinished),Ss(4),Ia(\"ngForOf\",e.accountsStatuses),Ss(1),Ia(\"disabled\",!e.workFinished))},directives:[vb,jC,Yk,Fd],encapsulation:2}),t})();const MY=[\"input\"],TY=function(t){return{enterDuration:t}},IY=[\"*\"],OY=new Qi(\"mat-checkbox-default-options\",{providedIn:\"root\",factory:PY});function PY(){return{color:\"accent\",clickAction:\"check-indeterminate\"}}let DY=0;const RY=PY(),FY={provide:Cb,useExisting:ot(()=>NY),multi:!0};class LY{}const BY=xy(by(wy(yy(class{constructor(t){this._elementRef=t}}))));let NY=(()=>{class t extends BY{constructor(t,e,i,n,r,s,o){super(t),this._changeDetectorRef=e,this._focusMonitor=i,this._ngZone=n,this._animationMode=s,this._options=o,this.ariaLabel=\"\",this.ariaLabelledby=null,this._uniqueId=\"mat-checkbox-\"+ ++DY,this.id=this._uniqueId,this.labelPosition=\"after\",this.name=null,this.change=new ph,this.indeterminateChange=new ph,this._onTouched=()=>{},this._currentAnimationClass=\"\",this._currentCheckState=0,this._controlValueAccessorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||RY,this.color=this.defaultColor=this._options.color||RY.color,this.tabIndex=parseInt(r)||0}get inputId(){return`${this.id||this._uniqueId}-input`}get required(){return this._required}set required(t){this._required=Of(t)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{t||Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}),this._syncIndeterminate(this._indeterminate)}ngAfterViewChecked(){}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}get checked(){return this._checked}set checked(t){t!=this.checked&&(this._checked=t,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(t){const e=Of(t);e!==this.disabled&&(this._disabled=e,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(t){const e=t!=this._indeterminate;this._indeterminate=Of(t),e&&(this._transitionCheckState(this._indeterminate?3:this.checked?1:2),this.indeterminateChange.emit(this._indeterminate)),this._syncIndeterminate(this._indeterminate)}_isRippleDisabled(){return this.disableRipple||this.disabled}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(t){this.checked=!!t}registerOnChange(t){this._controlValueAccessorChangeFn=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t}_getAriaChecked(){return this.checked?\"true\":this.indeterminate?\"mixed\":\"false\"}_transitionCheckState(t){let e=this._currentCheckState,i=this._elementRef.nativeElement;if(e!==t&&(this._currentAnimationClass.length>0&&i.classList.remove(this._currentAnimationClass),this._currentAnimationClass=this._getAnimationClassForCheckStateTransition(e,t),this._currentCheckState=t,this._currentAnimationClass.length>0)){i.classList.add(this._currentAnimationClass);const t=this._currentAnimationClass;this._ngZone.runOutsideAngular(()=>{setTimeout(()=>{i.classList.remove(t)},1e3)})}}_emitChangeEvent(){const t=new LY;t.source=this,t.checked=this.checked,this._controlValueAccessorChangeFn(this.checked),this.change.emit(t),this._inputElement&&(this._inputElement.nativeElement.checked=this.checked)}toggle(){this.checked=!this.checked}_onInputClick(t){var e;const i=null===(e=this._options)||void 0===e?void 0:e.clickAction;t.stopPropagation(),this.disabled||\"noop\"===i?!this.disabled&&\"noop\"===i&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate):(this.indeterminate&&\"check\"!==i&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this.toggle(),this._transitionCheckState(this._checked?1:2),this._emitChangeEvent())}focus(t,e){t?this._focusMonitor.focusVia(this._inputElement,t,e):this._inputElement.nativeElement.focus(e)}_onInteractionEvent(t){t.stopPropagation()}_getAnimationClassForCheckStateTransition(t,e){if(\"NoopAnimations\"===this._animationMode)return\"\";let i=\"\";switch(t){case 0:if(1===e)i=\"unchecked-checked\";else{if(3!=e)return\"\";i=\"unchecked-indeterminate\"}break;case 2:i=1===e?\"unchecked-checked\":\"unchecked-indeterminate\";break;case 1:i=2===e?\"checked-unchecked\":\"checked-indeterminate\";break;case 3:i=1===e?\"indeterminate-checked\":\"indeterminate-unchecked\"}return`mat-checkbox-anim-${i}`}_syncIndeterminate(t){const e=this._inputElement;e&&(e.nativeElement.indeterminate=t)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(Cc),Ta(Bm),Ta(tu),Wi(\"tabindex\"),Ta(sy,8),Ta(OY,8))},t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-checkbox\"]],viewQuery:function(t,e){if(1&t&&(kh(MY,5),kh(Xy,5)),2&t){let t;Ch(t=Mh())&&(e._inputElement=t.first),Ch(t=Mh())&&(e.ripple=t.first)}},hostAttrs:[1,\"mat-checkbox\"],hostVars:12,hostBindings:function(t,e){2&t&&(El(\"id\",e.id),ta(\"tabindex\",null),ll(\"mat-checkbox-indeterminate\",e.indeterminate)(\"mat-checkbox-checked\",e.checked)(\"mat-checkbox-disabled\",e.disabled)(\"mat-checkbox-label-before\",\"before\"==e.labelPosition)(\"_mat-animation-noopable\",\"NoopAnimations\"===e._animationMode))},inputs:{disableRipple:\"disableRipple\",color:\"color\",tabIndex:\"tabIndex\",ariaLabel:[\"aria-label\",\"ariaLabel\"],ariaLabelledby:[\"aria-labelledby\",\"ariaLabelledby\"],id:\"id\",labelPosition:\"labelPosition\",name:\"name\",required:\"required\",checked:\"checked\",disabled:\"disabled\",indeterminate:\"indeterminate\",ariaDescribedby:[\"aria-describedby\",\"ariaDescribedby\"],value:\"value\"},outputs:{change:\"change\",indeterminateChange:\"indeterminateChange\"},exportAs:[\"matCheckbox\"],features:[Gl([FY]),Vo],ngContentSelectors:IY,decls:17,vars:21,consts:[[1,\"mat-checkbox-layout\"],[\"label\",\"\"],[1,\"mat-checkbox-inner-container\"],[\"type\",\"checkbox\",1,\"mat-checkbox-input\",\"cdk-visually-hidden\",3,\"id\",\"required\",\"checked\",\"disabled\",\"tabIndex\",\"change\",\"click\"],[\"input\",\"\"],[\"matRipple\",\"\",1,\"mat-checkbox-ripple\",\"mat-focus-indicator\",3,\"matRippleTrigger\",\"matRippleDisabled\",\"matRippleRadius\",\"matRippleCentered\",\"matRippleAnimation\"],[1,\"mat-ripple-element\",\"mat-checkbox-persistent-ripple\"],[1,\"mat-checkbox-frame\"],[1,\"mat-checkbox-background\"],[\"version\",\"1.1\",\"focusable\",\"false\",\"viewBox\",\"0 0 24 24\",0,\"xml\",\"space\",\"preserve\",\"aria-hidden\",\"true\",1,\"mat-checkbox-checkmark\"],[\"fill\",\"none\",\"stroke\",\"white\",\"d\",\"M4.1,12.7 9,17.6 20.3,6.3\",1,\"mat-checkbox-checkmark-path\"],[1,\"mat-checkbox-mixedmark\"],[1,\"mat-checkbox-label\",3,\"cdkObserveContent\"],[\"checkboxLabel\",\"\"],[2,\"display\",\"none\"]],template:function(t,e){if(1&t&&(Za(),Pa(0,\"label\",0,1),Pa(2,\"span\",2),Pa(3,\"input\",3,4),$a(\"change\",function(t){return e._onInteractionEvent(t)})(\"click\",function(t){return e._onInputClick(t)}),Da(),Pa(5,\"span\",5),Ra(6,\"span\",6),Da(),Ra(7,\"span\",7),Pa(8,\"span\",8),ci(),Pa(9,\"svg\",9),Ra(10,\"path\",10),Da(),hi(),Ra(11,\"span\",11),Da(),Da(),Pa(12,\"span\",12,13),$a(\"cdkObserveContent\",function(){return e._onLabelTextChange()}),Pa(14,\"span\",14),bl(15,\"\\xa0\"),Da(),Xa(16),Da(),Da()),2&t){const t=ra(1),i=ra(13);ta(\"for\",e.inputId),Ss(2),ll(\"mat-checkbox-inner-container-no-side-margin\",!i.textContent||!i.textContent.trim()),Ss(1),Ia(\"id\",e.inputId)(\"required\",e.required)(\"checked\",e.checked)(\"disabled\",e.disabled)(\"tabIndex\",e.tabIndex),ta(\"value\",e.value)(\"name\",e.name)(\"aria-label\",e.ariaLabel||null)(\"aria-labelledby\",e.ariaLabelledby)(\"aria-checked\",e._getAriaChecked())(\"aria-describedby\",e.ariaDescribedby),Ss(2),Ia(\"matRippleTrigger\",t)(\"matRippleDisabled\",e._isRippleDisabled())(\"matRippleRadius\",20)(\"matRippleCentered\",!0)(\"matRippleAnimation\",Jc(19,TY,\"NoopAnimations\"===e._animationMode?0:150))}},directives:[Xy,rm],styles:[\"@keyframes mat-checkbox-fade-in-background{0%{opacity:0}50%{opacity:1}}@keyframes mat-checkbox-fade-out-background{0%,50%{opacity:1}100%{opacity:0}}@keyframes mat-checkbox-unchecked-checked-checkmark-path{0%,50%{stroke-dashoffset:22.910259}50%{animation-timing-function:cubic-bezier(0, 0, 0.2, 0.1)}100%{stroke-dashoffset:0}}@keyframes mat-checkbox-unchecked-indeterminate-mixedmark{0%,68.2%{transform:scaleX(0)}68.2%{animation-timing-function:cubic-bezier(0, 0, 0, 1)}100%{transform:scaleX(1)}}@keyframes mat-checkbox-checked-unchecked-checkmark-path{from{animation-timing-function:cubic-bezier(0.4, 0, 1, 1);stroke-dashoffset:0}to{stroke-dashoffset:-22.910259}}@keyframes mat-checkbox-checked-indeterminate-checkmark{from{animation-timing-function:cubic-bezier(0, 0, 0.2, 0.1);opacity:1;transform:rotate(0deg)}to{opacity:0;transform:rotate(45deg)}}@keyframes mat-checkbox-indeterminate-checked-checkmark{from{animation-timing-function:cubic-bezier(0.14, 0, 0, 1);opacity:0;transform:rotate(45deg)}to{opacity:1;transform:rotate(360deg)}}@keyframes mat-checkbox-checked-indeterminate-mixedmark{from{animation-timing-function:cubic-bezier(0, 0, 0.2, 0.1);opacity:0;transform:rotate(-45deg)}to{opacity:1;transform:rotate(0deg)}}@keyframes mat-checkbox-indeterminate-checked-mixedmark{from{animation-timing-function:cubic-bezier(0.14, 0, 0, 1);opacity:1;transform:rotate(0deg)}to{opacity:0;transform:rotate(315deg)}}@keyframes mat-checkbox-indeterminate-unchecked-mixedmark{0%{animation-timing-function:linear;opacity:1;transform:scaleX(1)}32.8%,100%{opacity:0;transform:scaleX(0)}}.mat-checkbox-background,.mat-checkbox-frame{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:2px;box-sizing:border-box;pointer-events:none}.mat-checkbox{display:inline-block;transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);cursor:pointer;-webkit-tap-highlight-color:transparent}._mat-animation-noopable.mat-checkbox{transition:none;animation:none}.mat-checkbox .mat-ripple-element:not(.mat-checkbox-persistent-ripple){opacity:.16}.mat-checkbox .mat-checkbox-ripple{position:absolute;left:calc(50% - 20px);top:calc(50% - 20px);height:40px;width:40px;z-index:1;pointer-events:none}.cdk-high-contrast-active .mat-checkbox.cdk-keyboard-focused .mat-checkbox-ripple{outline:solid 3px}.mat-checkbox-layout{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:inherit;align-items:baseline;vertical-align:middle;display:inline-flex;white-space:nowrap}.mat-checkbox-label{-webkit-user-select:auto;-moz-user-select:auto;-ms-user-select:auto;user-select:auto}.mat-checkbox-inner-container{display:inline-block;height:16px;line-height:0;margin:auto;margin-right:8px;order:0;position:relative;vertical-align:middle;white-space:nowrap;width:16px;flex-shrink:0}[dir=rtl] .mat-checkbox-inner-container{margin-left:8px;margin-right:auto}.mat-checkbox-inner-container-no-side-margin{margin-left:0;margin-right:0}.mat-checkbox-frame{background-color:transparent;transition:border-color 90ms cubic-bezier(0, 0, 0.2, 0.1);border-width:2px;border-style:solid}._mat-animation-noopable .mat-checkbox-frame{transition:none}.mat-checkbox-background{align-items:center;display:inline-flex;justify-content:center;transition:background-color 90ms cubic-bezier(0, 0, 0.2, 0.1),opacity 90ms cubic-bezier(0, 0, 0.2, 0.1);-webkit-print-color-adjust:exact;color-adjust:exact}._mat-animation-noopable .mat-checkbox-background{transition:none}.cdk-high-contrast-active .mat-checkbox .mat-checkbox-background{background:none}.mat-checkbox-persistent-ripple{display:block;width:100%;height:100%;transform:none}.mat-checkbox-inner-container:hover .mat-checkbox-persistent-ripple{opacity:.04}.mat-checkbox.cdk-keyboard-focused .mat-checkbox-persistent-ripple{opacity:.12}.mat-checkbox-persistent-ripple,.mat-checkbox.mat-checkbox-disabled .mat-checkbox-inner-container:hover .mat-checkbox-persistent-ripple{opacity:0}@media(hover: none){.mat-checkbox-inner-container:hover .mat-checkbox-persistent-ripple{display:none}}.mat-checkbox-checkmark{top:0;left:0;right:0;bottom:0;position:absolute;width:100%}.mat-checkbox-checkmark-path{stroke-dashoffset:22.910259;stroke-dasharray:22.910259;stroke-width:2.1333333333px}.cdk-high-contrast-black-on-white .mat-checkbox-checkmark-path{stroke:#000 !important}.mat-checkbox-mixedmark{width:calc(100% - 6px);height:2px;opacity:0;transform:scaleX(0) rotate(0deg);border-radius:2px}.cdk-high-contrast-active .mat-checkbox-mixedmark{height:0;border-top:solid 2px;margin-top:2px}.mat-checkbox-label-before .mat-checkbox-inner-container{order:1;margin-left:8px;margin-right:auto}[dir=rtl] .mat-checkbox-label-before .mat-checkbox-inner-container{margin-left:auto;margin-right:8px}.mat-checkbox-checked .mat-checkbox-checkmark{opacity:1}.mat-checkbox-checked .mat-checkbox-checkmark-path{stroke-dashoffset:0}.mat-checkbox-checked .mat-checkbox-mixedmark{transform:scaleX(1) rotate(-45deg)}.mat-checkbox-indeterminate .mat-checkbox-checkmark{opacity:0;transform:rotate(45deg)}.mat-checkbox-indeterminate .mat-checkbox-checkmark-path{stroke-dashoffset:0}.mat-checkbox-indeterminate .mat-checkbox-mixedmark{opacity:1;transform:scaleX(1) rotate(0deg)}.mat-checkbox-unchecked .mat-checkbox-background{background-color:transparent}.mat-checkbox-disabled{cursor:default}.cdk-high-contrast-active .mat-checkbox-disabled{opacity:.5}.mat-checkbox-anim-unchecked-checked .mat-checkbox-background{animation:180ms linear 0ms mat-checkbox-fade-in-background}.mat-checkbox-anim-unchecked-checked .mat-checkbox-checkmark-path{animation:180ms linear 0ms mat-checkbox-unchecked-checked-checkmark-path}.mat-checkbox-anim-unchecked-indeterminate .mat-checkbox-background{animation:180ms linear 0ms mat-checkbox-fade-in-background}.mat-checkbox-anim-unchecked-indeterminate .mat-checkbox-mixedmark{animation:90ms linear 0ms mat-checkbox-unchecked-indeterminate-mixedmark}.mat-checkbox-anim-checked-unchecked .mat-checkbox-background{animation:180ms linear 0ms mat-checkbox-fade-out-background}.mat-checkbox-anim-checked-unchecked .mat-checkbox-checkmark-path{animation:90ms linear 0ms mat-checkbox-checked-unchecked-checkmark-path}.mat-checkbox-anim-checked-indeterminate .mat-checkbox-checkmark{animation:90ms linear 0ms mat-checkbox-checked-indeterminate-checkmark}.mat-checkbox-anim-checked-indeterminate .mat-checkbox-mixedmark{animation:90ms linear 0ms mat-checkbox-checked-indeterminate-mixedmark}.mat-checkbox-anim-indeterminate-checked .mat-checkbox-checkmark{animation:500ms linear 0ms mat-checkbox-indeterminate-checked-checkmark}.mat-checkbox-anim-indeterminate-checked .mat-checkbox-mixedmark{animation:500ms linear 0ms mat-checkbox-indeterminate-checked-mixedmark}.mat-checkbox-anim-indeterminate-unchecked .mat-checkbox-background{animation:180ms linear 0ms mat-checkbox-fade-out-background}.mat-checkbox-anim-indeterminate-unchecked .mat-checkbox-mixedmark{animation:300ms linear 0ms mat-checkbox-indeterminate-unchecked-mixedmark}.mat-checkbox-input{bottom:0;left:50%}\\n\"],encapsulation:2,changeDetection:0}),t})(),zY=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({}),t})(),VY=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({imports:[[Ky,_y,sm,zY],_y,zY]}),t})();const jY=[\"*\"];let $Y=(()=>{class t{constructor(){this.title=\"\",this.bgColor=\"#55575f\",this.color=\"#ffffff\"}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-chip\"]],inputs:{title:\"title\",bgColor:\"bgColor\",color:\"color\"},ngContentSelectors:jY,decls:2,vars:5,consts:[[1,\"chip\",3,\"title\"]],template:function(t,e){1&t&&(Za(),Pa(0,\"div\",0),Xa(1),Da()),2&t&&(al(\"color\",e.color)(\"background-color\",e.bgColor),Ia(\"title\",e.title))},styles:[\".chip[_ngcontent-%COMP%]{display:inline-block;padding:4px 5px;border-radius:5px;font-size:12px}\"],changeDetection:0}),t})();function UY(t,e){if(1&t&&(ci(),Ra(0,\"circle\",3)),2&t){const t=Wa();al(\"animation-name\",\"mat-progress-spinner-stroke-rotate-\"+t._spinnerAnimationLabel)(\"stroke-dashoffset\",t._getStrokeDashOffset(),\"px\")(\"stroke-dasharray\",t._getStrokeCircumference(),\"px\")(\"stroke-width\",t._getCircleStrokeWidth(),\"%\"),ta(\"r\",t._getCircleRadius())}}function HY(t,e){if(1&t&&(ci(),Ra(0,\"circle\",3)),2&t){const t=Wa();al(\"stroke-dashoffset\",t._getStrokeDashOffset(),\"px\")(\"stroke-dasharray\",t._getStrokeCircumference(),\"px\")(\"stroke-width\",t._getCircleStrokeWidth(),\"%\"),ta(\"r\",t._getCircleRadius())}}function GY(t,e){if(1&t&&(ci(),Ra(0,\"circle\",3)),2&t){const t=Wa();al(\"animation-name\",\"mat-progress-spinner-stroke-rotate-\"+t._spinnerAnimationLabel)(\"stroke-dashoffset\",t._getStrokeDashOffset(),\"px\")(\"stroke-dasharray\",t._getStrokeCircumference(),\"px\")(\"stroke-width\",t._getCircleStrokeWidth(),\"%\"),ta(\"r\",t._getCircleRadius())}}function qY(t,e){if(1&t&&(ci(),Ra(0,\"circle\",3)),2&t){const t=Wa();al(\"stroke-dashoffset\",t._getStrokeDashOffset(),\"px\")(\"stroke-dasharray\",t._getStrokeCircumference(),\"px\")(\"stroke-width\",t._getCircleStrokeWidth(),\"%\"),ta(\"r\",t._getCircleRadius())}}const WY=\".mat-progress-spinner{display:block;position:relative;overflow:hidden}.mat-progress-spinner svg{position:absolute;transform:rotate(-90deg);top:0;left:0;transform-origin:center;overflow:visible}.mat-progress-spinner circle{fill:transparent;transform-origin:center;transition:stroke-dashoffset 225ms linear}._mat-animation-noopable.mat-progress-spinner circle{transition:none;animation:none}.cdk-high-contrast-active .mat-progress-spinner circle{stroke:currentColor;stroke:CanvasText}.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] svg{animation:mat-progress-spinner-linear-rotate 2000ms linear infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] svg{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] circle{transition-property:stroke;animation-duration:4000ms;animation-timing-function:cubic-bezier(0.35, 0, 0.25, 1);animation-iteration-count:infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] circle{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] svg{animation:mat-progress-spinner-stroke-rotate-fallback 10000ms cubic-bezier(0.87, 0.03, 0.33, 1) infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] svg{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] circle{transition-property:stroke}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] circle{transition:none;animation:none}@keyframes mat-progress-spinner-linear-rotate{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes mat-progress-spinner-stroke-rotate-100{0%{stroke-dashoffset:268.606171575px;transform:rotate(0)}12.5%{stroke-dashoffset:56.5486677px;transform:rotate(0)}12.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(72.5deg)}25%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(72.5deg)}25.0001%{stroke-dashoffset:268.606171575px;transform:rotate(270deg)}37.5%{stroke-dashoffset:56.5486677px;transform:rotate(270deg)}37.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(161.5deg)}50%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(161.5deg)}50.0001%{stroke-dashoffset:268.606171575px;transform:rotate(180deg)}62.5%{stroke-dashoffset:56.5486677px;transform:rotate(180deg)}62.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(251.5deg)}75%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(251.5deg)}75.0001%{stroke-dashoffset:268.606171575px;transform:rotate(90deg)}87.5%{stroke-dashoffset:56.5486677px;transform:rotate(90deg)}87.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(341.5deg)}100%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(341.5deg)}}@keyframes mat-progress-spinner-stroke-rotate-fallback{0%{transform:rotate(0deg)}25%{transform:rotate(1170deg)}50%{transform:rotate(2340deg)}75%{transform:rotate(3510deg)}100%{transform:rotate(4680deg)}}\\n\",YY=by(class{constructor(t){this._elementRef=t}},\"primary\"),ZY=new Qi(\"mat-progress-spinner-default-options\",{providedIn:\"root\",factory:function(){return{diameter:100}}});class XY extends YY{constructor(t,e,i,n,r){super(t),this._document=i,this._diameter=100,this._value=0,this._fallbackAnimation=!1,this.mode=\"determinate\";const s=XY._diameters;this._spinnerAnimationLabel=this._getSpinnerAnimationLabel(),s.has(i.head)||s.set(i.head,new Set([100])),this._fallbackAnimation=e.EDGE||e.TRIDENT,this._noopAnimations=\"NoopAnimations\"===n&&!!r&&!r._forceAnimations,r&&(r.diameter&&(this.diameter=r.diameter),r.strokeWidth&&(this.strokeWidth=r.strokeWidth))}get diameter(){return this._diameter}set diameter(t){this._diameter=Pf(t),this._spinnerAnimationLabel=this._getSpinnerAnimationLabel(),!this._fallbackAnimation&&this._styleRoot&&this._attachStyleNode()}get strokeWidth(){return this._strokeWidth||this.diameter/10}set strokeWidth(t){this._strokeWidth=Pf(t)}get value(){return\"determinate\"===this.mode?this._value:0}set value(t){this._value=Math.max(0,Math.min(100,Pf(t)))}ngOnInit(){const t=this._elementRef.nativeElement;this._styleRoot=Qf(t)||this._document.head,this._attachStyleNode(),t.classList.add(`mat-progress-spinner-indeterminate${this._fallbackAnimation?\"-fallback\":\"\"}-animation`)}_getCircleRadius(){return(this.diameter-10)/2}_getViewBox(){const t=2*this._getCircleRadius()+this.strokeWidth;return`0 0 ${t} ${t}`}_getStrokeCircumference(){return 2*Math.PI*this._getCircleRadius()}_getStrokeDashOffset(){return\"determinate\"===this.mode?this._getStrokeCircumference()*(100-this._value)/100:this._fallbackAnimation&&\"indeterminate\"===this.mode?.2*this._getStrokeCircumference():null}_getCircleStrokeWidth(){return this.strokeWidth/this.diameter*100}_attachStyleNode(){const t=this._styleRoot,e=this._diameter,i=XY._diameters;let n=i.get(t);if(!n||!n.has(e)){const r=this._document.createElement(\"style\");r.setAttribute(\"mat-spinner-animation\",this._spinnerAnimationLabel),r.textContent=this._getAnimationText(),t.appendChild(r),n||(n=new Set,i.set(t,n)),n.add(e)}}_getAnimationText(){const t=this._getStrokeCircumference();return\"\\n @keyframes mat-progress-spinner-stroke-rotate-DIAMETER {\\n    0%      { stroke-dashoffset: START_VALUE;  transform: rotate(0); }\\n    12.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(0); }\\n    12.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(72.5deg); }\\n    25%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(72.5deg); }\\n\\n    25.0001%   { stroke-dashoffset: START_VALUE;  transform: rotate(270deg); }\\n    37.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(270deg); }\\n    37.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(161.5deg); }\\n    50%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(161.5deg); }\\n\\n    50.0001%  { stroke-dashoffset: START_VALUE;  transform: rotate(180deg); }\\n    62.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(180deg); }\\n    62.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(251.5deg); }\\n    75%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(251.5deg); }\\n\\n    75.0001%  { stroke-dashoffset: START_VALUE;  transform: rotate(90deg); }\\n    87.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(90deg); }\\n    87.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(341.5deg); }\\n    100%    { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(341.5deg); }\\n  }\\n\".replace(/START_VALUE/g,\"\"+.95*t).replace(/END_VALUE/g,\"\"+.2*t).replace(/DIAMETER/g,`${this._spinnerAnimationLabel}`)}_getSpinnerAnimationLabel(){return this.diameter.toString().replace(\".\",\"_\")}}XY.\\u0275fac=function(t){return new(t||XY)(Ta(Jl),Ta(Vf),Ta(Du,8),Ta(sy,8),Ta(ZY))},XY.\\u0275cmp=Ht({type:XY,selectors:[[\"mat-progress-spinner\"]],hostAttrs:[\"role\",\"progressbar\",\"tabindex\",\"-1\",1,\"mat-progress-spinner\"],hostVars:10,hostBindings:function(t,e){2&t&&(ta(\"aria-valuemin\",\"determinate\"===e.mode?0:null)(\"aria-valuemax\",\"determinate\"===e.mode?100:null)(\"aria-valuenow\",\"determinate\"===e.mode?e.value:null)(\"mode\",e.mode),al(\"width\",e.diameter,\"px\")(\"height\",e.diameter,\"px\"),ll(\"_mat-animation-noopable\",e._noopAnimations))},inputs:{color:\"color\",mode:\"mode\",diameter:\"diameter\",strokeWidth:\"strokeWidth\",value:\"value\"},exportAs:[\"matProgressSpinner\"],features:[Vo],decls:3,vars:8,consts:[[\"preserveAspectRatio\",\"xMidYMid meet\",\"focusable\",\"false\",\"aria-hidden\",\"true\",3,\"ngSwitch\"],[\"cx\",\"50%\",\"cy\",\"50%\",3,\"animation-name\",\"stroke-dashoffset\",\"stroke-dasharray\",\"stroke-width\",4,\"ngSwitchCase\"],[\"cx\",\"50%\",\"cy\",\"50%\",3,\"stroke-dashoffset\",\"stroke-dasharray\",\"stroke-width\",4,\"ngSwitchCase\"],[\"cx\",\"50%\",\"cy\",\"50%\"]],template:function(t,e){1&t&&(ci(),Pa(0,\"svg\",0),na(1,UY,1,9,\"circle\",1),na(2,HY,1,7,\"circle\",2),Da()),2&t&&(al(\"width\",e.diameter,\"px\")(\"height\",e.diameter,\"px\"),Ia(\"ngSwitch\",\"indeterminate\"===e.mode),ta(\"viewBox\",e._getViewBox()),Ss(1),Ia(\"ngSwitchCase\",!0),Ss(1),Ia(\"ngSwitchCase\",!1))},directives:[jd,$d],styles:[WY],encapsulation:2,changeDetection:0}),XY._diameters=new WeakMap;let KY=(()=>{class t extends XY{constructor(t,e,i,n,r){super(t,e,i,n,r),this.mode=\"indeterminate\"}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(Vf),Ta(Du,8),Ta(sy,8),Ta(ZY))},t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-spinner\"]],hostAttrs:[\"role\",\"progressbar\",\"mode\",\"indeterminate\",1,\"mat-spinner\",\"mat-progress-spinner\"],hostVars:6,hostBindings:function(t,e){2&t&&(al(\"width\",e.diameter,\"px\")(\"height\",e.diameter,\"px\"),ll(\"_mat-animation-noopable\",e._noopAnimations))},inputs:{color:\"color\"},features:[Vo],decls:3,vars:8,consts:[[\"preserveAspectRatio\",\"xMidYMid meet\",\"focusable\",\"false\",\"aria-hidden\",\"true\",3,\"ngSwitch\"],[\"cx\",\"50%\",\"cy\",\"50%\",3,\"animation-name\",\"stroke-dashoffset\",\"stroke-dasharray\",\"stroke-width\",4,\"ngSwitchCase\"],[\"cx\",\"50%\",\"cy\",\"50%\",3,\"stroke-dashoffset\",\"stroke-dasharray\",\"stroke-width\",4,\"ngSwitchCase\"],[\"cx\",\"50%\",\"cy\",\"50%\"]],template:function(t,e){1&t&&(ci(),Pa(0,\"svg\",0),na(1,GY,1,9,\"circle\",1),na(2,qY,1,7,\"circle\",2),Da()),2&t&&(al(\"width\",e.diameter,\"px\")(\"height\",e.diameter,\"px\"),Ia(\"ngSwitch\",\"indeterminate\"===e.mode),ta(\"viewBox\",e._getViewBox()),Ss(1),Ia(\"ngSwitchCase\",!0),Ss(1),Ia(\"ngSwitchCase\",!1))},directives:[jd,$d],styles:[WY],encapsulation:2,changeDetection:0}),t})(),QY=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({imports:[[_y,Jd],_y]}),t})();function JY(t,e){if(1&t){const t=Na();Pa(0,\"button\",26),$a(\"click\",function(){Fe(t);const e=Wa(2);return e.filterValue=\"\",e.filterUsers(\"\")}),Pa(1,\"mat-icon\"),bl(2,\"close\"),Da(),Da()}}function tZ(t,e){1&t&&(Pa(0,\"th\",27),bl(1,\"Email\"),Da())}function eZ(t,e){1&t&&(Pa(0,\"app-chip\",31),bl(1,\"Admin\"),Da())}function iZ(t,e){1&t&&(Pa(0,\"app-chip\",32),bl(1,\"C'est vous !\"),Da())}function nZ(t,e){if(1&t&&(Pa(0,\"td\",28),bl(1),na(2,eZ,2,0,\"app-chip\",29),na(3,iZ,2,0,\"app-chip\",30),Da()),2&t){const t=e.$implicit,i=Wa(2);Ss(1),xl(\" \",t.email,\" \"),Ss(1),Ia(\"ngIf\",\"admin\"===t.profile),Ss(1),Ia(\"ngIf\",t.id===i.authenticationService.getUserId())}}function rZ(t,e){1&t&&(Pa(0,\"th\",27),bl(1,\"Date de cr\\xe9ation\"),Da())}function sZ(t,e){if(1&t&&(Pa(0,\"td\",28),bl(1),oh(2,\"date\"),Da()),2&t){const t=e.$implicit;Ss(1),wl(lh(2,1,t.created_at,\"yyyy-MM-dd HH:mm\"))}}function oZ(t,e){1&t&&(Pa(0,\"th\",27),bl(1,\"Derni\\xe8re activit\\xe9\"),Da())}function aZ(t,e){if(1&t&&(Pa(0,\"td\",28),bl(1),oh(2,\"date\"),Da()),2&t){const t=e.$implicit;Ss(1),wl(lh(2,1,t.last_activity,\"yyyy-MM-dd HH:mm\"))}}function lZ(t,e){1&t&&(Pa(0,\"th\",27),bl(1,\"Unit\\xe9\"),Da())}function cZ(t,e){if(1&t){const t=Na();Pa(0,\"td\",28),Pa(1,\"mat-form-field\"),Pa(2,\"input\",33),$a(\"ngModelChange\",function(e){return Fe(t).$implicit.note=e})(\"ngModelChange\",function(e){const i=Fe(t).$implicit;return Wa(2).onUserNoteUpdate(i,e)}),Da(),Da(),Da()}if(2&t){const t=e.$implicit;Ss(2),Ia(\"ngModel\",t.note)}}function hZ(t,e){1&t&&Ra(0,\"th\",34)}function uZ(t,e){if(1&t){const t=Na();Pa(0,\"button\",37),$a(\"click\",function(){Fe(t);const e=Wa().$implicit;return Wa(2).deleteUser(e.id)}),Pa(1,\"mat-icon\"),bl(2,\"delete\"),Da(),Da()}}function dZ(t,e){if(1&t&&(Pa(0,\"td\",28),na(1,uZ,3,0,\"button\",35),Pa(2,\"button\",36),Pa(3,\"mat-icon\"),bl(4,\"mail\"),Da(),Da(),Da()),2&t){const t=e.$implicit,i=Wa(2);Ss(1),Ia(\"ngIf\",t.id!==i.authenticationService.getUserId()),Ss(1),Ia(\"app-async-action\",i.sendWelcomeEmail.bind(i,t.id))}}function pZ(t,e){1&t&&Ra(0,\"tr\",38)}function fZ(t,e){1&t&&Ra(0,\"tr\",39)}const mZ=function(){return[10,20,100]};function gZ(t,e){if(1&t){const t=Na();Pa(0,\"div\"),Pa(1,\"div\",10),Pa(2,\"mat-form-field\"),Pa(3,\"mat-label\"),bl(4,\"Filtre\"),Da(),Pa(5,\"input\",11),$a(\"ngModelChange\",function(e){return Fe(t),Wa().filterValue=e})(\"keyup\",function(e){return Fe(t),Wa().filterUsers(e.target.value)}),Da(),na(6,JY,3,0,\"button\",12),Da(),Pa(7,\"button\",13),bl(8,\"Rafraichir la liste\"),Da(),Da(),Pa(9,\"table\",14),Fa(10,15),na(11,tZ,2,0,\"th\",16),na(12,nZ,4,3,\"td\",17),La(),Fa(13,18),na(14,rZ,2,0,\"th\",16),na(15,sZ,3,4,\"td\",17),La(),Fa(16,19),na(17,oZ,2,0,\"th\",16),na(18,aZ,3,4,\"td\",17),La(),Fa(19,20),na(20,lZ,2,0,\"th\",16),na(21,cZ,3,1,\"td\",17),La(),Fa(22,21),na(23,hZ,1,0,\"th\",22),na(24,dZ,5,2,\"td\",17),La(),na(25,pZ,1,0,\"tr\",23),na(26,fZ,1,0,\"tr\",24),Da(),Ra(27,\"mat-paginator\",25),Da()}if(2&t){const t=Wa();Ss(5),Ia(\"ngModel\",t.filterValue),Ss(1),Ia(\"ngIf\",t.filterValue),Ss(1),Ia(\"app-async-action\",t.refreshList),Ss(2),Ia(\"dataSource\",t.usersDataSource),Ss(16),Ia(\"matHeaderRowDef\",t.displayedColumns),Ss(1),Ia(\"matRowDefColumns\",t.displayedColumns),Ss(1),Ia(\"pageSizeOptions\",Qc(7,mZ))}}function AZ(t,e){1&t&&Ra(0,\"mat-spinner\",40)}function vZ(t,e){if(1&t&&(Pa(0,\"mat-hint\"),bl(1),Da()),2&t){const t=Wa();Ss(1),Cl(\"\",t.extractedEmailsCount,\" email\",t.extractedEmailsCount>1?\"s\":\"\",\" reconnu\",t.extractedEmailsCount>1?\"s\":\"\",\".\")}}function _Z(t,e){1&t&&(Pa(0,\"mat-error\"),bl(1,\"Aucun email reconnu\"),Da())}const yZ=/(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))/g;function bZ(t){const e=t.value.match(yZ);return(null==e?void 0:e.length)>0?null:{missingEmails:!0}}let wZ=(()=>{class t extends Lq{constructor(t,e,i,n,r,s){super(),this.dialog=t,this.formBuilder=e,this.workerService=i,this.authenticationService=n,this.configService=r,this.uiService=s,this.displayedColumns=[\"email\",\"created_at\",\"last_activity\",\"note\",\"actions\"],this.pendingNoteUpdates=new Map,this.extractedEmails=[],this.extractedEmailsCount=0,this.createUser=()=>Vp(this,void 0,void 0,function*(){this.createUserForm.valid&&(1===this.extractedEmailsCount?(yield this.workerService.users.create({email:this.extractedEmails[0],profile:this.createUserForm.controls.admin.value?\"admin\":\"user\"}),this.uiService.success(\"L'utilisateur a bien \\xe9t\\xe9 cr\\xe9\\xe9. Il recevra un email avec un lien vers l'application et les instructions pour d\\xe9finir son mot de passe.\")):yield this.openCreateUsersDialog(this.extractedEmails,this.createUserForm.controls.admin.value?\"admin\":\"user\"),this.createUserForm.controls.emails.reset(\"\"),this.createUserForm.controls.emails.status=\"VALID\",this.usersDataSource.data=yield this.workerService.users.list())}),this.refreshList=()=>Vp(this,void 0,void 0,function*(){this.usersDataSource.data=yield this.workerService.users.list()})}ngOnInit(){return Vp(this,void 0,void 0,function*(){this.createUserForm=this.formBuilder.group({emails:[\"\",[bZ]],admin:[!1]}),this.usersDataSource=new CY(yield this.workerService.users.list()),this.usersDataSource.filterPredicate=this.filterPredicate,setTimeout(()=>{this.paginator.pageSize=this.configService.adminManageUsersPageSize,this.sort.sort(this.configService.adminManageUsersSort),this.usersDataSource.paginator=this.paginator,this.usersDataSource.sort=this.sort,this.subscriptions.push(this.paginator.page.subscribe(t=>{this.configService.set(\"adminManageUsersPageSize\",t.pageSize)}),this.sort.sortChange.subscribe(t=>{this.configService.set(\"adminManageUsersSort\",{id:t.active,start:t.direction})}))}),this.subscriptions.push(this.createUserForm.controls.emails.valueChanges.subscribe(t=>{var e;const i=t.match(yZ);this.extractedEmails=null!=i?i:[],this.extractedEmailsCount=null!==(e=null==i?void 0:i.length)&&void 0!==e?e:0}))})}deleteUser(t){this.uiService.confirm({title:\"Suppression\",message:\"Cela va supprimer l'utilisateur ainsi que toutes ses r\\xe8gles, alertes et flottes associ\\xe9es. Confirmez-vous la suppression de cet utilisateur ?\",action:e=>Vp(this,void 0,void 0,function*(){e&&(yield this.workerService.users.delete(t),this.usersDataSource.data=this.usersDataSource.data.filter(e=>e.id!==t))})})}sendWelcomeEmail(t){return Vp(this,void 0,void 0,function*(){yield this.workerService.users.sendWelcomeEmail(t),this.uiService.success(\"Un email d'invitation a \\xe9t\\xe9 envoy\\xe9 \\xe0 l'utilisateur\")})}filterUsers(t){this.usersDataSource.filter=Gj(t.trim()),this.usersDataSource.paginator&&this.usersDataSource.paginator.firstPage()}filterPredicate(t,e){return Gj(t.email).includes(e)||Gj(t.note).includes(e)}onUserNoteUpdate(t,e){return Vp(this,void 0,void 0,function*(){const i=this.pendingNoteUpdates.get(t.id);i&&clearTimeout(i),this.pendingNoteUpdates.set(t.id,window.setTimeout(()=>Vp(this,void 0,void 0,function*(){yield this.workerService.users.updateNote(t.id,e),this.pendingNoteUpdates.delete(t.id)}),500))})}openCreateUsersDialog(t,e){return Vp(this,void 0,void 0,function*(){return new Promise(i=>{this.createUsersDialogRef=this.dialog.open(EY,{data:{emails:t,profile:e},autoFocus:!0,closeOnNavigation:!1}),this.createUsersDialogRef.afterClosed().subscribe(()=>{i()})})})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(zC),Ta(vx),Ta(iU),Ta(nU),Ta(C$),Ta(AU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-manage-users-page\"]],viewQuery:function(t,e){if(1&t&&(kh(yW,5),kh(pI,5)),2&t){let t;Ch(t=Mh())&&(e.sort=t.first),Ch(t=Mh())&&(e.paginator=t.first)}},features:[Vo],decls:20,vars:8,consts:[[1,\"mat-h1\"],[4,\"ngIf\",\"ngIfElse\"],[\"loading\",\"\"],[1,\"mat-h2\"],[1,\"d-flex-center\",3,\"formGroup\"],[\"appearance\",\"outline\",1,\"u-flex\",\"mt-3\"],[\"matInput\",\"\",\"formControlName\",\"emails\",\"cdkTextareaAutosize\",\"\",\"cdkAutosizeMinRows\",\"1\",\"cdkAutosizeMaxRows\",\"6\",\"required\",\"\"],[4,\"ngIf\"],[\"color\",\"primary\",\"title\",\"Un administrateur peut g\\xe9rer les utilisateurs (pour l'instant...)\",\"formControlName\",\"admin\",1,\"mx-3\"],[\"mat-raised-button\",\"\",\"color\",\"primary\",3,\"app-async-action\",\"disabled\"],[1,\"d-flex-center\",2,\"justify-content\",\"space-between\"],[\"matInput\",\"\",\"placeholder\",\"utilisateur@exemple.com\",3,\"ngModel\",\"ngModelChange\",\"keyup\"],[\"mat-button\",\"\",\"matSuffix\",\"\",\"mat-icon-button\",\"\",\"aria-label\",\"Clear\",3,\"click\",4,\"ngIf\"],[\"mat-stroked-button\",\"\",3,\"app-async-action\"],[\"mat-table\",\"\",\"matSort\",\"\",\"matSortActive\",\"email\",\"matSortDirection\",\"asc\",1,\"table\",3,\"dataSource\"],[\"matColumnDef\",\"email\"],[\"mat-header-cell\",\"\",\"mat-sort-header\",\"\",4,\"matHeaderCellDef\"],[\"mat-cell\",\"\",4,\"matCellDef\"],[\"matColumnDef\",\"created_at\"],[\"matColumnDef\",\"last_activity\"],[\"matColumnDef\",\"note\"],[\"matColumnDef\",\"actions\"],[\"mat-header-cell\",\"\",4,\"matHeaderCellDef\"],[\"mat-header-row\",\"\",4,\"matHeaderRowDef\"],[\"mat-row\",\"\",4,\"matRowDef\",\"matRowDefColumns\"],[\"showFirstLastButtons\",\"\",3,\"pageSizeOptions\"],[\"mat-button\",\"\",\"matSuffix\",\"\",\"mat-icon-button\",\"\",\"aria-label\",\"Clear\",3,\"click\"],[\"mat-header-cell\",\"\",\"mat-sort-header\",\"\"],[\"mat-cell\",\"\"],[\"bgColor\",\"#1aaa55\",4,\"ngIf\"],[\"class\",\"ml-1\",\"bgColor\",\"#2d60eb\",4,\"ngIf\"],[\"bgColor\",\"#1aaa55\"],[\"bgColor\",\"#2d60eb\",1,\"ml-1\"],[\"matInput\",\"\",\"type\",\"text\",\"title\",\"Unit\\xe9\",3,\"ngModel\",\"ngModelChange\"],[\"mat-header-cell\",\"\"],[\"mat-icon-button\",\"\",\"color\",\"warn\",\"title\",\"Supprimer cet utilisateur\",3,\"click\",4,\"ngIf\"],[\"mat-icon-button\",\"\",\"title\",\"Envoyer un email d'invitation\",3,\"app-async-action\"],[\"mat-icon-button\",\"\",\"color\",\"warn\",\"title\",\"Supprimer cet utilisateur\",3,\"click\"],[\"mat-header-row\",\"\"],[\"mat-row\",\"\"],[\"strokeWidth\",\"4\",\"diameter\",\"80\",1,\"spinner\"]],template:function(t,e){if(1&t&&(Pa(0,\"h1\",0),bl(1,\"Gestion des utilisateurs\"),Da(),na(2,gZ,28,8,\"div\",1),na(3,AZ,1,0,\"ng-template\",null,2,Ph),Pa(5,\"h2\",3),bl(6,\"Cr\\xe9ation de comptes utilisateur\"),Da(),Pa(7,\"p\"),bl(8,\" Les utilisateurs cr\\xe9\\xe9s recevront un email avec un lien pour d\\xe9finir leur mot de passe. Vous pouvez copier du texte multi-lignes contenant des emails. Ces derniers seront extraits automatiquement.\\n\"),Da(),Pa(9,\"form\",4),Pa(10,\"mat-form-field\",5),Pa(11,\"mat-label\"),bl(12,\"Email(s)\"),Da(),Ra(13,\"textarea\",6),na(14,vZ,2,3,\"mat-hint\",7),na(15,_Z,2,0,\"mat-error\",7),Da(),Pa(16,\"mat-checkbox\",8),bl(17,\"Administrateur\"),Da(),Pa(18,\"button\",9),bl(19),Da(),Da()),2&t){const t=ra(4);Ss(2),Ia(\"ngIf\",e.usersDataSource)(\"ngIfElse\",t),Ss(7),Ia(\"formGroup\",e.createUserForm),Ss(5),Ia(\"ngIf\",e.extractedEmailsCount>0),Ss(1),Ia(\"ngIf\",e.createUserForm.get(\"emails\").touched&&e.createUserForm.get(\"emails\").hasError(\"missingEmails\")),Ss(3),Ia(\"app-async-action\",e.createUser)(\"disabled\",!e.createUserForm.valid),Ss(1),xl(\"Cr\\xe9er \",e.extractedEmailsCount>1?\"les utilisateurs\":\"l'utilisateur\",\"\")}},directives:[Bd,jw,lw,Zw,tS,Hx,hS,Mb,rS,aw,ix,hx,NY,vb,cW,Vw,fY,yW,AY,gY,mY,yY,bY,pI,Zx,Yk,vY,kW,_Y,$Y,wY,xY,KY,Ux,Nx],pipes:[Qd],styles:[\".table[_ngcontent-%COMP%]{width:100%}.table[_ngcontent-%COMP%]     td.mat-cell{padding:0 4px!important;font-size:13px}.table[_ngcontent-%COMP%]     td.mat-cell:first-of-type{padding-left:24px!important}.table[_ngcontent-%COMP%]     td.mat-cell:last-of-type{padding-right:24px!important}\"]}),t})();function xZ(t,e){1&t&&(Pa(0,\"mat-error\"),bl(1,\"L'email est obligatoire\"),Da())}function SZ(t,e){1&t&&(Pa(0,\"mat-error\"),bl(1,\"L'email doit \\xeatre valide\"),Da())}function CZ(t,e){1&t&&(Pa(0,\"mat-error\"),bl(1,\"Le mot de passe est obligatoire\"),Da())}const kZ=function(){return[\"/reset-password\"]};let EZ=(()=>{class t{constructor(t,e,i,n){this.formBuilder=t,this.router=e,this.authenticationService=i,this.uiService=n,this.login=()=>Vp(this,void 0,void 0,function*(){if(this.loginForm.valid)try{yield this.authenticationService.login(this.loginForm.value);const t=new URLSearchParams(window.location.search).get(\"redirect\");yield this.router.navigateByUrl(null!=t?t:\"/\")}catch(t){this.uiService.error(t.message)}})}ngOnInit(){return Vp(this,void 0,void 0,function*(){if(this.loginForm=this.formBuilder.group({email:[\"\",[Rb.required,Rb.email]],password:[\"\",[Rb.required]]}),this.authenticationService.isAuthenticated()){const t=new URLSearchParams(window.location.search).get(\"redirect\");yield this.router.navigateByUrl(null!=t?t:\"/\")}else null!==new URLSearchParams(window.location.search).get(\"expired\")&&this.uiService.error(\"Votre session a expir\\xe9. Veuillez vous authentifier \\xe0 nouveau.\")})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(vx),Ta(XR),Ta(nU),Ta(AU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-login-page\"]],decls:23,vars:7,consts:[[1,\"unauthenticated-page\",\"mat-typography\"],[\"novalidate\",\"\",1,\"unauthenticated-page__form\",3,\"formGroup\"],[\"src\",\"./assets/images/logo_anais.png\",\"alt\",\"Logo ANAIS\",1,\"login-page__logo\"],[\"matPrefix\",\"\",1,\"login-page__prefix-icon\"],[\"type\",\"email\",\"matInput\",\"\",\"placeholder\",\"utilisateur@exemple.com\",\"formControlName\",\"email\",\"required\",\"\"],[4,\"ngIf\"],[\"type\",\"password\",\"matInput\",\"\",\"color\",\"white\",\"placeholder\",\"******\",\"formControlName\",\"password\",\"required\",\"\"],[\"mat-stroked-button\",\"\",\"color\",\"primary\",1,\"login-page__login-btn\",3,\"app-async-action\"],[\"mat-button\",\"\",1,\"mt-3\",\"login-page__reset-password-button\",3,\"routerLink\"],[\"src\",\"./assets/images/logo_fabnum.png\",\"alt\",\"Logo Fabrique num\\xe9rique\",1,\"login-page__fabnumlogo\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"form\",1),Ra(2,\"img\",2),Pa(3,\"mat-form-field\"),Pa(4,\"mat-label\"),bl(5,\"Email\"),Da(),Pa(6,\"mat-icon\",3),bl(7,\"perm_identity\"),Da(),Ra(8,\"input\",4),na(9,xZ,2,0,\"mat-error\",5),na(10,SZ,2,0,\"mat-error\",5),Da(),Pa(11,\"mat-form-field\"),Pa(12,\"mat-label\"),bl(13,\"Mot de passe\"),Da(),Pa(14,\"mat-icon\",3),bl(15,\"lock\"),Da(),Ra(16,\"input\",6),na(17,CZ,2,0,\"mat-error\",5),Da(),Pa(18,\"button\",7),bl(19,\"Se connecter\"),Da(),Pa(20,\"button\",8),bl(21,\" J'ai perdu mon mot de passe \"),Da(),Da(),Ra(22,\"img\",9),Da()),2&t&&(Ss(1),Ia(\"formGroup\",e.loginForm),Ss(8),Ia(\"ngIf\",e.loginForm.get(\"email\").hasError(\"required\")),Ss(1),Ia(\"ngIf\",e.loginForm.get(\"email\").hasError(\"email\")),Ss(7),Ia(\"ngIf\",e.loginForm.get(\"password\").hasError(\"required\")),Ss(1),Ia(\"app-async-action\",e.login),Ss(2),Ia(\"routerLink\",Qc(6,kZ)))},directives:[jw,lw,Zw,tS,Hx,Yk,Wx,hS,Mb,aw,ix,hx,Bd,vb,cW,QR,Nx],styles:[\".login-page__login-btn[_ngcontent-%COMP%]{margin-top:2em;background-color:#fff!important}.login-page__login-btn[_ngcontent-%COMP%]:hover     .mat-button-focus-overlay{opacity:.18}.login-page__logo[_ngcontent-%COMP%]{width:350px;max-height:83px;margin-bottom:3em}.login-page__fabnumlogo[_ngcontent-%COMP%]{margin-top:3em;width:200px;max-height:86px}.login-page__prefix-icon[_ngcontent-%COMP%]{margin-right:.5em}.login-page__reset-password-button[_ngcontent-%COMP%]{color:#fff;font-weight:300;line-height:2em;height:2em}\",\"[_nghost-%COMP%]{flex:1}.unauthenticated-page[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:auto;background-image:url(/assets/images/login_background.jpg);background-size:cover;background-position:70% 50%}.unauthenticated-page__form[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:300px;color:#fff;background-color:rgba(0,55,146,.949);padding:2.5em 2.5em 1em;border-radius:2em;box-shadow:0 16px 24px 2px rgba(0,55,146,.639),0 6px 30px 5px rgba(0,55,146,.62)}.unauthenticated-page__form[_ngcontent-%COMP%]     .mat-form-field-label{color:#fff}\"]}),t})(),MZ=(()=>{class t extends Lq{constructor(t,e){super(),this.router=t,this.workerService=e}ngOnInit(){return Vp(this,void 0,void 0,function*(){this.subscriptions.push(this.workerService.applicationHealth$.pipe(wf(1)).subscribe(t=>Vp(this,void 0,void 0,function*(){var e;(null===(e=null==t?void 0:t.maintenance)||void 0===e?void 0:e.type)!==Wq.InProgress&&(yield this.router.navigateByUrl(\"/\"))}))),yield this.workerService.application.refreshHealthState()})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(XR),Ta(iU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-maintenance-wall-page\"]],features:[Vo],decls:4,vars:0,consts:[[1,\"unauthenticated-page\",\"mat-typography\"],[1,\"unauthenticated-page__form\"],[1,\"maintenance-page__title\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"div\",1),Pa(2,\"h3\",2),bl(3,\"Maintenance en cours\"),Da(),Da(),Da())},styles:[\".maintenance-page__title[_ngcontent-%COMP%]{font-weight:bold;font-size:2.5em}\",\"[_nghost-%COMP%]{flex:1}.unauthenticated-page[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:auto;background-image:url(/assets/images/login_background.jpg);background-size:cover;background-position:70% 50%}.unauthenticated-page__form[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:300px;color:#fff;background-color:rgba(0,55,146,.949);padding:2.5em 2.5em 1em;border-radius:2em;box-shadow:0 16px 24px 2px rgba(0,55,146,.639),0 6px 30px 5px rgba(0,55,146,.62)}.unauthenticated-page__form[_ngcontent-%COMP%]     .mat-form-field-label{color:#fff}\"]}),t})(),TZ=(()=>{class t{ngOnChanges(t){(t.flag||t.mmsi)&&(this.country=this.flag?jG(this.flag):function(t){return jG($G[t.substr(0,3)])}(this.mmsi))}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-flag\"]],inputs:{mmsi:\"mmsi\",flag:\"flag\"},features:[ce],decls:1,vars:2,consts:[[3,\"className\",\"title\"]],template:function(t,e){1&t&&Ra(0,\"span\",0),2&t&&Ia(\"className\",\"flag-icon flag-icon-\"+e.country.flag)(\"title\",e.country.name)},styles:[\"[_nghost-%COMP%]{display:inline-flex;font-size:1.5em}\"],changeDetection:0}),t})();const IZ=function(t){return{transform:t}};function OZ(t,e){if(1&t&&(bl(0),Pa(1,\"mat-icon\",8),bl(2,\"arrow_right_alt\"),Da()),2&t){const t=Wa(2);xl(\" \",t.aircraft.track,\"\\xb0 \"),Ss(1),Ia(\"ngStyle\",Jc(2,IZ,\"rotate(\"+(t.aircraft.track-90)+\"deg)\"))}}function PZ(t,e){1&t&&bl(0,\" ? \")}function DZ(t,e){if(1&t&&(Ra(0,\"mat-divider\"),Pa(1,\"div\",0),Pa(2,\"div\",1),Pa(3,\"div\",2),bl(4,\"Squawk\"),Da(),Pa(5,\"strong\"),bl(6),Da(),Da(),Ra(7,\"mat-divider\",3),Pa(8,\"div\",1),Pa(9,\"div\",2),bl(10,\"Vitesse / Cap\"),Da(),Pa(11,\"strong\",5),bl(12),na(13,OZ,3,4,\"ng-template\",6),na(14,PZ,1,0,\"ng-template\",null,7,Ph),Da(),Da(),Ra(16,\"mat-divider\",3),Pa(17,\"div\",1),Pa(18,\"div\",2),bl(19,\"Destination\"),Da(),Pa(20,\"strong\"),bl(21),Da(),Da(),Da()),2&t){const t=ra(15),e=Wa();Ss(6),xl(\" \",e.aircraft.squawk||\"?\",\" \"),Ss(1),Ia(\"vertical\",!0),Ss(5),xl(\" \",e.aircraft.speed?e.aircraft.speed+\" kt\":\"?\",\" / \"),Ss(1),Ia(\"ngIf\",e.aircraft.track)(\"ngIfElse\",t),Ss(3),Ia(\"vertical\",!0),Ss(5),Sl(\" \",e.aircraft.fromIcao||\"?\",\" \\u2192 \",e.aircraft.toIcao||\"?\",\" \")}}function RZ(t,e){if(1&t&&(Ra(0,\"mat-divider\"),Pa(1,\"div\",0),Pa(2,\"div\",1),Pa(3,\"div\",9),bl(4,\"VSI\"),Da(),Pa(5,\"strong\"),bl(6),Da(),Da(),Ra(7,\"mat-divider\",3),Pa(8,\"div\",1),Pa(9,\"div\",2),bl(10,\"Propri\\xe9taire\"),Da(),Pa(11,\"strong\"),bl(12),Da(),Da(),Da(),Ra(13,\"mat-divider\"),Pa(14,\"div\",0),Pa(15,\"div\",1),Pa(16,\"div\",2),bl(17,\"Providers\"),Da(),Pa(18,\"strong\"),bl(19),Da(),Da(),Da()),2&t){const t=Wa();Ss(6),xl(\"\",t.aircraft.vsi?t.aircraft.vsi:\"?\",\" \"),Ss(1),Ia(\"vertical\",!0),Ss(5),xl(\"\",t.aircraft.registeredOwners||\"?\",\" \"),Ss(7),wl((null==t.aircraft||null==t.aircraft.providers?null:t.aircraft.providers.length)>0?null==t.aircraft?null:t.aircraft.providers.join(\", \"):\"?\")}}let FZ=(()=>{class t extends Lq{constructor(t){super(),this.mapStateConfig=t,this.positionInput=null,this.full=!1,this.extensive=!1,this.position=null,this.stringPosition=\"\"}ngOnInit(){this.ensureMandatoryInputParams(\"aircraft\")}ngOnChanges(t){t.positionInput&&(this.position=this.positionInput),t.aircraft&&!this.positionInput&&(this.position=this.aircraft),this.stringPosition=this.mapStateConfig.coordinateSystem$.value.format([this.position.lon,this.position.lat])}}return t.\\u0275fac=function(e){return new(e||t)(Ta(KG))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-aircraft-infos\"]],inputs:{aircraft:\"aircraft\",positionInput:[\"position\",\"positionInput\"],full:\"full\",extensive:\"extensive\"},features:[Vo,ce],decls:33,vars:10,consts:[[1,\"aircraft-infos__row\"],[1,\"aircraft-infos__info-cell\"],[1,\"aircraft-infos__info-label\"],[3,\"vertical\"],[3,\"ngIf\"],[1,\"d-flex-center\"],[3,\"ngIf\",\"ngIfElse\"],[\"unknown\",\"\"],[1,\"aircraft-infos__course-icon\",3,\"ngStyle\"],[\"title\",\"Vertical Speed Indicator\",1,\"aircraft-infos__info-label\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"div\",1),Pa(2,\"div\",2),bl(3,\"ICAO\"),Da(),Pa(4,\"strong\"),bl(5),Da(),Da(),Ra(6,\"mat-divider\",3),Pa(7,\"div\",1),Pa(8,\"div\",2),bl(9,\"Callsign\"),Da(),Pa(10,\"strong\"),bl(11),Da(),Da(),Ra(12,\"mat-divider\",3),Pa(13,\"div\",1),Pa(14,\"div\",2),bl(15,\"Registration\"),Da(),Pa(16,\"strong\"),bl(17),Da(),Da(),Da(),na(18,DZ,22,8,\"ng-template\",4),Ra(19,\"mat-divider\"),Pa(20,\"div\",0),Pa(21,\"div\",1),Pa(22,\"div\",2),bl(23,\"Altitude\"),Da(),Pa(24,\"strong\"),bl(25),Da(),Da(),Ra(26,\"mat-divider\",3),Pa(27,\"div\",1),Pa(28,\"div\",2),bl(29,\"Position\"),Da(),Pa(30,\"strong\"),bl(31),Da(),Da(),Da(),na(32,RZ,20,4,\"ng-template\",4)),2&t&&(Ss(5),wl(e.aircraft.icao),Ss(1),Ia(\"vertical\",!0),Ss(5),wl(e.aircraft.callsign||\"?\"),Ss(1),Ia(\"vertical\",!0),Ss(5),wl(e.aircraft.registration||\"?\"),Ss(1),Ia(\"ngIf\",e.full||e.extensive),Ss(7),wl(e.position.altitude?e.position.altitude+\" ft\":\"?\"),Ss(1),Ia(\"vertical\",!0),Ss(5),wl(e.stringPosition),Ss(1),Ia(\"ngIf\",e.full))},directives:[Hq,Bd,Yk,Hd],styles:['.aircraft-infos[_ngcontent-%COMP%]{background-color:#e7ecf0;box-shadow:0 1px 3px rgba(0,0,0,.102),0 1px 2px rgba(0,0,0,.2);border-radius:2px}.aircraft-infos[_ngcontent-%COMP%]:after{content:\" \";position:absolute;top:100%;left:50%;margin-left:-12px;border-width:12px;border-style:solid;border-color:#cdd1d4 transparent transparent transparent}.aircraft-infos__header[_ngcontent-%COMP%]{background-color:#cdd1d4;display:flex}.aircraft-infos__link[_ngcontent-%COMP%]{flex:1;padding:0;line-height:inherit;text-align:inherit;font-size:inherit;font-weight:inherit}.aircraft-infos__link[_ngcontent-%COMP%]     .mat-button-wrapper{display:flex}.aircraft-infos__flag[_ngcontent-%COMP%]{margin:5px}.aircraft-infos__title[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:5px 0;flex:1}.aircraft-infos__name[_ngcontent-%COMP%]{font-size:1.2em}.aircraft-infos__type[_ngcontent-%COMP%]{font-size:.9em;color:#555}.aircraft-infos__row[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly;font-size:.9em}.aircraft-infos__info-cell[_ngcontent-%COMP%]{padding:.4em;text-align:center}.aircraft-infos__info-label[_ngcontent-%COMP%]{color:gray;font-weight:500;padding-bottom:.2em}.aircraft-infos__course-icon[_ngcontent-%COMP%]{line-height:.7em;height:.7em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.aircraft-infos__footer[_ngcontent-%COMP%]{background-color:#cdd1d4;padding-left:.4em;display:flex;align-items:center;font-size:.85em;line-height:36px}.aircraft-infos__signal-label[_ngcontent-%COMP%]{font-weight:500;color:#595959}'],changeDetection:0}),t})();function LZ(t,e){1&t&&Ra(0,\"div\",3)}function BZ(t,e){if(1&t&&(Pa(0,\"a\",18),Pa(1,\"img\",19),$a(\"load\",function(t){return t.target.style.display=\"block\"})(\"error\",function(t){return t.target.remove()}),Da(),Da()),2&t){const t=Wa(2);Ia(\"href\",t.aircraft.photoLink,xr),Ss(1),Ia(\"src\",t.aircraft.photoURL,xr)}}function NZ(t,e){1&t&&(Pa(0,\"a\",20),Ra(1,\"img\",21),Da()),2&t&&Qa(\"href\",\"https://www.flightradar24.com/\",Wa(2).aircraft.callsign,\"\",xr)}function zZ(t,e){if(1&t){const t=Na();Pa(0,\"div\",4),Pa(1,\"div\",5),Ra(2,\"app-flag\",6),Pa(3,\"div\",7),Pa(4,\"div\",8),bl(5),Da(),Pa(6,\"small\",9),bl(7),Da(),Da(),Da(),Pa(8,\"div\",10),bl(9,\"R\\xe9ception : \"),Pa(10,\"span\",11),oh(11,\"timeago\"),bl(12),oh(13,\"date\"),Da(),Da(),Da(),na(14,BZ,2,2,\"a\",12),oh(15,\"async\"),Pa(16,\"div\",5),Pa(17,\"button\",13),$a(\"click\",function(){return Fe(t),Wa().locateAircraft()})(\"dblclick\",function(){return Fe(t),Wa().locateAndZoomToAircraft()}),Pa(18,\"mat-icon\"),bl(19,\"center_focus_strong\"),Da(),Da(),Pa(20,\"a\",14),Ra(21,\"img\",15),Da(),na(22,NZ,2,1,\"a\",16),Da(),Ra(23,\"mat-divider\"),Ra(24,\"app-aircraft-infos\",17)}if(2&t){const t=Wa();Ss(2),Ia(\"flag\",t.aircraft.country.flag),Ss(3),wl(t.aircraft.callsign||\"?\"),Ss(2),wl(t.aircraft.type||\"?\"),Ss(3),Ka(\"title\",ah(11,10,1e3*t.aircraft.timestamp)),Ss(2),wl(ch(13,12,1e3*t.aircraft.timestamp,\"yyyy-MM-dd HH:mm:ss z\",t.mapConfigService.useUTCDates$.value&&\"+00\")),Ss(2),Ia(\"ngIf\",ah(15,16,t.aircraft.photoURL&&t.mapConfigService.showMarineTrafficPhotos$)),Ss(6),Qa(\"href\",\"https://globe.adsbexchange.com/?icao=\",t.aircraft.icao,\"\",xr),Ss(2),Ia(\"ngIf\",t.aircraft.callsign),Ss(2),Ia(\"aircraft\",t.aircraft)(\"full\",!0)}}let VZ=(()=>{class t extends Lq{constructor(t,e,i,n,r,s,o,a,l,c){super(),this.activatedRoute=t,this.changeDetectorRef=e,this.titleService=i,this.router=n,this.configService=r,this.interactionsService=s,this.mapService=o,this.mapConfigService=a,this.selectionService=l,this.uiService=c,this.loading=!1,this.aircraft=null}ngOnInit(){this.subscriptions.push(this.selectionService.openEntity$.pipe(wf(1),pf(t=>t.type===pH.Aircraft&&t.id===this.icao)).subscribe(t=>Vp(this,void 0,void 0,function*(){if(t.error){this.loading=!1,this.uiService.error(`L'a\\xe9ronef ${this.icao} est inconnu. Il a pu atterrir ou son signal n'est plus capt\\xe9 depuis plus de 5 minutes.`);const t=MH(this.router);return t?yield this.router.navigateByUrl(t):this.mapService.hasBooted$.value?yield this.router.navigateByUrl(`/${this.mapService.view$.value.toURL()}`):yield this.router.navigateByUrl(\"/\"),void this.changeDetectorRef.markForCheck()}if(!t.entity)return;this.loading=!1;const e=t.entity;this.mapService.hasBooted$.value||this.mapService.locate([e.lon,e.lat]),this.titleService.setTitle(`A\\xe9ronef ${e.callsign||\"?\"} / ${e.icao} - ANAIS`),this.aircraft=e,this.changeDetectorRef.markForCheck()})),this.activatedRoute.paramMap.subscribe(t=>{this.loading=!0,this.icao=t.get(\"icao\"),this.selectionService.openEntity(pH.Aircraft,this.icao),this.changeDetectorRef.markForCheck()}))}ngOnDestroy(){super.ngOnDestroy(),this.selectionService.closeOpenEntity()}locateAircraft(){this.mapService.centerOnLonLat([this.aircraft.lon,this.aircraft.lat])}locateAndZoomToAircraft(){this.mapService.locate([this.aircraft.lon,this.aircraft.lat])}}return t.\\u0275fac=function(e){return new(e||t)(Ta(MD),Ta(Cc),Ta(zp),Ta(XR),Ta(C$),Ta(Cq),Ta(T$),Ta(k$),Ta(bq),Ta(AU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-aircraft-details-panel\"]],features:[Vo],decls:3,vars:2,consts:[[1,\"panel\",\"aircraft-details-panel\"],[\"class\",\"loader\",4,\"ngIf\"],[3,\"ngIf\"],[1,\"loader\"],[1,\"panel__header\",\"d-flex-column\"],[1,\"d-flex\"],[1,\"ma-1\",3,\"flag\"],[1,\"ma-1\",\"u-flex\"],[1,\"aircraft-details-panel__name\"],[1,\"aircraft-details-panel__type\"],[1,\"aircraft-details-panel__reception\"],[3,\"title\"],[\"target\",\"_blank\",\"rel\",\"noopener\",\"referrerpolicy\",\"no-referrer\",\"title\",\"Voir la photo\",3,\"href\",4,\"ngIf\"],[\"mat-button\",\"\",\"title\",\"Centrer la vue sur l'a\\xe9ronef\",1,\"aircraft-details-panel__action\",3,\"click\",\"dblclick\"],[\"mat-button\",\"\",\"title\",\"Ouvrir la page ADSB Exchange\",\"target\",\"_blank\",\"rel\",\"noopener\",\"referrerpolicy\",\"no-referrer\",1,\"aircraft-details-panel__action\",3,\"href\"],[\"src\",\"/assets/images/adsbexchange-icon.png\",\"width\",\"20\",\"alt\",\"ADSB Exchange\"],[\"mat-button\",\"\",\"class\",\"aircraft-details-panel__action\",\"title\",\"Ouvrir la page Flightradar24\",\"target\",\"_blank\",\"rel\",\"noopener\",\"referrerpolicy\",\"no-referrer\",3,\"href\",4,\"ngIf\"],[1,\"aircraft-details-panel__infos\",3,\"aircraft\",\"full\"],[\"target\",\"_blank\",\"rel\",\"noopener\",\"referrerpolicy\",\"no-referrer\",\"title\",\"Voir la photo\",3,\"href\"],[\"referrerpolicy\",\"no-referrer\",1,\"d-block\",2,\"display\",\"none\",3,\"src\",\"load\",\"error\"],[\"mat-button\",\"\",\"title\",\"Ouvrir la page Flightradar24\",\"target\",\"_blank\",\"rel\",\"noopener\",\"referrerpolicy\",\"no-referrer\",1,\"aircraft-details-panel__action\",3,\"href\"],[\"src\",\"/assets/images/flightradar24-icon.png\",\"width\",\"20\",\"alt\",\"Flightradar24\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),na(1,LZ,1,0,\"div\",1),na(2,zZ,25,18,\"ng-template\",2),Da()),2&t&&(Ss(1),Ia(\"ngIf\",e.loading),Ss(1),Ia(\"ngIf\",!e.loading&&e.aircraft))},directives:[Bd,TZ,vb,Yk,_b,Hq,FZ],pipes:[SL,Qd,Kd],styles:[\".aircraft-details-panel[_ngcontent-%COMP%]{max-width:310px}.aircraft-details-panel__name[_ngcontent-%COMP%]{font-size:1.4em;font-weight:500}.aircraft-details-panel__type[_ngcontent-%COMP%]{font-size:.9em;color:#432e2e}.aircraft-details-panel__reception[_ngcontent-%COMP%]{font-size:14px;padding-left:.5em;padding-right:.5em;padding-bottom:.5em}.aircraft-details-panel__action[_ngcontent-%COMP%]{flex:1;min-width:inherit}.aircraft-details-panel__infos[_ngcontent-%COMP%]{font-size:.9em}.aircraft-details-panel__section[_ngcontent-%COMP%]{margin-top:.4em}.aircraft-details-panel__section--nopadding[_ngcontent-%COMP%]   .mat-expansion-panel-body[_ngcontent-%COMP%]{padding:0}.aircraft-details-panel__section-row[_ngcontent-%COMP%]{display:flex}.aircraft-details-panel__subheader[_ngcontent-%COMP%]{background-color:#abb8cb}.aircraft-details-panel__subheader[_ngcontent-%COMP%]:focus, .aircraft-details-panel__subheader[_ngcontent-%COMP%]:hover{background-color:#bbc5d5!important}.aircraft-details-panel__label[_ngcontent-%COMP%]{font-weight:300}\"],changeDetection:0}),t})(),jZ=(()=>{class t{constructor(t,e,i){this.drawingService=t,this.zonesLayerService=e,this.zonesService=i,this.editedZone$=new Zp(null),this.tooManyHexagons$=new Zp(!1),this.editedZone$.subscribe(t=>{this.tooManyHexagons$.next(t&&t.h3indexes.length>130)})}clear(){this.editedZone$.next(null)}startEditing(t){this.editedZone$.next(t),this.zonesLayerService.clear(),this.drawingSubscription=this.drawingService.editZone(t.h3indexes).subscribe(t=>{this.updateZoneH3Indexes(t),this.zonesLayerService.updateZones([{name:\"\",h3indexes:this.editedZone$.value.h3indexes}])})}updateZoneName(t){this.editedZone$.value.name=t,this.editedZone$.next(this.editedZone$.value)}updateZoneH3Indexes(t){this.editedZone$.value.h3indexes=t,this.editedZone$.next(this.editedZone$.value)}saveEditedZone(){return Vp(this,void 0,void 0,function*(){const t=this.editedZone$.value;if(!t.name||0===t.h3indexes.length)throw new Error(\"La zone est incompl\\xe8te\");if(t.h3indexes.length>130)throw new Error(`La zone contient trop d'hexagones : ${t.h3indexes.length} / 130 maximum`);return t.id?yield this.zonesService.updateZone(t):t.id=yield this.zonesService.createZone(t),this.cancelEditing(),t})}cancelEditing(){this.drawingSubscription&&this.drawingSubscription.unsubscribe(),this.editedZone$.next(null),this.drawingService.stopEditingZone()}}return t.\\u0275fac=function(e){return new(e||t)(En(mH),En(kq),En(lH))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),$Z=(()=>{class t{validate(t){return(t=>{var e;const i=t.get(\"aisInterruption\"),n=t.get(\"transhipment\"),r=t.get(\"erraticRoute\"),s=t.get(\"speed\"),o=t.get(\"passageInZone\"),a=t.get(\"spoofing\"),l=t.get(\"zone\");if(!(i&&n&&r&&s&&o&&a))return null;const c=[i,n,r,s,o,a];if(c.some(t=>!t.value))return null;const h={};return c.every(t=>!t.value.enable)&&(h.missingCriterion=!0),(null===(e=l.value)||void 0===e?void 0:e.zones.length)>0||(h.missingZone=!0),h})(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"appAlertRule\",\"\"]],features:[Gl([{provide:Ob,useExisting:t,multi:!0}])]}),t})();const UZ=[\"*\"],HZ=new Qi(\"MatChipRemove\"),GZ=new Qi(\"MatChipAvatar\"),qZ=new Qi(\"MatChipTrailingIcon\");class WZ{constructor(t){this._elementRef=t}}const YZ=xy(by(wy(WZ),\"primary\"),-1);let ZZ=(()=>{class t extends YZ{constructor(t,e,i,n,r,s,o,a){super(t),this._ngZone=e,this._changeDetectorRef=r,this._hasFocus=!1,this.chipListSelectable=!0,this._chipListMultiple=!1,this._chipListDisabled=!1,this._selected=!1,this._selectable=!0,this._disabled=!1,this._removable=!0,this._onFocus=new S,this._onBlur=new S,this.selectionChange=new ph,this.destroyed=new ph,this.removed=new ph,this._addHostClassName(),this._chipRippleTarget=s.createElement(\"div\"),this._chipRippleTarget.classList.add(\"mat-chip-ripple\"),this._elementRef.nativeElement.appendChild(this._chipRippleTarget),this._chipRipple=new Yy(this,e,this._chipRippleTarget,i),this._chipRipple.setupTriggerEvents(t),this.rippleConfig=n||{},this._animationsDisabled=\"NoopAnimations\"===o,this.tabIndex=null!=a&&parseInt(a)||-1}get rippleDisabled(){return this.disabled||this.disableRipple||this._animationsDisabled||!!this.rippleConfig.disabled}get selected(){return this._selected}set selected(t){const e=Of(t);e!==this._selected&&(this._selected=e,this._dispatchSelectionChange())}get value(){return void 0!==this._value?this._value:this._elementRef.nativeElement.textContent}set value(t){this._value=t}get selectable(){return this._selectable&&this.chipListSelectable}set selectable(t){this._selectable=Of(t)}get disabled(){return this._chipListDisabled||this._disabled}set disabled(t){this._disabled=Of(t)}get removable(){return this._removable}set removable(t){this._removable=Of(t)}get ariaSelected(){return this.selectable&&(this._chipListMultiple||this.selected)?this.selected.toString():null}_addHostClassName(){const t=\"mat-basic-chip\",e=this._elementRef.nativeElement;e.hasAttribute(t)||e.tagName.toLowerCase()===t?e.classList.add(t):e.classList.add(\"mat-standard-chip\")}ngOnDestroy(){this.destroyed.emit({chip:this}),this._chipRipple._removeTriggerEvents()}select(){this._selected||(this._selected=!0,this._dispatchSelectionChange(),this._changeDetectorRef.markForCheck())}deselect(){this._selected&&(this._selected=!1,this._dispatchSelectionChange(),this._changeDetectorRef.markForCheck())}selectViaInteraction(){this._selected||(this._selected=!0,this._dispatchSelectionChange(!0),this._changeDetectorRef.markForCheck())}toggleSelected(t=!1){return this._selected=!this.selected,this._dispatchSelectionChange(t),this._changeDetectorRef.markForCheck(),this.selected}focus(){this._hasFocus||(this._elementRef.nativeElement.focus(),this._onFocus.next({chip:this})),this._hasFocus=!0}remove(){this.removable&&this.removed.emit({chip:this})}_handleClick(t){this.disabled?t.preventDefault():t.stopPropagation()}_handleKeydown(t){if(!this.disabled)switch(t.keyCode){case 46:case 8:this.remove(),t.preventDefault();break;case 32:this.selectable&&this.toggleSelected(!0),t.preventDefault()}}_blur(){this._ngZone.onStable.pipe(_f(1)).subscribe(()=>{this._ngZone.run(()=>{this._hasFocus=!1,this._onBlur.next({chip:this})})})}_dispatchSelectionChange(t=!1){this.selectionChange.emit({source:this,isUserInput:t,selected:this._selected})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(tu),Ta(Vf),Ta(Zy,8),Ta(Cc),Ta(Du),Ta(sy,8),Wi(\"tabindex\"))},t.\\u0275dir=Xt({type:t,selectors:[[\"mat-basic-chip\"],[\"\",\"mat-basic-chip\",\"\"],[\"mat-chip\"],[\"\",\"mat-chip\",\"\"]],contentQueries:function(t,e,i){if(1&t&&(Eh(i,GZ,5),Eh(i,qZ,5),Eh(i,HZ,5)),2&t){let t;Ch(t=Mh())&&(e.avatar=t.first),Ch(t=Mh())&&(e.trailingIcon=t.first),Ch(t=Mh())&&(e.removeIcon=t.first)}},hostAttrs:[\"role\",\"option\",1,\"mat-chip\",\"mat-focus-indicator\"],hostVars:14,hostBindings:function(t,e){1&t&&$a(\"click\",function(t){return e._handleClick(t)})(\"keydown\",function(t){return e._handleKeydown(t)})(\"focus\",function(){return e.focus()})(\"blur\",function(){return e._blur()}),2&t&&(ta(\"tabindex\",e.disabled?null:e.tabIndex)(\"disabled\",e.disabled||null)(\"aria-disabled\",e.disabled.toString())(\"aria-selected\",e.ariaSelected),ll(\"mat-chip-selected\",e.selected)(\"mat-chip-with-avatar\",e.avatar)(\"mat-chip-with-trailing-icon\",e.trailingIcon||e.removeIcon)(\"mat-chip-disabled\",e.disabled)(\"_mat-animation-noopable\",e._animationsDisabled))},inputs:{color:\"color\",disableRipple:\"disableRipple\",tabIndex:\"tabIndex\",selected:\"selected\",value:\"value\",selectable:\"selectable\",disabled:\"disabled\",removable:\"removable\"},outputs:{selectionChange:\"selectionChange\",destroyed:\"destroyed\",removed:\"removed\"},exportAs:[\"matChip\"],features:[Vo]}),t})(),XZ=(()=>{class t{constructor(t,e){this._parentChip=t,\"BUTTON\"===e.nativeElement.nodeName&&e.nativeElement.setAttribute(\"type\",\"button\")}_handleClick(t){const e=this._parentChip;e.removable&&!e.disabled&&e.remove(),t.stopPropagation()}}return t.\\u0275fac=function(e){return new(e||t)(Ta(ZZ),Ta(Jl))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matChipRemove\",\"\"]],hostAttrs:[1,\"mat-chip-remove\",\"mat-chip-trailing-icon\"],hostBindings:function(t,e){1&t&&$a(\"click\",function(t){return e._handleClick(t)})},features:[Gl([{provide:HZ,useExisting:t}])]}),t})();const KZ=new Qi(\"mat-chips-default-options\"),QZ=Sy(class{constructor(t,e,i,n){this._defaultErrorStateMatcher=t,this._parentForm=e,this._parentFormGroup=i,this.ngControl=n}});let JZ=0;class tX{constructor(t,e){this.source=t,this.value=e}}let eX=(()=>{class t extends QZ{constructor(t,e,i,n,r,s,o){super(s,n,r,o),this._elementRef=t,this._changeDetectorRef=e,this._dir=i,this.controlType=\"mat-chip-list\",this._lastDestroyedChipIndex=null,this._destroyed=new S,this._uid=\"mat-chip-list-\"+JZ++,this._tabIndex=0,this._userTabIndex=null,this._onTouched=()=>{},this._onChange=()=>{},this._multiple=!1,this._compareWith=(t,e)=>t===e,this._required=!1,this._disabled=!1,this.ariaOrientation=\"horizontal\",this._selectable=!0,this.change=new ph,this.valueChange=new ph,this.ngControl&&(this.ngControl.valueAccessor=this)}get selected(){var t,e;return this.multiple?(null===(t=this._selectionModel)||void 0===t?void 0:t.selected)||[]:null===(e=this._selectionModel)||void 0===e?void 0:e.selected[0]}get role(){return this.empty?null:\"listbox\"}get multiple(){return this._multiple}set multiple(t){this._multiple=Of(t),this._syncChipsState()}get compareWith(){return this._compareWith}set compareWith(t){this._compareWith=t,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(t){this.writeValue(t),this._value=t}get id(){return this._chipInput?this._chipInput.id:this._uid}get required(){return this._required}set required(t){this._required=Of(t),this.stateChanges.next()}get placeholder(){return this._chipInput?this._chipInput.placeholder:this._placeholder}set placeholder(t){this._placeholder=t,this.stateChanges.next()}get focused(){return this._chipInput&&this._chipInput.focused||this._hasFocusedChip()}get empty(){return(!this._chipInput||this._chipInput.empty)&&(!this.chips||0===this.chips.length)}get shouldLabelFloat(){return!this.empty||this.focused}get disabled(){return this.ngControl?!!this.ngControl.disabled:this._disabled}set disabled(t){this._disabled=Of(t),this._syncChipsState()}get selectable(){return this._selectable}set selectable(t){this._selectable=Of(t),this.chips&&this.chips.forEach(t=>t.chipListSelectable=this._selectable)}set tabIndex(t){this._userTabIndex=t,this._tabIndex=t}get chipSelectionChanges(){return q(...this.chips.map(t=>t.selectionChange))}get chipFocusChanges(){return q(...this.chips.map(t=>t._onFocus))}get chipBlurChanges(){return q(...this.chips.map(t=>t._onBlur))}get chipRemoveChanges(){return q(...this.chips.map(t=>t.destroyed))}ngAfterContentInit(){this._keyManager=new vm(this.chips).withWrap().withVerticalOrientation().withHomeAndEnd().withHorizontalOrientation(this._dir?this._dir.value:\"ltr\"),this._dir&&this._dir.change.pipe(Mf(this._destroyed)).subscribe(t=>this._keyManager.withHorizontalOrientation(t)),this._keyManager.tabOut.pipe(Mf(this._destroyed)).subscribe(()=>{this._allowFocusEscape()}),this.chips.changes.pipe(og(null),Mf(this._destroyed)).subscribe(()=>{this.disabled&&Promise.resolve().then(()=>{this._syncChipsState()}),this._resetChips(),this._initializeSelection(),this._updateTabIndex(),this._updateFocusForDestroyedChips(),this.stateChanges.next()})}ngOnInit(){this._selectionModel=new Eg(this.multiple,void 0,!1),this.stateChanges.next()}ngDoCheck(){this.ngControl&&(this.updateErrorState(),this.ngControl.disabled!==this._disabled&&(this.disabled=!!this.ngControl.disabled))}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this.stateChanges.complete(),this._dropSubscriptions()}registerInput(t){this._chipInput=t,this._elementRef.nativeElement.setAttribute(\"data-mat-chip-input\",t.id)}setDescribedByIds(t){this._ariaDescribedby=t.join(\" \")}writeValue(t){this.chips&&this._setSelectionByValue(t,!1)}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t,this.stateChanges.next()}onContainerClick(t){this._originatesFromChip(t)||this.focus()}focus(t){this.disabled||this._chipInput&&this._chipInput.focused||(this.chips.length>0?(this._keyManager.setFirstItemActive(),this.stateChanges.next()):(this._focusInput(t),this.stateChanges.next()))}_focusInput(t){this._chipInput&&this._chipInput.focus(t)}_keydown(t){const e=t.target;e&&e.classList.contains(\"mat-chip\")&&(this._keyManager.onKeydown(t),this.stateChanges.next())}_updateTabIndex(){this._tabIndex=this._userTabIndex||(0===this.chips.length?-1:0)}_updateFocusForDestroyedChips(){if(null!=this._lastDestroyedChipIndex)if(this.chips.length){const t=Math.min(this._lastDestroyedChipIndex,this.chips.length-1);this._keyManager.setActiveItem(t)}else this.focus();this._lastDestroyedChipIndex=null}_isValidIndex(t){return t>=0&&t<this.chips.length}_setSelectionByValue(t,e=!0){if(this._clearSelection(),this.chips.forEach(t=>t.deselect()),Array.isArray(t))t.forEach(t=>this._selectValue(t,e)),this._sortValues();else{const i=this._selectValue(t,e);i&&e&&this._keyManager.setActiveItem(i)}}_selectValue(t,e=!0){const i=this.chips.find(e=>null!=e.value&&this._compareWith(e.value,t));return i&&(e?i.selectViaInteraction():i.select(),this._selectionModel.select(i)),i}_initializeSelection(){Promise.resolve().then(()=>{(this.ngControl||this._value)&&(this._setSelectionByValue(this.ngControl?this.ngControl.value:this._value,!1),this.stateChanges.next())})}_clearSelection(t){this._selectionModel.clear(),this.chips.forEach(e=>{e!==t&&e.deselect()}),this.stateChanges.next()}_sortValues(){this._multiple&&(this._selectionModel.clear(),this.chips.forEach(t=>{t.selected&&this._selectionModel.select(t)}),this.stateChanges.next())}_propagateChanges(t){let e=null;e=Array.isArray(this.selected)?this.selected.map(t=>t.value):this.selected?this.selected.value:t,this._value=e,this.change.emit(new tX(this,e)),this.valueChange.emit(e),this._onChange(e),this._changeDetectorRef.markForCheck()}_blur(){this._hasFocusedChip()||this._keyManager.setActiveItem(-1),this.disabled||(this._chipInput?setTimeout(()=>{this.focused||this._markAsTouched()}):this._markAsTouched())}_markAsTouched(){this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next()}_allowFocusEscape(){-1!==this._tabIndex&&(this._tabIndex=-1,setTimeout(()=>{this._tabIndex=this._userTabIndex||0,this._changeDetectorRef.markForCheck()}))}_resetChips(){this._dropSubscriptions(),this._listenToChipsFocus(),this._listenToChipsSelection(),this._listenToChipsRemoved()}_dropSubscriptions(){this._chipFocusSubscription&&(this._chipFocusSubscription.unsubscribe(),this._chipFocusSubscription=null),this._chipBlurSubscription&&(this._chipBlurSubscription.unsubscribe(),this._chipBlurSubscription=null),this._chipSelectionSubscription&&(this._chipSelectionSubscription.unsubscribe(),this._chipSelectionSubscription=null),this._chipRemoveSubscription&&(this._chipRemoveSubscription.unsubscribe(),this._chipRemoveSubscription=null)}_listenToChipsSelection(){this._chipSelectionSubscription=this.chipSelectionChanges.subscribe(t=>{t.source.selected?this._selectionModel.select(t.source):this._selectionModel.deselect(t.source),this.multiple||this.chips.forEach(t=>{!this._selectionModel.isSelected(t)&&t.selected&&t.deselect()}),t.isUserInput&&this._propagateChanges()})}_listenToChipsFocus(){this._chipFocusSubscription=this.chipFocusChanges.subscribe(t=>{let e=this.chips.toArray().indexOf(t.chip);this._isValidIndex(e)&&this._keyManager.updateActiveItem(e),this.stateChanges.next()}),this._chipBlurSubscription=this.chipBlurChanges.subscribe(()=>{this._blur(),this.stateChanges.next()})}_listenToChipsRemoved(){this._chipRemoveSubscription=this.chipRemoveChanges.subscribe(t=>{const e=t.chip,i=this.chips.toArray().indexOf(t.chip);this._isValidIndex(i)&&e._hasFocus&&(this._lastDestroyedChipIndex=i)})}_originatesFromChip(t){let e=t.target;for(;e&&e!==this._elementRef.nativeElement;){if(e.classList.contains(\"mat-chip\"))return!0;e=e.parentElement}return!1}_hasFocusedChip(){return this.chips&&this.chips.some(t=>t._hasFocus)}_syncChipsState(){this.chips&&this.chips.forEach(t=>{t._chipListDisabled=this._disabled,t._chipListMultiple=this.multiple})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(Cc),Ta(xg,8),Ta(Lw,8),Ta(Zw,8),Ta(zy),Ta(sw,10))},t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-chip-list\"]],contentQueries:function(t,e,i){if(1&t&&Eh(i,ZZ,5),2&t){let t;Ch(t=Mh())&&(e.chips=t)}},hostAttrs:[1,\"mat-chip-list\"],hostVars:15,hostBindings:function(t,e){1&t&&$a(\"focus\",function(){return e.focus()})(\"blur\",function(){return e._blur()})(\"keydown\",function(t){return e._keydown(t)}),2&t&&(El(\"id\",e._uid),ta(\"tabindex\",e.disabled?null:e._tabIndex)(\"aria-describedby\",e._ariaDescribedby||null)(\"aria-required\",e.role?e.required:null)(\"aria-disabled\",e.disabled.toString())(\"aria-invalid\",e.errorState)(\"aria-multiselectable\",e.multiple)(\"role\",e.role)(\"aria-orientation\",e.ariaOrientation),ll(\"mat-chip-list-disabled\",e.disabled)(\"mat-chip-list-invalid\",e.errorState)(\"mat-chip-list-required\",e.required))},inputs:{ariaOrientation:[\"aria-orientation\",\"ariaOrientation\"],multiple:\"multiple\",compareWith:\"compareWith\",value:\"value\",required:\"required\",placeholder:\"placeholder\",disabled:\"disabled\",selectable:\"selectable\",tabIndex:\"tabIndex\",errorStateMatcher:\"errorStateMatcher\"},outputs:{change:\"change\",valueChange:\"valueChange\"},exportAs:[\"matChipList\"],features:[Gl([{provide:Vx,useExisting:t}]),Vo],ngContentSelectors:UZ,decls:2,vars:0,consts:[[1,\"mat-chip-list-wrapper\"]],template:function(t,e){1&t&&(Za(),Pa(0,\"div\",0),Xa(1),Da())},styles:['.mat-chip{position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;transform:translateZ(0);border:none;-webkit-appearance:none;-moz-appearance:none}.mat-standard-chip{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);display:inline-flex;padding:7px 12px;border-radius:16px;align-items:center;cursor:default;min-height:32px;height:1px}._mat-animation-noopable.mat-standard-chip{transition:none;animation:none}.mat-standard-chip .mat-chip-remove{border:none;-webkit-appearance:none;-moz-appearance:none;padding:0;background:none}.mat-standard-chip .mat-chip-remove.mat-icon,.mat-standard-chip .mat-chip-remove .mat-icon{width:18px;height:18px;font-size:18px}.mat-standard-chip::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:inherit;opacity:0;content:\"\";pointer-events:none;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1)}.mat-standard-chip:hover::after{opacity:.12}.mat-standard-chip:focus{outline:none}.mat-standard-chip:focus::after{opacity:.16}.cdk-high-contrast-active .mat-standard-chip{outline:solid 1px}.cdk-high-contrast-active .mat-standard-chip:focus{outline:dotted 2px}.mat-standard-chip.mat-chip-disabled::after{opacity:0}.mat-standard-chip.mat-chip-disabled .mat-chip-remove,.mat-standard-chip.mat-chip-disabled .mat-chip-trailing-icon{cursor:default}.mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar,.mat-standard-chip.mat-chip-with-avatar{padding-top:0;padding-bottom:0}.mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar{padding-right:8px;padding-left:0}[dir=rtl] .mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar{padding-left:8px;padding-right:0}.mat-standard-chip.mat-chip-with-trailing-icon{padding-top:7px;padding-bottom:7px;padding-right:8px;padding-left:12px}[dir=rtl] .mat-standard-chip.mat-chip-with-trailing-icon{padding-left:8px;padding-right:12px}.mat-standard-chip.mat-chip-with-avatar{padding-left:0;padding-right:12px}[dir=rtl] .mat-standard-chip.mat-chip-with-avatar{padding-right:0;padding-left:12px}.mat-standard-chip .mat-chip-avatar{width:24px;height:24px;margin-right:8px;margin-left:4px}[dir=rtl] .mat-standard-chip .mat-chip-avatar{margin-left:8px;margin-right:4px}.mat-standard-chip .mat-chip-remove,.mat-standard-chip .mat-chip-trailing-icon{width:18px;height:18px;cursor:pointer}.mat-standard-chip .mat-chip-remove,.mat-standard-chip .mat-chip-trailing-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-standard-chip .mat-chip-remove,[dir=rtl] .mat-standard-chip .mat-chip-trailing-icon{margin-right:8px;margin-left:0}.mat-chip-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit;overflow:hidden}.mat-chip-list-wrapper{display:flex;flex-direction:row;flex-wrap:wrap;align-items:center;margin:-4px}.mat-chip-list-wrapper input.mat-input-element,.mat-chip-list-wrapper .mat-standard-chip{margin:4px}.mat-chip-list-stacked .mat-chip-list-wrapper{flex-direction:column;align-items:flex-start}.mat-chip-list-stacked .mat-chip-list-wrapper .mat-standard-chip{width:100%}.mat-chip-avatar{border-radius:50%;justify-content:center;align-items:center;display:flex;overflow:hidden;object-fit:cover}input.mat-chip-input{width:150px;margin:4px;flex:1 0 150px}\\n'],encapsulation:2,changeDetection:0}),t})();const iX={separatorKeyCodes:[13]};let nX=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({providers:[zy,{provide:KZ,useValue:iX}],imports:[[_y]]}),t})();const rX=\"anais-seen-glitters\";let sX=(()=>{class t{constructor(){this.glitters=[];try{this.glitters=JSON.parse(localStorage.getItem(rX))||[]}catch(k6){}}viewItem(t){this.glitters.includes(t)||(this.glitters.push(t),localStorage.setItem(rX,JSON.stringify(this.glitters)))}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();function oX(t,e){if(1&t&&Ra(0,\"div\",1),2&t){const t=e.$implicit;al(\"left\",t.x)(\"top\",t.y),Ia(\"ngClass\",\"glitter__star glitter__star--delay-\"+t.delay)}}const aX=[\"*\"],lX=[200,800,1400,2e3,2600],cX=new Date((new Date).setMonth((new Date).getMonth()-2));let hX=(()=>{class t{constructor(t,e,i){this.changeDetectorRef=t,this.elementRef=e,this.glitterService=i,this.stars=[],this.active=!1,this.clickListener=()=>{this.stopGlitter()}}ngOnInit(){this.changeDetectorRef.detach(),this.active=!this.glitterService.glitters.includes(this.gid)&&(!this.date||new Date(this.date)>cX),this.elementRef.nativeElement.addEventListener(\"click\",this.clickListener,!0),this.changeDetectorRef.detectChanges()}ngOnDestroy(){this.elementRef.nativeElement.removeEventListener(\"click\",this.clickListener,!0)}ngAfterViewInit(){if(!this.active)return;let t;if(this.width&&this.height)t={clientWidth:this.width,clientHeight:this.height};else{if(t=this.elementRef.nativeElement.children[0],!t)throw new Error(`Missing child element for glitter ${this.gid}`);for(;0===t.clientHeight||0===t.clientWidth;)if(t=t.children[0],!t)return}const e=.05*t.clientWidth;this.minX=e,this.maxX=t.clientWidth-16-e;const i=.05*t.clientHeight;this.minY=i,this.maxY=t.clientHeight-16-i,lX.forEach(t=>{setTimeout(()=>{this.createStar(t),this.changeDetectorRef.detectChanges()},t)})}createStar(t){this.stars.push({x:`${this.minX+Math.random()*(this.maxX-this.minX)}px`,y:`${this.minY+Math.random()*(this.maxY-this.minY)}px`,delay:t})}stopGlitter(){!this.active||(this.glitterService.viewItem(this.gid),this.stars=[],this.changeDetectorRef.detectChanges())}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Cc),Ta(Jl),Ta(sX))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-glitter\"]],inputs:{gid:\"gid\",date:\"date\",width:\"width\",height:\"height\"},ngContentSelectors:aX,decls:2,vars:1,consts:[[3,\"ngClass\",\"left\",\"top\",4,\"ngFor\",\"ngForOf\"],[3,\"ngClass\"]],template:function(t,e){1&t&&(Za(),Xa(0),na(1,oX,1,5,\"div\",0)),2&t&&(Ss(1),Ia(\"ngForOf\",e.stars))},directives:[Fd,Dd],styles:['[_nghost-%COMP%]{position:relative;display:block;line-height:0}.glitter__star[_ngcontent-%COMP%]{content:\" \";position:absolute;background-image:url(glitter-star.76372dc0eb5e11c5d423.png);background-position:center;height:16px;width:16px;-webkit-animation:glitter 3s linear infinite;animation:glitter 3s linear infinite;opacity:0;z-index:1;pointer-events:none;touch-action:none}.glitter__star--delay-200[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}.glitter__star--delay-800[_ngcontent-%COMP%]{-webkit-animation-delay:.8s;animation-delay:.8s}.glitter__star--delay-1400[_ngcontent-%COMP%]{-webkit-animation-delay:1.4s;animation-delay:1.4s}.glitter__star--delay-2000[_ngcontent-%COMP%]{-webkit-animation-delay:2s;animation-delay:2s}.glitter__star--delay-2600[_ngcontent-%COMP%]{-webkit-animation-delay:2.6s;animation-delay:2.6s}@-webkit-keyframes glitter{0%{transform:scale(.3) rotate(0);opacity:0}25%{transform:scale(1) rotate(180deg);opacity:1}50%{transform:scale(.3) rotate(360deg);opacity:0}to{transform:scale(.3) rotate(0);opacity:0}}@keyframes glitter{0%{transform:scale(.3) rotate(0);opacity:0}25%{transform:scale(1) rotate(180deg);opacity:1}50%{transform:scale(.3) rotate(360deg);opacity:0}to{transform:scale(.3) rotate(0);opacity:0}}']}),t})();const uX=[\"thumbContainer\"],dX=[\"toggleBar\"],pX=[\"input\"],fX=function(t){return{enterDuration:t}},mX=[\"*\"],gX=new Qi(\"mat-slide-toggle-default-options\",{providedIn:\"root\",factory:()=>({disableToggleValue:!1})});let AX=0;const vX={provide:Cb,useExisting:ot(()=>bX),multi:!0};class _X{constructor(t,e){this.source=t,this.checked=e}}const yX=xy(by(wy(yy(class{constructor(t){this._elementRef=t}}))));let bX=(()=>{class t extends yX{constructor(t,e,i,n,r,s){super(t),this._focusMonitor=e,this._changeDetectorRef=i,this.defaults=r,this._onChange=t=>{},this._onTouched=()=>{},this._uniqueId=\"mat-slide-toggle-\"+ ++AX,this._required=!1,this._checked=!1,this.name=null,this.id=this._uniqueId,this.labelPosition=\"after\",this.ariaLabel=null,this.ariaLabelledby=null,this.change=new ph,this.toggleChange=new ph,this.tabIndex=parseInt(n)||0,this.color=this.defaultColor=r.color||\"accent\",this._noopAnimations=\"NoopAnimations\"===s}get required(){return this._required}set required(t){this._required=Of(t)}get checked(){return this._checked}set checked(t){this._checked=Of(t),this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{\"keyboard\"===t||\"program\"===t?this._inputElement.nativeElement.focus():t||Promise.resolve().then(()=>this._onTouched())})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}_onChangeEvent(t){t.stopPropagation(),this.toggleChange.emit(),this.defaults.disableToggleValue?this._inputElement.nativeElement.checked=this.checked:(this.checked=this._inputElement.nativeElement.checked,this._emitChangeEvent())}_onInputClick(t){t.stopPropagation()}writeValue(t){this.checked=!!t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck()}focus(t,e){e?this._focusMonitor.focusVia(this._inputElement,e,t):this._inputElement.nativeElement.focus(t)}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(new _X(this,this.checked))}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(Bm),Ta(Cc),Wi(\"tabindex\"),Ta(gX),Ta(sy,8))},t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-slide-toggle\"]],viewQuery:function(t,e){if(1&t&&(kh(uX,5),kh(dX,5),kh(pX,5)),2&t){let t;Ch(t=Mh())&&(e._thumbEl=t.first),Ch(t=Mh())&&(e._thumbBarEl=t.first),Ch(t=Mh())&&(e._inputElement=t.first)}},hostAttrs:[1,\"mat-slide-toggle\"],hostVars:12,hostBindings:function(t,e){2&t&&(El(\"id\",e.id),ta(\"tabindex\",e.disabled?null:-1)(\"aria-label\",null)(\"aria-labelledby\",null),ll(\"mat-checked\",e.checked)(\"mat-disabled\",e.disabled)(\"mat-slide-toggle-label-before\",\"before\"==e.labelPosition)(\"_mat-animation-noopable\",e._noopAnimations))},inputs:{disabled:\"disabled\",disableRipple:\"disableRipple\",color:\"color\",tabIndex:\"tabIndex\",name:\"name\",id:\"id\",labelPosition:\"labelPosition\",ariaLabel:[\"aria-label\",\"ariaLabel\"],ariaLabelledby:[\"aria-labelledby\",\"ariaLabelledby\"],required:\"required\",checked:\"checked\",ariaDescribedby:[\"aria-describedby\",\"ariaDescribedby\"]},outputs:{change:\"change\",toggleChange:\"toggleChange\"},exportAs:[\"matSlideToggle\"],features:[Gl([vX]),Vo],ngContentSelectors:mX,decls:16,vars:20,consts:[[1,\"mat-slide-toggle-label\"],[\"label\",\"\"],[1,\"mat-slide-toggle-bar\"],[\"toggleBar\",\"\"],[\"type\",\"checkbox\",\"role\",\"switch\",1,\"mat-slide-toggle-input\",\"cdk-visually-hidden\",3,\"id\",\"required\",\"tabIndex\",\"checked\",\"disabled\",\"change\",\"click\"],[\"input\",\"\"],[1,\"mat-slide-toggle-thumb-container\"],[\"thumbContainer\",\"\"],[1,\"mat-slide-toggle-thumb\"],[\"mat-ripple\",\"\",1,\"mat-slide-toggle-ripple\",\"mat-focus-indicator\",3,\"matRippleTrigger\",\"matRippleDisabled\",\"matRippleCentered\",\"matRippleRadius\",\"matRippleAnimation\"],[1,\"mat-ripple-element\",\"mat-slide-toggle-persistent-ripple\"],[1,\"mat-slide-toggle-content\",3,\"cdkObserveContent\"],[\"labelContent\",\"\"],[2,\"display\",\"none\"]],template:function(t,e){if(1&t&&(Za(),Pa(0,\"label\",0,1),Pa(2,\"div\",2,3),Pa(4,\"input\",4,5),$a(\"change\",function(t){return e._onChangeEvent(t)})(\"click\",function(t){return e._onInputClick(t)}),Da(),Pa(6,\"div\",6,7),Ra(8,\"div\",8),Pa(9,\"div\",9),Ra(10,\"div\",10),Da(),Da(),Da(),Pa(11,\"span\",11,12),$a(\"cdkObserveContent\",function(){return e._onLabelTextChange()}),Pa(13,\"span\",13),bl(14,\"\\xa0\"),Da(),Xa(15),Da(),Da()),2&t){const t=ra(1),i=ra(12);ta(\"for\",e.inputId),Ss(2),ll(\"mat-slide-toggle-bar-no-side-margin\",!i.textContent||!i.textContent.trim()),Ss(2),Ia(\"id\",e.inputId)(\"required\",e.required)(\"tabIndex\",e.tabIndex)(\"checked\",e.checked)(\"disabled\",e.disabled),ta(\"name\",e.name)(\"aria-checked\",e.checked.toString())(\"aria-label\",e.ariaLabel)(\"aria-labelledby\",e.ariaLabelledby)(\"aria-describedby\",e.ariaDescribedby),Ss(5),Ia(\"matRippleTrigger\",t)(\"matRippleDisabled\",e.disableRipple||e.disabled)(\"matRippleCentered\",!0)(\"matRippleRadius\",20)(\"matRippleAnimation\",Jc(18,fX,e._noopAnimations?0:150))}},directives:[Xy,rm],styles:[\".mat-slide-toggle{display:inline-block;height:24px;max-width:100%;line-height:24px;white-space:nowrap;outline:none;-webkit-tap-highlight-color:transparent}.mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(16px, 0, 0)}[dir=rtl] .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(-16px, 0, 0)}.mat-slide-toggle.mat-disabled{opacity:.38}.mat-slide-toggle.mat-disabled .mat-slide-toggle-label,.mat-slide-toggle.mat-disabled .mat-slide-toggle-thumb-container{cursor:default}.mat-slide-toggle-label{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:flex;flex:1;flex-direction:row;align-items:center;height:inherit;cursor:pointer}.mat-slide-toggle-content{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-slide-toggle-label-before .mat-slide-toggle-label{order:1}.mat-slide-toggle-label-before .mat-slide-toggle-bar{order:2}[dir=rtl] .mat-slide-toggle-label-before .mat-slide-toggle-bar,.mat-slide-toggle-bar{margin-right:8px;margin-left:0}[dir=rtl] .mat-slide-toggle-bar,.mat-slide-toggle-label-before .mat-slide-toggle-bar{margin-left:8px;margin-right:0}.mat-slide-toggle-bar-no-side-margin{margin-left:0;margin-right:0}.mat-slide-toggle-thumb-container{position:absolute;z-index:1;width:20px;height:20px;top:-3px;left:0;transform:translate3d(0, 0, 0);transition:all 80ms linear;transition-property:transform}._mat-animation-noopable .mat-slide-toggle-thumb-container{transition:none}[dir=rtl] .mat-slide-toggle-thumb-container{left:auto;right:0}.mat-slide-toggle-thumb{height:20px;width:20px;border-radius:50%}.mat-slide-toggle-bar{position:relative;width:36px;height:14px;flex-shrink:0;border-radius:8px}.mat-slide-toggle-input{bottom:0;left:10px}[dir=rtl] .mat-slide-toggle-input{left:auto;right:10px}.mat-slide-toggle-bar,.mat-slide-toggle-thumb{transition:all 80ms linear;transition-property:background-color;transition-delay:50ms}._mat-animation-noopable .mat-slide-toggle-bar,._mat-animation-noopable .mat-slide-toggle-thumb{transition:none}.mat-slide-toggle .mat-slide-toggle-ripple{position:absolute;top:calc(50% - 20px);left:calc(50% - 20px);height:40px;width:40px;z-index:1;pointer-events:none}.mat-slide-toggle .mat-slide-toggle-ripple .mat-ripple-element:not(.mat-slide-toggle-persistent-ripple){opacity:.12}.mat-slide-toggle-persistent-ripple{width:100%;height:100%;transform:none}.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:.04}.mat-slide-toggle:not(.mat-disabled).cdk-keyboard-focused .mat-slide-toggle-persistent-ripple{opacity:.12}.mat-slide-toggle-persistent-ripple,.mat-slide-toggle.mat-disabled .mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:0}@media(hover: none){.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{display:none}}.cdk-high-contrast-active .mat-slide-toggle-thumb,.cdk-high-contrast-active .mat-slide-toggle-bar{border:1px solid}.cdk-high-contrast-active .mat-slide-toggle.cdk-keyboard-focused .mat-slide-toggle-bar{outline:2px dotted;outline-offset:5px}\\n\"],encapsulation:2,changeDetection:0}),t})(),wX=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({}),t})(),xX=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({imports:[[wX,Ky,_y,sm],wX,_y]}),t})();const SX=[\"mat-menu-item\",\"\"];function CX(t,e){1&t&&(ci(),Pa(0,\"svg\",2),Ra(1,\"polygon\",3),Da())}const kX=[\"*\"];function EX(t,e){if(1&t){const t=Na();Pa(0,\"div\",0),$a(\"keydown\",function(e){return Fe(t),Wa()._handleKeydown(e)})(\"click\",function(){return Fe(t),Wa().closed.emit(\"click\")})(\"@transformMenu.start\",function(e){return Fe(t),Wa()._onAnimationStart(e)})(\"@transformMenu.done\",function(e){return Fe(t),Wa()._onAnimationDone(e)}),Pa(1,\"div\",1),Xa(2),Da(),Da()}if(2&t){const t=Wa();Ia(\"id\",t.panelId)(\"ngClass\",t._classList)(\"@transformMenu\",t._panelAnimationState),ta(\"aria-label\",t.ariaLabel||null)(\"aria-labelledby\",t.ariaLabelledby||null)(\"aria-describedby\",t.ariaDescribedby||null)}}const MX={transformMenu:bA(\"transformMenu\",[CA(\"void\",SA({opacity:0,transform:\"scale(0.8)\"})),EA(\"void => enter\",wA(\"120ms cubic-bezier(0, 0, 0.2, 1)\",SA({opacity:1,transform:\"scale(1)\"}))),EA(\"* => void\",wA(\"100ms 25ms linear\",SA({opacity:0})))]),fadeInItems:bA(\"fadeInItems\",[CA(\"showing\",SA({opacity:1})),EA(\"void => *\",[SA({opacity:0}),wA(\"400ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)\")])])},TX=new Qi(\"MatMenuContent\"),IX=new Qi(\"MAT_MENU_PANEL\"),OX=wy(yy(class{}));let PX=(()=>{class t extends OX{constructor(t,e,i,n,r){super(),this._elementRef=t,this._focusMonitor=i,this._parentMenu=n,this._changeDetectorRef=r,this.role=\"menuitem\",this._hovered=new S,this._focused=new S,this._highlighted=!1,this._triggersSubmenu=!1,n&&n.addItem&&n.addItem(this)}focus(t,e){this._focusMonitor&&t?this._focusMonitor.focusVia(this._getHostElement(),t,e):this._getHostElement().focus(e),this._focused.next(this)}ngAfterViewInit(){this._focusMonitor&&this._focusMonitor.monitor(this._elementRef,!1)}ngOnDestroy(){this._focusMonitor&&this._focusMonitor.stopMonitoring(this._elementRef),this._parentMenu&&this._parentMenu.removeItem&&this._parentMenu.removeItem(this),this._hovered.complete(),this._focused.complete()}_getTabIndex(){return this.disabled?\"-1\":\"0\"}_getHostElement(){return this._elementRef.nativeElement}_checkDisabled(t){this.disabled&&(t.preventDefault(),t.stopPropagation())}_handleMouseEnter(){this._hovered.next(this)}getLabel(){var t,e;const i=this._elementRef.nativeElement.cloneNode(!0),n=i.querySelectorAll(\"mat-icon, .material-icons\");for(let r=0;r<n.length;r++){const e=n[r];null===(t=e.parentNode)||void 0===t||t.removeChild(e)}return(null===(e=i.textContent)||void 0===e?void 0:e.trim())||\"\"}_setHighlighted(t){var e;this._highlighted=t,null===(e=this._changeDetectorRef)||void 0===e||e.markForCheck()}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(Du),Ta(Bm),Ta(IX,8),Ta(Cc))},t.\\u0275cmp=Ht({type:t,selectors:[[\"\",\"mat-menu-item\",\"\"]],hostAttrs:[1,\"mat-focus-indicator\"],hostVars:10,hostBindings:function(t,e){1&t&&$a(\"click\",function(t){return e._checkDisabled(t)})(\"mouseenter\",function(){return e._handleMouseEnter()}),2&t&&(ta(\"role\",e.role)(\"tabindex\",e._getTabIndex())(\"aria-disabled\",e.disabled.toString())(\"disabled\",e.disabled||null),ll(\"mat-menu-item\",!0)(\"mat-menu-item-highlighted\",e._highlighted)(\"mat-menu-item-submenu-trigger\",e._triggersSubmenu))},inputs:{disabled:\"disabled\",disableRipple:\"disableRipple\",role:\"role\"},exportAs:[\"matMenuItem\"],features:[Vo],attrs:SX,ngContentSelectors:kX,decls:3,vars:3,consts:[[\"matRipple\",\"\",1,\"mat-menu-ripple\",3,\"matRippleDisabled\",\"matRippleTrigger\"],[\"class\",\"mat-menu-submenu-icon\",\"viewBox\",\"0 0 5 10\",\"focusable\",\"false\",4,\"ngIf\"],[\"viewBox\",\"0 0 5 10\",\"focusable\",\"false\",1,\"mat-menu-submenu-icon\"],[\"points\",\"0,0 5,5 0,10\"]],template:function(t,e){1&t&&(Za(),Xa(0),Ra(1,\"div\",0),na(2,CX,2,0,\"svg\",1)),2&t&&(Ss(1),Ia(\"matRippleDisabled\",e.disableRipple||e.disabled)(\"matRippleTrigger\",e._getHostElement()),Ss(1),Ia(\"ngIf\",e._triggersSubmenu))},directives:[Xy,Bd],encapsulation:2,changeDetection:0}),t})();const DX=new Qi(\"mat-menu-default-options\",{providedIn:\"root\",factory:function(){return{overlapTrigger:!1,xPosition:\"after\",yPosition:\"below\",backdropClass:\"cdk-overlay-transparent-backdrop\"}}});let RX=0,FX=(()=>{class t{constructor(t,e,i){this._elementRef=t,this._ngZone=e,this._defaultOptions=i,this._xPosition=this._defaultOptions.xPosition,this._yPosition=this._defaultOptions.yPosition,this._directDescendantItems=new mh,this._tabSubscription=u.EMPTY,this._classList={},this._panelAnimationState=\"void\",this._animationDone=new S,this.overlayPanelClass=this._defaultOptions.overlayPanelClass||\"\",this.backdropClass=this._defaultOptions.backdropClass,this._overlapTrigger=this._defaultOptions.overlapTrigger,this._hasBackdrop=this._defaultOptions.hasBackdrop,this.closed=new ph,this.close=this.closed,this.panelId=\"mat-menu-panel-\"+RX++}get xPosition(){return this._xPosition}set xPosition(t){this._xPosition=t,this.setPositionClasses()}get yPosition(){return this._yPosition}set yPosition(t){this._yPosition=t,this.setPositionClasses()}get overlapTrigger(){return this._overlapTrigger}set overlapTrigger(t){this._overlapTrigger=Of(t)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(t){this._hasBackdrop=Of(t)}set panelClass(t){const e=this._previousPanelClass;e&&e.length&&e.split(\" \").forEach(t=>{this._classList[t]=!1}),this._previousPanelClass=t,t&&t.length&&(t.split(\" \").forEach(t=>{this._classList[t]=!0}),this._elementRef.nativeElement.className=\"\")}get classList(){return this.panelClass}set classList(t){this.panelClass=t}ngOnInit(){this.setPositionClasses()}ngAfterContentInit(){this._updateDirectDescendants(),this._keyManager=new vm(this._directDescendantItems).withWrap().withTypeAhead().withHomeAndEnd(),this._tabSubscription=this._keyManager.tabOut.subscribe(()=>this.closed.emit(\"tab\")),this._directDescendantItems.changes.pipe(og(this._directDescendantItems),hg(t=>q(...t.map(t=>t._focused)))).subscribe(t=>this._keyManager.updateActiveItem(t))}ngOnDestroy(){this._directDescendantItems.destroy(),this._tabSubscription.unsubscribe(),this.closed.complete()}_hovered(){return this._directDescendantItems.changes.pipe(og(this._directDescendantItems),hg(t=>q(...t.map(t=>t._hovered))))}addItem(t){}removeItem(t){}_handleKeydown(t){const e=t.keyCode,i=this._keyManager;switch(e){case 27:Kp(t)||(t.preventDefault(),this.closed.emit(\"keydown\"));break;case 37:this.parentMenu&&\"ltr\"===this.direction&&this.closed.emit(\"keydown\");break;case 39:this.parentMenu&&\"rtl\"===this.direction&&this.closed.emit(\"keydown\");break;default:(38===e||40===e)&&i.setFocusOrigin(\"keyboard\"),i.onKeydown(t)}}focusFirstItem(t=\"program\"){this.lazyContent?this._ngZone.onStable.pipe(_f(1)).subscribe(()=>this._focusFirstItem(t)):this._focusFirstItem(t)}_focusFirstItem(t){const e=this._keyManager;if(e.setFocusOrigin(t).setFirstItemActive(),!e.activeItem&&this._directDescendantItems.length){let t=this._directDescendantItems.first._getHostElement().parentElement;for(;t;){if(\"menu\"===t.getAttribute(\"role\")){t.focus();break}t=t.parentElement}}}resetActiveItem(){this._keyManager.setActiveItem(-1)}setElevation(t){const e=Math.min(this._baseElevation+t,24),i=`${this._elevationPrefix}${e}`,n=Object.keys(this._classList).find(t=>t.startsWith(this._elevationPrefix));(!n||n===this._previousElevation)&&(this._previousElevation&&(this._classList[this._previousElevation]=!1),this._classList[i]=!0,this._previousElevation=i)}setPositionClasses(t=this.xPosition,e=this.yPosition){const i=this._classList;i[\"mat-menu-before\"]=\"before\"===t,i[\"mat-menu-after\"]=\"after\"===t,i[\"mat-menu-above\"]=\"above\"===e,i[\"mat-menu-below\"]=\"below\"===e}_startAnimation(){this._panelAnimationState=\"enter\"}_resetAnimation(){this._panelAnimationState=\"void\"}_onAnimationDone(t){this._animationDone.next(t),this._isAnimating=!1}_onAnimationStart(t){this._isAnimating=!0,\"enter\"===t.toState&&0===this._keyManager.activeItemIndex&&(t.element.scrollTop=0)}_updateDirectDescendants(){this._allItems.changes.pipe(og(this._allItems)).subscribe(t=>{this._directDescendantItems.reset(t.filter(t=>t._parentMenu===this)),this._directDescendantItems.notifyOnChanges()})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(tu),Ta(DX))},t.\\u0275dir=Xt({type:t,contentQueries:function(t,e,i){if(1&t&&(Eh(i,TX,5),Eh(i,PX,5),Eh(i,PX,4)),2&t){let t;Ch(t=Mh())&&(e.lazyContent=t.first),Ch(t=Mh())&&(e._allItems=t),Ch(t=Mh())&&(e.items=t)}},viewQuery:function(t,e){if(1&t&&kh(Ic,5),2&t){let t;Ch(t=Mh())&&(e.templateRef=t.first)}},inputs:{backdropClass:\"backdropClass\",xPosition:\"xPosition\",yPosition:\"yPosition\",overlapTrigger:\"overlapTrigger\",hasBackdrop:\"hasBackdrop\",panelClass:[\"class\",\"panelClass\"],classList:\"classList\",ariaLabel:[\"aria-label\",\"ariaLabel\"],ariaLabelledby:[\"aria-labelledby\",\"ariaLabelledby\"],ariaDescribedby:[\"aria-describedby\",\"ariaDescribedby\"]},outputs:{closed:\"closed\",close:\"close\"}}),t})(),LX=(()=>{class t extends FX{constructor(t,e,i){super(t,e,i),this._elevationPrefix=\"mat-elevation-z\",this._baseElevation=4}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(tu),Ta(DX))},t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-menu\"]],hostVars:3,hostBindings:function(t,e){2&t&&ta(\"aria-label\",null)(\"aria-labelledby\",null)(\"aria-describedby\",null)},exportAs:[\"matMenu\"],features:[Gl([{provide:IX,useExisting:t}]),Vo],ngContentSelectors:kX,decls:1,vars:0,consts:[[\"tabindex\",\"-1\",\"role\",\"menu\",1,\"mat-menu-panel\",3,\"id\",\"ngClass\",\"keydown\",\"click\"],[1,\"mat-menu-content\"]],template:function(t,e){1&t&&(Za(),na(0,EX,3,6,\"ng-template\"))},directives:[Dd],styles:[\"mat-menu{display:none}.mat-menu-panel{min-width:112px;max-width:280px;overflow:auto;-webkit-overflow-scrolling:touch;max-height:calc(100vh - 48px);border-radius:4px;outline:0;min-height:64px}.mat-menu-panel.ng-animating{pointer-events:none}.cdk-high-contrast-active .mat-menu-panel{outline:solid 1px}.mat-menu-content:not(:empty){padding-top:8px;padding-bottom:8px}.mat-menu-item{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;line-height:48px;height:48px;padding:0 16px;text-align:left;text-decoration:none;max-width:100%;position:relative}.mat-menu-item::-moz-focus-inner{border:0}.mat-menu-item[disabled]{cursor:default}[dir=rtl] .mat-menu-item{text-align:right}.mat-menu-item .mat-icon{margin-right:16px;vertical-align:middle}.mat-menu-item .mat-icon svg{vertical-align:top}[dir=rtl] .mat-menu-item .mat-icon{margin-left:16px;margin-right:0}.mat-menu-item[disabled]{pointer-events:none}.cdk-high-contrast-active .mat-menu-item{margin-top:1px}.cdk-high-contrast-active .mat-menu-item.cdk-program-focused,.cdk-high-contrast-active .mat-menu-item.cdk-keyboard-focused,.cdk-high-contrast-active .mat-menu-item-highlighted{outline:dotted 1px}.mat-menu-item-submenu-trigger{padding-right:32px}[dir=rtl] .mat-menu-item-submenu-trigger{padding-right:16px;padding-left:32px}.mat-menu-submenu-icon{position:absolute;top:50%;right:16px;transform:translateY(-50%);width:5px;height:10px;fill:currentColor}[dir=rtl] .mat-menu-submenu-icon{right:auto;left:16px;transform:translateY(-50%) scaleX(-1)}.cdk-high-contrast-active .mat-menu-submenu-icon{fill:CanvasText}button.mat-menu-item{width:100%}.mat-menu-item .mat-menu-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}\\n\"],encapsulation:2,data:{animation:[MX.transformMenu,MX.fadeInItems]},changeDetection:0}),t})();const BX=new Qi(\"mat-menu-scroll-strategy\"),NX={provide:BX,deps:[uA],useFactory:function(t){return()=>t.scrollStrategies.reposition()}},zX=Zf({passive:!0});let VX=(()=>{class t{constructor(t,e,i,n,r,s,o,a){this._overlay=t,this._element=e,this._viewContainerRef=i,this._menuItemInstance=s,this._dir=o,this._focusMonitor=a,this._overlayRef=null,this._menuOpen=!1,this._closingActionsSubscription=u.EMPTY,this._hoverSubscription=u.EMPTY,this._menuCloseSubscription=u.EMPTY,this._handleTouchStart=t=>{km(t)||(this._openedBy=\"touch\")},this._openedBy=void 0,this._ariaHaspopup=!0,this.restoreFocus=!0,this.menuOpened=new ph,this.onMenuOpen=this.menuOpened,this.menuClosed=new ph,this.onMenuClose=this.menuClosed,this._scrollStrategy=n,this._parentMaterialMenu=r instanceof FX?r:void 0,e.nativeElement.addEventListener(\"touchstart\",this._handleTouchStart,zX),s&&(s._triggersSubmenu=this.triggersSubmenu())}get _ariaExpanded(){return this.menuOpen||null}get _ariaControl(){return this.menuOpen?this.menu.panelId:null}get _deprecatedMatMenuTriggerFor(){return this.menu}set _deprecatedMatMenuTriggerFor(t){this.menu=t}get menu(){return this._menu}set menu(t){t!==this._menu&&(this._menu=t,this._menuCloseSubscription.unsubscribe(),t&&(this._menuCloseSubscription=t.close.subscribe(t=>{this._destroyMenu(t),(\"click\"===t||\"tab\"===t)&&this._parentMaterialMenu&&this._parentMaterialMenu.closed.emit(t)})))}ngAfterContentInit(){this._checkMenu(),this._handleHover()}ngOnDestroy(){this._overlayRef&&(this._overlayRef.dispose(),this._overlayRef=null),this._element.nativeElement.removeEventListener(\"touchstart\",this._handleTouchStart,zX),this._menuCloseSubscription.unsubscribe(),this._closingActionsSubscription.unsubscribe(),this._hoverSubscription.unsubscribe()}get menuOpen(){return this._menuOpen}get dir(){return this._dir&&\"rtl\"===this._dir.value?\"rtl\":\"ltr\"}triggersSubmenu(){return!(!this._menuItemInstance||!this._parentMaterialMenu)}toggleMenu(){return this._menuOpen?this.closeMenu():this.openMenu()}openMenu(){if(this._menuOpen)return;this._checkMenu();const t=this._createOverlay(),e=t.getConfig();this._setPosition(e.positionStrategy),e.hasBackdrop=null==this.menu.hasBackdrop?!this.triggersSubmenu():this.menu.hasBackdrop,t.attach(this._getPortal()),this.menu.lazyContent&&this.menu.lazyContent.attach(this.menuData),this._closingActionsSubscription=this._menuClosingActions().subscribe(()=>this.closeMenu()),this._initMenu(),this.menu instanceof FX&&this.menu._startAnimation()}closeMenu(){this.menu.close.emit()}focus(t,e){this._focusMonitor&&t?this._focusMonitor.focusVia(this._element,t,e):this._element.nativeElement.focus(e)}updatePosition(){var t;null===(t=this._overlayRef)||void 0===t||t.updatePosition()}_destroyMenu(t){if(!this._overlayRef||!this.menuOpen)return;const e=this.menu;this._closingActionsSubscription.unsubscribe(),this._overlayRef.detach(),this.restoreFocus&&(\"keydown\"===t||!this._openedBy||!this.triggersSubmenu())&&this.focus(this._openedBy),this._openedBy=void 0,e instanceof FX?(e._resetAnimation(),e.lazyContent?e._animationDone.pipe(pf(t=>\"void\"===t.toState),_f(1),Mf(e.lazyContent._attached)).subscribe({next:()=>e.lazyContent.detach(),complete:()=>this._setIsMenuOpen(!1)}):this._setIsMenuOpen(!1)):(this._setIsMenuOpen(!1),e.lazyContent&&e.lazyContent.detach())}_initMenu(){this.menu.parentMenu=this.triggersSubmenu()?this._parentMaterialMenu:void 0,this.menu.direction=this.dir,this._setMenuElevation(),this.menu.focusFirstItem(this._openedBy||\"program\"),this._setIsMenuOpen(!0)}_setMenuElevation(){if(this.menu.setElevation){let t=0,e=this.menu.parentMenu;for(;e;)t++,e=e.parentMenu;this.menu.setElevation(t)}}_setIsMenuOpen(t){this._menuOpen=t,this._menuOpen?this.menuOpened.emit():this.menuClosed.emit(),this.triggersSubmenu()&&this._menuItemInstance._setHighlighted(t)}_checkMenu(){}_createOverlay(){if(!this._overlayRef){const t=this._getOverlayConfig();this._subscribeToPositions(t.positionStrategy),this._overlayRef=this._overlay.create(t),this._overlayRef.keydownEvents().subscribe()}return this._overlayRef}_getOverlayConfig(){return new qg({positionStrategy:this._overlay.position().flexibleConnectedTo(this._element).withLockedPosition().withGrowAfterOpen().withTransformOriginOn(\".mat-menu-panel, .mat-mdc-menu-panel\"),backdropClass:this.menu.backdropClass||\"cdk-overlay-transparent-backdrop\",panelClass:this.menu.overlayPanelClass,scrollStrategy:this._scrollStrategy(),direction:this._dir})}_subscribeToPositions(t){this.menu.setPositionClasses&&t.positionChanges.subscribe(t=>{this.menu.setPositionClasses(\"start\"===t.connectionPair.overlayX?\"after\":\"before\",\"top\"===t.connectionPair.overlayY?\"below\":\"above\")})}_setPosition(t){let[e,i]=\"before\"===this.menu.xPosition?[\"end\",\"start\"]:[\"start\",\"end\"],[n,r]=\"above\"===this.menu.yPosition?[\"bottom\",\"top\"]:[\"top\",\"bottom\"],[s,o]=[n,r],[a,l]=[e,i],c=0;this.triggersSubmenu()?(l=e=\"before\"===this.menu.xPosition?\"start\":\"end\",i=a=\"end\"===e?\"start\":\"end\",c=\"bottom\"===n?8:-8):this.menu.overlapTrigger||(s=\"top\"===n?\"bottom\":\"top\",o=\"top\"===r?\"bottom\":\"top\"),t.withPositions([{originX:e,originY:s,overlayX:a,overlayY:n,offsetY:c},{originX:i,originY:s,overlayX:l,overlayY:n,offsetY:c},{originX:e,originY:o,overlayX:a,overlayY:r,offsetY:-c},{originX:i,originY:o,overlayX:l,overlayY:r,offsetY:-c}])}_menuClosingActions(){const t=this._overlayRef.backdropClick(),e=this._overlayRef.detachments();return q(t,this._parentMaterialMenu?this._parentMaterialMenu.closed:Xp(),this._parentMaterialMenu?this._parentMaterialMenu._hovered().pipe(pf(t=>t!==this._menuItemInstance),pf(()=>this._menuOpen)):Xp(),e)}_handleMousedown(t){Cm(t)||(this._openedBy=0===t.button?\"mouse\":void 0,this.triggersSubmenu()&&t.preventDefault())}_handleKeydown(t){const e=t.keyCode;(13===e||32===e)&&(this._openedBy=\"keyboard\"),this.triggersSubmenu()&&(39===e&&\"ltr\"===this.dir||37===e&&\"rtl\"===this.dir)&&(this._openedBy=\"keyboard\",this.openMenu())}_handleClick(t){this.triggersSubmenu()?(t.stopPropagation(),this.openMenu()):this.toggleMenu()}_handleHover(){!this.triggersSubmenu()||!this._parentMaterialMenu||(this._hoverSubscription=this._parentMaterialMenu._hovered().pipe(pf(t=>t===this._menuItemInstance&&!t.disabled),I$(0,Qm)).subscribe(()=>{this._openedBy=\"mouse\",this.menu instanceof FX&&this.menu._isAnimating?this.menu._animationDone.pipe(_f(1),I$(0,Qm),Mf(this._parentMaterialMenu._hovered())).subscribe(()=>this.openMenu()):this.openMenu()}))}_getPortal(){return(!this._portal||this._portal.templateRef!==this.menu.templateRef)&&(this._portal=new Up(this.menu.templateRef,this._viewContainerRef)),this._portal}}return t.\\u0275fac=function(e){return new(e||t)(Ta(uA),Ta(Jl),Ta(Bc),Ta(BX),Ta(IX,8),Ta(PX,10),Ta(xg,8),Ta(Bm))},t.\\u0275dir=Xt({type:t,hostVars:3,hostBindings:function(t,e){1&t&&$a(\"mousedown\",function(t){return e._handleMousedown(t)})(\"keydown\",function(t){return e._handleKeydown(t)})(\"click\",function(t){return e._handleClick(t)}),2&t&&ta(\"aria-haspopup\",e._ariaHaspopup)(\"aria-expanded\",e._ariaExpanded)(\"aria-controls\",e._ariaControl)},inputs:{restoreFocus:[\"matMenuTriggerRestoreFocus\",\"restoreFocus\"],_deprecatedMatMenuTriggerFor:[\"mat-menu-trigger-for\",\"_deprecatedMatMenuTriggerFor\"],menu:[\"matMenuTriggerFor\",\"menu\"],menuData:[\"matMenuTriggerData\",\"menuData\"]},outputs:{menuOpened:\"menuOpened\",onMenuOpen:\"onMenuOpen\",menuClosed:\"menuClosed\",onMenuClose:\"onMenuClose\"}}),t})(),jX=(()=>{class t extends VX{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"mat-menu-trigger-for\",\"\"],[\"\",\"matMenuTriggerFor\",\"\"]],hostAttrs:[1,\"mat-menu-trigger\"],exportAs:[\"matMenuTrigger\"],features:[Vo]}),t})(),$X=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({providers:[NX],imports:[[Jd,_y,Ky,AA],Dg,_y]}),t})(),UX=(()=>{class t extends Lq{constructor(t){super(),this.editZoneService=t,this.saveEmitter=new ph,this.cancelEmitter=new ph,this.isZoneValid=!1,this.save=()=>Vp(this,void 0,void 0,function*(){if(this.isZoneValid){const t=yield this.editZoneService.saveEditedZone();this.saveEmitter.next(t)}})}ngOnInit(){this.editZoneService.startEditing(this.initialZone?Uj(this.initialZone):function(t={}){var e,i;return Object.assign(Object.assign({},t),{name:null!==(e=t.name)&&void 0!==e?e:\"\",h3indexes:null!==(i=t.h3indexes)&&void 0!==i?i:[]})}()),this.subscriptions.push(this.editZoneService.editedZone$.subscribe(t=>{this.zone=t,this.isZoneValid=function(t){return!!t&&t.name&&t.h3indexes.length>0&&t.h3indexes.length<=130}(t)}))}updateZoneName(t){this.editZoneService.updateZoneName(t)}cancel(){this.editZoneService.cancelEditing(),this.cancelEmitter.next()}}return t.\\u0275fac=function(e){return new(e||t)(Ta(jZ))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-zone-form\"]],inputs:{initialZone:\"initialZone\"},outputs:{saveEmitter:\"save\",cancelEmitter:\"cancel\"},features:[Vo],decls:8,vars:3,consts:[[1,\"u-flex\",\"ml-2\",\"auto-width\"],[\"matInput\",\"\",\"placeholder\",\"Nom de la zone\",3,\"ngModel\",\"ngModelChange\",\"keyup.enter\"],[\"mat-button\",\"\",\"title\",\"Enregistrer\",3,\"app-async-action\",\"disabled\"],[\"mat-button\",\"\",\"title\",\"Annuler\",3,\"click\"]],template:function(t,e){1&t&&(Pa(0,\"mat-form-field\",0),Pa(1,\"input\",1),$a(\"ngModelChange\",function(t){return e.updateZoneName(t)})(\"keyup.enter\",function(){return e.save()}),Da(),Da(),Pa(2,\"button\",2),Pa(3,\"mat-icon\"),bl(4,\"check\"),Da(),Da(),Pa(5,\"button\",3),$a(\"click\",function(){return e.cancel()}),Pa(6,\"mat-icon\"),bl(7,\"cancel\"),Da(),Da()),2&t&&(Ss(1),Ia(\"ngModel\",e.zone.name),Ss(1),Ia(\"app-async-action\",e.save)(\"disabled\",!e.isZoneValid))},directives:[tS,hS,Mb,aw,Vw,vb,cW,Yk],styles:[\"[_nghost-%COMP%]{display:flex}\"]}),t})();function HX(t,e){if(1&t){const t=Na();Pa(0,\"app-zone-form\",2),$a(\"save\",function(e){return Fe(t),Wa().updateZone(e)})(\"cancel\",function(){return Fe(t),Wa().hideEditForm()}),Da()}2&t&&Ia(\"initialZone\",Wa().zone)}function GX(t,e){if(1&t){const t=Na();Pa(0,\"button\",3),$a(\"click\",function(){return Fe(t),Wa().locate()}),bl(1),Da(),Pa(2,\"button\",4),$a(\"click\",function(){return Fe(t),Wa().showEditForm()}),Pa(3,\"mat-icon\"),bl(4,\"edit\"),Da(),Da(),Pa(5,\"button\",5),$a(\"click\",function(){return Fe(t),Wa().deleteZone()}),Pa(6,\"mat-icon\"),bl(7,\"delete\"),Da(),Da()}if(2&t){const t=Wa();Ss(1),xl(\" \",t.zone.name,\" \"),Ss(1),Ia(\"disabled\",!t.editable),Ss(3),Ia(\"disabled\",!t.editable||!!t.mustDeleteAssociatedAlertRulesErrorMessage)(\"title\",t.mustDeleteAssociatedAlertRulesErrorMessage)}}let qX=(()=>{class t extends Lq{constructor(t,e,i,n){super(),this.alertRulesService=t,this.mapService=e,this.uiService=i,this.zonesService=n,this.editable=!1,this.trueDeletion=!1,this.deleteEmitter=new ph,this.editMode=!1,this.editedZoneSubscription=new u}ngOnInit(){this.ensureMandatoryInputParams(\"zone\");const t=this.alertRulesService.alertRulesNamesByZoneId[this.zone.id]||[];this.mustDeleteAssociatedAlertRulesErrorMessage=this.trueDeletion&&t.length>0?`Cette zone est utilis\\xe9e par les r\\xe8gles suivantes : ${t.join(\", \")}. Veuillez supprimer la zone de ces r\\xe8gles avant de pouvoir supprimer cette zone.`:\"\"}locate(){this.mapService.fitOn(rH(this.zone.h3indexes))}showEditForm(){this.editMode=!0,this.locate()}hideEditForm(){this.editMode=!1}updateZone(t){Object.assign(this.zone,t),this.hideEditForm()}deleteZone(){this.trueDeletion?this.uiService.confirm({title:\"Suppression\",message:\"Une fois supprim\\xe9e, cette zone ne sera plus accessible et sera supprim\\xe9e de toute les r\\xe8gles qui l'utilisent. Confirmez-vous la suppression de cette zone ?\",action:t=>Vp(this,void 0,void 0,function*(){t&&(yield this.zonesService.deleteZone(this.zone.id),this.deleteEmitter.next(null))})}):this.deleteEmitter.next(null)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(hH),Ta(T$),Ta(AU),Ta(lH))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-zone-item\"]],inputs:{zone:\"zone\",editable:\"editable\",trueDeletion:\"trueDeletion\"},outputs:{deleteEmitter:\"delete\"},features:[Vo],decls:3,vars:2,consts:[[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[1,\"u-flex\",3,\"initialZone\",\"save\",\"cancel\"],[\"mat-button\",\"\",\"title\",\"Visualiser la zone\",1,\"u-flex\",3,\"click\"],[\"mat-button\",\"\",\"title\",\"\\xc9diter la zone\",3,\"disabled\",\"click\"],[\"mat-button\",\"\",\"title\",\"Supprimer la zone\",3,\"disabled\",\"title\",\"click\"]],template:function(t,e){if(1&t&&(na(0,HX,1,1,\"ng-template\",0),na(1,GX,8,4,\"ng-template\",null,1,Ph)),2&t){const t=ra(2);Ia(\"ngIf\",e.editMode)(\"ngIfElse\",t)}},directives:[Bd,UX,vb,Yk],styles:[\"[_nghost-%COMP%]{display:flex}\"]}),t})();const WX=[\"*\"],YX=[[[\"\",\"mat-list-avatar\",\"\"],[\"\",\"mat-list-icon\",\"\"],[\"\",\"matListAvatar\",\"\"],[\"\",\"matListIcon\",\"\"]],[[\"\",\"mat-line\",\"\"],[\"\",\"matLine\",\"\"]],\"*\"],ZX=[\"[mat-list-avatar], [mat-list-icon], [matListAvatar], [matListIcon]\",\"[mat-line], [matLine]\",\"*\"],XX=yy(wy(class{})),KX=wy(class{}),QX=new Qi(\"MatList\"),JX=new Qi(\"MatNavList\");let tK=(()=>{class t extends XX{constructor(t){super(),this._elementRef=t,this._stateChanges=new S,\"action-list\"===this._getListType()&&t.nativeElement.classList.add(\"mat-action-list\")}_getListType(){const t=this._elementRef.nativeElement.nodeName.toLowerCase();return\"mat-list\"===t?\"list\":\"mat-action-list\"===t?\"action-list\":null}ngOnChanges(){this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete()}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl))},t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-list\"],[\"mat-action-list\"]],hostAttrs:[1,\"mat-list\",\"mat-list-base\"],inputs:{disableRipple:\"disableRipple\",disabled:\"disabled\"},exportAs:[\"matList\"],features:[Gl([{provide:QX,useExisting:t}]),Vo,ce],ngContentSelectors:WX,decls:1,vars:0,template:function(t,e){1&t&&(Za(),Xa(0))},styles:['.mat-subheader{display:flex;box-sizing:border-box;padding:16px;align-items:center}.mat-list-base .mat-subheader{margin:0}.mat-list-base{padding-top:8px;display:block;-webkit-tap-highlight-color:transparent}.mat-list-base .mat-subheader{height:48px;line-height:16px}.mat-list-base .mat-subheader:first-child{margin-top:-8px}.mat-list-base .mat-list-item,.mat-list-base .mat-list-option{display:block;height:48px;-webkit-tap-highlight-color:transparent;width:100%;padding:0}.mat-list-base .mat-list-item .mat-list-item-content,.mat-list-base .mat-list-option .mat-list-item-content{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;padding:0 16px;position:relative;height:inherit}.mat-list-base .mat-list-item .mat-list-item-content-reverse,.mat-list-base .mat-list-option .mat-list-item-content-reverse{display:flex;align-items:center;padding:0 16px;flex-direction:row-reverse;justify-content:space-around}.mat-list-base .mat-list-item .mat-list-item-ripple,.mat-list-base .mat-list-option .mat-list-item-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-list-base .mat-list-item.mat-list-item-with-avatar,.mat-list-base .mat-list-option.mat-list-item-with-avatar{height:56px}.mat-list-base .mat-list-item.mat-2-line,.mat-list-base .mat-list-option.mat-2-line{height:72px}.mat-list-base .mat-list-item.mat-3-line,.mat-list-base .mat-list-option.mat-3-line{height:88px}.mat-list-base .mat-list-item.mat-multi-line,.mat-list-base .mat-list-option.mat-multi-line{height:auto}.mat-list-base .mat-list-item.mat-multi-line .mat-list-item-content,.mat-list-base .mat-list-option.mat-multi-line .mat-list-item-content{padding-top:16px;padding-bottom:16px}.mat-list-base .mat-list-item .mat-list-text,.mat-list-base .mat-list-option .mat-list-text{display:flex;flex-direction:column;flex:auto;box-sizing:border-box;overflow:hidden;padding:0}.mat-list-base .mat-list-item .mat-list-text>*,.mat-list-base .mat-list-option .mat-list-text>*{margin:0;padding:0;font-weight:normal;font-size:inherit}.mat-list-base .mat-list-item .mat-list-text:empty,.mat-list-base .mat-list-option .mat-list-text:empty{display:none}.mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:0;padding-left:16px}[dir=rtl] .mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:0}.mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-left:0;padding-right:16px}[dir=rtl] .mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-right:0;padding-left:16px}.mat-list-base .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:16px}.mat-list-base .mat-list-item .mat-list-avatar,.mat-list-base .mat-list-option .mat-list-avatar{flex-shrink:0;width:40px;height:40px;border-radius:50%;object-fit:cover}.mat-list-base .mat-list-item .mat-list-avatar~.mat-divider-inset,.mat-list-base .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:72px;width:calc(100% - 72px)}[dir=rtl] .mat-list-base .mat-list-item .mat-list-avatar~.mat-divider-inset,[dir=rtl] .mat-list-base .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:auto;margin-right:72px}.mat-list-base .mat-list-item .mat-list-icon,.mat-list-base .mat-list-option .mat-list-icon{flex-shrink:0;width:24px;height:24px;font-size:24px;box-sizing:content-box;border-radius:50%;padding:4px}.mat-list-base .mat-list-item .mat-list-icon~.mat-divider-inset,.mat-list-base .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:64px;width:calc(100% - 64px)}[dir=rtl] .mat-list-base .mat-list-item .mat-list-icon~.mat-divider-inset,[dir=rtl] .mat-list-base .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:auto;margin-right:64px}.mat-list-base .mat-list-item .mat-divider,.mat-list-base .mat-list-option .mat-divider{position:absolute;bottom:0;left:0;width:100%;margin:0}[dir=rtl] .mat-list-base .mat-list-item .mat-divider,[dir=rtl] .mat-list-base .mat-list-option .mat-divider{margin-left:auto;margin-right:0}.mat-list-base .mat-list-item .mat-divider.mat-divider-inset,.mat-list-base .mat-list-option .mat-divider.mat-divider-inset{position:absolute}.mat-list-base[dense]{padding-top:4px;display:block}.mat-list-base[dense] .mat-subheader{height:40px;line-height:8px}.mat-list-base[dense] .mat-subheader:first-child{margin-top:-4px}.mat-list-base[dense] .mat-list-item,.mat-list-base[dense] .mat-list-option{display:block;height:40px;-webkit-tap-highlight-color:transparent;width:100%;padding:0}.mat-list-base[dense] .mat-list-item .mat-list-item-content,.mat-list-base[dense] .mat-list-option .mat-list-item-content{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;padding:0 16px;position:relative;height:inherit}.mat-list-base[dense] .mat-list-item .mat-list-item-content-reverse,.mat-list-base[dense] .mat-list-option .mat-list-item-content-reverse{display:flex;align-items:center;padding:0 16px;flex-direction:row-reverse;justify-content:space-around}.mat-list-base[dense] .mat-list-item .mat-list-item-ripple,.mat-list-base[dense] .mat-list-option .mat-list-item-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar{height:48px}.mat-list-base[dense] .mat-list-item.mat-2-line,.mat-list-base[dense] .mat-list-option.mat-2-line{height:60px}.mat-list-base[dense] .mat-list-item.mat-3-line,.mat-list-base[dense] .mat-list-option.mat-3-line{height:76px}.mat-list-base[dense] .mat-list-item.mat-multi-line,.mat-list-base[dense] .mat-list-option.mat-multi-line{height:auto}.mat-list-base[dense] .mat-list-item.mat-multi-line .mat-list-item-content,.mat-list-base[dense] .mat-list-option.mat-multi-line .mat-list-item-content{padding-top:16px;padding-bottom:16px}.mat-list-base[dense] .mat-list-item .mat-list-text,.mat-list-base[dense] .mat-list-option .mat-list-text{display:flex;flex-direction:column;flex:auto;box-sizing:border-box;overflow:hidden;padding:0}.mat-list-base[dense] .mat-list-item .mat-list-text>*,.mat-list-base[dense] .mat-list-option .mat-list-text>*{margin:0;padding:0;font-weight:normal;font-size:inherit}.mat-list-base[dense] .mat-list-item .mat-list-text:empty,.mat-list-base[dense] .mat-list-option .mat-list-text:empty{display:none}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:0;padding-left:16px}[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:0}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-left:0;padding-right:16px}[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-right:0;padding-left:16px}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:16px}.mat-list-base[dense] .mat-list-item .mat-list-avatar,.mat-list-base[dense] .mat-list-option .mat-list-avatar{flex-shrink:0;width:36px;height:36px;border-radius:50%;object-fit:cover}.mat-list-base[dense] .mat-list-item .mat-list-avatar~.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:68px;width:calc(100% - 68px)}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-list-avatar~.mat-divider-inset,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:auto;margin-right:68px}.mat-list-base[dense] .mat-list-item .mat-list-icon,.mat-list-base[dense] .mat-list-option .mat-list-icon{flex-shrink:0;width:20px;height:20px;font-size:20px;box-sizing:content-box;border-radius:50%;padding:4px}.mat-list-base[dense] .mat-list-item .mat-list-icon~.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:60px;width:calc(100% - 60px)}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-list-icon~.mat-divider-inset,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:auto;margin-right:60px}.mat-list-base[dense] .mat-list-item .mat-divider,.mat-list-base[dense] .mat-list-option .mat-divider{position:absolute;bottom:0;left:0;width:100%;margin:0}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-divider,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-divider{margin-left:auto;margin-right:0}.mat-list-base[dense] .mat-list-item .mat-divider.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-divider.mat-divider-inset{position:absolute}.mat-nav-list a{text-decoration:none;color:inherit}.mat-nav-list .mat-list-item{cursor:pointer;outline:none}mat-action-list button{background:none;color:inherit;border:none;font:inherit;outline:inherit;-webkit-tap-highlight-color:transparent;text-align:left}[dir=rtl] mat-action-list button{text-align:right}mat-action-list button::-moz-focus-inner{border:0}mat-action-list .mat-list-item{cursor:pointer;outline:inherit}.mat-list-option:not(.mat-list-item-disabled){cursor:pointer;outline:none}.mat-list-item-disabled{pointer-events:none}.cdk-high-contrast-active .mat-list-item-disabled{opacity:.5}.cdk-high-contrast-active :host .mat-list-item-disabled{opacity:.5}.cdk-high-contrast-active .mat-selection-list:focus{outline-style:dotted}.cdk-high-contrast-active .mat-list-option:hover,.cdk-high-contrast-active .mat-list-option:focus,.cdk-high-contrast-active .mat-nav-list .mat-list-item:hover,.cdk-high-contrast-active .mat-nav-list .mat-list-item:focus,.cdk-high-contrast-active mat-action-list .mat-list-item:hover,.cdk-high-contrast-active mat-action-list .mat-list-item:focus{outline:dotted 1px;z-index:1}.cdk-high-contrast-active .mat-list-single-selected-option::after{content:\"\";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}.cdk-high-contrast-active [dir=rtl] .mat-list-single-selected-option::after{right:auto;left:16px}@media(hover: none){.mat-list-option:not(.mat-list-single-selected-option):not(.mat-list-item-disabled):hover,.mat-nav-list .mat-list-item:not(.mat-list-item-disabled):hover,.mat-action-list .mat-list-item:not(.mat-list-item-disabled):hover{background:none}}\\n'],encapsulation:2,changeDetection:0}),t})(),eK=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"mat-list-avatar\",\"\"],[\"\",\"matListAvatar\",\"\"]],hostAttrs:[1,\"mat-list-avatar\"]}),t})(),iK=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"mat-list-icon\",\"\"],[\"\",\"matListIcon\",\"\"]],hostAttrs:[1,\"mat-list-icon\"]}),t})(),nK=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"mat-subheader\",\"\"],[\"\",\"matSubheader\",\"\"]],hostAttrs:[1,\"mat-subheader\"]}),t})(),rK=(()=>{class t extends KX{constructor(t,e,i,n){super(),this._element=t,this._isInteractiveList=!1,this._destroyed=new S,this._disabled=!1,this._isInteractiveList=!!(i||n&&\"action-list\"===n._getListType()),this._list=i||n;const r=this._getHostElement();\"button\"===r.nodeName.toLowerCase()&&!r.hasAttribute(\"type\")&&r.setAttribute(\"type\",\"button\"),this._list&&this._list._stateChanges.pipe(Mf(this._destroyed)).subscribe(()=>{e.markForCheck()})}get disabled(){return this._disabled||!(!this._list||!this._list.disabled)}set disabled(t){this._disabled=Of(t)}ngAfterContentInit(){!function(t,e,i=\"mat\"){t.changes.pipe(og(t)).subscribe(({length:t})=>{jy(e,`${i}-2-line`,!1),jy(e,`${i}-3-line`,!1),jy(e,`${i}-multi-line`,!1),2===t||3===t?jy(e,`${i}-${t}-line`,!0):t>3&&jy(e,`${i}-multi-line`,!0)})}(this._lines,this._element)}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_isRippleDisabled(){return!this._isInteractiveList||this.disableRipple||!(!this._list||!this._list.disableRipple)}_getHostElement(){return this._element.nativeElement}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(Cc),Ta(JX,8),Ta(QX,8))},t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-list-item\"],[\"a\",\"mat-list-item\",\"\"],[\"button\",\"mat-list-item\",\"\"]],contentQueries:function(t,e,i){if(1&t&&(Eh(i,eK,5),Eh(i,iK,5),Eh(i,Vy,5)),2&t){let t;Ch(t=Mh())&&(e._avatar=t.first),Ch(t=Mh())&&(e._icon=t.first),Ch(t=Mh())&&(e._lines=t)}},hostAttrs:[1,\"mat-list-item\",\"mat-focus-indicator\"],hostVars:6,hostBindings:function(t,e){2&t&&ll(\"mat-list-item-disabled\",e.disabled)(\"mat-list-item-avatar\",e._avatar||e._icon)(\"mat-list-item-with-avatar\",e._avatar||e._icon)},inputs:{disableRipple:\"disableRipple\",disabled:\"disabled\"},exportAs:[\"matListItem\"],features:[Vo],ngContentSelectors:ZX,decls:6,vars:2,consts:[[1,\"mat-list-item-content\"],[\"mat-ripple\",\"\",1,\"mat-list-item-ripple\",3,\"matRippleTrigger\",\"matRippleDisabled\"],[1,\"mat-list-text\"]],template:function(t,e){1&t&&(Za(YX),Pa(0,\"div\",0),Ra(1,\"div\",1),Xa(2),Pa(3,\"div\",2),Xa(4,1),Da(),Xa(5,2),Da()),2&t&&(Ss(1),Ia(\"matRippleTrigger\",e._getHostElement())(\"matRippleDisabled\",e._isRippleDisabled()))},directives:[Xy],encapsulation:2,changeDetection:0}),t})(),sK=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({imports:[[$y,Ky,_y,Jy,Jd],$y,_y,Jy,Gq]}),t})();function oK(t,e){1&t&&(Pa(0,\"div\",4),bl(1,\" Ce filtre restreint les alertes \\xe0 certaines zones. \"),Da())}function aK(t,e){1&t&&(Pa(0,\"div\",13),bl(1,\" Au moins une zone est n\\xe9cessaire pour d\\xe9finir la r\\xe8gle. \"),Da())}function lK(t,e){if(1&t){const t=Na();Pa(0,\"app-zone-item\",14),$a(\"delete\",function(){const e=Fe(t).$implicit;return Wa(2).deleteZone(e)}),Da()}if(2&t){const t=e.$implicit,i=Wa(2);Ia(\"zone\",t)(\"editable\",i.zonesEditable)}}function cK(t,e){if(1&t){const t=Na();Pa(0,\"app-zone-form\",15),$a(\"save\",function(e){return Fe(t),Wa(2).addCreatedZone(e)})(\"cancel\",function(){return Fe(t),Wa(2).hideCreateZoneForm()}),Da()}}function hK(t,e){if(1&t){const t=Na();Pa(0,\"button\",16),Pa(1,\"span\"),bl(2,\"\\xa0Ajouter une zone\"),Da(),Da(),Pa(3,\"button\",17),$a(\"click\",function(){return Fe(t),Wa(2).displayCreateZoneForm()}),bl(4,\" Cr\\xe9er une zone \"),Da()}if(2&t){Wa();const t=ra(6),e=Wa();Ia(\"matMenuTriggerFor\",t)(\"disabled\",!e.zonesEditable),Ss(3),Ia(\"disabled\",!e.zonesEditable)}}function uK(t,e){if(1&t){const t=Na();Pa(0,\"button\",18),$a(\"click\",function(){const e=Fe(t).$implicit;return Wa(2).addZone(e)}),bl(1),Da()}if(2&t){const t=e.$implicit;Ss(1),xl(\" \",t.name,\" \")}}function dK(t,e){if(1&t&&(na(0,aK,2,0,\"div\",5),na(1,lK,1,2,\"app-zone-item\",6),Pa(2,\"div\",7),na(3,cK,1,0,\"app-zone-form\",8),na(4,hK,5,3,\"ng-template\",9),Da(),Pa(5,\"mat-menu\",10,11),na(7,uK,2,1,\"button\",12),Da()),2&t){const t=Wa();Ia(\"ngIf\",0===t.criterion.zones.length),Ss(1),Ia(\"ngForOf\",t.criterion.zones)(\"ngForTrackBy\",t.trackById),Ss(2),Ia(\"ngIf\",t.showCreateZoneForm),Ss(1),Ia(\"ngIf\",!t.showCreateZoneForm),Ss(3),Ia(\"ngForOf\",t.availableZones)}}function pK(t,e){if(1&t){const t=Na();Pa(0,\"mat-list-item\"),Pa(1,\"button\",21),$a(\"click\",function(){const e=Fe(t).$implicit;return Wa(2).viewZone(e)}),bl(2),Da(),Da()}if(2&t){const t=e.$implicit;Ss(2),xl(\" \",t.name,\" \")}}function fK(t,e){if(1&t&&(Pa(0,\"mat-list\",19),na(1,pK,3,1,\"mat-list-item\",20),Da()),2&t){const t=Wa();Ss(1),Ia(\"ngForOf\",t.criterion.zones)(\"ngForTrackBy\",t.trackById)}}let mK=(()=>{class t extends Lq{constructor(t,e,i){super(),this.editZoneService=t,this.mapService=e,this.zonesService=i,this.updateZones=new ph,this.availableZones=[],this.showCreateZoneForm=!1,this.zonesEditable=!0,this.usedZonesIds$=new Zp([])}ngOnInit(){this.usedZonesIds$.next(this.criterion.zones.map(t=>t.id)),this.subscriptions.push(LT([this.zonesService.zones$,this.usedZonesIds$]).subscribe(([t,e])=>{this.availableZones=t.filter(t=>!e.includes(t.id))})),this.subscriptions.push(this.usedZonesIds$.pipe(wf(1)).subscribe(()=>{this.updateZones.next(null)})),this.subscriptions.push(this.editZoneService.editedZone$.pipe(Cf(),I$(0)).subscribe(t=>{this.zonesEditable=!t}))}displayCreateZoneForm(){this.showCreateZoneForm=!0}hideCreateZoneForm(){this.showCreateZoneForm=!1}addCreatedZone(t){this.criterion.zones.push(t),this.hideCreateZoneForm(),this.onChange(this.criterion)}viewZone(t){this.mapService.fitOn(rH(t.h3indexes))}deleteZone(t){this.criterion.zones.splice(this.criterion.zones.findIndex(e=>e===t),1),this.usedZonesIds$.next(this.usedZonesIds$.value.filter(e=>e!==t.id)),this.onChange(this.criterion)}addZone(t){this.criterion.zones.push(t),this.usedZonesIds$.next(this.usedZonesIds$.value.concat(t.id)),this.onChange(this.criterion)}trackById(t,e){return e.id}writeValue(t){this.criterion=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){}}return t.\\u0275fac=function(e){return new(e||t)(Ta(jZ),Ta(T$),Ta(lH))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-zone-filter\"]],inputs:{criterion:[\"ngModel\",\"criterion\"],editable:\"editable\"},outputs:{updateZones:\"updateZones\"},features:[Gl([{provide:Cb,useExisting:t,multi:!0}]),Vo],decls:5,vars:4,consts:[[1,\"alert-rule-criterion\"],[\"class\",\"alert-rule-criterion__description\",4,\"ngIf\"],[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[1,\"alert-rule-criterion__description\"],[\"class\",\"alert-rule-criterion__description error-message\",4,\"ngIf\"],[3,\"zone\",\"editable\",\"delete\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[1,\"criterion-content\"],[\"class\",\"u-flex\",3,\"save\",\"cancel\",4,\"ngIf\"],[3,\"ngIf\"],[1,\"add-zones-menu\"],[\"addZonesMenu\",\"matMenu\"],[\"mat-menu-item\",\"\",3,\"click\",4,\"ngFor\",\"ngForOf\"],[1,\"alert-rule-criterion__description\",\"error-message\"],[3,\"zone\",\"editable\",\"delete\"],[1,\"u-flex\",3,\"save\",\"cancel\"],[\"mat-button\",\"\",\"title\",\"Ajouter une zone existante\",3,\"matMenuTriggerFor\",\"disabled\"],[\"mat-button\",\"\",\"title\",\"Cr\\xe9er une nouvelle zone\",3,\"disabled\",\"click\"],[\"mat-menu-item\",\"\",3,\"click\"],[\"dense\",\"\"],[4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[\"mat-button\",\"\",\"title\",\"Visualiser la zone\",1,\"u-flex\",3,\"click\"]],template:function(t,e){if(1&t&&(Pa(0,\"div\",0),na(1,oK,2,0,\"div\",1),na(2,dK,8,6,\"ng-template\",2),na(3,fK,2,2,\"ng-template\",null,3,Ph),Da()),2&t){const t=ra(4);ta(\"data-test\",\"criterion-zone\"),Ss(1),Ia(\"ngIf\",e.editable),Ss(1),Ia(\"ngIf\",e.editable)(\"ngIfElse\",t)}},directives:[Bd,Fd,LX,qX,UX,vb,jX,PX,tK,rK],styles:[\".alert-rule-criterion[_ngcontent-%COMP%]{padding:.5em}.alert-rule-criterion__description[_ngcontent-%COMP%]{margin-bottom:.5em;font-size:14px}.add-zones-menu[_ngcontent-%COMP%]{max-height:256px}\"]}),t})();const gK={speed:{key:\"speed\",title:\"Vitesse\",description:\"Ce crit\\xe8re d\\xe9clenche une alerte si la vitesse du navire est comprise dans un intervalle.\"},erraticRoute:{key:\"erraticRoute\",title:\"Route erratique\",description:\"Ce crit\\xe8re d\\xe9clenche une alerte quand un navire change plusieurs fois de direction dans un intervalle de temps court.\"},transhipment:{key:\"transhipment\",title:\"Transbordement\",description:\"Ce crit\\xe8re d\\xe9clenche une alerte quand deux navires ont des positions tr\\xe8s proches et une vitesse r\\xe9duite pendant un intervalle de temps prolong\\xe9.\"},aisInterruption:{key:\"aisInterruption\",title:\"Coupure AIS\",description:\"Ce crit\\xe8re d\\xe9clenche une alerte si un navire n'\\xe9met plus de donn\\xe9es AIS pendant un intervalle de temps.\"},passageInZone:{key:\"passageInZone\",title:\"Passage dans des zones\",description:\"Ce crit\\xe8re d\\xe9clenche une alerte si un navire passe dans certaines zones. Si plusieurs zones sont choisies, un navire doit \\xeatre pass\\xe9 dans toutes les zones pour d\\xe9clencher une alerte.\"},spoofing:{key:\"spoofing\",title:\"Spoofing AIS\",description:\"Ce crit\\xe8re d\\xe9clenche une alerte si un navire change de nom ou de MMSI en conservant le m\\xeame IMO.\"},identifier:{key:\"identifier\",title:\"Identifiant\",description:\"Ce filtre restreint les alertes aux navires dont les identifiants (nom, MMSI, IMO) correspondent \\xe0 ceux recherch\\xe9s.\"},fleet:{key:\"fleet\",title:\"Flotte\",description:\"Ce filtre restreint les alertes aux navires faisant partie des flottes s\\xe9lectionn\\xe9es.\"},flag:{key:\"flag\",title:\"Pavillon\",description:\"Ce filtre restreint les alertes aux navires dont le pavillon correspond \\xe0 ceux recherch\\xe9s.\"},type:{key:\"type\",title:\"Type de navire\",description:\"Ce filtre restreint les alertes aux navires dont le type du navire correspond \\xe0 ceux recherch\\xe9s.\"},time:{key:\"time\",title:\"P\\xe9riode d'analyse\",soon:!0,description:\"Ce filtre restreint l'analyse \\xe0 une p\\xe9riode de temps.\"},zone:{key:\"zone\",title:\"Zone\",description:\"Ce filtre restreint les alertes \\xe0 certaines zones.\"}};let AK=(()=>{class t{constructor(){this.editable=!1,this.criteriaLabels=gK}get enable(){var t;return null===(t=this.criterion)||void 0===t?void 0:t.enable}set enable(t){this.criterion.enable=t,this.onChange(this.criterion)}writeValue(t){this.criterion=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,inputs:{criterion:[\"ngModel\",\"criterion\"],editable:\"editable\"}}),t})(),vK=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-chip-coming-soon\"]],decls:2,vars:0,consts:[[\"title\",\"Cette fonctionnalit\\xe9 n'est pas encore impl\\xe9ment\\xe9e mais le sera tr\\xe8s bient\\xf4t !\",1,\"chip\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),bl(1,\"Bient\\xf4t\"),Da())},styles:[\".chip[_ngcontent-%COMP%]{display:inline-block;padding:3px 6px;border-radius:8px;font-size:.7em;line-height:1.5em;background-color:#55575f;color:#fff}\"],changeDetection:0}),t})();function _K(t,e){if(1&t){const t=Na();Pa(0,\"mat-slide-toggle\",6),$a(\"ngModelChange\",function(e){return Fe(t),Wa().enableChange.next(e)}),Da()}if(2&t){const t=Wa();Ia(\"name\",t.type.key)(\"title\",t.enable?\"D\\xe9sactiver\":\"Activer\")(\"ngModel\",t.enable)(\"disabled\",!t.editable)}}function yK(t,e){1&t&&Ra(0,\"app-chip-coming-soon\")}function bK(t,e){if(1&t&&(Pa(0,\"div\",7),bl(1),Da()),2&t){const t=Wa();Ss(1),xl(\" \",t.type.description,\" \")}}function wK(t,e){1&t&&Xa(0,0,[\"*ngIf\",\"enable || enable === undefined\"])}const xK=[\"*\"];let SK=(()=>{class t extends Lq{constructor(){super(...arguments),this.enableChange=new ph}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"app-alert-rule-criterion\"]],inputs:{type:\"type\",enable:\"enable\",editable:\"editable\"},outputs:{enableChange:\"enableChange\"},features:[Vo],ngContentSelectors:xK,decls:8,vars:8,consts:[[1,\"alert-rule-criterion\"],[1,\"alert-rule-criterion__title\"],[\"class\",\"alert-rule-criterion__toggle\",\"color\",\"primary\",3,\"name\",\"title\",\"ngModel\",\"disabled\",\"ngModelChange\",4,\"ngIf\"],[1,\"u-flex\"],[4,\"ngIf\"],[\"class\",\"alert-rule-criterion__description\",4,\"ngIf\"],[\"color\",\"primary\",1,\"alert-rule-criterion__toggle\",3,\"name\",\"title\",\"ngModel\",\"disabled\",\"ngModelChange\"],[1,\"alert-rule-criterion__description\"]],template:function(t,e){1&t&&(Za(),Pa(0,\"div\",0),Pa(1,\"div\",1),bl(2),na(3,_K,1,4,\"mat-slide-toggle\",2),Ra(4,\"div\",3),na(5,yK,1,0,\"app-chip-coming-soon\",4),Da(),na(6,bK,2,1,\"div\",5),na(7,wK,1,0,\"ng-content\",4),Da()),2&t&&(ll(\"alert-rule-criterion--active\",e.enable),ta(\"data-test\",\"criterion-\"+e.type.key),Ss(2),xl(\" \",e.type.title,\" \"),Ss(1),Ia(\"ngIf\",void 0!==e.enable),Ss(2),Ia(\"ngIf\",e.type.soon),Ss(1),Ia(\"ngIf\",e.editable),Ss(1),Ia(\"ngIf\",e.enable||void 0===e.enable))},directives:[Bd,bX,aw,Vw,vK],styles:[\".alert-rule-criterion[_ngcontent-%COMP%]{padding:.5em}.alert-rule-criterion--active[_ngcontent-%COMP%]{background-color:#e6e9f7}.alert-rule-criterion__title[_ngcontent-%COMP%]{display:flex;margin:0;padding:.5em;color:#1515a6;font-size:18px}.alert-rule-criterion__toggle[_ngcontent-%COMP%]{margin-left:.5em}.alert-rule-criterion__description[_ngcontent-%COMP%]{margin-bottom:.5em;font-size:14px}\"],changeDetection:0}),t})(),CK=(()=>{class t extends AK{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"app-ais-interruption-criterion\"]],features:[Gl([{provide:Cb,useExisting:t,multi:!0}]),Vo],decls:1,vars:3,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"]],template:function(t,e){1&t&&(Pa(0,\"app-alert-rule-criterion\",0),$a(\"enableChange\",function(t){return e.enable=t}),Da()),2&t&&Ia(\"type\",e.criteriaLabels.aisInterruption)(\"enable\",e.enable)(\"editable\",e.editable)},directives:[SK],encapsulation:2,changeDetection:0}),t})(),kK=(()=>{class t extends AK{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"app-transhipment-criterion\"]],features:[Gl([{provide:Cb,useExisting:t,multi:!0}]),Vo],decls:1,vars:3,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"]],template:function(t,e){1&t&&(Pa(0,\"app-alert-rule-criterion\",0),$a(\"enableChange\",function(t){return e.enable=t}),Da()),2&t&&Ia(\"type\",e.criteriaLabels.transhipment)(\"enable\",e.enable)(\"editable\",e.editable)},directives:[SK],encapsulation:2,changeDetection:0}),t})(),EK=(()=>{class t extends AK{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"app-erratic-route-criterion\"]],features:[Gl([{provide:Cb,useExisting:t,multi:!0}]),Vo],decls:1,vars:3,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"]],template:function(t,e){1&t&&(Pa(0,\"app-alert-rule-criterion\",0),$a(\"enableChange\",function(t){return e.enable=t}),Da()),2&t&&Ia(\"type\",e.criteriaLabels.erraticRoute)(\"enable\",e.enable)(\"editable\",e.editable)},directives:[SK],encapsulation:2,changeDetection:0}),t})();function MK(t,e){if(1&t){const t=Na();Pa(0,\"div\",4),Pa(1,\"ngx-slider\",5),$a(\"valueChange\",function(e){return Fe(t),Wa(2).criterion.min=e})(\"highValueChange\",function(e){return Fe(t),Wa(2).criterion.max=e}),Da(),Da()}if(2&t){const t=Wa(2);Ss(1),Ia(\"value\",t.criterion.min)(\"highValue\",t.criterion.max)(\"options\",t.speedSliderOptions)}}function TK(t,e){if(1&t&&bl(0),2&t){const t=Wa(2);Sl(\" Vitesse : entre \",t.criterion.min,\" et \",t.criterion.max,\" \")}}function IK(t,e){if(1&t&&(na(0,MK,2,3,\"ng-template\",2),na(1,TK,1,2,\"ng-template\",null,3,Ph)),2&t){const t=ra(2);Ia(\"ngIf\",Wa().editable)(\"ngIfElse\",t)}}let OK=(()=>{class t extends AK{constructor(){super(...arguments),this.speedSliderOptions={floor:0,ceil:100,animate:!1}}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"app-speed-criterion\"]],features:[Gl([{provide:Cb,useExisting:t,multi:!0}]),Vo],decls:2,vars:4,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"],[3,\"ngIf\"],[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[1,\"criterion-content\",\"app-slider\"],[\"name\",\"speed\",3,\"value\",\"highValue\",\"options\",\"valueChange\",\"highValueChange\"]],template:function(t,e){1&t&&(Pa(0,\"app-alert-rule-criterion\",0),$a(\"enableChange\",function(t){return e.enable=t}),na(1,IK,3,2,\"ng-template\",1),Da()),2&t&&(Ia(\"type\",e.criteriaLabels.speed)(\"enable\",e.enable)(\"editable\",e.editable),Ss(1),Ia(\"ngIf\",e.criterion.enable))},directives:[SK,Bd,cT],encapsulation:2,changeDetection:0}),t})();function PK(t,e,i){for(let n in e)if(e.hasOwnProperty(n)){const r=e[n];r?t.setProperty(n,r,(null==i?void 0:i.has(n))?\"important\":\"\"):t.removeProperty(n)}return t}function DK(t,e){const i=e?\"\":\"none\";PK(t.style,{\"touch-action\":e?\"\":\"none\",\"-webkit-user-drag\":e?\"\":\"none\",\"-webkit-tap-highlight-color\":e?\"\":\"transparent\",\"user-select\":i,\"-ms-user-select\":i,\"-webkit-user-select\":i,\"-moz-user-select\":i})}function RK(t,e,i){PK(t.style,{position:e?\"\":\"fixed\",top:e?\"\":\"0\",opacity:e?\"\":\"0\",left:e?\"\":\"-999em\"},i)}function FK(t,e){return e&&\"none\"!=e?t+\" \"+e:t}function LK(t){const e=t.toLowerCase().indexOf(\"ms\")>-1?1:1e3;return parseFloat(t)*e}function BK(t,e){return t.getPropertyValue(e).split(\",\").map(t=>t.trim())}function NK(t){const e=t.getBoundingClientRect();return{top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height}}function zK(t,e,i){const{top:n,bottom:r,left:s,right:o}=t;return i>=n&&i<=r&&e>=s&&e<=o}function VK(t,e,i){t.top+=e,t.bottom=t.top+t.height,t.left+=i,t.right=t.left+t.width}function jK(t,e,i,n){const{top:r,right:s,bottom:o,left:a,width:l,height:c}=t,h=l*e,u=c*e;return n>r-u&&n<o+u&&i>a-h&&i<s+h}class $K{constructor(t,e){this._document=t,this._viewportRuler=e,this.positions=new Map}clear(){this.positions.clear()}cache(t){this.clear(),this.positions.set(this._document,{scrollPosition:this._viewportRuler.getViewportScrollPosition()}),t.forEach(t=>{this.positions.set(t,{scrollPosition:{top:t.scrollTop,left:t.scrollLeft},clientRect:NK(t)})})}handleScroll(t){const e=tm(t),i=this.positions.get(e);if(!i)return null;const n=e===this._document?e.documentElement:e,r=i.scrollPosition;let s,o;if(e===this._document){const t=this._viewportRuler.getViewportScrollPosition();s=t.top,o=t.left}else s=e.scrollTop,o=e.scrollLeft;const a=r.top-s,l=r.left-o;return this.positions.forEach((t,i)=>{t.clientRect&&e!==i&&n.contains(i)&&VK(t.clientRect,a,l)}),r.top=s,r.left=o,{top:a,left:l}}}function UK(t){const e=t.cloneNode(!0),i=e.querySelectorAll(\"[id]\"),n=t.nodeName.toLowerCase();e.removeAttribute(\"id\");for(let r=0;r<i.length;r++)i[r].removeAttribute(\"id\");return\"canvas\"===n?WK(t,e):(\"input\"===n||\"select\"===n||\"textarea\"===n)&&qK(t,e),HK(\"canvas\",t,e,WK),HK(\"input, textarea, select\",t,e,qK),e}function HK(t,e,i,n){const r=e.querySelectorAll(t);if(r.length){const e=i.querySelectorAll(t);for(let t=0;t<r.length;t++)n(r[t],e[t])}}let GK=0;function qK(t,e){\"file\"!==e.type&&(e.value=t.value),\"radio\"===e.type&&e.name&&(e.name=`mat-clone-${e.name}-${GK++}`)}function WK(t,e){const i=e.getContext(\"2d\");if(i)try{i.drawImage(t,0,0)}catch(n){}}const YK=Zf({passive:!0}),ZK=Zf({passive:!1}),XK=new Set([\"position\"]);class KK{constructor(t,e,i,n,r,s){this._config=e,this._document=i,this._ngZone=n,this._viewportRuler=r,this._dragDropRegistry=s,this._passiveTransform={x:0,y:0},this._activeTransform={x:0,y:0},this._hasStartedDragging=!1,this._moveEvents=new S,this._pointerMoveSubscription=u.EMPTY,this._pointerUpSubscription=u.EMPTY,this._scrollSubscription=u.EMPTY,this._resizeSubscription=u.EMPTY,this._boundaryElement=null,this._nativeInteractionsEnabled=!0,this._handles=[],this._disabledHandles=new Set,this._direction=\"ltr\",this.dragStartDelay=0,this._disabled=!1,this.beforeStarted=new S,this.started=new S,this.released=new S,this.ended=new S,this.entered=new S,this.exited=new S,this.dropped=new S,this.moved=this._moveEvents,this._pointerDown=t=>{if(this.beforeStarted.next(),this._handles.length){const e=this._handles.find(e=>{const i=tm(t);return!!i&&(i===e||e.contains(i))});e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,t)}else this.disabled||this._initializeDragSequence(this._rootElement,t)},this._pointerMove=t=>{const e=this._getPointerPositionOnPage(t);if(!this._hasStartedDragging){if(Math.abs(e.x-this._pickupPositionOnPage.x)+Math.abs(e.y-this._pickupPositionOnPage.y)>=this._config.dragStartThreshold){const e=Date.now()>=this._dragStartTime+this._getDragStartDelay(t),i=this._dropContainer;if(!e)return void this._endDragSequence(t);(!i||!i.isDragging()&&!i.isReceiving())&&(t.preventDefault(),this._hasStartedDragging=!0,this._ngZone.run(()=>this._startDragSequence(t)))}return}this._boundaryElement&&(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=(this._preview||this._rootElement).getBoundingClientRect()),t.preventDefault();const i=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(i),this._dropContainer)this._updateActiveDropContainer(i,e);else{const t=this._activeTransform;t.x=i.x-this._pickupPositionOnPage.x+this._passiveTransform.x,t.y=i.y-this._pickupPositionOnPage.y+this._passiveTransform.y,this._applyRootElementTransform(t.x,t.y),\"undefined\"!=typeof SVGElement&&this._rootElement instanceof SVGElement&&this._rootElement.setAttribute(\"transform\",`translate(${t.x} ${t.y})`)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:i,event:t,distance:this._getDragDistance(i),delta:this._pointerDirectionDelta})})},this._pointerUp=t=>{this._endDragSequence(t)},this.withRootElement(t).withParent(e.parentDragRef||null),this._parentPositions=new $K(i,r),s.registerDragItem(this)}get disabled(){return this._disabled||!(!this._dropContainer||!this._dropContainer.disabled)}set disabled(t){const e=Of(t);e!==this._disabled&&(this._disabled=e,this._toggleNativeDragInteractions(),this._handles.forEach(t=>DK(t,e)))}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(t){this._handles=t.map(t=>Lf(t)),this._handles.forEach(t=>DK(t,this.disabled)),this._toggleNativeDragInteractions();const e=new Set;return this._disabledHandles.forEach(t=>{this._handles.indexOf(t)>-1&&e.add(t)}),this._disabledHandles=e,this}withPreviewTemplate(t){return this._previewTemplate=t,this}withPlaceholderTemplate(t){return this._placeholderTemplate=t,this}withRootElement(t){const e=Lf(t);return e!==this._rootElement&&(this._rootElement&&this._removeRootElementListeners(this._rootElement),this._ngZone.runOutsideAngular(()=>{e.addEventListener(\"mousedown\",this._pointerDown,ZK),e.addEventListener(\"touchstart\",this._pointerDown,YK)}),this._initialTransform=void 0,this._rootElement=e),\"undefined\"!=typeof SVGElement&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(t){return this._boundaryElement=t?Lf(t):null,this._resizeSubscription.unsubscribe(),t&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(t){return this._parentDragRef=t,this}dispose(){this._removeRootElementListeners(this._rootElement),this.isDragging()&&tQ(this._rootElement),tQ(this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeSubscriptions(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||\"\",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(t){!this._disabledHandles.has(t)&&this._handles.indexOf(t)>-1&&(this._disabledHandles.add(t),DK(t,!0))}enableHandle(t){this._disabledHandles.has(t)&&(this._disabledHandles.delete(t),DK(t,this.disabled))}withDirection(t){return this._direction=t,this}_withDropContainer(t){this._dropContainer=t}getFreeDragPosition(){const t=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:t.x,y:t.y}}setFreeDragPosition(t){return this._activeTransform={x:0,y:0},this._passiveTransform.x=t.x,this._passiveTransform.y=t.y,this._dropContainer||this._applyRootElementTransform(t.x,t.y),this}withPreviewContainer(t){return this._previewContainer=t,this}_sortFromLastPointerPosition(){const t=this._lastKnownPointerPosition;t&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(t),t)}_removeSubscriptions(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe()}_destroyPreview(){this._preview&&tQ(this._preview),this._previewRef&&this._previewRef.destroy(),this._preview=this._previewRef=null}_destroyPlaceholder(){this._placeholder&&tQ(this._placeholder),this._placeholderRef&&this._placeholderRef.destroy(),this._placeholder=this._placeholderRef=null}_endDragSequence(t){if(this._dragDropRegistry.isDragging(this)&&(this._removeSubscriptions(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),this._hasStartedDragging))if(this.released.next({source:this}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(t),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;const e=this._getPointerPositionOnPage(t);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(t){eQ(t)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();const e=this._dropContainer;if(e){const t=this._rootElement,i=t.parentNode,n=this._placeholder=this._createPlaceholderElement(),r=this._anchor=this._anchor||this._document.createComment(\"\"),s=this._getShadowRoot();i.insertBefore(r,t),this._initialTransform=t.style.transform||\"\",this._preview=this._createPreviewElement(),RK(t,!1,XK),this._document.body.appendChild(i.replaceChild(n,t)),this._getPreviewInsertionPoint(i,s).appendChild(this._preview),this.started.next({source:this}),e.start(),this._initialContainer=e,this._initialIndex=e.getItemIndex(this)}else this.started.next({source:this}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(e?e.getScrollableParents():[])}_initializeDragSequence(t,e){this._parentDragRef&&e.stopPropagation();const i=this.isDragging(),n=eQ(e),r=!n&&0!==e.button,s=this._rootElement,o=tm(e),a=!n&&this._lastTouchEventTime&&this._lastTouchEventTime+800>Date.now(),l=n?km(e):Cm(e);if(o&&o.draggable&&\"mousedown\"===e.type&&e.preventDefault(),i||r||a||l)return;this._handles.length&&(this._rootElementTapHighlight=s.style.webkitTapHighlightColor||\"\",s.style.webkitTapHighlightColor=\"transparent\"),this._hasStartedDragging=this._hasMoved=!1,this._removeSubscriptions(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>this._updateOnScroll(t)),this._boundaryElement&&(this._boundaryRect=NK(this._boundaryElement));const c=this._previewTemplate;this._pickupPositionInElement=c&&c.template&&!c.matchSize?{x:0,y:0}:this._getPointerPositionInElement(t,e);const h=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:h.x,y:h.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(t){RK(this._rootElement,!0,XK),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{const e=this._dropContainer,i=e.getItemIndex(this),n=this._getPointerPositionOnPage(t),r=this._getDragDistance(n),s=e._isOverContainer(n.x,n.y);this.ended.next({source:this,distance:r,dropPoint:n}),this.dropped.next({item:this,currentIndex:i,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:s,distance:r,dropPoint:n}),e.drop(this,i,this._initialIndex,this._initialContainer,s,r,n),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:t,y:e},{x:i,y:n}){let r=this._initialContainer._getSiblingContainerFromPosition(this,t,e);!r&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(t,e)&&(r=this._initialContainer),r&&r!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=r,this._dropContainer.enter(this,t,e,r===this._initialContainer&&r.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:r,currentIndex:r.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(i,n),this._dropContainer._sortItem(this,t,e,this._pointerDirectionDelta),this._applyPreviewTransform(t-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_createPreviewElement(){const t=this._previewTemplate,e=this.previewClass,i=t?t.template:null;let n;if(i&&t){const e=t.matchSize?this._rootElement.getBoundingClientRect():null,r=t.viewContainer.createEmbeddedView(i,t.context);r.detectChanges(),n=iQ(r,this._document),this._previewRef=r,t.matchSize?nQ(n,e):n.style.transform=QK(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else{const t=this._rootElement;n=UK(t),nQ(n,t.getBoundingClientRect()),this._initialTransform&&(n.style.transform=this._initialTransform)}return PK(n.style,{\"pointer-events\":\"none\",margin:\"0\",position:\"fixed\",top:\"0\",left:\"0\",\"z-index\":`${this._config.zIndex||1e3}`},XK),DK(n,!1),n.classList.add(\"cdk-drag-preview\"),n.setAttribute(\"dir\",this._direction),e&&(Array.isArray(e)?e.forEach(t=>n.classList.add(t)):n.classList.add(e)),n}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();const t=this._placeholder.getBoundingClientRect();this._preview.classList.add(\"cdk-drag-animating\"),this._applyPreviewTransform(t.left,t.top);const e=function(t){const e=getComputedStyle(t),i=BK(e,\"transition-property\"),n=i.find(t=>\"transform\"===t||\"all\"===t);if(!n)return 0;const r=i.indexOf(n),s=BK(e,\"transition-duration\"),o=BK(e,\"transition-delay\");return LK(s[r])+LK(o[r])}(this._preview);return 0===e?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(t=>{const i=e=>{var r;(!e||tm(e)===this._preview&&\"transform\"===e.propertyName)&&(null===(r=this._preview)||void 0===r||r.removeEventListener(\"transitionend\",i),t(),clearTimeout(n))},n=setTimeout(i,1.5*e);this._preview.addEventListener(\"transitionend\",i)}))}_createPlaceholderElement(){const t=this._placeholderTemplate,e=t?t.template:null;let i;return e?(this._placeholderRef=t.viewContainer.createEmbeddedView(e,t.context),this._placeholderRef.detectChanges(),i=iQ(this._placeholderRef,this._document)):i=UK(this._rootElement),i.classList.add(\"cdk-drag-placeholder\"),i}_getPointerPositionInElement(t,e){const i=this._rootElement.getBoundingClientRect(),n=t===this._rootElement?null:t,r=n?n.getBoundingClientRect():i,s=eQ(e)?e.targetTouches[0]:e,o=this._getViewportScrollPosition();return{x:r.left-i.left+(s.pageX-r.left-o.left),y:r.top-i.top+(s.pageY-r.top-o.top)}}_getPointerPositionOnPage(t){const e=this._getViewportScrollPosition(),i=eQ(t)?t.touches[0]||t.changedTouches[0]||{pageX:0,pageY:0}:t,n=i.pageX-e.left,r=i.pageY-e.top;if(this._ownerSVGElement){const t=this._ownerSVGElement.getScreenCTM();if(t){const e=this._ownerSVGElement.createSVGPoint();return e.x=n,e.y=r,e.matrixTransform(t.inverse())}}return{x:n,y:r}}_getConstrainedPointerPosition(t){const e=this._dropContainer?this._dropContainer.lockAxis:null;let{x:i,y:n}=this.constrainPosition?this.constrainPosition(t,this):t;if(\"x\"===this.lockAxis||\"x\"===e?n=this._pickupPositionOnPage.y:(\"y\"===this.lockAxis||\"y\"===e)&&(i=this._pickupPositionOnPage.x),this._boundaryRect){const{x:t,y:e}=this._pickupPositionInElement,r=this._boundaryRect,s=this._previewRect,o=r.top+e,a=r.bottom-(s.height-e);i=JK(i,r.left+t,r.right-(s.width-t)),n=JK(n,o,a)}return{x:i,y:n}}_updatePointerDirectionDelta(t){const{x:e,y:i}=t,n=this._pointerDirectionDelta,r=this._pointerPositionAtLastDirectionChange,s=Math.abs(e-r.x),o=Math.abs(i-r.y);return s>this._config.pointerDirectionChangeThreshold&&(n.x=e>r.x?1:-1,r.x=e),o>this._config.pointerDirectionChangeThreshold&&(n.y=i>r.y?1:-1,r.y=i),n}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;const t=this._handles.length>0||!this.isDragging();t!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=t,DK(this._rootElement,t))}_removeRootElementListeners(t){t.removeEventListener(\"mousedown\",this._pointerDown,ZK),t.removeEventListener(\"touchstart\",this._pointerDown,YK)}_applyRootElementTransform(t,e){const i=QK(t,e);null==this._initialTransform&&(this._initialTransform=this._rootElement.style.transform&&\"none\"!=this._rootElement.style.transform?this._rootElement.style.transform:\"\"),this._rootElement.style.transform=FK(i,this._initialTransform)}_applyPreviewTransform(t,e){var i;const n=(null===(i=this._previewTemplate)||void 0===i?void 0:i.template)?void 0:this._initialTransform,r=QK(t,e);this._preview.style.transform=FK(r,n)}_getDragDistance(t){const e=this._pickupPositionOnPage;return e?{x:t.x-e.x,y:t.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:t,y:e}=this._passiveTransform;if(0===t&&0===e||this.isDragging()||!this._boundaryElement)return;const i=this._boundaryElement.getBoundingClientRect(),n=this._rootElement.getBoundingClientRect();if(0===i.width&&0===i.height||0===n.width&&0===n.height)return;const r=i.left-n.left,s=n.right-i.right,o=i.top-n.top,a=n.bottom-i.bottom;i.width>n.width?(r>0&&(t+=r),s>0&&(t-=s)):t=0,i.height>n.height?(o>0&&(e+=o),a>0&&(e-=a)):e=0,(t!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:t})}_getDragStartDelay(t){const e=this.dragStartDelay;return\"number\"==typeof e?e:eQ(t)?e.touch:e?e.mouse:0}_updateOnScroll(t){const e=this._parentPositions.handleScroll(t);if(e){const i=tm(t);this._boundaryRect&&(i===this._document||i!==this._boundaryElement&&i.contains(this._boundaryElement))&&VK(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){const t=this._parentPositions.positions.get(this._document);return t?t.scrollPosition:this._viewportRuler.getViewportScrollPosition()}_getShadowRoot(){return void 0===this._cachedShadowRoot&&(this._cachedShadowRoot=Qf(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(t,e){const i=this._previewContainer||\"global\";if(\"parent\"===i)return t;if(\"global\"===i){const t=this._document;return e||t.fullscreenElement||t.webkitFullscreenElement||t.mozFullScreenElement||t.msFullscreenElement||t.body}return Lf(i)}}function QK(t,e){return`translate3d(${Math.round(t)}px, ${Math.round(e)}px, 0)`}function JK(t,e,i){return Math.max(e,Math.min(i,t))}function tQ(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function eQ(t){return\"t\"===t.type[0]}function iQ(t,e){const i=t.rootNodes;if(1===i.length&&i[0].nodeType===e.ELEMENT_NODE)return i[0];const n=e.createElement(\"div\");return i.forEach(t=>n.appendChild(t)),n}function nQ(t,e){t.style.width=`${e.width}px`,t.style.height=`${e.height}px`,t.style.transform=QK(e.left,e.top)}function rQ(t,e,i){const n=sQ(e,t.length-1),r=sQ(i,t.length-1);if(n===r)return;const s=t[n],o=r<n?-1:1;for(let a=n;a!==r;a+=o)t[a]=t[a+o];t[r]=s}function sQ(t,e){return Math.max(0,Math.min(e,t))}class oQ{constructor(t,e,i,n,r){this._dragDropRegistry=e,this._ngZone=n,this._viewportRuler=r,this.disabled=!1,this.sortingDisabled=!1,this.autoScrollDisabled=!1,this.autoScrollStep=2,this.enterPredicate=()=>!0,this.sortPredicate=()=>!0,this.beforeStarted=new S,this.entered=new S,this.exited=new S,this.dropped=new S,this.sorted=new S,this._isDragging=!1,this._itemPositions=[],this._previousSwap={drag:null,delta:0,overlaps:!1},this._draggables=[],this._siblings=[],this._orientation=\"vertical\",this._activeSiblings=new Set,this._direction=\"ltr\",this._viewportScrollSubscription=u.EMPTY,this._verticalScrollDirection=0,this._horizontalScrollDirection=0,this._stopScrollTimers=new S,this._cachedShadowRoot=null,this._startScrollInterval=()=>{this._stopScrolling(),mq(0,qm).pipe(Mf(this._stopScrollTimers)).subscribe(()=>{const t=this._scrollNode,e=this.autoScrollStep;1===this._verticalScrollDirection?lQ(t,-e):2===this._verticalScrollDirection&&lQ(t,e),1===this._horizontalScrollDirection?cQ(t,-e):2===this._horizontalScrollDirection&&cQ(t,e)})},this.element=Lf(t),this._document=i,this.withScrollableParents([this.element]),e.registerDropContainer(this),this._parentPositions=new $K(i,r)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(t,e,i,n){let r;this._draggingStarted(),null==n?(r=this.sortingDisabled?this._draggables.indexOf(t):-1,-1===r&&(r=this._getItemIndexFromPointerPosition(t,e,i))):r=n;const s=this._activeDraggables,o=s.indexOf(t),a=t.getPlaceholderElement();let l=s[r];if(l===t&&(l=s[r+1]),o>-1&&s.splice(o,1),l&&!this._dragDropRegistry.isDragging(l)){const e=l.getRootElement();e.parentElement.insertBefore(a,e),s.splice(r,0,t)}else if(this._shouldEnterAsFirstChild(e,i)){const e=s[0].getRootElement();e.parentNode.insertBefore(a,e),s.unshift(t)}else Lf(this.element).appendChild(a),s.push(t);a.style.transform=\"\",this._cacheItemPositions(),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:t,container:this,currentIndex:this.getItemIndex(t)})}exit(t){this._reset(),this.exited.next({item:t,container:this})}drop(t,e,i,n,r,s,o){this._reset(),this.dropped.next({item:t,currentIndex:e,previousIndex:i,container:this,previousContainer:n,isPointerOverContainer:r,distance:s,dropPoint:o})}withItems(t){const e=this._draggables;return this._draggables=t,t.forEach(t=>t._withDropContainer(this)),this.isDragging()&&(e.filter(t=>t.isDragging()).every(e=>-1===t.indexOf(e))?this._reset():this._cacheItems()),this}withDirection(t){return this._direction=t,this}connectedTo(t){return this._siblings=t.slice(),this}withOrientation(t){return this._orientation=t,this}withScrollableParents(t){const e=Lf(this.element);return this._scrollableElements=-1===t.indexOf(e)?[e,...t]:t.slice(),this}getScrollableParents(){return this._scrollableElements}getItemIndex(t){return this._isDragging?aQ(\"horizontal\"===this._orientation&&\"rtl\"===this._direction?this._itemPositions.slice().reverse():this._itemPositions,e=>e.drag===t):this._draggables.indexOf(t)}isReceiving(){return this._activeSiblings.size>0}_sortItem(t,e,i,n){if(this.sortingDisabled||!this._clientRect||!jK(this._clientRect,.05,e,i))return;const r=this._itemPositions,s=this._getItemIndexFromPointerPosition(t,e,i,n);if(-1===s&&r.length>0)return;const o=\"horizontal\"===this._orientation,a=aQ(r,e=>e.drag===t),l=r[s],c=l.clientRect,h=a>s?1:-1,u=this._getItemOffsetPx(r[a].clientRect,c,h),d=this._getSiblingOffsetPx(a,r,h),p=r.slice();rQ(r,a,s),this.sorted.next({previousIndex:a,currentIndex:s,container:this,item:t}),r.forEach((e,i)=>{if(p[i]===e)return;const n=e.drag===t,r=n?u:d,s=n?t.getPlaceholderElement():e.drag.getRootElement();e.offset+=r,o?(s.style.transform=FK(`translate3d(${Math.round(e.offset)}px, 0, 0)`,e.initialTransform),VK(e.clientRect,0,r)):(s.style.transform=FK(`translate3d(0, ${Math.round(e.offset)}px, 0)`,e.initialTransform),VK(e.clientRect,r,0))}),this._previousSwap.overlaps=zK(c,e,i),this._previousSwap.drag=l.drag,this._previousSwap.delta=o?n.x:n.y}_startScrollingIfNecessary(t,e){if(this.autoScrollDisabled)return;let i,n=0,r=0;if(this._parentPositions.positions.forEach((s,o)=>{o===this._document||!s.clientRect||i||jK(s.clientRect,.05,t,e)&&([n,r]=function(t,e,i,n){const r=hQ(e,n),s=uQ(e,i);let o=0,a=0;if(r){const e=t.scrollTop;1===r?e>0&&(o=1):t.scrollHeight-e>t.clientHeight&&(o=2)}if(s){const e=t.scrollLeft;1===s?e>0&&(a=1):t.scrollWidth-e>t.clientWidth&&(a=2)}return[o,a]}(o,s.clientRect,t,e),(n||r)&&(i=o))}),!n&&!r){const{width:s,height:o}=this._viewportRuler.getViewportSize(),a={width:s,height:o,top:0,right:s,bottom:o,left:0};n=hQ(a,e),r=uQ(a,t),i=window}i&&(n!==this._verticalScrollDirection||r!==this._horizontalScrollDirection||i!==this._scrollNode)&&(this._verticalScrollDirection=n,this._horizontalScrollDirection=r,this._scrollNode=i,(n||r)&&i?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){const t=Lf(this.element).style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=t.msScrollSnapType||t.scrollSnapType||\"\",t.scrollSnapType=t.msScrollSnapType=\"none\",this._cacheItems(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){const t=Lf(this.element);this._parentPositions.cache(this._scrollableElements),this._clientRect=this._parentPositions.positions.get(t).clientRect}_cacheItemPositions(){const t=\"horizontal\"===this._orientation;this._itemPositions=this._activeDraggables.map(t=>{const e=t.getVisibleElement();return{drag:t,offset:0,initialTransform:e.style.transform||\"\",clientRect:NK(e)}}).sort((e,i)=>t?e.clientRect.left-i.clientRect.left:e.clientRect.top-i.clientRect.top)}_reset(){this._isDragging=!1;const t=Lf(this.element).style;t.scrollSnapType=t.msScrollSnapType=this._initialScrollSnap,this._activeDraggables.forEach(t=>{var e;const i=t.getRootElement();if(i){const n=null===(e=this._itemPositions.find(e=>e.drag===t))||void 0===e?void 0:e.initialTransform;i.style.transform=n||\"\"}}),this._siblings.forEach(t=>t._stopReceiving(this)),this._activeDraggables=[],this._itemPositions=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1,this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_getSiblingOffsetPx(t,e,i){const n=\"horizontal\"===this._orientation,r=e[t].clientRect,s=e[t+-1*i];let o=r[n?\"width\":\"height\"]*i;if(s){const t=n?\"left\":\"top\",e=n?\"right\":\"bottom\";-1===i?o-=s.clientRect[t]-r[e]:o+=r[t]-s.clientRect[e]}return o}_getItemOffsetPx(t,e,i){const n=\"horizontal\"===this._orientation;let r=n?e.left-t.left:e.top-t.top;return-1===i&&(r+=n?e.width-t.width:e.height-t.height),r}_shouldEnterAsFirstChild(t,e){if(!this._activeDraggables.length)return!1;const i=this._itemPositions,n=\"horizontal\"===this._orientation;if(i[0].drag!==this._activeDraggables[0]){const r=i[i.length-1].clientRect;return n?t>=r.right:e>=r.bottom}{const r=i[0].clientRect;return n?t<=r.left:e<=r.top}}_getItemIndexFromPointerPosition(t,e,i,n){const r=\"horizontal\"===this._orientation,s=aQ(this._itemPositions,({drag:s,clientRect:o},a,l)=>{if(s===t)return l.length<2;if(n){const t=r?n.x:n.y;if(s===this._previousSwap.drag&&this._previousSwap.overlaps&&t===this._previousSwap.delta)return!1}return r?e>=Math.floor(o.left)&&e<Math.floor(o.right):i>=Math.floor(o.top)&&i<Math.floor(o.bottom)});return-1!==s&&this.sortPredicate(s,t,this)?s:-1}_cacheItems(){this._activeDraggables=this._draggables.slice(),this._cacheItemPositions(),this._cacheParentPositions()}_isOverContainer(t,e){return null!=this._clientRect&&zK(this._clientRect,t,e)}_getSiblingContainerFromPosition(t,e,i){return this._siblings.find(n=>n._canReceive(t,e,i))}_canReceive(t,e,i){if(!this._clientRect||!zK(this._clientRect,e,i)||!this.enterPredicate(t,this))return!1;const n=this._getShadowRoot().elementFromPoint(e,i);if(!n)return!1;const r=Lf(this.element);return n===r||r.contains(n)}_startReceiving(t,e){const i=this._activeSiblings;!i.has(t)&&e.every(t=>this.enterPredicate(t,this)||this._draggables.indexOf(t)>-1)&&(i.add(t),this._cacheParentPositions(),this._listenToScrollEvents())}_stopReceiving(t){this._activeSiblings.delete(t),this._viewportScrollSubscription.unsubscribe()}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>{if(this.isDragging()){const e=this._parentPositions.handleScroll(t);e&&(this._itemPositions.forEach(({clientRect:t})=>{VK(t,e.top,e.left)}),this._itemPositions.forEach(({drag:t})=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()}))}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){const t=Qf(Lf(this.element));this._cachedShadowRoot=t||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){const t=this._activeDraggables.filter(t=>t.isDragging());this._siblings.forEach(e=>e._startReceiving(this,t))}}function aQ(t,e){for(let i=0;i<t.length;i++)if(e(t[i],i,t))return i;return-1}function lQ(t,e){t===window?t.scrollBy(0,e):t.scrollTop+=e}function cQ(t,e){t===window?t.scrollBy(e,0):t.scrollLeft+=e}function hQ(t,e){const{top:i,bottom:n,height:r}=t,s=.05*r;return e>=i-s&&e<=i+s?1:e>=n-s&&e<=n+s?2:0}function uQ(t,e){const{left:i,right:n,width:r}=t,s=.05*r;return e>=i-s&&e<=i+s?1:e>=n-s&&e<=n+s?2:0}const dQ=Zf({passive:!1,capture:!0});let pQ=(()=>{class t{constructor(t,e){this._ngZone=t,this._dropInstances=new Set,this._dragInstances=new Set,this._activeDragInstances=[],this._globalListeners=new Map,this._draggingPredicate=t=>t.isDragging(),this.pointerMove=new S,this.pointerUp=new S,this.scroll=new S,this._preventDefaultWhileDragging=t=>{this._activeDragInstances.length>0&&t.preventDefault()},this._persistentTouchmoveListener=t=>{this._activeDragInstances.length>0&&(this._activeDragInstances.some(this._draggingPredicate)&&t.preventDefault(),this.pointerMove.next(t))},this._document=e}registerDropContainer(t){this._dropInstances.has(t)||this._dropInstances.add(t)}registerDragItem(t){this._dragInstances.add(t),1===this._dragInstances.size&&this._ngZone.runOutsideAngular(()=>{this._document.addEventListener(\"touchmove\",this._persistentTouchmoveListener,dQ)})}removeDropContainer(t){this._dropInstances.delete(t)}removeDragItem(t){this._dragInstances.delete(t),this.stopDragging(t),0===this._dragInstances.size&&this._document.removeEventListener(\"touchmove\",this._persistentTouchmoveListener,dQ)}startDragging(t,e){if(!(this._activeDragInstances.indexOf(t)>-1)&&(this._activeDragInstances.push(t),1===this._activeDragInstances.length)){const t=e.type.startsWith(\"touch\");this._globalListeners.set(t?\"touchend\":\"mouseup\",{handler:t=>this.pointerUp.next(t),options:!0}).set(\"scroll\",{handler:t=>this.scroll.next(t),options:!0}).set(\"selectstart\",{handler:this._preventDefaultWhileDragging,options:dQ}),t||this._globalListeners.set(\"mousemove\",{handler:t=>this.pointerMove.next(t),options:dQ}),this._ngZone.runOutsideAngular(()=>{this._globalListeners.forEach((t,e)=>{this._document.addEventListener(e,t.handler,t.options)})})}}stopDragging(t){const e=this._activeDragInstances.indexOf(t);e>-1&&(this._activeDragInstances.splice(e,1),0===this._activeDragInstances.length&&this._clearGlobalListeners())}isDragging(t){return this._activeDragInstances.indexOf(t)>-1}scrolled(t){const e=[this.scroll];return t&&t!==this._document&&e.push(new _(e=>this._ngZone.runOutsideAngular(()=>{const i=t=>{this._activeDragInstances.length&&e.next(t)};return t.addEventListener(\"scroll\",i,!0),()=>{t.removeEventListener(\"scroll\",i,!0)}}))),q(...e)}ngOnDestroy(){this._dragInstances.forEach(t=>this.removeDragItem(t)),this._dropInstances.forEach(t=>this.removeDropContainer(t)),this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_clearGlobalListeners(){this._globalListeners.forEach((t,e)=>{this._document.removeEventListener(e,t.handler,t.options)}),this._globalListeners.clear()}}return t.\\u0275fac=function(e){return new(e||t)(En(tu),En(Du))},t.\\u0275prov=ft({factory:function(){return new t(En(tu),En(Du))},token:t,providedIn:\"root\"}),t})();const fQ={dragStartThreshold:5,pointerDirectionChangeThreshold:5};let mQ=(()=>{class t{constructor(t,e,i,n){this._document=t,this._ngZone=e,this._viewportRuler=i,this._dragDropRegistry=n}createDrag(t,e=fQ){return new KK(t,e,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry)}createDropList(t){return new oQ(t,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}}return t.\\u0275fac=function(e){return new(e||t)(En(Du),En(tu),En(Pg),En(pQ))},t.\\u0275prov=ft({factory:function(){return new t(En(Du),En(tu),En(Pg),En(pQ))},token:t,providedIn:\"root\"}),t})();const gQ=new Qi(\"CDK_DRAG_PARENT\"),AQ=new Qi(\"CdkDropListGroup\"),vQ=new Qi(\"CDK_DRAG_CONFIG\");let _Q=0;const yQ=new Qi(\"CdkDropList\");let bQ=(()=>{class t{constructor(e,i,n,r,s,o,a){this.element=e,this._changeDetectorRef=n,this._scrollDispatcher=r,this._dir=s,this._group=o,this._destroyed=new S,this.connectedTo=[],this.id=\"cdk-drop-list-\"+_Q++,this.enterPredicate=()=>!0,this.sortPredicate=()=>!0,this.dropped=new ph,this.entered=new ph,this.exited=new ph,this.sorted=new ph,this._unsortedItems=new Set,this._dropListRef=i.createDropList(e),this._dropListRef.data=this,a&&this._assignDefaults(a),this._dropListRef.enterPredicate=(t,e)=>this.enterPredicate(t.data,e.data),this._dropListRef.sortPredicate=(t,e,i)=>this.sortPredicate(t,e.data,i.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),t._dropLists.push(this),o&&o._items.add(this)}get disabled(){return this._disabled||!!this._group&&this._group.disabled}set disabled(t){this._dropListRef.disabled=this._disabled=Of(t)}addItem(t){this._unsortedItems.add(t),this._dropListRef.isDragging()&&this._syncItemsWithRef()}removeItem(t){this._unsortedItems.delete(t),this._dropListRef.isDragging()&&this._syncItemsWithRef()}getSortedItems(){return Array.from(this._unsortedItems).sort((t,e)=>t._dragRef.getVisibleElement().compareDocumentPosition(e._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)}ngOnDestroy(){const e=t._dropLists.indexOf(this);e>-1&&t._dropLists.splice(e,1),this._group&&this._group._items.delete(this),this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete()}_setupInputSyncSubscription(e){this._dir&&this._dir.change.pipe(og(this._dir.value),Mf(this._destroyed)).subscribe(t=>e.withDirection(t)),e.beforeStarted.subscribe(()=>{const i=Rf(this.connectedTo).map(e=>\"string\"==typeof e?t._dropLists.find(t=>t.id===e):e);if(this._group&&this._group._items.forEach(t=>{-1===i.indexOf(t)&&i.push(t)}),!this._scrollableParentsResolved){const t=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(t=>t.getElementRef().nativeElement);this._dropListRef.withScrollableParents(t),this._scrollableParentsResolved=!0}e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.sortingDisabled=Of(this.sortingDisabled),e.autoScrollDisabled=Of(this.autoScrollDisabled),e.autoScrollStep=Pf(this.autoScrollStep,2),e.connectedTo(i.filter(t=>t&&t!==this).map(t=>t._dropListRef)).withOrientation(this.orientation)})}_handleEvents(t){t.beforeStarted.subscribe(()=>{this._syncItemsWithRef(),this._changeDetectorRef.markForCheck()}),t.entered.subscribe(t=>{this.entered.emit({container:this,item:t.item.data,currentIndex:t.currentIndex})}),t.exited.subscribe(t=>{this.exited.emit({container:this,item:t.item.data}),this._changeDetectorRef.markForCheck()}),t.sorted.subscribe(t=>{this.sorted.emit({previousIndex:t.previousIndex,currentIndex:t.currentIndex,container:this,item:t.item.data})}),t.dropped.subscribe(t=>{this.dropped.emit({previousIndex:t.previousIndex,currentIndex:t.currentIndex,previousContainer:t.previousContainer.data,container:t.container.data,item:t.item.data,isPointerOverContainer:t.isPointerOverContainer,distance:t.distance,dropPoint:t.dropPoint}),this._changeDetectorRef.markForCheck()})}_assignDefaults(t){const{lockAxis:e,draggingDisabled:i,sortingDisabled:n,listAutoScrollDisabled:r,listOrientation:s}=t;this.disabled=null!=i&&i,this.sortingDisabled=null!=n&&n,this.autoScrollDisabled=null!=r&&r,this.orientation=s||\"vertical\",e&&(this.lockAxis=e)}_syncItemsWithRef(){this._dropListRef.withItems(this.getSortedItems().map(t=>t._dragRef))}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(mQ),Ta(Cc),Ta(Ig),Ta(xg,8),Ta(AQ,12),Ta(vQ,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkDropList\",\"\"],[\"cdk-drop-list\"]],hostAttrs:[1,\"cdk-drop-list\"],hostVars:7,hostBindings:function(t,e){2&t&&(ta(\"id\",e.id),ll(\"cdk-drop-list-disabled\",e.disabled)(\"cdk-drop-list-dragging\",e._dropListRef.isDragging())(\"cdk-drop-list-receiving\",e._dropListRef.isReceiving()))},inputs:{connectedTo:[\"cdkDropListConnectedTo\",\"connectedTo\"],id:\"id\",enterPredicate:[\"cdkDropListEnterPredicate\",\"enterPredicate\"],sortPredicate:[\"cdkDropListSortPredicate\",\"sortPredicate\"],disabled:[\"cdkDropListDisabled\",\"disabled\"],sortingDisabled:[\"cdkDropListSortingDisabled\",\"sortingDisabled\"],autoScrollDisabled:[\"cdkDropListAutoScrollDisabled\",\"autoScrollDisabled\"],orientation:[\"cdkDropListOrientation\",\"orientation\"],lockAxis:[\"cdkDropListLockAxis\",\"lockAxis\"],data:[\"cdkDropListData\",\"data\"],autoScrollStep:[\"cdkDropListAutoScrollStep\",\"autoScrollStep\"]},outputs:{dropped:\"cdkDropListDropped\",entered:\"cdkDropListEntered\",exited:\"cdkDropListExited\",sorted:\"cdkDropListSorted\"},exportAs:[\"cdkDropList\"],features:[Gl([{provide:AQ,useValue:void 0},{provide:yQ,useExisting:t}])]}),t._dropLists=[],t})();const wQ=new Qi(\"CdkDragHandle\");let xQ=(()=>{class t{constructor(t,e){this.element=t,this._stateChanges=new S,this._disabled=!1,this._parentDrag=e}get disabled(){return this._disabled}set disabled(t){this._disabled=Of(t),this._stateChanges.next(this)}ngOnDestroy(){this._stateChanges.complete()}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(gQ,12))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkDragHandle\",\"\"]],hostAttrs:[1,\"cdk-drag-handle\"],inputs:{disabled:[\"cdkDragHandleDisabled\",\"disabled\"]},features:[Gl([{provide:wQ,useExisting:t}])]}),t})();const SQ=new Qi(\"CdkDragPlaceholder\"),CQ=new Qi(\"CdkDragPreview\");let kQ=(()=>{class t{constructor(e,i,n,r,s,o,a,l,c,h,u){this.element=e,this.dropContainer=i,this._ngZone=r,this._viewContainerRef=s,this._dir=a,this._changeDetectorRef=c,this._selfHandle=h,this._parentDrag=u,this._destroyed=new S,this.started=new ph,this.released=new ph,this.ended=new ph,this.entered=new ph,this.exited=new ph,this.dropped=new ph,this.moved=new _(t=>{const e=this._dragRef.moved.pipe(E(t=>({source:this,pointerPosition:t.pointerPosition,event:t.event,delta:t.delta,distance:t.distance}))).subscribe(t);return()=>{e.unsubscribe()}}),this._dragRef=l.createDrag(e,{dragStartThreshold:o&&null!=o.dragStartThreshold?o.dragStartThreshold:5,pointerDirectionChangeThreshold:o&&null!=o.pointerDirectionChangeThreshold?o.pointerDirectionChangeThreshold:5,zIndex:null==o?void 0:o.zIndex}),this._dragRef.data=this,t._dragInstances.push(this),o&&this._assignDefaults(o),i&&(this._dragRef._withDropContainer(i._dropListRef),i.addItem(this)),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}get disabled(){return this._disabled||this.dropContainer&&this.dropContainer.disabled}set disabled(t){this._disabled=Of(t),this._dragRef.disabled=this._disabled}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(_f(1),Mf(this._destroyed)).subscribe(()=>{this._updateRootElement(),this._setupHandlesListener(),this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)})})}ngOnChanges(t){const e=t.rootElementSelector,i=t.freeDragPosition;e&&!e.firstChange&&this._updateRootElement(),i&&!i.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this);const e=t._dragInstances.indexOf(this);e>-1&&t._dragInstances.splice(e,1),this._ngZone.runOutsideAngular(()=>{this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_updateRootElement(){const t=this.element.nativeElement,e=this.rootElementSelector?EQ(t,this.rootElementSelector):t;this._dragRef.withRootElement(e||t)}_getBoundaryElement(){const t=this.boundaryElement;return t?\"string\"==typeof t?EQ(this.element.nativeElement,t):Lf(t):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){const t=this._dir,i=this.dragStartDelay,n=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,r=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.dragStartDelay=\"object\"==typeof i&&i?i:Pf(i),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(n).withPreviewTemplate(r).withPreviewContainer(this.previewContainer||\"global\"),t&&e.withDirection(t.value)}}),e.beforeStarted.pipe(_f(1)).subscribe(()=>{var i,n;if(this._parentDrag)return void e.withParent(this._parentDrag._dragRef);let r=this.element.nativeElement.parentElement;for(;r;){if(null===(i=r.classList)||void 0===i?void 0:i.contains(\"cdk-drag\")){e.withParent((null===(n=t._dragInstances.find(t=>t.element.nativeElement===r))||void 0===n?void 0:n._dragRef)||null);break}r=r.parentElement}})}_handleEvents(t){t.started.subscribe(()=>{this.started.emit({source:this}),this._changeDetectorRef.markForCheck()}),t.released.subscribe(()=>{this.released.emit({source:this})}),t.ended.subscribe(t=>{this.ended.emit({source:this,distance:t.distance,dropPoint:t.dropPoint}),this._changeDetectorRef.markForCheck()}),t.entered.subscribe(t=>{this.entered.emit({container:t.container.data,item:this,currentIndex:t.currentIndex})}),t.exited.subscribe(t=>{this.exited.emit({container:t.container.data,item:this})}),t.dropped.subscribe(t=>{this.dropped.emit({previousIndex:t.previousIndex,currentIndex:t.currentIndex,previousContainer:t.previousContainer.data,container:t.container.data,isPointerOverContainer:t.isPointerOverContainer,item:this,distance:t.distance,dropPoint:t.dropPoint})})}_assignDefaults(t){const{lockAxis:e,dragStartDelay:i,constrainPosition:n,previewClass:r,boundaryElement:s,draggingDisabled:o,rootElementSelector:a,previewContainer:l}=t;this.disabled=null!=o&&o,this.dragStartDelay=i||0,e&&(this.lockAxis=e),n&&(this.constrainPosition=n),r&&(this.previewClass=r),s&&(this.boundaryElement=s),a&&(this.rootElementSelector=a),l&&(this.previewContainer=l)}_setupHandlesListener(){this._handles.changes.pipe(og(this._handles),Jp(t=>{const e=t.filter(t=>t._parentDrag===this).map(t=>t.element);this._selfHandle&&this.rootElementSelector&&e.push(this.element),this._dragRef.withHandles(e)}),hg(t=>q(...t.map(t=>t._stateChanges.pipe(og(t))))),Mf(this._destroyed)).subscribe(t=>{const e=this._dragRef,i=t.element.nativeElement;t.disabled?e.disableHandle(i):e.enableHandle(i)})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(yQ,12),Ta(Du),Ta(tu),Ta(Bc),Ta(vQ,8),Ta(xg,8),Ta(mQ),Ta(Cc),Ta(wQ,10),Ta(gQ,12))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkDrag\",\"\"]],contentQueries:function(t,e,i){if(1&t&&(Eh(i,CQ,5),Eh(i,SQ,5),Eh(i,wQ,5)),2&t){let t;Ch(t=Mh())&&(e._previewTemplate=t.first),Ch(t=Mh())&&(e._placeholderTemplate=t.first),Ch(t=Mh())&&(e._handles=t)}},hostAttrs:[1,\"cdk-drag\"],hostVars:4,hostBindings:function(t,e){2&t&&ll(\"cdk-drag-disabled\",e.disabled)(\"cdk-drag-dragging\",e._dragRef.isDragging())},inputs:{disabled:[\"cdkDragDisabled\",\"disabled\"],dragStartDelay:[\"cdkDragStartDelay\",\"dragStartDelay\"],lockAxis:[\"cdkDragLockAxis\",\"lockAxis\"],constrainPosition:[\"cdkDragConstrainPosition\",\"constrainPosition\"],previewClass:[\"cdkDragPreviewClass\",\"previewClass\"],boundaryElement:[\"cdkDragBoundary\",\"boundaryElement\"],rootElementSelector:[\"cdkDragRootElement\",\"rootElementSelector\"],previewContainer:[\"cdkDragPreviewContainer\",\"previewContainer\"],data:[\"cdkDragData\",\"data\"],freeDragPosition:[\"cdkDragFreeDragPosition\",\"freeDragPosition\"]},outputs:{started:\"cdkDragStarted\",released:\"cdkDragReleased\",ended:\"cdkDragEnded\",entered:\"cdkDragEntered\",exited:\"cdkDragExited\",dropped:\"cdkDragDropped\",moved:\"cdkDragMoved\"},exportAs:[\"cdkDrag\"],features:[Gl([{provide:gQ,useExisting:t}]),ce]}),t._dragInstances=[],t})();function EQ(t,e){let i=t.parentElement;for(;i;){if(i.matches?i.matches(e):i.msMatchesSelector(e))return i;i=i.parentElement}return null}let MQ=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({providers:[mQ],imports:[Dg]}),t})();function TQ(t,e){if(1&t&&(Pa(0,\"mat-option\",9),bl(1),Da()),2&t){const t=e.$implicit;Ia(\"value\",t.value),Ss(1),xl(\" \",t.label,\" \")}}function IQ(t,e){if(1&t){const t=Na();Pa(0,\"div\"),Pa(1,\"mat-form-field\",5),Pa(2,\"mat-label\"),bl(3,\"Intervalle de temps\"),Da(),Pa(4,\"mat-select\",6),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).criterion.timeWindow=e}),na(5,TQ,2,2,\"mat-option\",7),Da(),Da(),Pa(6,\"mat-checkbox\",8),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).criterion.sequential=e}),bl(7,\" Passages ordonn\\xe9s \"),Da(),Da()}if(2&t){const t=Wa(2);Ss(4),Ia(\"ngModel\",t.criterion.timeWindow)(\"disabled\",!t.editable),Ss(1),Ia(\"ngForOf\",t.timeWindows),Ss(1),Ia(\"ngModel\",t.criterion.sequential)(\"disabled\",!t.editable)}}function OQ(t,e){if(1&t&&(Pa(0,\"div\",21),bl(1),Da()),2&t){const t=Wa().index;Ss(1),wl(t+1)}}function PQ(t,e){1&t&&(Pa(0,\"mat-icon\",22),bl(1,\"drag_handle\"),Da())}function DQ(t,e){if(1&t){const t=Na();Pa(0,\"mat-list-item\",17),$a(\"cdkDragStarted\",function(){return Fe(t),Wa(3).startReorderingPassages()}),na(1,OQ,2,1,\"div\",18),na(2,PQ,2,0,\"mat-icon\",19),Pa(3,\"app-zone-item\",20),$a(\"delete\",function(){const e=Fe(t).$implicit;return Wa(3).deleteZone(e.zone)}),Da(),Da()}if(2&t){const t=e.$implicit,i=Wa(3);Ss(1),Ia(\"ngIf\",i.criterion.sequential),Ss(1),Ia(\"ngIf\",i.zonesEditable),Ss(1),Ia(\"zone\",t.zone)(\"editable\",i.zonesEditable)}}function RQ(t,e){if(1&t){const t=Na();Pa(0,\"app-zone-form\",23),$a(\"save\",function(e){return Fe(t),Wa(3).addCreatedZone(e)})(\"cancel\",function(){return Fe(t),Wa(3).hideCreateZoneForm()}),Da()}}function FQ(t,e){if(1&t){const t=Na();Pa(0,\"button\",24),Pa(1,\"span\"),bl(2,\"\\xa0Ajouter une zone\"),Da(),Da(),Pa(3,\"button\",25),$a(\"click\",function(){return Fe(t),Wa(3).displayCreateZoneForm()}),bl(4,\" Cr\\xe9er une zone \"),Da()}if(2&t){Wa();const t=ra(6),e=Wa(2);Ia(\"matMenuTriggerFor\",t)(\"disabled\",!e.zonesEditable),Ss(3),Ia(\"disabled\",!e.zonesEditable)}}function LQ(t,e){if(1&t){const t=Na();Pa(0,\"button\",26),$a(\"click\",function(){const e=Fe(t).$implicit;return Wa(3).addZone(e)}),bl(1),Da()}if(2&t){const t=e.$implicit;Ss(1),xl(\" \",t.name,\" \")}}function BQ(t,e){if(1&t){const t=Na();Pa(0,\"mat-list\",10),$a(\"cdkDropListDropped\",function(e){return Fe(t),Wa(2).reorderPassage(e)}),na(1,DQ,4,4,\"mat-list-item\",11),Da(),Pa(2,\"div\",12),na(3,RQ,1,0,\"app-zone-form\",13),na(4,FQ,5,3,\"ng-template\",1),Da(),Pa(5,\"mat-menu\",14,15),na(7,LQ,2,1,\"button\",16),Da()}if(2&t){const t=Wa(2);Ss(1),Ia(\"ngForOf\",t.criterion.passages)(\"ngForTrackBy\",t.trackById),Ss(2),Ia(\"ngIf\",t.showCreateZoneForm),Ss(1),Ia(\"ngIf\",!t.showCreateZoneForm),Ss(3),Ia(\"ngForOf\",t.availableZones)}}function NQ(t,e){if(1&t&&(Pa(0,\"div\",21),bl(1),Da()),2&t){const t=Wa().index;Ss(1),wl(t+1)}}function zQ(t,e){if(1&t){const t=Na();Pa(0,\"mat-list-item\"),na(1,NQ,2,1,\"div\",18),Pa(2,\"button\",29),$a(\"click\",function(){const e=Fe(t).$implicit;return Wa(3).viewZone(e.zone)}),bl(3),Da(),Da()}if(2&t){const t=e.$implicit,i=Wa(3);Ss(1),Ia(\"ngIf\",i.criterion.sequential),Ss(2),xl(\" \",t.zone.name,\" \")}}function VQ(t,e){if(1&t&&(Pa(0,\"mat-list\",27),na(1,zQ,4,2,\"mat-list-item\",28),Da()),2&t){const t=Wa(2);Ss(1),Ia(\"ngForOf\",t.criterion.passages)}}function jQ(t,e){if(1&t&&(na(0,IQ,8,5,\"div\",2),na(1,BQ,8,5,\"ng-template\",3),na(2,VQ,2,1,\"ng-template\",null,4,Ph)),2&t){const t=ra(3),e=Wa();Ia(\"ngIf\",e.criterion.passages.length>1),Ss(1),Ia(\"ngIf\",e.editable)(\"ngIfElse\",t)}}let $Q=(()=>{class t extends AK{constructor(t,e,i){super(),this.editZoneService=t,this.mapService=e,this.zonesService=i,this.updateZones=new ph,this.timeWindows=_U,this.reorderingPassages=!1,this.availableZones=[],this.showCreateZoneForm=!1,this.zonesEditable=!0,this.subscriptions=[],this.usedZonesIds$=new Zp([])}ngOnInit(){this.usedZonesIds$.next(this.criterion.passages.map(t=>t.zone.id)),this.subscriptions.push(LT([this.zonesService.zones$,this.usedZonesIds$]).subscribe(([t,e])=>{this.availableZones=t.filter(t=>!e.includes(t.id))})),this.subscriptions.push(this.usedZonesIds$.pipe(wf(1)).subscribe(()=>{this.updateZones.next(null)})),this.subscriptions.push(this.editZoneService.editedZone$.pipe(Cf(),I$(0)).subscribe(t=>{this.zonesEditable=!t}))}ngOnDestroy(){this.subscriptions.forEach(t=>{t.unsubscribe()})}get passages(){return this.criterion.passages.map(t=>t.zone.name).join(\", \")}displayCreateZoneForm(){this.showCreateZoneForm=!0}hideCreateZoneForm(){this.showCreateZoneForm=!1}addCreatedZone(t){this.criterion.passages.push({zone:t}),this.hideCreateZoneForm()}viewZone(t){this.mapService.fitOn(rH(t.h3indexes))}deleteZone(t){this.criterion.passages.splice(this.criterion.passages.findIndex(e=>e.zone===t),1),this.usedZonesIds$.next(this.usedZonesIds$.value.filter(e=>e!==t.id))}addZone(t){this.criterion.passages.push({zone:t}),this.usedZonesIds$.next(this.usedZonesIds$.value.concat(t.id))}trackById(t,e){return e.zone.id}startReorderingPassages(){this.reorderingPassages=!0}reorderPassage(t){this.reorderingPassages=!1,rQ(this.criterion.passages,t.previousIndex,t.currentIndex)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(jZ),Ta(T$),Ta(lH))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-passage-in-zone-criterion\"]],outputs:{updateZones:\"updateZones\"},features:[Gl([{provide:Cb,useExisting:t,multi:!0}]),Vo],decls:2,vars:4,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"],[3,\"ngIf\"],[4,\"ngIf\"],[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[1,\"mr-2\"],[3,\"ngModel\",\"disabled\",\"ngModelChange\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[\"color\",\"primary\",\"matTooltip\",\"Cette option active le passage des zones dans l'ordre d\\xe9fini\",3,\"ngModel\",\"disabled\",\"ngModelChange\"],[3,\"value\"],[\"dense\",\"\",\"cdkDropList\",\"\",3,\"cdkDropListDropped\"],[\"cdkDrag\",\"\",3,\"cdkDragStarted\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[1,\"criterion-content\"],[\"class\",\"u-flex\",3,\"save\",\"cancel\",4,\"ngIf\"],[1,\"add-zones-menu\"],[\"addZonesMenu\",\"matMenu\"],[\"mat-menu-item\",\"\",3,\"click\",4,\"ngFor\",\"ngForOf\"],[\"cdkDrag\",\"\",3,\"cdkDragStarted\"],[\"class\",\"criterion__sequence-number\",4,\"ngIf\"],[\"class\",\"criterion__drag-handle\",\"cdkDragHandle\",\"\",\"title\",\"R\\xe9ordonner\",4,\"ngIf\"],[1,\"u-flex\",3,\"zone\",\"editable\",\"delete\"],[1,\"criterion__sequence-number\"],[\"cdkDragHandle\",\"\",\"title\",\"R\\xe9ordonner\",1,\"criterion__drag-handle\"],[1,\"u-flex\",3,\"save\",\"cancel\"],[\"mat-button\",\"\",\"title\",\"Ajouter une zone existante\",3,\"matMenuTriggerFor\",\"disabled\"],[\"mat-button\",\"\",\"title\",\"Cr\\xe9er une nouvelle zone\",3,\"disabled\",\"click\"],[\"mat-menu-item\",\"\",3,\"click\"],[\"dense\",\"\"],[4,\"ngFor\",\"ngForOf\"],[\"mat-button\",\"\",\"title\",\"Visualiser la zone\",1,\"u-flex\",3,\"click\"]],template:function(t,e){1&t&&(Pa(0,\"app-alert-rule-criterion\",0),$a(\"enableChange\",function(t){return e.enable=t}),na(1,jQ,4,3,\"ng-template\",1),Da()),2&t&&(Ia(\"type\",e.criteriaLabels.passageInZone)(\"enable\",e.enable)(\"editable\",e.editable),Ss(1),Ia(\"ngIf\",e.criterion.enable))},directives:[SK,Bd,tS,Hx,IT,aw,Vw,Fd,NY,QT,cb,tK,bQ,LX,rK,kQ,qX,Yk,xQ,UX,vb,jX,PX],styles:[\".criterion__sequence-number[_ngcontent-%COMP%]{font-size:1.2em;font-weight:bold;margin-right:.5em}.criterion__drag-handle[_ngcontent-%COMP%]{cursor:move;margin-right:.5em}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.141),0 3px 14px 2px rgba(0,0,0,.122);background-color:#e6e9f7;font-size:12px}.cdk-drag-preview[_ngcontent-%COMP%]    >.mat-list-item-content{display:flex;align-items:center;padding:0 16px;height:inherit}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}\"]}),t})(),UQ=(()=>{class t extends AK{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"app-spoofing-criterion\"]],features:[Gl([{provide:Cb,useExisting:t,multi:!0}]),Vo],decls:1,vars:3,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"]],template:function(t,e){1&t&&(Pa(0,\"app-alert-rule-criterion\",0),$a(\"enableChange\",function(t){return e.enable=t}),Da()),2&t&&Ia(\"type\",e.criteriaLabels.spoofing)(\"enable\",e.enable)(\"editable\",e.editable)},directives:[SK],encapsulation:2,changeDetection:0}),t})();const HQ=[\"panel\"];function GQ(t,e){if(1&t&&(Pa(0,\"div\",0,1),Xa(2),Da()),2&t){const t=e.id,i=Wa();Ia(\"id\",i.id)(\"ngClass\",i._classList),ta(\"aria-label\",i.ariaLabel||null)(\"aria-labelledby\",i._getPanelAriaLabelledby(t))}}const qQ=[\"*\"];let WQ=0;class YQ{constructor(t,e){this.source=t,this.option=e}}const ZQ=wy(class{}),XQ=new Qi(\"mat-autocomplete-default-options\",{providedIn:\"root\",factory:function(){return{autoActiveFirstOption:!1}}});let KQ=(()=>{class t extends ZQ{constructor(t,e,i,n){super(),this._changeDetectorRef=t,this._elementRef=e,this._activeOptionChanges=u.EMPTY,this.showPanel=!1,this._isOpen=!1,this.displayWith=null,this.optionSelected=new ph,this.opened=new ph,this.closed=new ph,this.optionActivated=new ph,this._classList={},this.id=\"mat-autocomplete-\"+WQ++,this.inertGroups=(null==n?void 0:n.SAFARI)||!1,this._autoActiveFirstOption=!!i.autoActiveFirstOption}get isOpen(){return this._isOpen&&this.showPanel}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(t){this._autoActiveFirstOption=Of(t)}set classList(t){this._classList=t&&t.length?Bf(t).reduce((t,e)=>(t[e]=!0,t),{}):{},this._setVisibilityClasses(this._classList),this._elementRef.nativeElement.className=\"\"}ngAfterContentInit(){this._keyManager=new Am(this.options).withWrap(),this._activeOptionChanges=this._keyManager.change.subscribe(t=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[t]||null})}),this._setVisibility()}ngOnDestroy(){this._activeOptionChanges.unsubscribe()}_setScrollTop(t){this.panel&&(this.panel.nativeElement.scrollTop=t)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options.length,this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(t){const e=new YQ(this,t);this.optionSelected.emit(e)}_getPanelAriaLabelledby(t){return this.ariaLabel?null:this.ariaLabelledby?(t?t+\" \":\"\")+this.ariaLabelledby:t}_setVisibilityClasses(t){t[this._visibleClass]=this.showPanel,t[this._hiddenClass]=!this.showPanel}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Cc),Ta(Jl),Ta(XQ),Ta(Vf))},t.\\u0275dir=Xt({type:t,viewQuery:function(t,e){if(1&t&&(kh(Ic,7),kh(HQ,5)),2&t){let t;Ch(t=Mh())&&(e.template=t.first),Ch(t=Mh())&&(e.panel=t.first)}},inputs:{displayWith:\"displayWith\",autoActiveFirstOption:\"autoActiveFirstOption\",classList:[\"class\",\"classList\"],ariaLabel:[\"aria-label\",\"ariaLabel\"],ariaLabelledby:[\"aria-labelledby\",\"ariaLabelledby\"],panelWidth:\"panelWidth\"},outputs:{optionSelected:\"optionSelected\",opened:\"opened\",closed:\"closed\",optionActivated:\"optionActivated\"},features:[Vo]}),t})(),QQ=(()=>{class t extends KQ{constructor(){super(...arguments),this._visibleClass=\"mat-autocomplete-visible\",this._hiddenClass=\"mat-autocomplete-hidden\"}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-autocomplete\"]],contentQueries:function(t,e,i){if(1&t&&(Eh(i,rb,5),Eh(i,cb,5)),2&t){let t;Ch(t=Mh())&&(e.optionGroups=t),Ch(t=Mh())&&(e.options=t)}},hostAttrs:[1,\"mat-autocomplete\"],inputs:{disableRipple:\"disableRipple\"},exportAs:[\"matAutocomplete\"],features:[Gl([{provide:tb,useExisting:t}]),Vo],ngContentSelectors:qQ,decls:1,vars:0,consts:[[\"role\",\"listbox\",1,\"mat-autocomplete-panel\",3,\"id\",\"ngClass\"],[\"panel\",\"\"]],template:function(t,e){1&t&&(Za(),na(0,GQ,3,4,\"ng-template\"))},directives:[Dd],styles:[\".mat-autocomplete-panel{min-width:112px;max-width:280px;overflow:auto;-webkit-overflow-scrolling:touch;visibility:hidden;max-width:none;max-height:256px;position:relative;width:100%;border-bottom-left-radius:4px;border-bottom-right-radius:4px}.mat-autocomplete-panel.mat-autocomplete-visible{visibility:visible}.mat-autocomplete-panel.mat-autocomplete-hidden{visibility:hidden}.mat-autocomplete-panel-above .mat-autocomplete-panel{border-radius:0;border-top-left-radius:4px;border-top-right-radius:4px}.mat-autocomplete-panel .mat-divider-horizontal{margin-top:-1px}.cdk-high-contrast-active .mat-autocomplete-panel{outline:solid 1px}mat-autocomplete{display:none}\\n\"],encapsulation:2,changeDetection:0}),t})(),JQ=(()=>{class t{constructor(t){this.elementRef=t}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl))},t.\\u0275dir=Xt({type:t}),t})(),tJ=(()=>{class t extends JQ{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matAutocompleteOrigin\",\"\"]],exportAs:[\"matAutocompleteOrigin\"],features:[Vo]}),t})();const eJ=new Qi(\"mat-autocomplete-scroll-strategy\"),iJ={provide:eJ,deps:[uA],useFactory:function(t){return()=>t.scrollStrategies.reposition()}},nJ={provide:Cb,useExisting:ot(()=>sJ),multi:!0};let rJ=(()=>{class t{constructor(t,e,i,n,r,s,o,a,l,c,h){this._element=t,this._overlay=e,this._viewContainerRef=i,this._zone=n,this._changeDetectorRef=r,this._dir=o,this._formField=a,this._document=l,this._viewportRuler=c,this._defaults=h,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._manuallyFloatingLabel=!1,this._viewportSubscription=u.EMPTY,this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new S,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position=\"auto\",this.autocompleteAttribute=\"off\",this._overlayAttached=!1,this.optionSelections=CC(()=>this.autocomplete&&this.autocomplete.options?q(...this.autocomplete.options.map(t=>t.onSelectionChange)):this._zone.onStable.pipe(_f(1),hg(()=>this.optionSelections))),this._scrollStrategy=s}get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(t){this._autocompleteDisabled=Of(t)}ngAfterViewInit(){const t=this._getWindow();void 0!==t&&this._zone.runOutsideAngular(()=>t.addEventListener(\"blur\",this._windowBlurHandler))}ngOnChanges(t){t.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const t=this._getWindow();void 0!==t&&t.removeEventListener(\"blur\",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay(),this._floatLabel()}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this.autocomplete.closed.emit(),this.autocomplete._isOpen=this._overlayAttached=!1,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return q(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(pf(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(pf(()=>this._overlayAttached)):Xp()).pipe(E(t=>t instanceof ab?t:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return q(Hm(this._document,\"click\"),Hm(this._document,\"auxclick\"),Hm(this._document,\"touchend\")).pipe(pf(t=>{const e=tm(t),i=this._formField?this._formField._elementRef.nativeElement:null,n=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&e!==this._element.nativeElement&&(!i||!i.contains(e))&&(!n||!n.contains(e))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(e)}))}writeValue(t){Promise.resolve(null).then(()=>this._setTriggerValue(t))}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this._element.nativeElement.disabled=t}_handleKeydown(t){const e=t.keyCode;if(27===e&&!Kp(t)&&t.preventDefault(),this.activeOption&&13===e&&this.panelOpen)this.activeOption._selectViaInteraction(),this._resetActiveItem(),t.preventDefault();else if(this.autocomplete){const i=this.autocomplete._keyManager.activeItem,n=38===e||40===e;this.panelOpen||9===e?this.autocomplete._keyManager.onKeydown(t):n&&this._canOpen()&&this.openPanel(),(n||this.autocomplete._keyManager.activeItem!==i)&&this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0)}}_handleInput(t){let e=t.target,i=e.value;\"number\"===e.type&&(i=\"\"==i?null:parseFloat(i)),this._previousValue!==i&&(this._previousValue=i,this._onChange(i),this._canOpen()&&this._document.activeElement===t.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_floatLabel(t=!1){this._formField&&\"auto\"===this._formField.floatLabel&&(t?this._formField._animateAndLockLabel():this._formField.floatLabel=\"always\",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField.floatLabel=\"auto\",this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){return q(this._zone.onStable.pipe(_f(1)),this.autocomplete.options.changes.pipe(Jp(()=>this._positionStrategy.reapplyLastPosition()),I$(0))).pipe(hg(()=>{const t=this.panelOpen;return this._resetActiveItem(),this.autocomplete._setVisibility(),this.panelOpen&&(this._overlayRef.updatePosition(),t!==this.panelOpen&&this.autocomplete.opened.emit()),this.panelClosingActions}),_f(1)).subscribe(t=>this._setValueAndClose(t))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_setTriggerValue(t){const e=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(t):t,i=null!=e?e:\"\";this._formField?this._formField._control.value=i:this._element.nativeElement.value=i,this._previousValue=i}_setValueAndClose(t){t&&t.source&&(this._clearPreviousSelectedOption(t.source),this._setTriggerValue(t.source.value),this._onChange(t.source.value),this._element.nativeElement.focus(),this.autocomplete._emitSelectEvent(t.source)),this.closePanel()}_clearPreviousSelectedOption(t){this.autocomplete.options.forEach(e=>{e!==t&&e.selected&&e.deselect()})}_attachOverlay(){var t;let e=this._overlayRef;e?(this._positionStrategy.setOrigin(this._getConnectedElement()),e.updateSize({width:this._getPanelWidth()})):(this._portal=new Up(this.autocomplete.template,this._viewContainerRef,{id:null===(t=this._formField)||void 0===t?void 0:t.getLabelId()}),e=this._overlay.create(this._getOverlayConfig()),this._overlayRef=e,e.keydownEvents().subscribe(t=>{(27===t.keyCode&&!Kp(t)||38===t.keyCode&&Kp(t,\"altKey\"))&&(this._closeKeyEventStream.next(),this._resetActiveItem(),t.stopPropagation(),t.preventDefault())}),this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&e&&e.updateSize({width:this._getPanelWidth()})})),e&&!e.hasAttached()&&(e.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const i=this.panelOpen;this.autocomplete._setVisibility(),this.autocomplete._isOpen=this._overlayAttached=!0,this.panelOpen&&i!==this.panelOpen&&this.autocomplete.opened.emit()}_getOverlayConfig(){var t;return new qg({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir,panelClass:null===(t=this._defaults)||void 0===t?void 0:t.overlayPanelClass})}_getOverlayPosition(){const t=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1);return this._setStrategyPositions(t),this._positionStrategy=t,t}_setStrategyPositions(t){const e=[{originX:\"start\",originY:\"bottom\",overlayX:\"start\",overlayY:\"top\"},{originX:\"end\",originY:\"bottom\",overlayX:\"end\",overlayY:\"top\"}],i=this._aboveClass,n=[{originX:\"start\",originY:\"top\",overlayX:\"start\",overlayY:\"bottom\",panelClass:i},{originX:\"end\",originY:\"top\",overlayX:\"end\",overlayY:\"bottom\",panelClass:i}];let r;r=\"above\"===this.position?n:\"below\"===this.position?e:[...e,...n],t.withPositions(r)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const t=this.autocomplete;t.autoActiveFirstOption?t._keyManager.setFirstItemActive():t._keyManager.setActiveItem(-1)}_canOpen(){const t=this._element.nativeElement;return!t.readOnly&&!t.disabled&&!this._autocompleteDisabled}_getWindow(){var t;return(null===(t=this._document)||void 0===t?void 0:t.defaultView)||window}_scrollToOption(t){const e=this.autocomplete,i=hb(t,e.options,e.optionGroups);if(0===t&&1===i)e._setScrollTop(0);else if(e.panel){const i=e.options.toArray()[t];if(i){const t=i._getHostElement(),n=ub(t.offsetTop,t.offsetHeight,e._getScrollTop(),e.panel.nativeElement.offsetHeight);e._setScrollTop(n)}}}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(uA),Ta(Bc),Ta(tu),Ta(Cc),Ta(eJ),Ta(xg,8),Ta(Jx,9),Ta(Du,8),Ta(Pg),Ta(XQ,8))},t.\\u0275dir=Xt({type:t,inputs:{position:[\"matAutocompletePosition\",\"position\"],autocompleteAttribute:[\"autocomplete\",\"autocompleteAttribute\"],autocompleteDisabled:[\"matAutocompleteDisabled\",\"autocompleteDisabled\"],autocomplete:[\"matAutocomplete\",\"autocomplete\"],connectedTo:[\"matAutocompleteConnectedTo\",\"connectedTo\"]},features:[ce]}),t})(),sJ=(()=>{class t extends rJ{constructor(){super(...arguments),this._aboveClass=\"mat-autocomplete-panel-above\"}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"input\",\"matAutocomplete\",\"\"],[\"textarea\",\"matAutocomplete\",\"\"]],hostAttrs:[1,\"mat-autocomplete-trigger\"],hostVars:7,hostBindings:function(t,e){1&t&&$a(\"focusin\",function(){return e._handleFocus()})(\"blur\",function(){return e._onTouched()})(\"input\",function(t){return e._handleInput(t)})(\"keydown\",function(t){return e._handleKeydown(t)}),2&t&&ta(\"autocomplete\",e.autocompleteAttribute)(\"role\",e.autocompleteDisabled?null:\"combobox\")(\"aria-autocomplete\",e.autocompleteDisabled?null:\"list\")(\"aria-activedescendant\",e.panelOpen&&e.activeOption?e.activeOption.id:null)(\"aria-expanded\",e.autocompleteDisabled?null:e.panelOpen.toString())(\"aria-owns\",e.autocompleteDisabled||!e.panelOpen||null==e.autocomplete?null:e.autocomplete.id)(\"aria-haspopup\",!e.autocompleteDisabled)},exportAs:[\"matAutocompleteTrigger\"],features:[Gl([nJ]),Vo]}),t})(),oJ=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({providers:[iJ],imports:[[AA,db,_y,Jd],Dg,db,_y]}),t})();const aJ=[\"searchInput\"];function lJ(t,e){if(1&t&&(Pa(0,\"mat-option\",7),Pa(1,\"div\",8),Pa(2,\"div\"),Ra(3,\"app-flag\",9),bl(4),Da(),Pa(5,\"div\"),Pa(6,\"span\",10),bl(7),Da(),bl(8),Da(),Da(),Da()),2&t){const t=e.$implicit;Ia(\"value\",t),Ss(3),Ia(\"flag\",t.country.flag),Ss(1),xl(\" \",t.name||\"?\",\" \"),Ss(3),xl(\"MMSI \",t.mmsi,\"\"),Ss(1),xl(\" IMO \",t.imo||\"?\",\" \")}}let cJ=(()=>{class t{constructor(t){this.workerService=t,this.allowTextValue=!1,this.existingItems=[],this.selectItem=new ph,this.searchFormControl=new Ow,this.loadingResults=!1}ngOnInit(){this.searchResults=this.searchFormControl.valueChanges.pipe(cf(300),Jp(()=>{this.loadingResults=!0}),E(t=>\"string\"==typeof t?t:t.name),JC(t=>\"\"===t?Xp([]):this.workerService.ships.findShips(t.toUpperCase())),E(t=>(this.loadingResults=!1,this.existingItems.length>0?t.filter(t=>!this.existingItems.includes(t.mmsi)):t)))}selectShip(t){t&&(this.selectItem.emit(t),this.searchFormControl.reset(\"\"))}selectValue(){this.allowTextValue&&this.searchFormControl.value&&(this.selectItem.emit(this.searchFormControl.value),this.searchFormControl.reset(\"\"))}}return t.\\u0275fac=function(e){return new(e||t)(Ta(iU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-ship-identifier-input\"]],viewQuery:function(t,e){if(1&t&&kh(aJ,5),2&t){let t;Ch(t=Mh())&&(e.inputElement=t.first)}},inputs:{allowTextValue:\"allowTextValue\",existingItems:\"existingItems\"},outputs:{selectItem:\"selectItem\"},decls:9,vars:6,consts:[[\"matAutocompleteOrigin\",\"\",1,\"ship-identifier-input\"],[\"origin\",\"matAutocompleteOrigin\"],[\"type\",\"search\",\"placeholder\",\"Nom, MMSI, IMO...\",\"matInput\",\"\",1,\"ship-identifier-input__input\",3,\"formControl\",\"matAutocomplete\",\"matAutocompleteConnectedTo\",\"keyup.enter\"],[\"searchInput\",\"\"],[3,\"optionSelected\"],[\"autocomplete\",\"matAutocomplete\"],[\"class\",\"ship-identifier-input__result-item\",3,\"value\",4,\"ngFor\",\"ngForOf\"],[1,\"ship-identifier-input__result-item\",3,\"value\"],[1,\"d-flex-column\"],[3,\"flag\"],[1,\"mr-3\"]],template:function(t,e){if(1&t&&(Pa(0,\"div\",0,1),Pa(2,\"mat-form-field\"),Pa(3,\"input\",2,3),$a(\"keyup.enter\",function(){return e.selectValue()}),Da(),Pa(5,\"mat-autocomplete\",4,5),$a(\"optionSelected\",function(){return e.selectShip(e.searchFormControl.value)}),na(7,lJ,9,5,\"mat-option\",6),oh(8,\"async\"),Da(),Da(),Da()),2&t){const t=ra(1),i=ra(6);Ss(3),Ia(\"formControl\",e.searchFormControl)(\"matAutocomplete\",i)(\"matAutocompleteConnectedTo\",t),Ss(4),Ia(\"ngForOf\",ah(8,4,e.searchResults))}},directives:[tJ,tS,hS,Mb,sJ,aw,Ww,QQ,Fd,cb,TZ],pipes:[Kd],styles:[\".ship-identifier-input[_ngcontent-%COMP%]{flex:1;display:flex;color:#50647f}.ship-identifier-input[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:100%}.ship-identifier-input__input[_ngcontent-%COMP%]{border:0;outline:0;padding:8px;height:1.5em;min-width:300px}.ship-identifier-input__result-item[_ngcontent-%COMP%]{line-height:22px}\",\"[_nghost-%COMP%]{flex:1;display:flex}\"],changeDetection:0}),t})();function hJ(t,e){if(1&t){const t=Na();Pa(0,\"mat-chip\",7),$a(\"removed\",function(){const e=Fe(t).index;return Wa(3).criterion.identifiers.splice(e,1)}),bl(1),Pa(2,\"mat-icon\",8),bl(3,\"cancel\"),Da(),Da()}if(2&t){const t=e.$implicit;Ia(\"selectable\",!1),Ss(1),xl(\" \",t,\" \")}}function uJ(t,e){if(1&t){const t=Na();Pa(0,\"mat-chip-list\"),na(1,hJ,4,2,\"mat-chip\",4),Da(),Pa(2,\"div\",5),Pa(3,\"app-ship-identifier-input\",6),$a(\"selectItem\",function(e){return Fe(t),Wa(2).addIdentifier(e)}),Da(),Da()}if(2&t){const t=Wa(2);Ss(1),Ia(\"ngForOf\",t.criterion.identifiers),Ss(2),Ia(\"allowTextValue\",!0)}}function dJ(t,e){1&t&&bl(0),2&t&&xl(\" Identifiants : \",Wa(2).criterion.identifiers.join(\", \"),\" \")}function pJ(t,e){if(1&t&&(na(0,uJ,4,2,\"ng-template\",2),na(1,dJ,1,1,\"ng-template\",null,3,Ph)),2&t){const t=ra(2);Ia(\"ngIf\",Wa().editable)(\"ngIfElse\",t)}}let fJ=(()=>{class t extends AK{addIdentifier(t){t&&this.criterion.identifiers.push(t instanceof String?t:t.name)}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"app-identifier-filter\"]],features:[Gl([{provide:Cb,useExisting:t,multi:!0}]),Vo],decls:2,vars:4,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"],[3,\"ngIf\"],[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[\"disableRipple\",\"\",\"removable\",\"\",3,\"selectable\",\"removed\",4,\"ngFor\",\"ngForOf\"],[1,\"criterion-content\"],[3,\"allowTextValue\",\"selectItem\"],[\"disableRipple\",\"\",\"removable\",\"\",3,\"selectable\",\"removed\"],[\"matChipRemove\",\"\",\"title\",\"Retirer ce filtre\"]],template:function(t,e){1&t&&(Pa(0,\"app-alert-rule-criterion\",0),$a(\"enableChange\",function(t){return e.enable=t}),na(1,pJ,3,2,\"ng-template\",1),Da()),2&t&&(Ia(\"type\",e.criteriaLabels.identifier)(\"enable\",e.enable)(\"editable\",e.editable),Ss(1),Ia(\"ngIf\",e.criterion.enable))},directives:[SK,Bd,eX,Fd,cJ,ZZ,Yk,XZ],encapsulation:2,changeDetection:0}),t})(),mJ=(()=>{class t{constructor(){this.values=[],this.key=\"\",this.text=\"Tout s\\xe9lectionner\"}isChecked(){return this.model.value&&this.values.length&&this.model.value.length===this.values.length}isIndeterminate(){return this.model.value&&this.values.length&&this.model.value.length&&this.model.value.length<this.values.length}toggleSelection(t){this.model.update.emit(t.checked?this.values.map(t=>t[this.key]):[])}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-select-check-all\"]],inputs:{model:\"model\",values:\"values\",key:\"key\",text:\"text\"},decls:2,vars:4,consts:[[\"color\",\"primary\",1,\"mat-option\",3,\"disableRipple\",\"indeterminate\",\"checked\",\"click\",\"change\"]],template:function(t,e){1&t&&(Pa(0,\"mat-checkbox\",0),$a(\"click\",function(t){return t.stopPropagation()})(\"change\",function(t){return e.toggleSelection(t)}),bl(1),Da()),2&t&&(Ia(\"disableRipple\",!0)(\"indeterminate\",e.isIndeterminate())(\"checked\",e.isChecked()),Ss(1),xl(\" \",e.text,\" \"))},directives:[NY],styles:[\"\"]}),t})();function gJ(t,e){if(1&t&&(Pa(0,\"mat-option\",10),bl(1),Da()),2&t){const t=e.$implicit;Ia(\"value\",t.id),Ss(1),xl(\" \",t.name,\" \")}}function AJ(t,e){if(1&t){const t=Na();Pa(0,\"div\",4),Pa(1,\"mat-form-field\",5),Pa(2,\"mat-label\"),bl(3,\"Flottes\"),Da(),Pa(4,\"mat-select\",6,7),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).criterion.fleets=e}),Ra(6,\"app-select-check-all\",8),na(7,gJ,2,2,\"mat-option\",9),Da(),Da(),Da()}if(2&t){const t=ra(5),e=Wa(2);Ss(4),Ia(\"ngModel\",e.criterion.fleets),Ss(2),Ia(\"model\",t)(\"values\",e.fleets)(\"key\",\"id\"),Ss(1),Ia(\"ngForOf\",e.fleets)}}function vJ(t,e){1&t&&bl(0),2&t&&xl(\" Flottes : \",Wa(2).fleetNames.join(\", \"),\" \")}function _J(t,e){if(1&t&&(na(0,AJ,8,5,\"ng-template\",2),na(1,vJ,1,1,\"ng-template\",null,3,Ph)),2&t){const t=ra(2);Ia(\"ngIf\",Wa().editable)(\"ngIfElse\",t)}}let yJ=(()=>{class t extends AK{constructor(t){super(),this.fleetsService=t,this.fleets=[],this.fleetsService.fleets$.subscribe(t=>{this.fleets=t})}get fleetNames(){return this.criterion.fleets.map(t=>{var e;return(null!==(e=this.fleetsService.fleetsById[t])&&void 0!==e?e:{}).name}).filter(t=>!!t)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Tq))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-fleet-filter\"]],features:[Gl([{provide:Cb,useExisting:t,multi:!0}]),Vo],decls:2,vars:4,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"],[3,\"ngIf\"],[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[1,\"criterion-content\"],[1,\"d-block\"],[\"multiple\",\"\",3,\"ngModel\",\"ngModelChange\"],[\"fleetSelection\",\"ngModel\"],[3,\"model\",\"values\",\"key\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[3,\"value\"]],template:function(t,e){1&t&&(Pa(0,\"app-alert-rule-criterion\",0),$a(\"enableChange\",function(t){return e.enable=t}),na(1,_J,3,2,\"ng-template\",1),Da()),2&t&&(Ia(\"type\",e.criteriaLabels.fleet)(\"enable\",e.enable)(\"editable\",e.editable),Ss(1),Ia(\"ngIf\",e.criterion.enable))},directives:[SK,Bd,tS,Hx,IT,aw,Vw,mJ,Fd,cb],encapsulation:2,changeDetection:0}),t})();function bJ(t,e){if(1&t&&(Pa(0,\"mat-option\",10),Ra(1,\"app-flag\",11),bl(2),Da()),2&t){const t=e.$implicit;Ia(\"value\",t.flag),Ss(1),Ia(\"flag\",t.flag),Ss(1),xl(\" \",t.name,\" \")}}function wJ(t,e){if(1&t){const t=Na();Pa(0,\"div\",4),Pa(1,\"mat-form-field\",5),Pa(2,\"mat-label\"),bl(3,\"Pavillon\"),Da(),Pa(4,\"mat-select\",6,7),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).criterion.flags=e}),Ra(6,\"app-select-check-all\",8),na(7,bJ,3,3,\"mat-option\",9),Da(),Da(),Da()}if(2&t){const t=ra(5),e=Wa(2);Ss(4),Ia(\"ngModel\",e.criterion.flags),Ss(2),Ia(\"model\",t)(\"values\",e.countries)(\"key\",\"flag\"),Ss(1),Ia(\"ngForOf\",e.countries)}}function xJ(t,e){if(1&t&&(Pa(0,\"mat-option\",10),Ra(1,\"app-flag\",11),bl(2),Da()),2&t){const t=e.$implicit;Ia(\"value\",t.flag),Ss(1),Ia(\"flag\",t.flag),Ss(1),xl(\" \",t.name,\" \")}}function SJ(t,e){if(1&t){const t=Na();Pa(0,\"mat-select\",12,7),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).criterion.flags=e}),Ra(2,\"app-select-check-all\",8),na(3,xJ,3,3,\"mat-option\",9),Da()}if(2&t){const t=ra(1),e=Wa(2);Ia(\"ngModel\",e.criterion.flags),Ss(2),Ia(\"model\",t)(\"values\",e.countries)(\"key\",\"flag\"),Ss(1),Ia(\"ngForOf\",e.countries)}}function CJ(t,e){if(1&t&&(na(0,wJ,8,5,\"ng-template\",2),na(1,SJ,4,5,\"ng-template\",null,3,Ph)),2&t){const t=ra(2);Ia(\"ngIf\",Wa().editable)(\"ngIfElse\",t)}}let kJ=(()=>{class t extends AK{constructor(){super(...arguments),this.countries=xU}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"app-flag-filter\"]],features:[Gl([{provide:Cb,useExisting:t,multi:!0}]),Vo],decls:2,vars:4,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"],[3,\"ngIf\"],[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[1,\"criterion-content\"],[1,\"d-block\",\"px-3\"],[\"multiple\",\"\",3,\"ngModel\",\"ngModelChange\"],[\"countrySelection\",\"ngModel\"],[3,\"model\",\"values\",\"key\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[3,\"value\"],[3,\"flag\"],[\"multiple\",\"\",\"disabled\",\"\",3,\"ngModel\",\"ngModelChange\"]],template:function(t,e){1&t&&(Pa(0,\"app-alert-rule-criterion\",0),$a(\"enableChange\",function(t){return e.enable=t}),na(1,CJ,3,2,\"ng-template\",1),Da()),2&t&&(Ia(\"type\",e.criteriaLabels.flag)(\"enable\",e.enable)(\"editable\",e.editable),Ss(1),Ia(\"ngIf\",e.criterion.enable))},directives:[SK,Bd,tS,Hx,IT,aw,Vw,mJ,Fd,cb,TZ],encapsulation:2,changeDetection:0}),t})();function EJ(t,e){if(1&t&&(Pa(0,\"mat-option\",10),bl(1),Da()),2&t){const t=e.$implicit;Ia(\"value\",t.key),Ss(1),xl(\" \",t.name,\" \")}}function MJ(t,e){if(1&t){const t=Na();Pa(0,\"div\",4),Pa(1,\"mat-form-field\",5),Pa(2,\"mat-label\"),bl(3,\"Types\"),Da(),Pa(4,\"mat-select\",6,7),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).criterion.types=e}),Ra(6,\"app-select-check-all\",8),na(7,EJ,2,2,\"mat-option\",9),Da(),Da(),Da()}if(2&t){const t=ra(5),e=Wa(2);Ss(4),Ia(\"ngModel\",e.criterion.types),Ss(2),Ia(\"model\",t)(\"values\",e.vesselTypes)(\"key\",\"key\"),Ss(1),Ia(\"ngForOf\",e.vesselTypes)}}function TJ(t,e){1&t&&bl(0),2&t&&xl(\" \",Wa(2).criteriaTypes.join(\", \"),\" \")}function IJ(t,e){if(1&t&&(na(0,MJ,8,5,\"ng-template\",2),na(1,TJ,1,1,\"ng-template\",null,3,Ph)),2&t){const t=ra(2);Ia(\"ngIf\",Wa().editable)(\"ngIfElse\",t)}}let OJ=(()=>{class t extends AK{constructor(){super(...arguments),this.typesControl=new Ow,this.vesselTypes=Nj,this.vesselTypeLabelsByType=zj}get criteriaTypes(){return this.criterion.types.map(t=>Vj[t].name)}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"app-type-filter\"]],features:[Gl([{provide:Cb,useExisting:t,multi:!0}]),Vo],decls:2,vars:4,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"],[3,\"ngIf\"],[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[1,\"criterion-content\"],[1,\"d-block\"],[\"multiple\",\"\",3,\"ngModel\",\"ngModelChange\"],[\"typeSelection\",\"ngModel\"],[3,\"model\",\"values\",\"key\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[3,\"value\"]],template:function(t,e){1&t&&(Pa(0,\"app-alert-rule-criterion\",0),$a(\"enableChange\",function(t){return e.enable=t}),na(1,IJ,3,2,\"ng-template\",1),Da()),2&t&&(Ia(\"type\",e.criteriaLabels.type)(\"enable\",e.enable)(\"editable\",e.editable),Ss(1),Ia(\"ngIf\",e.criterion.enable))},directives:[SK,Bd,tS,Hx,IT,aw,Vw,mJ,Fd,cb],encapsulation:2,changeDetection:0}),t})();function PJ(t,e){1&t&&Ba(0)}const DJ=function(t){return{alert:t}};function RJ(t,e){if(1&t&&na(0,PJ,1,0,\"ng-container\",6),2&t){const t=Wa();Ia(\"ngTemplateOutlet\",t.titleRef)(\"ngTemplateOutletContext\",Jc(2,DJ,t.alert))}}function FJ(t,e){1&t&&Ba(0)}function LJ(t,e){1&t&&(Pa(0,\"mat-icon\",16),bl(1,\"report_off\"),Da())}function BJ(t,e){if(1&t&&(Pa(0,\"div\",12),na(1,FJ,1,0,\"ng-container\",6),na(2,LJ,2,0,\"mat-icon\",13),Da(),Pa(3,\"div\",14),oh(4,\"timeago\"),Pa(5,\"mat-icon\",15),bl(6,\"access_time\"),Da(),bl(7),oh(8,\"date\"),Da()),2&t){const t=Wa();Ss(1),Ia(\"ngTemplateOutlet\",t.titleRef)(\"ngTemplateOutletContext\",Jc(11,DJ,t.alert)),Ss(1),Ia(\"ngIf\",t.alert.false_positive),Ss(1),Ka(\"title\",ah(4,5,1e3*t.alert.start)),Ss(4),xl(\" \",ch(8,7,1e3*t.alert.start,\"yyyy-MM-dd HH:mm:ss z\",t.mapConfigService.useUTCDates$.value&&\"+00\"),\" \")}}function NJ(t,e){1&t&&(Pa(0,\"button\",17),Pa(1,\"mat-icon\"),bl(2,\"more_vert\"),Da(),Da()),2&t&&(Wa(),Ia(\"matMenuTriggerFor\",ra(6)))}function zJ(t,e){1&t&&Ba(0)}function VJ(t,e){if(1&t){const t=Na();Pa(0,\"button\",18),$a(\"click\",function(){return Fe(t),Wa().unreadAlert()}),Pa(1,\"mat-icon\"),bl(2,\"markunread\"),Da(),bl(3,\" Marquer comme non-lu \"),Da()}}function jJ(t,e){if(1&t){const t=Na();Pa(0,\"button\",19),$a(\"click\",function(){return Fe(t),Wa().readAlert()}),Pa(1,\"mat-icon\"),bl(2,\"drafts\"),Da(),bl(3,\" Marquer comme lu \"),Da()}}function $J(t,e){if(1&t){const t=Na();Pa(0,\"button\",20),$a(\"click\",function(){return Fe(t),Wa().markAsFalsePositive()}),Pa(1,\"mat-icon\"),bl(2,\"report_off\"),Da(),bl(3,\" Marquer comme faux-positif \"),Da()}}function UJ(t,e){if(1&t){const t=Na();Pa(0,\"button\",21),$a(\"click\",function(){return Fe(t),Wa().markAsTruePositive()}),Pa(1,\"mat-icon\"),bl(2,\"report\"),Da(),bl(3,\" Marquer comme vrai-positif \"),Da()}}let HJ=(()=>{class t extends Lq{constructor(t,e,i,n,r,s){super(),this.configService=t,this.historyService=e,this.mapConfigService=i,this.offlineService=n,this.mapService=r,this.workerService=s,this.highlight=!1,this.simple=!0,this.update=new ph}ngOnInit(){this.ensureMandatoryInputParams(\"alert\")}locateAlert(){return Vp(this,void 0,void 0,function*(){this.configService.devMode&&console.log(\"locate-alert\",JSON.stringify(this.alert,null,2)),this.mapService.pingLocation([this.alert.lon,this.alert.lat]),this.mapService.centerOnLonLat([this.alert.lon,this.alert.lat]),this.alert.read||(yield this.readAlert())})}locateAndZoom(){this.mapService.locate([this.alert.lon,this.alert.lat])}readAlert(){return Vp(this,void 0,void 0,function*(){yield this.workerService.alerts.markAlertAsRead(this.alert.id),this.alert.read=!0,this.emitUpdate()})}unreadAlert(){return Vp(this,void 0,void 0,function*(){yield this.workerService.alerts.markAlertAsUnread(this.alert.id),this.alert.read=!1,this.emitUpdate()})}markAsFalsePositive(){return Vp(this,void 0,void 0,function*(){yield this.workerService.alerts.markAlertAsFalsePositive(this.alert.id),this.alert.false_positive=!0,this.emitUpdate()})}markAsTruePositive(){return Vp(this,void 0,void 0,function*(){yield this.workerService.alerts.markAlertAsTruePositive(this.alert.id),this.alert.false_positive=!1,this.emitUpdate()})}emitUpdate(){this.update.emit(this.alert)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(C$),Ta(R$),Ta(k$),Ta(fq),Ta(T$),Ta(iU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-alert-item\"]],inputs:{alert:\"alert\",titleRef:\"titleRef\",menuItemsRef:\"menuItemsRef\",highlight:\"highlight\",simple:\"simple\"},outputs:{update:\"update\"},features:[Vo],decls:16,vars:15,consts:[[1,\"alert-item\"],[\"mat-button\",\"\",\"title\",\"Localiser l'alerte (double-clic = zoom)\",1,\"alert-item__content\",3,\"click\",\"dblclick\"],[3,\"ngIf\"],[\"mat-button\",\"\",\"class\",\"alert-item__actions-button\",\"title\",\"Actions\",3,\"matMenuTriggerFor\",4,\"ngIf\"],[1,\"u-wide-menu\"],[\"alertActionsMenu\",\"matMenu\"],[4,\"ngTemplateOutlet\",\"ngTemplateOutletContext\"],[\"mat-menu-item\",\"\",\"title\",\"Marquer comme non-lu\",3,\"click\",4,\"ngIf\"],[\"mat-menu-item\",\"\",\"title\",\"Marquer comme lu\",3,\"click\",4,\"ngIf\"],[\"mat-menu-item\",\"\",\"title\",\"Marquer comme faux-positif\",3,\"click\",4,\"ngIf\"],[\"mat-menu-item\",\"\",\"title\",\"Marquer comme vrai-positif\",3,\"click\",4,\"ngIf\"],[\"mat-menu-item\",\"\",\"title\",\"Visualiser la situation des navires\",3,\"click\"],[1,\"alert-item__title\"],[\"style\",\"margin-left: .5em\",\"title\",\"L'alerte a \\xe9t\\xe9 marqu\\xe9e comme \\xe9tant un faux-positif\",4,\"ngIf\"],[1,\"alert-item__timestamp\",3,\"title\"],[\"title\",\"R\\xe9ception\",1,\"mini-icon\",\"mr-1\"],[\"title\",\"L'alerte a \\xe9t\\xe9 marqu\\xe9e comme \\xe9tant un faux-positif\",2,\"margin-left\",\".5em\"],[\"mat-button\",\"\",\"title\",\"Actions\",1,\"alert-item__actions-button\",3,\"matMenuTriggerFor\"],[\"mat-menu-item\",\"\",\"title\",\"Marquer comme non-lu\",3,\"click\"],[\"mat-menu-item\",\"\",\"title\",\"Marquer comme lu\",3,\"click\"],[\"mat-menu-item\",\"\",\"title\",\"Marquer comme faux-positif\",3,\"click\"],[\"mat-menu-item\",\"\",\"title\",\"Marquer comme vrai-positif\",3,\"click\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"button\",1),$a(\"click\",function(){return e.locateAlert()})(\"dblclick\",function(){return e.locateAndZoom()}),na(2,RJ,1,4,\"ng-template\",2),na(3,BJ,9,13,\"ng-template\",2),Da(),na(4,NJ,3,1,\"button\",3),Pa(5,\"mat-menu\",4,5),na(7,zJ,1,0,\"ng-container\",6),na(8,VJ,4,0,\"button\",7),na(9,jJ,4,0,\"button\",8),na(10,$J,4,0,\"button\",9),na(11,UJ,4,0,\"button\",10),Pa(12,\"button\",11),$a(\"click\",function(){return e.historyService.setTimestamp(e.alert.start)}),Pa(13,\"mat-icon\"),bl(14,\"history\"),Da(),bl(15,\" Visualiser la situation des navires \"),Da(),Da(),Da()),2&t&&(ll(\"alert-item--unread\",!e.alert.read)(\"alert-item--highlighted\",e.highlight),Ss(2),Ia(\"ngIf\",!e.simple),Ss(1),Ia(\"ngIf\",e.simple),Ss(1),Ia(\"ngIf\",!e.offlineService.isOffline$.value),Ss(3),Ia(\"ngTemplateOutlet\",e.menuItemsRef)(\"ngTemplateOutletContext\",Jc(13,DJ,e.alert)),Ss(1),Ia(\"ngIf\",e.alert.read),Ss(1),Ia(\"ngIf\",!e.alert.read),Ss(1),Ia(\"ngIf\",!e.alert.false_positive),Ss(1),Ia(\"ngIf\",e.alert.false_positive))},directives:[vb,Bd,LX,Gd,PX,Yk,jX],pipes:[SL,Qd],styles:[\".alert-item[_ngcontent-%COMP%]{flex:1;display:flex;align-items:stretch;justify-content:stretch;transition:2s ease-out background-color;min-height:82px;padding-left:6px}.alert-item--unread[_ngcontent-%COMP%]{font-weight:600;border-left:6px solid #3778ff;padding-left:0}.alert-item--highlighted[_ngcontent-%COMP%]{background-color:#f32121;transition:0s}.alert-item__content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:stretch;justify-content:center;line-height:24px;padding:.5em;font-weight:inherit!important;text-align:left}.alert-item__title[_ngcontent-%COMP%]{padding:0;width:100%;display:flex;justify-content:space-between;align-items:center;font-size:1.1em}.alert-item__actions-button[_ngcontent-%COMP%]{min-width:inherit!important}.alert-item__timestamp[_ngcontent-%COMP%]{color:#424242;font-weight:500;display:flex;align-items:center}\"],changeDetection:0}),t})();const GJ=[\"alertElements\"];function qJ(t,e){if(1&t&&bl(0),2&t){const t=Wa();xl(\" \",t.activeRulesFiltersCount>0?t.activeRulesFiltersCount+\" filtre(s) de r\\xe8gles actif(s)\":\"Aucun filtre de r\\xe8gles actif\",\" \")}}function WJ(t,e){1&t&&bl(0,\" Afficher les filtres \")}function YJ(t,e){if(1&t&&(Pa(0,\"mat-option\",15),bl(1),Da()),2&t){const t=e.$implicit;Ia(\"value\",t.id),Ss(1),xl(\" \",t.name,\" \")}}function ZJ(t,e){if(1&t){const t=Na();Pa(0,\"h3\",6),bl(1,\" R\\xe8gles d'alertes \"),Pa(2,\"button\",12),$a(\"click\",function(){return Fe(t),Wa().resetRulesFilters()}),bl(3,\" R\\xe9initialiser \"),Da(),Da(),Pa(4,\"mat-list-item\"),Pa(5,\"mat-form-field\"),Pa(6,\"mat-label\"),bl(7,\"R\\xe8gles\"),Da(),Pa(8,\"mat-select\",13),$a(\"ngModelChange\",function(e){return Fe(t),Wa().updateAlertRulesFilter(e)}),na(9,YJ,2,2,\"mat-option\",14),Da(),Da(),Da()}if(2&t){const t=Wa();Ss(8),Ia(\"ngModel\",t.alertsFilter.rules),Ss(1),Ia(\"ngForOf\",t.alertRules)}}function XJ(t,e){if(1&t){const t=Na();Pa(0,\"app-alert-item\",18,19),$a(\"update\",function(e){const i=Fe(t).$implicit;return Wa(2).updateAlert(i.id,e)}),Da()}if(2&t){const t=e.$implicit,i=Wa(2);Ia(\"titleRef\",i.alertTitleRef)(\"simple\",i.simpleItems)(\"menuItemsRef\",i.alertMenuItemsRef)(\"alert\",t)(\"highlight\",t.id===i.highlightedAlertId),ta(\"data-id\",t.id)}}function KJ(t,e){if(1&t&&(Pa(0,\"div\",16),na(1,XJ,2,6,\"app-alert-item\",17),Da()),2&t){const t=Wa();Ss(1),Ia(\"ngForOf\",t.displayedAlerts)(\"ngForTrackBy\",t.trackByIndex)}}function QJ(t,e){1&t&&(Pa(0,\"div\",20),bl(1,\" Aucune alerte ne correspond aux filtres\\n\"),Da())}function JJ(t,e){1&t&&(Pa(0,\"div\",20),bl(1,\" Aucune alerte pour cette p\\xe9riode\\n\"),Da())}let t0=(()=>{class t extends Lq{constructor(t,e,i,n,r){super(),this.changeDetectorRef=t,this.ngZone=e,this.alertRulesService=i,this.configService=n,this.interactionsService=r,this.enableRuleFilters=!1,this.simpleItems=!0,this.alertRules=[],this.alertsFilter=new o$,this.filteredAlerts=[],this.displayedAlerts=[],this.currentAlertsPageIndex=0,this.alertsPageSize=30,this.highlightedAlertId=null,this.alertsFilter$=new Zp(new o$),this.currentAlertsPageIndex$=new Zp(0),this.filteredAlerts$=new Zp([])}ngOnInit(){if(this.ensureMandatoryInputParams(\"alerts$\"),this.subscriptions.push(this.alertRulesService.alertRules$.pipe(_P()).subscribe(t=>{this.alertRules=t,this.alertRules.map(t=>t.id)})),this.configService.alertsFilter){const t=this.alertRules.map(t=>t.id);this.configService.alertsFilter.rules=this.configService.alertsFilter.rules.filter(e=>t.includes(e)),this.alertsFilter$.next(this.configService.alertsFilter)}else this.resetRulesFilters();this.subscriptions.push(this.alerts$.subscribe(t=>{this.alerts=t})),this.subscriptions.push(LT([this.alerts$,this.alertsFilter$]).pipe(E(([t,e])=>t.filter(t=>(0===e.rules.length||e.rules.includes(t.rule_id))&&(e.showReadAlerts||!t.read)&&(e.showFalsePositiveAlerts||!t.false_positive)))).subscribe(t=>{this.filteredAlerts=t,this.filteredAlerts$.next(t)})),this.subscriptions.push(LT([this.filteredAlerts$,this.currentAlertsPageIndex$]).pipe(pf(([t,e])=>{if(0===t.length&&0!==e)return this.showAlertsPage(0),!1;const i=e*this.alertsPageSize;if(0===t.slice(i,i+this.alertsPageSize).length&&t.length>0){const e=Math.ceil(t.length/this.alertsPageSize)-1;return this.showAlertsPage(-1===e?0:e),!1}return!0}),E(([t,e])=>{const i=e*this.alertsPageSize;return t.slice(i,i+this.alertsPageSize)})).subscribe(t=>{this.displayedAlerts=t,this.changeDetectorRef.markForCheck()})),this.subscriptions.push(this.alertsFilter$.subscribe(t=>{this.alertsFilter=t,this.configService.set(\"alertsFilter\",t),this.showAlertsPage(0)})),this.subscriptions.push(this.interactionsService.selectAlertFeature$.subscribe(t=>{const e=this.getPageIndexForAlertId(t.id);-1!==e&&this.currentAlertsPageIndex!==e&&this.showAlertsPage(e),setTimeout(()=>{const e=this.alertElements.find(e=>e.nativeElement.dataset.id===t.id);e&&e.nativeElement.scrollIntoView({behavior:\"smooth\"})},225),this.highlightedAlertId=t.id,this.ngZone.run(()=>{setTimeout(()=>{this.highlightedAlertId=null,this.changeDetectorRef.markForCheck()},16),this.changeDetectorRef.markForCheck()})}))}get activeRulesFiltersCount(){const t=this.alertsFilter.rules.length;return t===this.alertRules.length?0:t}updateShowReadAlerts(t){this.alertsFilter.showReadAlerts=t,this.triggerAlertsFilterUpdate()}updateShowFalsePositiveAlerts(t){this.alertsFilter.showFalsePositiveAlerts=t,this.triggerAlertsFilterUpdate()}updateAlertRulesFilter(t){this.alertsFilter.rules=t,this.triggerAlertsFilterUpdate()}resetRulesFilters(){this.updateAlertRulesFilter(this.alertRules.map(t=>t.id))}triggerAlertsFilterUpdate(){this.alertsFilter$.next(this.alertsFilter)}showAlertsPage(t){this.currentAlertsPageIndex$.next(t),this.currentAlertsPageIndex=t}trackByIndex(t){return t}updateAlert(t,e){const i=this.alerts.find(e=>e.id===t);if(!i)throw new Error(`Missing alert with id '${t}'`);Object.assign(i,e),this.alerts$.next(this.alerts)}getPageIndexForAlertId(t){const e=this.filteredAlerts.findIndex(e=>e.id===t);if(-1===e)return-1;const i=Math.ceil((e+1)/this.alertsPageSize)-1;return-1===i?0:i}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Cc),Ta(tu),Ta(hH),Ta(C$),Ta(Cq))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-alerts-list\"]],viewQuery:function(t,e){if(1&t&&kh(GJ,5,Jl),2&t){let t;Ch(t=Mh())&&(e.alertElements=t)}},inputs:{alerts$:\"alerts$\",enableRuleFilters:\"enableRuleFilters\",alertTitleRef:\"alertTitleRef\",alertMenuItemsRef:\"alertMenuItemsRef\",simpleItems:\"simpleItems\"},features:[Vo],decls:22,vars:13,consts:[[\"mat-button\",\"\",\"title\",\"Filtrer les alertes\",1,\"alerts-list__filters\",3,\"color\",\"matMenuTriggerFor\"],[3,\"ngIf\",\"ngIfElse\"],[\"disabledRuleFilters\",\"\"],[1,\"u-wide-menu\"],[\"alertsFilterMenu\",\"matMenu\"],[3,\"click\"],[\"mat-subheader\",\"\"],[\"color\",\"primary\",3,\"ngModel\",\"ngModelChange\"],[3,\"ngIf\"],[\"class\",\"scrollable\",4,\"ngIf\"],[\"class\",\"panel__content u-center\",4,\"ngIf\"],[\"showFirstLastButtons\",\"\",\"hidePageSize\",\"\",3,\"pageIndex\",\"length\",\"pageSize\",\"page\"],[\"mat-button\",\"\",\"title\",\"R\\xe9initialiser les filtres\",1,\"alerts-list__reset-filters-btn\",3,\"click\"],[\"multiple\",\"\",3,\"ngModel\",\"ngModelChange\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[3,\"value\"],[1,\"scrollable\"],[3,\"titleRef\",\"simple\",\"menuItemsRef\",\"alert\",\"highlight\",\"update\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[3,\"titleRef\",\"simple\",\"menuItemsRef\",\"alert\",\"highlight\",\"update\"],[\"alertElements\",\"\"],[1,\"panel__content\",\"u-center\"]],template:function(t,e){if(1&t&&(Pa(0,\"button\",0),Pa(1,\"mat-icon\"),bl(2,\"filter_list\"),Da(),na(3,qJ,1,1,\"ng-template\",1),na(4,WJ,1,0,\"ng-template\",null,2,Ph),Da(),Pa(6,\"mat-menu\",3,4),Pa(8,\"mat-list\",5),$a(\"click\",function(t){return t.stopPropagation()}),Pa(9,\"h2\",6),bl(10,\"Filtres\"),Da(),Pa(11,\"mat-list-item\"),Pa(12,\"mat-checkbox\",7),$a(\"ngModelChange\",function(t){return e.updateShowReadAlerts(t)}),bl(13,\"Afficher les alertes lues\"),Da(),Da(),Pa(14,\"mat-list-item\"),Pa(15,\"mat-checkbox\",7),$a(\"ngModelChange\",function(t){return e.updateShowFalsePositiveAlerts(t)}),bl(16,\"Afficher les faux-positifs\"),Da(),Da(),na(17,ZJ,10,2,\"ng-template\",8),Da(),Da(),na(18,KJ,2,2,\"div\",9),na(19,QJ,2,0,\"div\",10),na(20,JJ,2,0,\"div\",10),Pa(21,\"mat-paginator\",11),$a(\"page\",function(t){return e.showAlertsPage(t.pageIndex)}),Da()),2&t){const t=ra(5),i=ra(7);Ia(\"color\",e.activeRulesFiltersCount?\"primary\":\"default\")(\"matMenuTriggerFor\",i),Ss(3),Ia(\"ngIf\",e.enableRuleFilters)(\"ngIfElse\",t),Ss(9),Ia(\"ngModel\",e.alertsFilter.showReadAlerts),Ss(3),Ia(\"ngModel\",e.alertsFilter.showFalsePositiveAlerts),Ss(2),Ia(\"ngIf\",e.enableRuleFilters),Ss(1),Ia(\"ngIf\",e.displayedAlerts.length),Ss(1),Ia(\"ngIf\",!e.filteredAlerts.length&&e.alerts.length),Ss(1),Ia(\"ngIf\",!e.alerts.length),Ss(1),Ia(\"pageIndex\",e.currentAlertsPageIndex)(\"length\",e.filteredAlerts.length)(\"pageSize\",e.alertsPageSize)}},directives:[vb,jX,Yk,Bd,LX,tK,nK,rK,NY,aw,Vw,pI,tS,Hx,IT,Fd,cb,HJ],styles:[\"[_nghost-%COMP%]{display:flex;flex-direction:column;overflow:hidden}.alerts-list__filters[_ngcontent-%COMP%]{background-color:#e4e7ec;width:100%}.alerts-list__reset-filters-btn[_ngcontent-%COMP%]{margin-left:2em}\"],changeDetection:0}),t})();function e0(t,e){1&t&&Ra(0,\"mat-spinner\",5)}function i0(t,e){1&t&&(Pa(0,\"mat-error\",32),bl(1,\" Ce champ ne peut \\xeatre vide. \"),Da())}function n0(t,e){if(1&t){const t=Na();Pa(0,\"mat-form-field\",26),Pa(1,\"input\",27,28),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).alertRule.name=e}),Da(),na(3,i0,2,0,\"mat-error\",29),Da(),Pa(4,\"button\",30),$a(\"click\",function(){return Fe(t),Wa(2).save()}),Pa(5,\"mat-icon\"),bl(6,\"check\"),Da(),Da(),Pa(7,\"button\",31),Pa(8,\"mat-icon\"),bl(9,\"clear\"),Da(),Da()}if(2&t){const t=ra(2);Wa();const e=ra(1),i=Wa();Ss(1),Ia(\"ngModel\",i.alertRule.name),Ss(2),Ia(\"ngIf\",null==t.errors?null:t.errors.required),Ss(1),Ia(\"disabled\",!e.form.valid),Ss(3),Ia(\"routerLink\",i.newRule?\"/alerts/rules\":\"/alerts/rules/\"+i.alertRule.id)}}function r0(t,e){if(1&t){const t=Na();Pa(0,\"h2\",33),bl(1),Da(),Ra(2,\"div\",14),Pa(3,\"button\",34),Pa(4,\"mat-icon\"),bl(5,\"create\"),Da(),Da(),Pa(6,\"button\",35),$a(\"click\",function(){return Fe(t),Wa(2).delete()}),Pa(7,\"mat-icon\"),bl(8,\"delete\"),Da(),Da()}if(2&t){const t=Wa(2);Ss(1),xl(\" \",t.alertRule.name,\" \"),Ss(2),Ia(\"routerLink\",\"/alerts/rules/\"+t.alertRule.id+\"/edit\")}}function s0(t,e){1&t&&(Pa(0,\"div\",17),Pa(1,\"mat-chip-list\",12),Pa(2,\"mat-chip\",36),bl(3,\" Configuration incorrecte \"),Da(),Da(),Da())}function o0(t,e){1&t&&(Pa(0,\"div\",17),Pa(1,\"mat-chip-list\",12),Pa(2,\"mat-chip\",36),bl(3,\" Configuration incorrecte \"),Da(),Da(),Da())}function a0(t,e){if(1&t){const t=Na();bl(0,\" \\xa0 \"),Pa(1,\"mat-slide-toggle\",37),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).alertRule.active=e}),Da()}if(2&t){const t=Wa(2);Ss(1),Ia(\"title\",t.alertRule.active?\"D\\xe9sactiver\":\"Activer\")(\"ngModel\",t.alertRule.active)}}function l0(t,e){1&t&&(Pa(0,\"div\",38),bl(1,\" Une r\\xe8gle active va permettre au serveur d'analyser les donn\\xe9es en temps r\\xe9el et remonter des alertes en fonction des crit\\xe8res choisis. \"),Da(),Pa(2,\"div\",38),bl(3,\" Une r\\xe8gle d\\xe9sactiv\\xe9e ne remontera aucune nouvelle alerte. \"),Da(),Ra(4,\"br\"))}function c0(t,e){1&t&&(Pa(0,\"div\",39),bl(1,\" Au moins un crit\\xe8re est n\\xe9cessaire pour d\\xe9clencher les alertes. \"),Da())}function h0(t,e){if(1&t){const t=Na();Pa(0,\"app-ais-interruption-criterion\",40),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).alertRule.criteria.aisInterruption=e}),Da(),Ra(1,\"mat-divider\")}if(2&t){const t=Wa(2);Ia(\"ngModel\",t.alertRule.criteria.aisInterruption)(\"editable\",t.editMode)}}function u0(t,e){if(1&t){const t=Na();Pa(0,\"app-transhipment-criterion\",41),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).alertRule.criteria.transhipment=e}),Da(),Ra(1,\"mat-divider\")}if(2&t){const t=Wa(2);Ia(\"ngModel\",t.alertRule.criteria.transhipment)(\"editable\",t.editMode)}}function d0(t,e){if(1&t){const t=Na();Pa(0,\"app-erratic-route-criterion\",42),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).alertRule.criteria.erraticRoute=e}),Da(),Ra(1,\"mat-divider\")}if(2&t){const t=Wa(2);Ia(\"ngModel\",t.alertRule.criteria.erraticRoute)(\"editable\",t.editMode)}}function p0(t,e){if(1&t){const t=Na();Pa(0,\"app-speed-criterion\",43),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).alertRule.criteria.speed=e}),Da(),Ra(1,\"mat-divider\")}if(2&t){const t=Wa(2);Ia(\"ngModel\",t.alertRule.criteria.speed)(\"editable\",t.editMode)}}function f0(t,e){if(1&t){const t=Na();Pa(0,\"app-passage-in-zone-criterion\",44),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).alertRule.criteria.passageInZone=e})(\"updateZones\",function(){return Fe(t),Wa(2).refreshAlertRulesZones()}),Da(),Ra(1,\"mat-divider\")}if(2&t){const t=Wa(2);Ia(\"ngModel\",t.alertRule.criteria.passageInZone)(\"editable\",t.editMode)}}function m0(t,e){if(1&t){const t=Na();Pa(0,\"app-spoofing-criterion\",45),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).alertRule.criteria.spoofing=e}),Da()}if(2&t){const t=Wa(2);Ia(\"ngModel\",t.alertRule.criteria.spoofing)(\"editable\",t.editMode)}}function g0(t,e){if(1&t){const t=Na();Pa(0,\"app-identifier-filter\",46),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).alertRule.criteria.identifier=e}),Da(),Ra(1,\"mat-divider\")}if(2&t){const t=Wa(2);Ia(\"ngModel\",t.alertRule.criteria.identifier)(\"editable\",t.editMode)}}function A0(t,e){if(1&t){const t=Na();Pa(0,\"app-fleet-filter\",47),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).alertRule.criteria.fleet=e}),Da(),Ra(1,\"mat-divider\")}if(2&t){const t=Wa(2);Ia(\"ngModel\",t.alertRule.criteria.fleet)(\"editable\",t.editMode)}}function v0(t,e){if(1&t){const t=Na();Pa(0,\"app-flag-filter\",48),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).alertRule.criteria.flag=e}),Da(),Ra(1,\"mat-divider\")}if(2&t){const t=Wa(2);Ia(\"ngModel\",t.alertRule.criteria.flag)(\"editable\",t.editMode)}}function _0(t,e){if(1&t){const t=Na();Pa(0,\"app-type-filter\",49),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).alertRule.criteria.type=e}),Da(),Ra(1,\"mat-divider\")}if(2&t){const t=Wa(2);Ia(\"ngModel\",t.alertRule.criteria.type)(\"editable\",t.editMode)}}function y0(t,e){if(1&t&&(Pa(0,\"span\"),bl(1),Da()),2&t){const t=e.alert;Ss(1),wl(t.ship_name||\"MMSI: \"+t.mmsi)}}const b0=function(t){return[\"/ships/\",t]};function w0(t,e){if(1&t){const t=Na();Pa(0,\"button\",53),Pa(1,\"mat-icon\"),bl(2,\"info\"),Da(),bl(3,\" Voir d\\xe9tail Navire \"),Da(),Pa(4,\"button\",54),$a(\"click\",function(){const e=Fe(t).alert;return Wa(3).locateShip(e.mmsi)}),Pa(5,\"mat-icon\"),bl(6,\"center_focus_strong\"),Da(),bl(7,\" Voir position Navire \"),Da()}2&t&&Ia(\"routerLink\",Jc(1,b0,e.alert.mmsi))}function x0(t,e){if(1&t&&(Pa(0,\"h3\",22),bl(1,\"Alertes\"),Da(),Ra(2,\"app-alerts-list\",50),na(3,y0,2,1,\"ng-template\",null,51,Ph),na(5,w0,8,3,\"ng-template\",null,52,Ph)),2&t){const t=ra(4),e=ra(6),i=Wa(2);Ss(2),Ia(\"alerts$\",i.alerts$)(\"alertTitleRef\",t)(\"alertMenuItemsRef\",e)}}function S0(t,e){if(1&t){const t=Na();Pa(0,\"ng-form\",6,7),Pa(2,\"div\",8),na(3,n0,10,4,\"ng-template\",4),na(4,r0,9,2,\"ng-template\",4),Da(),Pa(5,\"div\",9),na(6,s0,4,0,\"div\",10),na(7,o0,4,0,\"div\",10),Pa(8,\"div\",11),bl(9,\" \\xc9tat :\\xa0 \"),Pa(10,\"mat-chip-list\",12),Pa(11,\"mat-chip\",13),bl(12),Da(),Da(),na(13,a0,2,2,\"ng-template\",4),Ra(14,\"div\",14),Pa(15,\"button\",15),$a(\"click\",function(){Fe(t);const e=Wa();return e.showColorPicker=!e.showColorPicker}),Da(),Pa(16,\"input\",16),$a(\"colorPickerChange\",function(e){return Fe(t),Wa().alertRule.color=e})(\"cpToggleChange\",function(e){return Fe(t),Wa().showColorPicker=e}),Da(),Da(),Pa(17,\"div\",17),na(18,l0,5,0,\"ng-template\",4),Pa(19,\"app-glitter\",18),bl(20,\" Rapport quotidien \"),Pa(21,\"mat-icon\",19),bl(22,\"help\"),Da(),bl(23,\" :\\xa0 \"),Pa(24,\"mat-slide-toggle\",20),$a(\"ngModelChange\",function(e){return Fe(t),Wa().alertRule.enableDailyReport=e}),Da(),Da(),Ra(25,\"br\"),bl(26,\" R\\xe9sum\\xe9 : \"),Ra(27,\"div\",21),Da(),Ra(28,\"mat-divider\"),Pa(29,\"h3\",22),bl(30,\"Zone\"),Da(),Pa(31,\"app-zone-filter\",23),$a(\"ngModelChange\",function(e){return Fe(t),Wa().alertRule.criteria.zone=e})(\"updateZones\",function(){return Fe(t),Wa().refreshAlertRulesZones()}),Da(),Ra(32,\"mat-divider\"),Pa(33,\"h3\",22),bl(34,\"Crit\\xe8res\"),Da(),na(35,c0,2,0,\"div\",24),na(36,h0,2,2,\"ng-template\",4),na(37,u0,2,2,\"ng-template\",4),na(38,d0,2,2,\"ng-template\",4),na(39,p0,2,2,\"ng-template\",4),na(40,f0,2,2,\"ng-template\",4),na(41,m0,1,2,\"ng-template\",4),Pa(42,\"h3\",22),bl(43,\"Filtres\"),Da(),Pa(44,\"div\",25),bl(45,\" L'ajout de filtres \\xe0 une r\\xe8gle permet de diminuer le nombre d'alertes. \"),Da(),Pa(46,\"h4\",22),bl(47,\"Sur navire\"),Da(),na(48,g0,2,2,\"ng-template\",4),na(49,A0,2,2,\"ng-template\",4),na(50,v0,2,2,\"ng-template\",4),na(51,_0,2,2,\"ng-template\",4),na(52,x0,7,3,\"ng-template\",4),Da(),Da()}if(2&t){const t=ra(1),e=Wa();Ss(3),Ia(\"ngIf\",e.editMode),Ss(1),Ia(\"ngIf\",!e.editMode),Ss(2),Ia(\"ngIf\",t.hasError(\"missingZone\")),Ss(1),Ia(\"ngIf\",!e.editMode&&!e.alertRule.validZone),Ss(4),Ia(\"disabled\",!e.alertRule.active),Ss(1),xl(\" \",e.alertRule.active?\"Active\":\"D\\xe9sactiv\\xe9e\",\" \"),Ss(1),Ia(\"ngIf\",e.editMode),Ss(2),al(\"background-color\",e.alertRule.color),Ia(\"disabled\",!e.editMode)(\"title\",e.editMode?\"Changer la couleur des alertes de la r\\xe8gle\":\"Couleur des alertes de la r\\xe8gle\"),Ss(1),Ia(\"colorPicker\",e.alertRule.color)(\"cpAlphaChannel\",\"disabled\")(\"cpOutputFormat\",\"hex\")(\"cpToggle\",e.showColorPicker),Ss(2),Ia(\"ngIf\",e.editMode),Ss(6),Ia(\"title\",e.alertRule.enableDailyReport?\"D\\xe9sactiver le rapport\":\"Activer le rapport\")(\"ngModel\",e.alertRule.enableDailyReport)(\"disabled\",!e.editMode),Ss(3),Ia(\"innerHTML\",e.summary,wr),Ss(4),Ia(\"ngModel\",e.alertRule.criteria.zone)(\"editable\",e.editMode),Ss(4),Ia(\"ngIf\",null==t.errors?null:t.errors.missingCriterion),Ss(1),Ia(\"ngIf\",e.editMode||e.alertRule.criteria.aisInterruption.enable),Ss(1),Ia(\"ngIf\",e.editMode||e.alertRule.criteria.transhipment.enable),Ss(1),Ia(\"ngIf\",e.editMode||e.alertRule.criteria.erraticRoute.enable),Ss(1),Ia(\"ngIf\",e.editMode||e.alertRule.criteria.speed.enable),Ss(1),Ia(\"ngIf\",e.editMode||e.alertRule.criteria.passageInZone.enable),Ss(1),Ia(\"ngIf\",e.editMode||e.alertRule.criteria.spoofing.enable),Ss(7),Ia(\"ngIf\",e.editMode||e.alertRule.criteria.identifier.enable),Ss(1),Ia(\"ngIf\",e.editMode||e.alertRule.criteria.fleet.enable),Ss(1),Ia(\"ngIf\",e.editMode||e.alertRule.criteria.flag.enable),Ss(1),Ia(\"ngIf\",e.editMode||e.alertRule.criteria.type.enable),Ss(1),Ia(\"ngIf\",!e.editMode)}}let C0=(()=>{class t extends Lq{constructor(t,e,i,n,r,s,o,a,l,c,h,u,d,p){super(),this.activatedRoute=t,this.domSanitizer=e,this.router=i,this.titleService=n,this.alertsService=r,this.alertRulesService=s,this.configService=o,this.editZoneService=a,this.fleetsService=l,this.mapService=c,this.timeRangeService=h,this.zonesLayerService=u,this.uiService=d,this.workerService=p,this.alertRuleId$=new Zp(null),this.alertRule$=new Zp(null),this.alerts$=new Zp([]),this.editMode=!1,this.newRule=!1,this.showColorPicker=!1,this.save=()=>Vp(this,void 0,void 0,function*(){if(this.newRule){const t=yield this.alertRulesService.createAlertRule(this.alertRule);yield this.router.navigateByUrl(`/alerts/rules/${t}`)}else yield this.alertRulesService.updateAlertRule(this.alertRule),yield this.router.navigateByUrl(`/alerts/rules/${this.alertRule.id}`)})}get summary(){return this.domSanitizer.bypassSecurityTrustHtml(function(t,e){var i,n,r,s,o,a,l,c,h,u,d;const p=[\"Tous les navires \"],f=[];if((null===(i=t.criteria.identifier)||void 0===i?void 0:i.enable)&&f.push(`<br>- dont les identifiants sont ${t.criteria.identifier.identifiers.map(t=>`<em>${Kj(t)}</em>`).join(\" OU \")}`),null===(n=t.criteria.fleet)||void 0===n?void 0:n.enable){const i=t.criteria.fleet.fleets.map(t=>{var i,n;return null===(n=null!==(i=e.find(e=>e.id===t))&&void 0!==i?i:{})||void 0===n?void 0:n.name}).filter(t=>!!t);f.push(`<br>- faisant partie ${t.criteria.fleet.fleets.length>1?\"des flottes\":\"de la flotte\"} ${i.map(t=>`<em>${Kj(t)}</em>`).join(\" OU \")}`)}(null===(r=t.criteria.flag)||void 0===r?void 0:r.enable)&&f.push(t.criteria.flag.flags.length<5?`<br>- de pavillon ${t.criteria.flag.flags.map(t=>`<span class=\"flag-icon flag-icon-${t}\" style=\"margin-right: 5px\"></span><em>${SU[t]}</em>`).join(\" OU \")}`:`<br>- de ${t.criteria.flag.flags.length} pavillons`),(null===(s=t.criteria.type)||void 0===s?void 0:s.enable)&&f.push(`<br>- de type ${t.criteria.type.types.map(t=>`<em>${Vj[t].name}</em>`).join(\" OU \")}`),f.length>0&&(p.push(\":\"),p.push(f.join(\"\")),p.push(\"<br>\"));const m=[];if((null===(o=t.criteria.aisInterruption)||void 0===o?void 0:o.enable)&&m.push(\"<br>- coup\\xe9 leur transmission AIS\"),(null===(a=t.criteria.transhipment)||void 0===a?void 0:a.enable)&&m.push(\"<br>- particip\\xe9 \\xe0 un transbordement\"),(null===(l=t.criteria.erraticRoute)||void 0===l?void 0:l.enable)&&m.push(\"<br>- navigu\\xe9 de fa\\xe7on erratique\"),(null===(c=t.criteria.speed)||void 0===c?void 0:c.enable)&&m.push(`<br>- eu une vitesse entre <em>${t.criteria.speed.min}</em> et <em>${t.criteria.speed.max}</em> noeuds`),null===(h=t.criteria.passageInZone)||void 0===h?void 0:h.enable){const e=t.criteria.passageInZone.sequential?\" PUIS \":\" ET \";m.push(`<br>- navigu\\xe9 dans ${t.criteria.passageInZone.passages.length>1?\"les zones\":\"la zone\"} ${t.criteria.passageInZone.passages.map(t=>`<em>${Kj(t.zone.name)}</em>`).join(e)}`),t.criteria.passageInZone.passages.length>1&&m.push(` dans un intervalle de ${yU[t.criteria.passageInZone.timeWindow]}`)}return(null===(u=t.criteria.spoofing)||void 0===u?void 0:u.enable)&&m.push(\"<br>- modifi\\xe9 ses identifiants AIS\"),0===m.length?\"Il faut s\\xe9lectionner au moins un crit\\xe8re avant d'avoir une r\\xe8gle applicable\":(p.push(\"ayant :\"),p.push(m.join(\"\")),(null===(d=t.criteria.zone)||void 0===d?void 0:d.enable)&&p.push(`<br>dans ${t.criteria.zone.zones.length>1?\"les zones\":\"la zone\"} ${t.criteria.zone.zones.map(t=>`<em>${Kj(t.name)}</em>`).join(\" OU \")}`),p.push(\".\"),p.join(\"\"))}(this.alertRule,this.fleetsService.fleets$.value))}ngOnInit(){this.subscriptions.push(this.activatedRoute.data.subscribe(t=>{this.editMode=!!t.edit,this.newRule=!!t.new})),this.subscriptions.push(this.alertRuleId$.pipe(wf(1)).subscribe(t=>Vp(this,void 0,void 0,function*(){this.editMode?yield this.editAlertRule(t):yield this.viewAlertRule(t)}))),this.subscriptions.push(this.activatedRoute.paramMap.subscribe(t=>Vp(this,void 0,void 0,function*(){this.newRule?(this.alertRule=function(){const t={name:\"\",active:!0,criteria:{},color:\"#5e12e2\",enableDailyReport:!1,validZone:!1};return wU(t.criteria),t}(),this.titleService.setTitle(\"Nouvelle r\\xe8gle - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView()):this.alertRuleId$.next(t.get(\"alertRuleId\"))}))),this.subscriptions.push(this.alertRule$.pipe(wf(1)).subscribe(t=>{this.titleService.setTitle(`R\\xe8gle ${t.name} - ANAIS`),this.alertRule=t,this.refreshAlertRulesSummary(),this.refreshAlertRulesZones()})),this.editMode||this.subscriptions.push(LT([this.alertRuleId$,this.timeRangeService.timeRange$]).subscribe(([t,e])=>Vp(this,void 0,void 0,function*(){if(t){const i=yield this.workerService.alertRules.getAlertRuleAlerts(t,e.start,e.end),[n,r]=this.alertRulesService.getAlertRuleColor(t);i.forEach(t=>{t.color=n,t.rgbVecColor=r}),this.alertsService.updateAlerts(i),this.alerts$.next(i)}}))),this.editMode&&this.subscriptions.push(this.editZoneService.editedZone$.pipe(wf(1),Cf(),I$(0)).subscribe(t=>{t||(this.refreshAlertRulesZones(),this.refreshAlertRulesSummary())}))}ngOnDestroy(){super.ngOnDestroy(),this.zonesLayerService.clear(),this.editZoneService.cancelEditing(),this.alertsService.updateAlerts([]),this.alertRulesService.deselectAlertRule()}editAlertRule(t){return Vp(this,void 0,void 0,function*(){yield this.fetchAlertRule(t)})}viewAlertRule(t){return Vp(this,void 0,void 0,function*(){this.alertRuleId!==t&&(this.alertRuleId=t),yield this.fetchAlertRule(t)})}refreshAlertRulesZones(){this.zonesLayerService.updateZones(function(t){return[].concat(t.criteria.passageInZone.enable?t.criteria.passageInZone.passages.flatMap(t=>t.zone):[]).concat(t.criteria.zone.enable?t.criteria.zone.zones:[])}(this.alertRule))}refreshAlertRulesSummary(){}delete(){this.uiService.confirm({title:\"Suppression\",message:\"Une fois supprim\\xe9e, cette r\\xe8gle ne sera plus accessible. Confirmez-vous la suppression de cette r\\xe8gle ?\",action:t=>Vp(this,void 0,void 0,function*(){t&&(yield this.alertRulesService.deleteAlertRule(this.alertRule.id),yield this.router.navigateByUrl(\"/alerts/rules\"))})})}locateShip(t){return Vp(this,void 0,void 0,function*(){const e=yield this.workerService.ships.getShip(t);this.mapService.centerOnLonLat([e.lon,e.lat])})}fetchAlertRule(t){return Vp(this,void 0,void 0,function*(){try{this.alertRule$.next(yield this.alertRulesService.selectAlertRule(t))}catch(e){throw e.notfound?(this.router.navigateByUrl(\"/alerts/rules\").catch(()=>{}),new Error(`La r\\xe8gle <${t}> n'existe pas.`)):e}})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(MD),Ta(Dp),Ta(XR),Ta(zp),Ta(uH),Ta(hH),Ta(C$),Ta(jZ),Ta(Tq),Ta(T$),Ta(_q),Ta(kq),Ta(AU),Ta(iU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-alert-rule-panel\"]],features:[Vo],decls:8,vars:2,consts:[[1,\"panel\"],[1,\"d-flex\",2,\"background-color\",\"#fff\"],[\"mat-button\",\"\",\"title\",\"Revenir \\xe0 la liste\",\"routerLink\",\"/alerts/rules\",1,\"back-button\"],[\"class\",\"spinner\",\"strokeWidth\",\"4\",\"diameter\",\"80\",4,\"ngIf\"],[3,\"ngIf\"],[\"strokeWidth\",\"4\",\"diameter\",\"80\",1,\"spinner\"],[\"name\",\"form\",\"appAlertRule\",\"\",1,\"alert-rule-panel\",\"panel\",\"unscrollable\"],[\"form\",\"ngForm\"],[1,\"panel__header\"],[1,\"scrollable\"],[\"class\",\"panel__content\",4,\"ngIf\"],[1,\"panel__content\",\"alert-rule-panel__header\"],[1,\"d-inline\"],[\"color\",\"primary\",\"selected\",\"\",\"disableRipple\",\"\",3,\"disabled\"],[1,\"u-flex\"],[\"mat-mini-fab\",\"\",1,\"alert-rule-panel__color-picker-button\",3,\"disabled\",\"title\",\"click\"],[\"name\",\"color\",1,\"alert-rule-panel__color-picker-attach\",3,\"colorPicker\",\"cpAlphaChannel\",\"cpOutputFormat\",\"cpToggle\",\"colorPickerChange\",\"cpToggleChange\"],[1,\"panel__content\"],[\"gid\",\"daily-report\",\"date\",\"2021-07-02\",\"width\",\"200\",\"height\",\"24\"],[\"matTooltip\",\"Activer pour recevoir par email un rapport quotidien des alertes de la veille (jours UTC)\",\"matTooltipPosition\",\"above\",1,\"help-icon\"],[\"name\",\"enableDailyReport\",\"color\",\"primary\",3,\"title\",\"ngModel\",\"disabled\",\"ngModelChange\"],[1,\"alert-rule-panel__summary\",3,\"innerHTML\"],[1,\"panel__subtitle\"],[\"name\",\"zone\",3,\"ngModel\",\"editable\",\"ngModelChange\",\"updateZones\"],[\"class\",\"criterion-content alert-rule-panel__error-msg\",4,\"ngIf\"],[1,\"criterion-content\"],[1,\"alert-rule-panel__name-input\"],[\"matInput\",\"\",\"name\",\"name\",\"placeholder\",\"Nom de la r\\xe8gle\",\"required\",\"\",\"maxlength\",\"64\",3,\"ngModel\",\"ngModelChange\"],[\"name\",\"ngModel\"],[\"class\",\"input-error\",4,\"ngIf\"],[\"mat-button\",\"\",\"color\",\"primary\",\"title\",\"Enregistrer les changements\",\"data-test\",\"save-rule\",3,\"disabled\",\"click\"],[\"mat-button\",\"\",\"title\",\"Annuler l'\\xe9dition\",3,\"routerLink\"],[1,\"input-error\"],[1,\"panel__title\"],[\"mat-button\",\"\",\"title\",\"Modifier\",3,\"routerLink\"],[\"mat-button\",\"\",\"color\",\"warn\",\"title\",\"Supprimer la r\\xe8gle\",3,\"click\"],[\"color\",\"warn\",\"selected\",\"\",\"disableRipple\",\"\",\"title\",\"La configuration de cette r\\xe8gle est incorrecte. Elle doit contenir au moins une zone de filtrage.\"],[\"name\",\"active\",\"color\",\"primary\",3,\"title\",\"ngModel\",\"ngModelChange\"],[1,\"alert-rule-panel__description\"],[1,\"criterion-content\",\"alert-rule-panel__error-msg\"],[\"name\",\"aisInterruption\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"transhipment\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"erraticRoute\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"speed\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"passageInZone\",3,\"ngModel\",\"editable\",\"ngModelChange\",\"updateZones\"],[\"name\",\"spoofing\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"identifier\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"fleet\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"flag\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"type\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[3,\"alerts$\",\"alertTitleRef\",\"alertMenuItemsRef\"],[\"alertTitleRef\",\"\"],[\"alertMenuItemsRef\",\"\"],[\"mat-menu-item\",\"\",3,\"routerLink\"],[\"mat-menu-item\",\"\",3,\"click\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"div\",1),Pa(2,\"a\",2),Pa(3,\"mat-icon\"),bl(4,\"arrow_back_ios\"),Da(),bl(5,\" R\\xe8gles d'alerte \"),Da(),Da(),na(6,e0,1,0,\"mat-spinner\",3),na(7,S0,53,34,\"ng-template\",4),Da()),2&t&&(Ss(6),Ia(\"ngIf\",!e.alertRule),Ss(1),Ia(\"ngIf\",e.alertRule))},directives:[_b,JR,Yk,Bd,KY,Lw,$Z,eX,ZZ,vb,nP,hX,QT,bX,aw,Vw,Hq,mK,tS,hS,Mb,hx,fx,QR,Nx,CK,kK,EK,OK,$Q,UQ,fJ,yJ,kJ,OJ,t0,PX],styles:[\"[_nghost-%COMP%]{display:flex;overflow:hidden}.back-button[_ngcontent-%COMP%]{line-height:36px}.alert-rule-panel__name-input[_ngcontent-%COMP%]{margin:.5em;flex:1;font-size:20px}.alert-rule-panel__header[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.alert-rule-panel__color-picker-button[_ngcontent-%COMP%]{margin-left:16px;margin-right:8px;height:30px;width:30px}  .alert-rule-panel__color-picker-button.mat-fab:not(.mat-button-disabled):active:not([class*=mat-elevation-z]),   .alert-rule-panel__color-picker-button.mat-mini-fab:not(.mat-button-disabled):active:not([class*=mat-elevation-z]){box-shadow:0 5px 7px -2px rgba(0,0,0,.2),0 8px 14px 2px rgba(0,0,0,.141),0 4px 20px 2px rgba(0,0,0,.122)!important}.alert-rule-panel__color-picker-attach[_ngcontent-%COMP%]{opacity:0;width:1px;height:1px;pointer-events:none}.alert-rule-panel__description[_ngcontent-%COMP%]{margin-top:.5em;font-size:14px}.alert-rule-panel__summary[_ngcontent-%COMP%]     em{font-size:1.1em;font-weight:500;font-style:normal;color:#1515a6}.alert-rule-panel__error-msg[_ngcontent-%COMP%]{color:#ce1d1d}\"]}),t})();function k0(t,e){1&t&&(Pa(0,\"mat-chip\",13),bl(1,\"D\\xe9sactiv\\xe9e\"),Da()),2&t&&Ia(\"disabled\",!0)}function E0(t,e){1&t&&(Pa(0,\"mat-chip\",14),bl(1,\" Incorrecte \"),Da())}function M0(t,e){if(1&t&&(Pa(0,\"li\"),bl(1),Da()),2&t){const t=Wa();Ss(1),Sl(\"\",t.criteriaLabels.identifier.title,\" : \",t.alertRule.criteria.identifier.identifiers.join(\", \"),\"\")}}function T0(t,e){if(1&t&&(Pa(0,\"li\"),bl(1),Da()),2&t){const t=Wa();Ss(1),Sl(\"\",t.criteriaLabels.fleet.title,\" : \",t.fleets,\"\")}}function I0(t,e){1&t&&Ra(0,\"app-flag\",18),2&t&&Ia(\"flag\",e.$implicit)}function O0(t,e){1&t&&na(0,I0,1,1,\"app-flag\",17),2&t&&Ia(\"ngForOf\",Wa(2).alertRule.criteria.flag.flags)}function P0(t,e){1&t&&bl(0),2&t&&xl(\" \",Wa(2).alertRule.criteria.flag.flags.length,\" pavillons \")}function D0(t,e){if(1&t&&(Pa(0,\"li\"),bl(1),na(2,O0,1,1,\"ng-template\",15),na(3,P0,1,1,\"ng-template\",null,16,Ph),Da()),2&t){const t=ra(4),e=Wa();Ss(1),xl(\" \",e.criteriaLabels.flag.title,\" : \"),Ss(1),Ia(\"ngIf\",e.alertRule.criteria.flag.flags.length<5)(\"ngIfElse\",t)}}function R0(t,e){if(1&t&&(Pa(0,\"li\"),bl(1),Da()),2&t){const t=Wa();Ss(1),Sl(\"\",t.criteriaLabels.type.title,\" : \",t.types,\"\")}}function F0(t,e){if(1&t&&(Pa(0,\"li\"),bl(1),Da()),2&t){const t=Wa();Ss(1),Cl(\"\",t.criteriaLabels.speed.title,\" : [\",t.alertRule.criteria.speed.min,\", \",t.alertRule.criteria.speed.max,\"]\")}}function L0(t,e){if(1&t&&(Pa(0,\"li\"),bl(1),Da()),2&t){const t=Wa();Ss(1),wl(t.criteriaLabels.erraticRoute.title)}}function B0(t,e){if(1&t&&(Pa(0,\"li\"),bl(1),Da()),2&t){const t=Wa();Ss(1),wl(t.criteriaLabels.transhipment.title)}}function N0(t,e){if(1&t&&(Pa(0,\"li\"),bl(1),Da()),2&t){const t=Wa();Ss(1),wl(t.criteriaLabels.aisInterruption.title)}}function z0(t,e){if(1&t&&(Pa(0,\"li\"),bl(1),Da()),2&t){const t=Wa();Ss(1),Sl(\"\",t.criteriaLabels.passageInZone.title,\" : \",t.passages,\"\")}}function V0(t,e){if(1&t&&(Pa(0,\"li\"),bl(1),Da()),2&t){const t=Wa();Ss(1),wl(t.criteriaLabels.spoofing.title)}}function j0(t,e){if(1&t&&(Pa(0,\"li\"),bl(1),Da()),2&t){const t=Wa();Ss(1),Sl(\"\",t.criteriaLabels.zone.title,\" : \",t.zones,\"\")}}let $0=(()=>{class t extends Lq{constructor(t){super(),this.fleetsService=t,this.criteriaLabels=gK,this.countriesLabelByFlag=SU}get passages(){return this.alertRule.criteria.passageInZone.passages.map(t=>t.zone.name).join(\", \")}get fleets(){return this.alertRule.criteria.fleet.fleets.map(t=>{var e;return(null!==(e=this.fleetsService.fleetsById[t])&&void 0!==e?e:{}).name}).join(\", \")}get zones(){return this.alertRule.criteria.zone.zones.map(t=>t.name).join(\", \")}get types(){return this.alertRule.criteria.type.types.map(t=>Vj[t].name).join(\", \")}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Tq))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-alert-rule-item\"]],inputs:{alertRule:\"alertRule\"},features:[Vo],decls:28,vars:16,consts:[[1,\"alert-rule-item\"],[1,\"alert-rule-item__header\"],[1,\"alert-rule-item__title\"],[1,\"d-inline\",\"u-flex\",\"alert-rule-item__state\"],[\"color\",\"primary\",\"selected\",\"\",\"disableRipple\",\"\",3,\"disabled\",4,\"ngIf\"],[\"color\",\"warn\",\"selected\",\"\",\"disableRipple\",\"\",\"title\",\"La configuration de cette r\\xe8gle est incorrecte. Elle doit contenir au moins une zone de filtrage.\",4,\"ngIf\"],[1,\"alert-rule-item__indicators\"],[\"title\",\"Statistiques\",1,\"mr-1\"],[\"title\",\"Nombre d'alertes lev\\xe9es au cours des derni\\xe8res 24 heures\"],[1,\"mx-1\"],[\"title\",\"Nombre d'alertes lev\\xe9es au cours des 7 derniers jours\"],[1,\"alert-rule-item__criteria\"],[4,\"ngIf\"],[\"color\",\"primary\",\"selected\",\"\",\"disableRipple\",\"\",3,\"disabled\"],[\"color\",\"warn\",\"selected\",\"\",\"disableRipple\",\"\",\"title\",\"La configuration de cette r\\xe8gle est incorrecte. Elle doit contenir au moins une zone de filtrage.\"],[3,\"ngIf\",\"ngIfElse\"],[\"tooManyFlags\",\"\"],[\"style\",\"margin: 4px\",3,\"flag\",4,\"ngFor\",\"ngForOf\"],[2,\"margin\",\"4px\",3,\"flag\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"h4\",1),Pa(2,\"div\",2),bl(3),Da(),Pa(4,\"mat-chip-list\",3),na(5,k0,2,1,\"mat-chip\",4),na(6,E0,2,0,\"mat-chip\",5),Da(),Pa(7,\"div\",6),Pa(8,\"mat-icon\",7),bl(9,\"trending_up\"),Da(),Pa(10,\"span\",8),bl(11),Da(),Pa(12,\"span\",9),bl(13,\"/\"),Da(),Pa(14,\"span\",10),bl(15),Da(),Da(),Da(),Pa(16,\"ul\",11),na(17,M0,2,2,\"li\",12),na(18,T0,2,2,\"li\",12),na(19,D0,5,3,\"li\",12),na(20,R0,2,2,\"li\",12),na(21,F0,2,3,\"li\",12),na(22,L0,2,1,\"li\",12),na(23,B0,2,1,\"li\",12),na(24,N0,2,1,\"li\",12),na(25,z0,2,2,\"li\",12),na(26,V0,2,1,\"li\",12),na(27,j0,2,2,\"li\",12),Da(),Da()),2&t&&(Ss(3),wl(e.alertRule.name),Ss(2),Ia(\"ngIf\",!e.alertRule.active),Ss(1),Ia(\"ngIf\",!e.alertRule.validZone),Ss(5),wl(e.alertRule.alertsSummary.lastDay),Ss(4),wl(e.alertRule.alertsSummary.lastWeek),Ss(2),Ia(\"ngIf\",e.alertRule.criteria.identifier.enable),Ss(1),Ia(\"ngIf\",e.alertRule.criteria.fleet.enable),Ss(1),Ia(\"ngIf\",e.alertRule.criteria.flag.enable),Ss(1),Ia(\"ngIf\",e.alertRule.criteria.type.enable),Ss(1),Ia(\"ngIf\",e.alertRule.criteria.speed.enable),Ss(1),Ia(\"ngIf\",e.alertRule.criteria.erraticRoute.enable),Ss(1),Ia(\"ngIf\",e.alertRule.criteria.transhipment.enable),Ss(1),Ia(\"ngIf\",e.alertRule.criteria.aisInterruption.enable),Ss(1),Ia(\"ngIf\",e.alertRule.criteria.passageInZone.enable),Ss(1),Ia(\"ngIf\",e.alertRule.criteria.spoofing.enable),Ss(1),Ia(\"ngIf\",e.alertRule.criteria.zone.enable))},directives:[eX,Bd,Yk,ZZ,Fd,TZ],styles:[\".alert-rule-item__header[_ngcontent-%COMP%]{color:#1515a6;text-align:left;margin-top:8px;display:flex;align-items:center}.alert-rule-item__title[_ngcontent-%COMP%]{word-break:break-word;margin-right:8px}.alert-rule-item__state[_ngcontent-%COMP%]{pointer-events:none;touch-action:none}.alert-rule-item__indicators[_ngcontent-%COMP%]{font-size:14px;margin-left:8px;display:flex;align-items:center;pointer-events:all!important}.alert-rule-item__criteria[_ngcontent-%COMP%]{text-align:left;margin:0;line-height:18px;padding-left:1em}\"],changeDetection:0}),t})();function U0(t,e){1&t&&Ra(0,\"mat-spinner\",4)}function H0(t,e){1&t&&(Pa(0,\"p\",6),bl(1,\"Aucune r\\xe8gle n'a \\xe9t\\xe9 configur\\xe9e.\"),Da())}function G0(t,e){1&t&&(Pa(0,\"div\",10),Pa(1,\"mat-icon\",11),bl(2,\"warning\"),Da(),bl(3,\" La configuration de certaines r\\xe8gles est incorrecte. Veuillez revoir leur configuration afin de les rendre \\xe0 nouveau effectives. \"),Da())}function q0(t,e){if(1&t&&(Pa(0,\"button\",12),Ra(1,\"app-alert-rule-item\",13),Da()),2&t){const t=e.$implicit;Qa(\"routerLink\",\"/alerts/rules/\",t.id,\"\"),Ss(1),Ia(\"alertRule\",t)}}function W0(t,e){if(1&t&&(Pa(0,\"p\",6),bl(1),Da(),na(2,G0,4,0,\"div\",7),Pa(3,\"div\",8),na(4,q0,2,2,\"button\",9),Da()),2&t){const t=Wa(2);Ss(1),xl(\"Vous avez configur\\xe9 \",t.alertRules.length,\" r\\xe8gles d'alerte.\"),Ss(1),Ia(\"ngIf\",t.containsInvalidAlertRule),Ss(2),Ia(\"ngForOf\",t.alertRules)}}function Y0(t,e){if(1&t&&(na(0,H0,2,0,\"p\",5),na(1,W0,5,3,\"ng-template\",3)),2&t){const t=Wa();Ia(\"ngIf\",0===t.alertRules.length),Ss(1),Ia(\"ngIf\",t.alertRules.length>0)}}let Z0=(()=>{class t extends Lq{constructor(t,e,i){super(),this.titleService=t,this.alertRulesService=e,this.mapService=i}ngOnInit(){return Vp(this,void 0,void 0,function*(){this.titleService.setTitle(\"Liste des r\\xe8gles - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.alertRulesService.alertRules$.subscribe(t=>{this.alertRules=t,this.containsInvalidAlertRule=t.some(t=>!t.validZone)})})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(zp),Ta(hH),Ta(T$))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-alert-rules-panel\"]],features:[Vo],decls:5,vars:2,consts:[[\"joyrideStep\",\"rules-panel\",\"stepPosition\",\"right\",\"title\",\"R\\xe8gles d'alertes\",\"text\",\"C'est ici que vous pouvez cr\\xe9er et visualiser des r\\xe8gles personnalis\\xe9es afin d'\\xeatre alert\\xe9 automatiquement de comportements de navires r\\xe9pondant \\xe0 des algorithmes et des filtres que vous aurez choisis. Par exemple: navires avec pavillon espagnol, de type p\\xeacheur, \\xe9tant pass\\xe9s \\xe0 proximit\\xe9 des c\\xf4tes Corse et ayant transbord\\xe9.\",1,\"panel\"],[\"mat-button\",\"\",\"color\",\"primary\",\"routerLink\",\"/alerts/rules/new\"],[\"class\",\"spinner\",\"strokeWidth\",\"4\",\"diameter\",\"80\",4,\"ngIf\"],[3,\"ngIf\"],[\"strokeWidth\",\"4\",\"diameter\",\"80\",1,\"spinner\"],[\"class\",\"panel__content\",4,\"ngIf\"],[1,\"panel__content\"],[\"class\",\"d-flex-center error-message panel__content mat-body\",4,\"ngIf\"],[1,\"alert-rules-panel__rules\",\"scrollable\"],[\"mat-button\",\"\",3,\"routerLink\",4,\"ngFor\",\"ngForOf\"],[1,\"d-flex-center\",\"error-message\",\"panel__content\",\"mat-body\"],[1,\"mr-2\"],[\"mat-button\",\"\",3,\"routerLink\"],[3,\"alertRule\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"button\",1),bl(2,\"Nouvelle r\\xe8gle\"),Da(),na(3,U0,1,0,\"mat-spinner\",2),na(4,Y0,2,2,\"ng-template\",3),Da()),2&t&&(Ss(3),Ia(\"ngIf\",!e.alertRules),Ss(1),Ia(\"ngIf\",e.alertRules))},directives:[tL,vb,QR,Bd,KY,Fd,Yk,$0],styles:[\"[_nghost-%COMP%]{display:flex;overflow:hidden}.alert-rules-panel__rules[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:stretch}.alert-rules-panel__rules[_ngcontent-%COMP%]     .mat-button{white-space:normal}\"]}),t})();function X0(t,e){if(1&t&&(Pa(0,\"div\",10),Pa(1,\"mat-icon\",11),bl(2,\"access_time\"),Da(),Pa(3,\"div\",12),oh(4,\"timeago\"),bl(5),oh(6,\"date\"),Da(),Da()),2&t){const t=Wa();Ss(3),Ka(\"title\",ah(4,2,1e3*t.ship.timestamp)),Ss(2),xl(\" \",ch(6,4,1e3*t.ship.timestamp,\"yyyy-MM-dd HH:mm:ss z\",t.useUTCDates&&\"+00\"),\" \")}}let K0=(()=>{class t extends Lq{constructor(t,e){super(),this.changeDetectorRef=t,this.mapConfigService=e,this.showTimestamp=!1,this.useUTCDates=!1,this.vesselTypeLabelsByType=zj}ngOnInit(){this.ensureMandatoryInputParams(\"ship\"),this.subscriptions.push(this.mapConfigService.useUTCDates$.subscribe(t=>{this.useUTCDates=t,this.changeDetectorRef.markForCheck()}))}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Cc),Ta(k$))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-ship-item-small\"]],inputs:{ship:\"ship\",showTimestamp:\"showTimestamp\"},features:[Vo],decls:23,vars:7,consts:[[1,\"ship-item\"],[1,\"ship-item__col1\"],[1,\"u-flex\",\"d-flex-center\"],[1,\"ship-item__flag\",3,\"mmsi\"],[1,\"d-flex-column\"],[1,\"ship-item__name\"],[1,\"ship-item__type\"],[\"class\",\"ship-item__timestamp\",\"title\",\"Derni\\xe8re r\\xe9ception\",4,\"ngIf\"],[1,\"ship-item__col2\"],[1,\"ship-item__label\"],[\"title\",\"Derni\\xe8re r\\xe9ception\",1,\"ship-item__timestamp\"],[1,\"mini-icon\",\"mr-1\"],[3,\"title\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"div\",1),Pa(2,\"div\",2),Ra(3,\"app-flag\",3),Pa(4,\"div\",4),Pa(5,\"div\",5),bl(6),Da(),Pa(7,\"small\",6),bl(8),Da(),Da(),Da(),na(9,X0,7,8,\"div\",7),Da(),Pa(10,\"div\",8),Pa(11,\"div\"),Pa(12,\"span\",9),bl(13,\"MMSI\"),Da(),bl(14),Da(),Pa(15,\"div\"),Pa(16,\"span\",9),bl(17,\"IMO\"),Da(),bl(18),Da(),Pa(19,\"div\"),Pa(20,\"span\",9),bl(21,\"Callsign\"),Da(),bl(22),Da(),Da(),Da()),2&t&&(Ss(3),Ia(\"mmsi\",e.ship.mmsi),Ss(3),wl(e.ship.name||\"?\"),Ss(2),wl(e.ship.cargo?e.vesselTypeLabelsByType[e.ship.cargo]:\"?\"),Ss(1),Ia(\"ngIf\",e.showTimestamp),Ss(5),xl(\" \",e.ship.mmsi,\"\"),Ss(4),xl(\" \",e.ship.imo||\"?\",\"\"),Ss(4),xl(\" \",e.ship.callsign||\"?\",\"\"))},directives:[TZ,Bd,Yk],pipes:[SL,Qd],styles:[\"[_nghost-%COMP%]{flex:1;display:block;position:relative}.ship-item[_ngcontent-%COMP%]{font-size:12px;line-height:16px;display:flex}.ship-item__col1[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.ship-item__col2[_ngcontent-%COMP%]{display:flex;flex-direction:column;text-align:right}.ship-item__flag[_ngcontent-%COMP%]{margin-right:4px}.ship-item__name[_ngcontent-%COMP%]{font-size:14px}.ship-item__type[_ngcontent-%COMP%]{line-height:1em;font-size:11px}.ship-item__timestamp[_ngcontent-%COMP%]{margin-top:4px;display:flex;align-items:center;color:gray}.ship-item__timestamp[_ngcontent-%COMP%] > .mat-icon[_ngcontent-%COMP%]{font-size:1em;height:1em;width:1em;margin-right:.3em;margin-left:.3em}.ship-item__label[_ngcontent-%COMP%]{color:gray;font-size:10px}\"],changeDetection:0}),t})();function Q0(t,e){1&t&&Ra(0,\"mat-spinner\",5)}function J0(t,e){if(1&t&&(Pa(0,\"div\",6),Pa(1,\"div\",7),Pa(2,\"div\",8),Pa(3,\"mat-icon\",9),bl(4,\"trending_up\"),Da(),bl(5,\" Dernier jour \"),Da(),bl(6),Da(),Pa(7,\"div\",10),Pa(8,\"div\",8),Pa(9,\"mat-icon\",9),bl(10,\"trending_up\"),Da(),bl(11,\" Derni\\xe8re semaine \"),Da(),bl(12),Da(),Da()),2&t){const t=Wa();Ss(6),xl(\" \",t.alertsSummary.lastDay,\" \"),Ss(6),xl(\" \",t.alertsSummary.lastWeek,\" \")}}function t1(t,e){1&t&&Ra(0,\"mat-spinner\",5)}function e1(t,e){if(1&t&&(Pa(0,\"div\",14),Pa(1,\"mat-icon\",9),bl(2,\"warning\"),Da(),bl(3),Da(),Ra(4,\"app-ship-item-small\",15),Pa(5,\"div\",16),oh(6,\"timeago\"),Pa(7,\"mat-icon\",17),bl(8,\"access_time\"),Da(),bl(9),oh(10,\"date\"),Da()),2&t){const t=e.alert,i=Wa(2);Ss(3),xl(\" \",t.rule_name,\" \"),Ss(1),Ia(\"ship\",t.ship),Ss(1),Ka(\"title\",ah(6,4,1e3*t.start)),Ss(4),xl(\" \",ch(10,6,1e3*t.start,\"yyyy-MM-dd HH:mm:ss z\",i.useUTCDates&&\"+00\"),\" \")}}const i1=function(t){return[\"/alerts/rules/\",t]},n1=function(t){return[\"/ships/\",t]};function r1(t,e){if(1&t){const t=Na();Pa(0,\"button\",18),Pa(1,\"mat-icon\"),bl(2,\"info\"),Da(),bl(3,\" Voir la r\\xe8gle \"),Da(),Pa(4,\"button\",18),Pa(5,\"mat-icon\"),bl(6,\"info\"),Da(),bl(7,\" Voir d\\xe9tail Navire \"),Da(),Pa(8,\"button\",19),$a(\"click\",function(){const e=Fe(t).alert;return Wa(2).locateShip(e.mmsi)}),Pa(9,\"mat-icon\"),bl(10,\"center_focus_strong\"),Da(),bl(11,\" Voir position actuelle Navire \"),Da()}if(2&t){const t=e.alert;Ia(\"routerLink\",Jc(2,i1,t.rule_id)),Ss(4),Ia(\"routerLink\",Jc(4,n1,t.mmsi))}}function s1(t,e){if(1&t&&(Ra(0,\"app-alerts-list\",11),na(1,e1,11,10,\"ng-template\",null,12,Ph),na(3,r1,12,6,\"ng-template\",null,13,Ph)),2&t){const t=ra(2),e=ra(4);Ia(\"alerts$\",Wa().alerts$)(\"enableRuleFilters\",!0)(\"simpleItems\",!1)(\"alertTitleRef\",t)(\"alertMenuItemsRef\",e)}}let o1=(()=>{class t extends Lq{constructor(t,e,i,n,r,s,o){super(),this.titleService=t,this.alertRulesService=e,this.alertsService=i,this.mapService=n,this.mapConfigService=r,this.timeRangeService=s,this.workerService=o,this.alerts$=new Zp([]),this.alertsSummary=null,this.alertsLoaded=!1,this.useUTCDates=!1}ngOnInit(){return Vp(this,void 0,void 0,function*(){this.titleService.setTitle(\"Alertes - ANAIS\"),this.subscriptions.push(this.mapConfigService.useUTCDates$.subscribe(t=>{this.useUTCDates=t}),this.timeRangeService.timeRange$.subscribe(t=>Vp(this,void 0,void 0,function*(){const e=yield this.workerService.alerts.list(t.start,t.end);e.forEach(t=>{const[e,i]=this.alertRulesService.getAlertRuleColor(t.rule_id);t.color=e,t.rgbVecColor=i}),this.alertsService.updateAlerts(e),this.alerts$.next(e),this.alertsLoaded=!0})),q(Xp(0),mq(3e5)).subscribe(()=>Vp(this,void 0,void 0,function*(){this.alertsSummary=yield this.workerService.alerts.getAlertsSummary()})))})}ngOnDestroy(){super.ngOnDestroy(),this.alertsService.updateAlerts([])}locateShip(t){return Vp(this,void 0,void 0,function*(){const e=yield this.workerService.ships.getShip(t);this.mapService.pingLocation([e.lon,e.lat]),this.mapService.centerOnLonLat([e.lon,e.lat])})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(zp),Ta(hH),Ta(uH),Ta(T$),Ta(k$),Ta(_q),Ta(iU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-alerts-dashboard\"]],features:[Vo],decls:9,vars:4,consts:[[\"joyrideStep\",\"alerts-panel\",\"stepPosition\",\"right\",\"title\",\"Tableau de bord des alertes\",\"text\",\"Cet endroit contient un tableau de bord de toutes les alertes lev\\xe9es par toutes vos r\\xe8gles.\",1,\"panel\"],[1,\"panel__title\"],[\"class\",\"small-spinner\",\"strokeWidth\",\"4\",\"diameter\",\"60\",4,\"ngIf\"],[\"class\",\"d-flex\",4,\"ngIf\"],[3,\"ngIf\"],[\"strokeWidth\",\"4\",\"diameter\",\"60\",1,\"small-spinner\"],[1,\"d-flex\"],[\"title\",\"Nombre d'alertes lev\\xe9es au cours des derni\\xe8res 24 heures\",1,\"indicator\",\"mat-elevation-z8\"],[1,\"indicator__label\"],[1,\"mr-1\"],[\"title\",\"Nombre d'alertes lev\\xe9es au cours des 7 derniers jours\",1,\"indicator\",\"mat-elevation-z8\"],[3,\"alerts$\",\"enableRuleFilters\",\"simpleItems\",\"alertTitleRef\",\"alertMenuItemsRef\"],[\"alertTitleRef\",\"\"],[\"alertMenuItemsRef\",\"\"],[1,\"d-flex-center\"],[1,\"alert__ship\",3,\"ship\"],[1,\"alert__timestamp\",3,\"title\"],[\"title\",\"Date de l'alerte\",1,\"mini-icon\",\"mr-1\"],[\"mat-menu-item\",\"\",3,\"routerLink\"],[\"mat-menu-item\",\"\",3,\"click\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"h2\",1),bl(2,\"Indicateurs\"),Da(),na(3,Q0,1,0,\"mat-spinner\",2),na(4,J0,13,2,\"div\",3),Pa(5,\"h2\",1),bl(6,\"Listes des alertes\"),Da(),na(7,t1,1,0,\"mat-spinner\",2),na(8,s1,5,5,\"ng-template\",4),Da()),2&t&&(Ss(3),Ia(\"ngIf\",!e.alertsSummary),Ss(1),Ia(\"ngIf\",e.alertsSummary),Ss(3),Ia(\"ngIf\",!e.alertsLoaded),Ss(1),Ia(\"ngIf\",e.alertsLoaded))},directives:[tL,Bd,KY,Yk,t0,K0,PX,QR],pipes:[SL,Qd],styles:[\"[_nghost-%COMP%]{display:flex;flex-direction:column;overflow:hidden}.indicator[_ngcontent-%COMP%]{flex:1;padding:.7em 8px 8px;position:relative;margin:8px;font-size:1.5em;display:flex;justify-content:center;align-items:center;min-height:3em;border-radius:4px}.indicator__label[_ngcontent-%COMP%]{position:absolute;top:0;left:4px;color:#8c8c8c;font-size:12px;display:flex;align-items:center}.alert__ship[_ngcontent-%COMP%]{border-left:1px solid grey;padding-left:3px;display:block}.alert__timestamp[_ngcontent-%COMP%]{color:gray;display:flex;align-items:center}\"]}),t})();const a1=[\"*\"],l1=[\"tabListContainer\"],c1=[\"tabList\"],h1=[\"nextPaginator\"],u1=[\"previousPaginator\"],d1=[\"mat-tab-nav-bar\",\"\"],p1=new Qi(\"MatInkBarPositioner\",{providedIn:\"root\",factory:function(){return t=>({left:t?(t.offsetLeft||0)+\"px\":\"0\",width:t?(t.offsetWidth||0)+\"px\":\"0\"})}});let f1=(()=>{class t{constructor(t,e,i,n){this._elementRef=t,this._ngZone=e,this._inkBarPositioner=i,this._animationMode=n}alignToElement(t){this.show(),\"undefined\"!=typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this._setStyles(t))}):this._setStyles(t)}show(){this._elementRef.nativeElement.style.visibility=\"visible\"}hide(){this._elementRef.nativeElement.style.visibility=\"hidden\"}_setStyles(t){const e=this._inkBarPositioner(t),i=this._elementRef.nativeElement;i.style.left=e.left,i.style.width=e.width}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(tu),Ta(p1),Ta(sy,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"mat-ink-bar\"]],hostAttrs:[1,\"mat-ink-bar\"],hostVars:2,hostBindings:function(t,e){2&t&&ll(\"_mat-animation-noopable\",\"NoopAnimations\"===e._animationMode)}}),t})();const m1=Zf({passive:!0});let g1=(()=>{class t{constructor(t,e,i,n,r,s,o){this._elementRef=t,this._changeDetectorRef=e,this._viewportRuler=i,this._dir=n,this._ngZone=r,this._platform=s,this._animationMode=o,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new S,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new S,this.disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new ph,this.indexFocused=new ph,r.runOutsideAngular(()=>{Hm(t.nativeElement,\"mouseleave\").pipe(Mf(this._destroyed)).subscribe(()=>{this._stopInterval()})})}get selectedIndex(){return this._selectedIndex}set selectedIndex(t){t=Pf(t),this._selectedIndex!=t&&(this._selectedIndexChanged=!0,this._selectedIndex=t,this._keyManager&&this._keyManager.updateActiveItem(t))}ngAfterViewInit(){Hm(this._previousPaginator.nativeElement,\"touchstart\",m1).pipe(Mf(this._destroyed)).subscribe(()=>{this._handlePaginatorPress(\"before\")}),Hm(this._nextPaginator.nativeElement,\"touchstart\",m1).pipe(Mf(this._destroyed)).subscribe(()=>{this._handlePaginatorPress(\"after\")})}ngAfterContentInit(){const t=this._dir?this._dir.change:Xp(\"ltr\"),e=this._viewportRuler.change(150),i=()=>{this.updatePagination(),this._alignInkBarToSelectedTab()};this._keyManager=new vm(this._items).withHorizontalOrientation(this._getLayoutDirection()).withHomeAndEnd().withWrap(),this._keyManager.updateActiveItem(this._selectedIndex),\"undefined\"!=typeof requestAnimationFrame?requestAnimationFrame(i):i(),q(t,e,this._items.changes).pipe(Mf(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>Promise.resolve().then(i)),this._keyManager.withHorizontalOrientation(this._getLayoutDirection())}),this._keyManager.change.pipe(Mf(this._destroyed)).subscribe(t=>{this.indexFocused.emit(t),this._setTabFocus(t)})}ngAfterContentChecked(){this._tabLabelCount!=this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._alignInkBarToSelectedTab(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(t){if(!Kp(t))switch(t.keyCode){case 13:case 32:this.focusIndex!==this.selectedIndex&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(t));break;default:this._keyManager.onKeydown(t)}}_onContentChanges(){const t=this._elementRef.nativeElement.textContent;t!==this._currentTextContent&&(this._currentTextContent=t||\"\",this._ngZone.run(()=>{this.updatePagination(),this._alignInkBarToSelectedTab(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(t){!this._isValidIndex(t)||this.focusIndex===t||!this._keyManager||this._keyManager.setActiveItem(t)}_isValidIndex(t){if(!this._items)return!0;const e=this._items?this._items.toArray()[t]:null;return!!e&&!e.disabled}_setTabFocus(t){if(this._showPaginationControls&&this._scrollToLabel(t),this._items&&this._items.length){this._items.toArray()[t].focus();const e=this._tabListContainer.nativeElement;e.scrollLeft=\"ltr\"==this._getLayoutDirection()?0:e.scrollWidth-e.offsetWidth}}_getLayoutDirection(){return this._dir&&\"rtl\"===this._dir.value?\"rtl\":\"ltr\"}_updateTabScrollPosition(){if(this.disablePagination)return;const t=this.scrollDistance,e=\"ltr\"===this._getLayoutDirection()?-t:t;this._tabList.nativeElement.style.transform=`translateX(${Math.round(e)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0)}get scrollDistance(){return this._scrollDistance}set scrollDistance(t){this._scrollTo(t)}_scrollHeader(t){return this._scrollTo(this._scrollDistance+(\"before\"==t?-1:1)*this._tabListContainer.nativeElement.offsetWidth/3)}_handlePaginatorClick(t){this._stopInterval(),this._scrollHeader(t)}_scrollToLabel(t){if(this.disablePagination)return;const e=this._items?this._items.toArray()[t]:null;if(!e)return;const i=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:n,offsetWidth:r}=e.elementRef.nativeElement;let s,o;\"ltr\"==this._getLayoutDirection()?(s=n,o=s+r):(o=this._tabList.nativeElement.offsetWidth-n,s=o-r);const a=this.scrollDistance,l=this.scrollDistance+i;s<a?this.scrollDistance-=a-s+60:o>l&&(this.scrollDistance+=o-l+60)}_checkPaginationEnabled(){if(this.disablePagination)this._showPaginationControls=!1;else{const t=this._tabList.nativeElement.scrollWidth>this._elementRef.nativeElement.offsetWidth;t||(this.scrollDistance=0),t!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=t}}_checkScrollingControls(){this.disablePagination?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=0==this.scrollDistance,this._disableScrollAfter=this.scrollDistance==this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){return this._tabList.nativeElement.scrollWidth-this._tabListContainer.nativeElement.offsetWidth||0}_alignInkBarToSelectedTab(){const t=this._items&&this._items.length?this._items.toArray()[this.selectedIndex]:null,e=t?t.elementRef.nativeElement:null;e?this._inkBar.alignToElement(e):this._inkBar.hide()}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(t,e){e&&null!=e.button&&0!==e.button||(this._stopInterval(),ig(650,100).pipe(Mf(q(this._stopScrolling,this._destroyed))).subscribe(()=>{const{maxScrollDistance:e,distance:i}=this._scrollHeader(t);(0===i||i>=e)&&this._stopInterval()}))}_scrollTo(t){if(this.disablePagination)return{maxScrollDistance:0,distance:0};const e=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(e,t)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:e,distance:this._scrollDistance}}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(Cc),Ta(Pg),Ta(xg,8),Ta(tu),Ta(Vf),Ta(sy,8))},t.\\u0275dir=Xt({type:t,inputs:{disablePagination:\"disablePagination\"}}),t})(),A1=(()=>{class t extends g1{constructor(t,e,i,n,r,s,o){super(t,n,r,e,i,s,o),this._disableRipple=!1,this.color=\"primary\"}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){const e=this._elementRef.nativeElement.classList;e.remove(`mat-background-${this.backgroundColor}`),t&&e.add(`mat-background-${t}`),this._backgroundColor=t}get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=Of(t)}_itemSelected(){}ngAfterContentInit(){this._items.changes.pipe(og(null),Mf(this._destroyed)).subscribe(()=>{this.updateActiveLink()}),super.ngAfterContentInit()}updateActiveLink(){if(!this._items)return;const t=this._items.toArray();for(let e=0;e<t.length;e++)if(t[e].active)return this.selectedIndex=e,void this._changeDetectorRef.markForCheck();this.selectedIndex=-1,this._inkBar.hide()}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(xg,8),Ta(tu),Ta(Cc),Ta(Pg),Ta(Vf),Ta(sy,8))},t.\\u0275dir=Xt({type:t,inputs:{color:\"color\",backgroundColor:\"backgroundColor\",disableRipple:\"disableRipple\"},features:[Vo]}),t})(),v1=(()=>{class t extends A1{constructor(t,e,i,n,r,s,o){super(t,e,i,n,r,s,o)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(xg,8),Ta(tu),Ta(Cc),Ta(Pg),Ta(Vf),Ta(sy,8))},t.\\u0275cmp=Ht({type:t,selectors:[[\"\",\"mat-tab-nav-bar\",\"\"]],contentQueries:function(t,e,i){if(1&t&&Eh(i,b1,5),2&t){let t;Ch(t=Mh())&&(e._items=t)}},viewQuery:function(t,e){if(1&t&&(kh(f1,7),kh(l1,7),kh(c1,7),kh(h1,5),kh(u1,5)),2&t){let t;Ch(t=Mh())&&(e._inkBar=t.first),Ch(t=Mh())&&(e._tabListContainer=t.first),Ch(t=Mh())&&(e._tabList=t.first),Ch(t=Mh())&&(e._nextPaginator=t.first),Ch(t=Mh())&&(e._previousPaginator=t.first)}},hostAttrs:[1,\"mat-tab-nav-bar\",\"mat-tab-header\"],hostVars:10,hostBindings:function(t,e){2&t&&ll(\"mat-tab-header-pagination-controls-enabled\",e._showPaginationControls)(\"mat-tab-header-rtl\",\"rtl\"==e._getLayoutDirection())(\"mat-primary\",\"warn\"!==e.color&&\"accent\"!==e.color)(\"mat-accent\",\"accent\"===e.color)(\"mat-warn\",\"warn\"===e.color)},inputs:{color:\"color\"},exportAs:[\"matTabNavBar\",\"matTabNav\"],features:[Vo],attrs:d1,ngContentSelectors:a1,decls:13,vars:8,consts:[[\"aria-hidden\",\"true\",\"mat-ripple\",\"\",1,\"mat-tab-header-pagination\",\"mat-tab-header-pagination-before\",\"mat-elevation-z4\",3,\"matRippleDisabled\",\"click\",\"mousedown\",\"touchend\"],[\"previousPaginator\",\"\"],[1,\"mat-tab-header-pagination-chevron\"],[1,\"mat-tab-link-container\",3,\"keydown\"],[\"tabListContainer\",\"\"],[1,\"mat-tab-list\",3,\"cdkObserveContent\"],[\"tabList\",\"\"],[1,\"mat-tab-links\"],[\"aria-hidden\",\"true\",\"mat-ripple\",\"\",1,\"mat-tab-header-pagination\",\"mat-tab-header-pagination-after\",\"mat-elevation-z4\",3,\"matRippleDisabled\",\"mousedown\",\"click\",\"touchend\"],[\"nextPaginator\",\"\"]],template:function(t,e){1&t&&(Za(),Pa(0,\"div\",0,1),$a(\"click\",function(){return e._handlePaginatorClick(\"before\")})(\"mousedown\",function(t){return e._handlePaginatorPress(\"before\",t)})(\"touchend\",function(){return e._stopInterval()}),Ra(2,\"div\",2),Da(),Pa(3,\"div\",3,4),$a(\"keydown\",function(t){return e._handleKeydown(t)}),Pa(5,\"div\",5,6),$a(\"cdkObserveContent\",function(){return e._onContentChanges()}),Pa(7,\"div\",7),Xa(8),Da(),Ra(9,\"mat-ink-bar\"),Da(),Da(),Pa(10,\"div\",8,9),$a(\"mousedown\",function(t){return e._handlePaginatorPress(\"after\",t)})(\"click\",function(){return e._handlePaginatorClick(\"after\")})(\"touchend\",function(){return e._stopInterval()}),Ra(12,\"div\",2),Da()),2&t&&(ll(\"mat-tab-header-pagination-disabled\",e._disableScrollBefore),Ia(\"matRippleDisabled\",e._disableScrollBefore||e.disableRipple),Ss(5),ll(\"_mat-animation-noopable\",\"NoopAnimations\"===e._animationMode),Ss(5),ll(\"mat-tab-header-pagination-disabled\",e._disableScrollAfter),Ia(\"matRippleDisabled\",e._disableScrollAfter||e.disableRipple))},directives:[Xy,rm,f1],styles:['.mat-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.mat-tab-header-pagination{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:32px;cursor:pointer;z-index:2;-webkit-tap-highlight-color:transparent;touch-action:none}.mat-tab-header-pagination-controls-enabled .mat-tab-header-pagination{display:flex}.mat-tab-header-pagination-before,.mat-tab-header-rtl .mat-tab-header-pagination-after{padding-left:4px}.mat-tab-header-pagination-before .mat-tab-header-pagination-chevron,.mat-tab-header-rtl .mat-tab-header-pagination-after .mat-tab-header-pagination-chevron{transform:rotate(-135deg)}.mat-tab-header-rtl .mat-tab-header-pagination-before,.mat-tab-header-pagination-after{padding-right:4px}.mat-tab-header-rtl .mat-tab-header-pagination-before .mat-tab-header-pagination-chevron,.mat-tab-header-pagination-after .mat-tab-header-pagination-chevron{transform:rotate(45deg)}.mat-tab-header-pagination-chevron{border-style:solid;border-width:2px 2px 0 0;content:\"\";height:8px;width:8px}.mat-tab-header-pagination-disabled{box-shadow:none;cursor:default}.mat-tab-list{flex-grow:1;position:relative;transition:transform 500ms cubic-bezier(0.35, 0, 0.25, 1)}.mat-tab-links{display:flex}[mat-align-tabs=center]>.mat-tab-link-container .mat-tab-links{justify-content:center}[mat-align-tabs=end]>.mat-tab-link-container .mat-tab-links{justify-content:flex-end}.mat-ink-bar{position:absolute;bottom:0;height:2px;transition:500ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable.mat-ink-bar{transition:none;animation:none}.mat-tab-group-inverted-header .mat-ink-bar{bottom:auto;top:0}.cdk-high-contrast-active .mat-ink-bar{outline:solid 2px;height:0}.mat-tab-link-container{display:flex;flex-grow:1;overflow:hidden;z-index:1}.mat-tab-link{height:48px;padding:0 24px;cursor:pointer;box-sizing:border-box;opacity:.6;min-width:160px;text-align:center;display:inline-flex;justify-content:center;align-items:center;white-space:nowrap;vertical-align:top;text-decoration:none;position:relative;overflow:hidden;-webkit-tap-highlight-color:transparent}.mat-tab-link:focus{outline:none}.mat-tab-link:focus:not(.mat-tab-disabled){opacity:1}.cdk-high-contrast-active .mat-tab-link:focus{outline:dotted 2px;outline-offset:-2px}.mat-tab-link.mat-tab-disabled{cursor:default}.cdk-high-contrast-active .mat-tab-link.mat-tab-disabled{opacity:.5}.mat-tab-link .mat-tab-label-content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}.cdk-high-contrast-active .mat-tab-link{opacity:1}[mat-stretch-tabs] .mat-tab-link{flex-basis:0;flex-grow:1}.mat-tab-link.mat-tab-disabled{pointer-events:none}@media(max-width: 599px){.mat-tab-link{min-width:72px}}\\n'],encapsulation:2}),t})();const _1=xy(wy(yy(class{})));let y1=(()=>{class t extends _1{constructor(t,e,i,n,r,s){super(),this._tabNavBar=t,this.elementRef=e,this._focusMonitor=r,this._isActive=!1,this.rippleConfig=i||{},this.tabIndex=parseInt(n)||0,\"NoopAnimations\"===s&&(this.rippleConfig.animation={enterDuration:0,exitDuration:0})}get active(){return this._isActive}set active(t){Of(t)!==this._isActive&&(this._isActive=t,this._tabNavBar.updateActiveLink())}get rippleDisabled(){return this.disabled||this.disableRipple||this._tabNavBar.disableRipple||!!this.rippleConfig.disabled}focus(){this.elementRef.nativeElement.focus()}ngAfterViewInit(){this._focusMonitor.monitor(this.elementRef)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.elementRef)}_handleFocus(){this._tabNavBar.focusIndex=this._tabNavBar._items.toArray().indexOf(this)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(A1),Ta(Jl),Ta(Zy,8),Wi(\"tabindex\"),Ta(Bm),Ta(sy,8))},t.\\u0275dir=Xt({type:t,inputs:{active:\"active\"},features:[Vo]}),t})(),b1=(()=>{class t extends y1{constructor(t,e,i,n,r,s,o,a){super(t,e,r,s,o,a),this._tabLinkRipple=new Yy(this,i,e,n),this._tabLinkRipple.setupTriggerEvents(e.nativeElement)}ngOnDestroy(){super.ngOnDestroy(),this._tabLinkRipple._removeTriggerEvents()}}return t.\\u0275fac=function(e){return new(e||t)(Ta(v1),Ta(Jl),Ta(tu),Ta(Vf),Ta(Zy,8),Wi(\"tabindex\"),Ta(Bm),Ta(sy,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"mat-tab-link\",\"\"],[\"\",\"matTabLink\",\"\"]],hostAttrs:[1,\"mat-tab-link\",\"mat-focus-indicator\"],hostVars:7,hostBindings:function(t,e){1&t&&$a(\"focus\",function(){return e._handleFocus()}),2&t&&(ta(\"aria-current\",e.active?\"page\":null)(\"aria-disabled\",e.disabled)(\"tabIndex\",e.tabIndex),ll(\"mat-tab-disabled\",e.disabled)(\"mat-tab-label-active\",e.active))},inputs:{disabled:\"disabled\",disableRipple:\"disableRipple\",tabIndex:\"tabIndex\"},exportAs:[\"matTabLink\"],features:[Vo]}),t})(),w1=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({imports:[[Jd,_y,Yp,Ky,sm,Um],_y]}),t})();function x1(t,e){if(1&t&&(Pa(0,\"a\",3,4),bl(2),Da()),2&t){const t=e.$implicit,i=ra(1);Qa(\"title\",\"Onglet \",t.label,\"\"),Ia(\"routerLink\",t.link)(\"active\",i.isActive),Ss(2),xl(\" \",t.label,\" \")}}let S1=(()=>{class t extends Lq{constructor(t){super(),this.mapService=t,this.tabs=[{label:\"Alertes\",link:\"/alerts/dashboard\"},{label:\"R\\xe8gles\",link:\"/alerts/rules\"}]}ngOnInit(){return Vp(this,void 0,void 0,function*(){this.mapService.hasBooted$.value||this.mapService.resetToDefaultView()})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(T$))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-alerts-panel\"]],features:[Vo],decls:4,vars:1,consts:[[1,\"panel\"],[\"mat-tab-nav-bar\",\"\",\"mat-align-tabs\",\"center\",1,\"tabs\"],[\"mat-tab-link\",\"\",\"routerLinkActive\",\"\",3,\"routerLink\",\"active\",\"title\",4,\"ngFor\",\"ngForOf\"],[\"mat-tab-link\",\"\",\"routerLinkActive\",\"\",3,\"routerLink\",\"active\",\"title\"],[\"rla\",\"routerLinkActive\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"nav\",1),na(2,x1,3,4,\"a\",2),Da(),Ra(3,\"router-outlet\"),Da()),2&t&&(Ss(2),Ia(\"ngForOf\",e.tabs))},directives:[v1,Fd,iF,JR,b1,eF],styles:[\".tabs[_ngcontent-%COMP%]{background-color:#f2c94c}\"]}),t})();var C1,k1=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),E1=function(t){function e(e){var i=t.call(this)||this;return i.id_=void 0,i.geometryName_=\"geometry\",i.style_=null,i.styleFunction_=void 0,i.geometryChangeKey_=null,i.addChangeListener(i.geometryName_,i.handleGeometryChanged_),e&&(\"function\"==typeof e.getSimplifiedGeometry?i.setGeometry(e):i.setProperties(e)),i}return k1(e,t),e.prototype.clone=function(){var t=new e(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());var i=this.getGeometry();i&&t.setGeometry(i.clone());var n=this.getStyle();return n&&t.setStyle(n),t},e.prototype.getGeometry=function(){return this.get(this.geometryName_)},e.prototype.getId=function(){return this.id_},e.prototype.getGeometryName=function(){return this.geometryName_},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.handleGeometryChange_=function(){this.changed()},e.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(oz(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=rz(t,\"change\",this.handleGeometryChange_,this)),this.changed()},e.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},e.prototype.setStyle=function(t){this.style_=t,this.styleFunction_=t?function(t){return\"function\"==typeof t?t:(Array.isArray(t)?e=t:(kN(\"function\"==typeof t.getZIndex,41),e=[t]),function(){return e});var e}(t):void 0,this.changed()},e.prototype.setId=function(t){this.id_=t,this.changed()},e.prototype.setGeometryName=function(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()},e}(FV),M1=new Array(6);function T1(t){return O1(t,1,0,0,1,0,0)}function I1(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],u=e[3],d=e[4],p=e[5];return t[0]=i*l+r*c,t[1]=n*l+s*c,t[2]=i*h+r*u,t[3]=n*h+s*u,t[4]=i*d+r*p+o,t[5]=n*d+s*p+a,t}function O1(t,e,i,n,r,s,o){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=s,t[5]=o,t}function P1(t,e){var i=e[0],n=e[1];return e[0]=t[0]*i+t[2]*n+t[4],e[1]=t[1]*i+t[3]*n+t[5],e}function D1(t,e,i,n,r,s,o,a){var l=Math.sin(s),c=Math.cos(s);return t[0]=n*c,t[1]=r*l,t[2]=-n*l,t[3]=r*c,t[4]=o*n*c-a*n*l+e,t[5]=o*r*l+a*r*c+i,t}function R1(t,e){var i=function(t){return t[0]*t[3]-t[1]*t[2]}(e);kN(0!==i,32);var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5];return t[0]=o/i,t[1]=-r/i,t[2]=-s/i,t[3]=n/i,t[4]=(s*l-o*a)/i,t[5]=-(n*l-r*a)/i,t}function F1(t){var e=\"matrix(\"+t.join(\", \")+\")\";if(pN)return e;var i=C1||(C1=document.createElement(\"div\"));return i.style.transform=e,i.style.transform}function L1(t,e,i,n,r,s){for(var o=s||[],a=0,l=e;l<i;l+=n){var c=t[l],h=t[l+1];o[a++]=r[0]*c+r[2]*h+r[4],o[a++]=r[1]*c+r[3]*h+r[5]}return s&&o.length!=a&&(o.length=a),o}function B1(t,e,i,n,r,s,o){for(var a=o||[],l=Math.cos(r),c=Math.sin(r),h=s[0],u=s[1],d=0,p=e;p<i;p+=n){var f=t[p]-h,m=t[p+1]-u;a[d++]=h+f*l-m*c,a[d++]=u+f*c+m*l;for(var g=p+2;g<p+n;++g)a[d++]=t[g]}return o&&a.length!=d&&(a.length=d),a}function N1(t,e,i,n,r,s,o){for(var a=o||[],l=0,c=e;c<i;c+=n){a[l++]=t[c]+r,a[l++]=t[c+1]+s;for(var h=c+2;h<c+n;++h)a[l++]=t[h]}return o&&a.length!=l&&(a.length=l),a}var z1=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),V1=[1,0,0,1,0,0],j1=function(t){function e(){var e=t.call(this)||this;return e.extent_=[1/0,1/0,-1/0,-1/0],e.extentRevision_=-1,e.simplifiedGeometryMaxMinSquaredTolerance=0,e.simplifiedGeometryRevision=0,e.simplifyTransformedInternal=function(t){var e,i,n,r=!1;return function(){var s=Array.prototype.slice.call(arguments);return(!r||this!==n||!UB(s,i))&&(r=!0,n=this,i=s,e=t.apply(this,arguments)),e}}(function(t,e,i){if(!i)return this.getSimplifiedGeometry(e);var n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(e)}),e}return z1(e,t),e.prototype.simplifyTransformed=function(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)},e.prototype.clone=function(){return JB()},e.prototype.closestPointXY=function(t,e,i,n){return JB()},e.prototype.containsXY=function(t,e){var i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e},e.prototype.getClosestPoint=function(t,e){var i=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],i,1/0),i},e.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},e.prototype.computeExtent=function(t){return JB()},e.prototype.getExtent=function(t){if(this.extentRevision_!=this.getRevision()){var e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&LN(e),this.extentRevision_=this.getRevision()}return function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)},e.prototype.rotate=function(t,e){JB()},e.prototype.scale=function(t,e,i){JB()},e.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},e.prototype.getSimplifiedGeometry=function(t){return JB()},e.prototype.getType=function(){return JB()},e.prototype.applyTransform=function(t){JB()},e.prototype.intersectsExtent=function(t){return JB()},e.prototype.translate=function(t,e){JB()},e.prototype.transform=function(t,e){var i=Yz(t),n=i.getUnits()==pz.TILE_PIXELS?function(t,n,r){var s=i.getExtent(),o=i.getWorldExtent(),a=KN(o)/KN(s);return D1(V1,o[0],o[3],a,-a,0,0,0),L1(t,0,t.length,r,V1,n),iV(i,e)(t,n,r)}:iV(i,e);return this.applyTransform(n),this},e}(FV),$1=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function U1(t){for(var e=[],i=0,n=t.length;i<n;++i)e.push(t[i].clone());return e}var H1=function(t){function e(e){var i=t.call(this)||this;return i.geometries_=e||null,i.changeEventsKeys_=[],i.listenGeometriesChange_(),i}return $1(e,t),e.prototype.unlistenGeometriesChange_=function(){this.changeEventsKeys_.forEach(oz),this.changeEventsKeys_.length=0},e.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(rz(this.geometries_[t],\"change\",this.changed,this))},e.prototype.clone=function(){var t=new e(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,i,n){if(n<IN(this.getExtent(),t,e))return n;for(var r=this.geometries_,s=0,o=r.length;s<o;++s)n=r[s].closestPointXY(t,e,i,n);return n},e.prototype.containsXY=function(t,e){for(var i=this.geometries_,n=0,r=i.length;n<r;++n)if(i[n].containsXY(t,e))return!0;return!1},e.prototype.computeExtent=function(t){LN(t);for(var e=this.geometries_,i=0,n=e.length;i<n;++i)VN(t,e[i].getExtent());return t},e.prototype.getGeometries=function(){return U1(this.geometries_)},e.prototype.getGeometriesArray=function(){return this.geometries_},e.prototype.getGeometriesArrayRecursive=function(){for(var t=[],e=this.geometries_,i=0,n=e.length;i<n;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;for(var i=[],n=this.geometries_,r=!1,s=0,o=n.length;s<o;++s){var a=n[s],l=a.getSimplifiedGeometry(t);i.push(l),l!==a&&(r=!0)}if(r){var c=new e(null);return c.setGeometriesArray(i),c}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this},e.prototype.getType=function(){return\"GeometryCollection\"},e.prototype.intersectsExtent=function(t){for(var e=this.geometries_,i=0,n=e.length;i<n;++i)if(e[i].intersectsExtent(t))return!0;return!1},e.prototype.isEmpty=function(){return 0===this.geometries_.length},e.prototype.rotate=function(t,e){for(var i=this.geometries_,n=0,r=i.length;n<r;++n)i[n].rotate(t,e);this.changed()},e.prototype.scale=function(t,e,i){var n=i;n||(n=YN(this.getExtent()));for(var r=this.geometries_,s=0,o=r.length;s<o;++s)r[s].scale(t,e,n);this.changed()},e.prototype.setGeometries=function(t){this.setGeometriesArray(U1(t))},e.prototype.setGeometriesArray=function(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()},e.prototype.applyTransform=function(t){for(var e=this.geometries_,i=0,n=e.length;i<n;++i)e[i].applyTransform(t);this.changed()},e.prototype.translate=function(t,e){for(var i=this.geometries_,n=0,r=i.length;n<r;++n)i[n].translate(t,e);this.changed()},e.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),t.prototype.disposeInternal.call(this)},e}(j1),G1=function(){function t(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}return t.prototype.getReadOptions=function(t,e){var i;if(e){var n=e.dataProjection?Yz(e.dataProjection):this.readProjection(t);e.extent&&n&&n.getUnits()===pz.TILE_PIXELS&&(n=Yz(n)).setWorldExtent(e.extent),i={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(i)},t.prototype.adaptOptions=function(t){return WB({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)},t.prototype.getType=function(){return JB()},t.prototype.readFeature=function(t,e){return JB()},t.prototype.readFeatures=function(t,e){return JB()},t.prototype.readGeometry=function(t,e){return JB()},t.prototype.readProjection=function(t){return JB()},t.prototype.writeFeature=function(t,e){return JB()},t.prototype.writeFeatures=function(t,e){return JB()},t.prototype.writeGeometry=function(t,e){return JB()},t}();function q1(t,e,i){var n,r=i?Yz(i.featureProjection):null,s=i?Yz(i.dataProjection):null;if(n=r&&s&&!tV(r,s)?(e?t.clone():t).transform(e?r:s,e?s:r):t,e&&i&&void 0!==i.decimals){var o=Math.pow(10,i.decimals);n===t&&(n=t.clone()),n.applyTransform(function(t){for(var e=0,i=t.length;e<i;++e)t[e]=Math.round(t[e]*o)/o;return t})}return n}var W1=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function Y1(t){return\"string\"==typeof t?JSON.parse(t)||null:null!==t?t:null}var Z1=function(t){function e(){return t.call(this)||this}return W1(e,t),e.prototype.getType=function(){return\"json\"},e.prototype.readFeature=function(t,e){return this.readFeatureFromObject(Y1(t),this.getReadOptions(t,e))},e.prototype.readFeatures=function(t,e){return this.readFeaturesFromObject(Y1(t),this.getReadOptions(t,e))},e.prototype.readFeatureFromObject=function(t,e){return JB()},e.prototype.readFeaturesFromObject=function(t,e){return JB()},e.prototype.readGeometry=function(t,e){return this.readGeometryFromObject(Y1(t),this.getReadOptions(t,e))},e.prototype.readGeometryFromObject=function(t,e){return JB()},e.prototype.readProjection=function(t){return this.readProjectionFromObject(Y1(t))},e.prototype.readProjectionFromObject=function(t){return JB()},e.prototype.writeFeature=function(t,e){return JSON.stringify(this.writeFeatureObject(t,e))},e.prototype.writeFeatureObject=function(t,e){return JB()},e.prototype.writeFeatures=function(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))},e.prototype.writeFeaturesObject=function(t,e){return JB()},e.prototype.writeGeometry=function(t,e){return JSON.stringify(this.writeGeometryObject(t,e))},e.prototype.writeGeometryObject=function(t,e){return JB()},e}(G1),X1=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function K1(t){var e;return\"XY\"==t?e=2:\"XYZ\"==t||\"XYM\"==t?e=3:\"XYZM\"==t&&(e=4),e}var Q1=function(t){function e(){var e=t.call(this)||this;return e.layout=\"XY\",e.stride=2,e.flatCoordinates=null,e}return X1(e,t),e.prototype.computeExtent=function(t){return NN(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinates=function(){return JB()},e.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.getFlatCoordinates=function(){return this.flatCoordinates},e.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},e.prototype.getLayout=function(){return this.layout},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},e.prototype.getSimplifiedGeometryInternal=function(t){return this},e.prototype.getStride=function(){return this.stride},e.prototype.setFlatCoordinates=function(t,e){this.stride=K1(t),this.layout=t,this.flatCoordinates=e},e.prototype.setCoordinates=function(t,e){JB()},e.prototype.setLayout=function(t,e,i){var n;if(t)n=K1(t);else{for(var r=0;r<i;++r){if(0===e.length)return this.layout=\"XY\",void(this.stride=2);e=e[0]}t=function(t){var e;return 2==t?e=\"XY\":3==t?e=\"XYZ\":4==t&&(e=\"XYZM\"),e}(n=e.length)}this.layout=t,this.stride=n},e.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},e.prototype.rotate=function(t,e){var i=this.getFlatCoordinates();if(i){var n=this.getStride();B1(i,0,i.length,n,t,e,i),this.changed()}},e.prototype.scale=function(t,e,i){var n=e;void 0===n&&(n=t);var r=i;r||(r=YN(this.getExtent()));var s=this.getFlatCoordinates();if(s){var o=this.getStride();(function(t,e,i,n,r,s,o,a){for(var l=a||[],c=o[0],h=o[1],u=0,d=0;d<i;d+=n){var p=t[d+1]-h;l[u++]=c+r*(t[d]-c),l[u++]=h+s*p;for(var f=d+2;f<d+n;++f)l[u++]=t[f]}a&&l.length!=u&&(l.length=u)})(s,0,s.length,o,t,n,r,s),this.changed()}},e.prototype.translate=function(t,e){var i=this.getFlatCoordinates();if(i){var n=this.getStride();N1(i,0,i.length,n,t,e,i),this.changed()}},e}(j1);function J1(t,e,i,n,r,s,o){var a,l=t[e],c=t[e+1],h=t[i]-l,u=t[i+1]-c;if(0===h&&0===u)a=e;else{var d=((r-l)*h+(s-c)*u)/(h*h+u*u);if(d>1)a=i;else{if(d>0){for(var p=0;p<n;++p)o[p]=xz(t[e+p],t[i+p],d);return void(o.length=n)}a=e}}for(p=0;p<n;++p)o[p]=t[a+p];o.length=n}function t2(t,e,i,n,r){var s=t[e],o=t[e+1];for(e+=n;e<i;e+=n){var a=t[e],l=t[e+1],c=_z(s,o,a,l);c>r&&(r=c),s=a,o=l}return r}function e2(t,e,i,n,r){for(var s=0,o=i.length;s<o;++s){var a=i[s];r=t2(t,e,a,n,r),e=a}return r}function i2(t,e,i,n,r,s,o,a,l,c,h){if(e==i)return c;var u,d;if(0===r){if((d=_z(o,a,t[e],t[e+1]))<c){for(u=0;u<n;++u)l[u]=t[e+u];return l.length=n,d}return c}for(var p=h||[NaN,NaN],f=e+n;f<i;)if(J1(t,f-n,f,n,o,a,p),(d=_z(o,a,p[0],p[1]))<c){for(c=d,u=0;u<n;++u)l[u]=p[u];l.length=n,f+=n}else f+=n*Math.max((Math.sqrt(d)-Math.sqrt(c))/r|0,1);if(s&&(J1(t,i-n,e,n,o,a,p),(d=_z(o,a,p[0],p[1]))<c)){for(c=d,u=0;u<n;++u)l[u]=p[u];l.length=n}return c}function n2(t,e,i,n,r,s,o,a,l,c,h){for(var u=h||[NaN,NaN],d=0,p=i.length;d<p;++d){var f=i[d];c=i2(t,e,f,n,r,s,o,a,l,c,u),e=f}return c}function r2(t,e,i,n){for(var r=0,s=i.length;r<s;++r)t[e++]=i[r];return e}function s2(t,e,i,n){for(var r=0,s=i.length;r<s;++r)for(var o=i[r],a=0;a<n;++a)t[e++]=o[a];return e}function o2(t,e,i,n,r){for(var s=r||[],o=0,a=0,l=i.length;a<l;++a){var c=s2(t,e,i[a],n);s[o++]=c,e=c}return s.length=o,s}function a2(t,e,i,n,r,s,o){var a=(i-e)/n;if(a<3){for(;e<i;e+=n)s[o++]=t[e],s[o++]=t[e+1];return o}var l=new Array(a);l[0]=1,l[a-1]=1;for(var c=[e,i-n],h=0;c.length>0;){for(var u=c.pop(),d=c.pop(),p=0,f=t[d],m=t[d+1],g=t[u],A=t[u+1],v=d+n;v<u;v+=n){var _=vz(t[v],t[v+1],f,m,g,A);_>p&&(h=v,p=_)}p>r&&(l[(h-e)/n]=1,d+n<h&&c.push(d,h),h+n<u&&c.push(h,u))}for(v=0;v<a;++v)l[v]&&(s[o++]=t[e+v*n],s[o++]=t[e+v*n+1]);return o}function l2(t,e){return e*Math.round(t/e)}function c2(t,e,i,n,r,s,o){if(e==i)return o;var a,l,c=l2(t[e],r),h=l2(t[e+1],r);e+=n,s[o++]=c,s[o++]=h;do{if(a=l2(t[e],r),l=l2(t[e+1],r),(e+=n)==i)return s[o++]=a,s[o++]=l,o}while(a==c&&l==h);for(;e<i;){var u=l2(t[e],r),d=l2(t[e+1],r);if(e+=n,u!=a||d!=l){var p=a-c,f=l-h,m=u-c,g=d-h;if(p*g==f*m&&(p<0&&m<p||p==m||p>0&&m>p)&&(f<0&&g<f||f==g||f>0&&g>f)){a=u,l=d;continue}s[o++]=a,s[o++]=l,c=a,h=l,a=u,l=d}}return s[o++]=a,s[o++]=l,o}function h2(t,e,i,n,r,s,o,a){for(var l=0,c=i.length;l<c;++l){var h=i[l];o=c2(t,e,h,n,r,s,o),a.push(o),e=h}return o}function u2(t,e,i,n,r){var s;for(e+=n;e<i;e+=n)if(s=r(t.slice(e-n,e),t.slice(e,e+n)))return s;return!1}function d2(t,e,i,n,r){for(var s=void 0!==r?r:[],o=0,a=e;a<i;a+=n)s[o++]=t.slice(a,a+n);return s.length=o,s}function p2(t,e,i,n,r){for(var s=void 0!==r?r:[],o=0,a=0,l=i.length;a<l;++a){var c=i[a];s[o++]=d2(t,e,c,n,s[o]),e=c}return s.length=o,s}function f2(t,e,i,n,r){for(var s=void 0!==r?r:[],o=0,a=0,l=i.length;a<l;++a){var c=i[a];s[o++]=p2(t,e,c,n,s[o]),e=c[c.length-1]}return s.length=o,s}function m2(t,e,i,n,r,s,o){var a,l,c=(i-e)/n;if(1===c)a=e;else if(2===c)a=e,l=r;else if(0!==c){for(var h=t[e],u=t[e+1],d=0,p=[0],f=e+n;f<i;f+=n){var m=t[f],g=t[f+1];d+=Math.sqrt((m-h)*(m-h)+(g-u)*(g-u)),p.push(d),h=m,u=g}var A=r*d,v=function(t,e,i){for(var n,r,s=NB,o=0,a=t.length,l=!1;o<a;)(r=+s(t[n=o+(a-o>>1)],e))<0?o=n+1:(a=n,l=!r);return l?o:~o}(p,A);v<0?(l=(A-p[-v-2])/(p[-v-1]-p[-v-2]),a=e+(-v-2)*n):a=e+v*n}var _=o>1?o:2,y=s||new Array(_);for(f=0;f<_;++f)y[f]=void 0===a?NaN:void 0===l?t[a+f]:xz(t[a+f],t[a+n+f],l);return y}function g2(t,e,i,n,r,s){if(i==e)return null;var o;if(r<t[e+n-1])return s?((o=t.slice(e,e+n))[n-1]=r,o):null;if(t[i-1]<r)return s?((o=t.slice(i-n,i))[n-1]=r,o):null;if(r==t[e+n-1])return t.slice(e,e+n);for(var a=e/n,l=i/n;a<l;){var c=a+l>>1;r<t[(c+1)*n-1]?l=c:a=c+1}var h=t[a*n-1];if(r==h)return t.slice((a-1)*n,(a-1)*n+n);var u=(r-h)/(t[(a+1)*n-1]-h);o=[];for(var d=0;d<n-1;++d)o.push(xz(t[(a-1)*n+d],t[a*n+d],u));return o.push(r),o}function A2(t,e,i,n,r){return!HN(r,function(r){return!v2(t,e,i,n,r[0],r[1])})}function v2(t,e,i,n,r,s){for(var o=0,a=t[i-n],l=t[i-n+1];e<i;e+=n){var c=t[e],h=t[e+1];l<=s?h>s&&(c-a)*(s-l)-(r-a)*(h-l)>0&&o++:h<=s&&(c-a)*(s-l)-(r-a)*(h-l)<0&&o--,a=c,l=h}return 0!==o}function _2(t,e,i,n,r,s){if(0===i.length||!v2(t,e,i[0],n,r,s))return!1;for(var o=1,a=i.length;o<a;++o)if(v2(t,i[o-1],i[o],n,r,s))return!1;return!0}function y2(t,e,i,n,r){var s=$N([1/0,1/0,-1/0,-1/0],t,e,i,n);return!!iz(r,s)&&(!!(PN(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3])||u2(t,e,i,n,function(t,e){return function(t,e,i){var n=!1,r=RN(t,e),s=RN(t,i);if(1===r||1===s)n=!0;else{var o=t[0],a=t[1],l=t[2],c=t[3],h=i[0],u=i[1],d=(u-e[1])/(h-e[0]),p=void 0,f=void 0;!!(2&s)&&!(2&r)&&(n=(p=h-(u-c)/d)>=o&&p<=l),n||!(4&s)||4&r||(n=(f=u-(h-l)*d)>=a&&f<=c),n||!(8&s)||8&r||(n=(p=h-(u-a)/d)>=o&&p<=l),!n&&16&s&&!(16&r)&&(n=(f=u-(h-o)*d)>=a&&f<=c)}return n}(r,t,e)}))}function b2(t,e,i,n,r){if(!function(t,e,i,n,r){return!!(y2(t,e,i,n,r)||v2(t,e,i,n,r[0],r[1])||v2(t,e,i,n,r[0],r[3])||v2(t,e,i,n,r[2],r[1])||v2(t,e,i,n,r[2],r[3]))}(t,e,i[0],n,r))return!1;if(1===i.length)return!0;for(var s=1,o=i.length;s<o;++s)if(A2(t,i[s-1],i[s],n,r)&&!y2(t,i[s-1],i[s],n,r))return!1;return!0}function w2(t,e,i,n){for(var r=t[e],s=t[e+1],o=0,a=e+n;a<i;a+=n){var l=t[a],c=t[a+1];o+=Math.sqrt((l-r)*(l-r)+(c-s)*(c-s)),r=l,s=c}return o}var x2=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),S2=function(t){function e(e,i){var n=t.call(this)||this;return n.flatMidpoint_=null,n.flatMidpointRevision_=-1,n.maxDelta_=-1,n.maxDeltaRevision_=-1,void 0===i||Array.isArray(e[0])?n.setCoordinates(e,i):n.setFlatCoordinates(i,e),n}return x2(e,t),e.prototype.appendCoordinate=function(t){this.flatCoordinates?$B(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,i,n){return n<IN(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(t2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),i2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,n))},e.prototype.forEachSegment=function(t){return u2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinateAtM=function(t,e){return\"XYM\"!=this.layout&&\"XYZM\"!=this.layout?null:g2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,void 0!==e&&e)},e.prototype.getCoordinates=function(){return d2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinateAt=function(t,e){return m2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)},e.prototype.getLength=function(){return w2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[];return i.length=a2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new e(i,\"XY\")},e.prototype.getType=function(){return\"LineString\"},e.prototype.intersectsExtent=function(t){return y2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=s2(this.flatCoordinates,0,t,this.stride),this.changed()},e}(Q1),C2=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),k2=function(t){function e(e,i,n){var r=t.call(this)||this;if(r.ends_=[],r.maxDelta_=-1,r.maxDeltaRevision_=-1,Array.isArray(e[0]))r.setCoordinates(e,i);else if(void 0!==i&&n)r.setFlatCoordinates(i,e),r.ends_=n;else{for(var s=r.getLayout(),o=e,a=[],l=[],c=0,h=o.length;c<h;++c){var u=o[c];0===c&&(s=u.getLayout()),$B(a,u.getFlatCoordinates()),l.push(a.length)}r.setFlatCoordinates(s,a),r.ends_=l}return r}return C2(e,t),e.prototype.appendLineString=function(t){this.flatCoordinates?$B(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,i,n){return n<IN(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(e2(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),n2(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,n))},e.prototype.getCoordinateAtM=function(t,e,i){return\"XYM\"!=this.layout&&\"XYZM\"!=this.layout||0===this.flatCoordinates.length?null:function(t,e,i,n,r,s,o){if(o)return g2(t,e,i[i.length-1],n,r,s);var a;if(r<t[n-1])return s?((a=t.slice(0,n))[n-1]=r,a):null;if(t[t.length-1]<r)return s?((a=t.slice(t.length-n))[n-1]=r,a):null;for(var l=0,c=i.length;l<c;++l){var h=i[l];if(e!=h){if(r<t[e+n-1])return null;if(r<=t[h-1])return g2(t,e,h,n,r,!1);e=h}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,void 0!==e&&e,void 0!==i&&i)},e.prototype.getCoordinates=function(){return p2(this.flatCoordinates,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new S2(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,i=this.layout,n=[],r=0,s=0,o=e.length;s<o;++s){var a=e[s],l=new S2(t.slice(r,a),i);n.push(l),r=a}return n},e.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,i=0,n=this.ends_,r=this.stride,s=0,o=n.length;s<o;++s){var a=n[s];$B(t,m2(e,i,a,r,.5)),i=a}return t},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[],n=[];return i.length=function(t,e,i,n,r,s,o,a){for(var l=0,c=i.length;l<c;++l){var h=i[l];o=a2(t,e,h,n,r,s,o),a.push(o),e=h}return o}(this.flatCoordinates,0,this.ends_,this.stride,t,i,0,n),new e(i,\"XY\",n)},e.prototype.getType=function(){return\"MultiLineString\"},e.prototype.intersectsExtent=function(t){return function(t,e,i,n,r){for(var s=0,o=i.length;s<o;++s){if(y2(t,e,i[s],n,r))return!0;e=i[s]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var i=o2(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()},e}(Q1),E2=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),M2=function(t){function e(e,i){var n=t.call(this)||this;return n.setCoordinates(e,i),n}return E2(e,t),e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,i,n){var r=this.flatCoordinates,s=_z(t,e,r[0],r[1]);if(s<n){for(var o=this.stride,a=0;a<o;++a)i[a]=r[a];return i.length=o,s}return n},e.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},e.prototype.computeExtent=function(t){return BN(this.flatCoordinates,t)},e.prototype.getType=function(){return\"Point\"},e.prototype.intersectsExtent=function(t){return DN(t,this.flatCoordinates[0],this.flatCoordinates[1])},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=r2(this.flatCoordinates,0,t),this.changed()},e}(Q1),T2=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),I2=function(t){function e(e,i){var n=t.call(this)||this;return i&&!Array.isArray(e[0])?n.setFlatCoordinates(i,e):n.setCoordinates(e,i),n}return T2(e,t),e.prototype.appendPoint=function(t){this.flatCoordinates?$B(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,i,n){if(n<IN(this.getExtent(),t,e))return n;for(var r=this.flatCoordinates,s=this.stride,o=0,a=r.length;o<a;o+=s){var l=_z(t,e,r[o],r[o+1]);if(l<n){n=l;for(var c=0;c<s;++c)i[c]=r[o+c];i.length=s}}return n},e.prototype.getCoordinates=function(){return d2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getPoint=function(t){return t<0||(this.flatCoordinates?this.flatCoordinates.length/this.stride:0)<=t?null:new M2(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},e.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,i=this.stride,n=[],r=0,s=t.length;r<s;r+=i){var o=new M2(t.slice(r,r+i),e);n.push(o)}return n},e.prototype.getType=function(){return\"MultiPoint\"},e.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,i=this.stride,n=0,r=e.length;n<r;n+=i)if(DN(t,e[n],e[n+1]))return!0;return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=s2(this.flatCoordinates,0,t,this.stride),this.changed()},e}(Q1);function O2(t,e,i,n){for(var r=0,s=t[i-n],o=t[i-n+1];e<i;e+=n){var a=t[e],l=t[e+1];r+=o*a-s*l,s=a,o=l}return r/2}function P2(t,e,i,n){for(var r=0,s=0,o=i.length;s<o;++s){var a=i[s];r+=O2(t,e,a,n),e=a}return r}var D2=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),R2=function(t){function e(e,i){var n=t.call(this)||this;return n.maxDelta_=-1,n.maxDeltaRevision_=-1,void 0===i||Array.isArray(e[0])?n.setCoordinates(e,i):n.setFlatCoordinates(i,e),n}return D2(e,t),e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,i,n){return n<IN(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(t2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),i2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,n))},e.prototype.getArea=function(){return O2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinates=function(){return d2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[];return i.length=a2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new e(i,\"XY\")},e.prototype.getType=function(){return\"LinearRing\"},e.prototype.intersectsExtent=function(t){return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=s2(this.flatCoordinates,0,t,this.stride),this.changed()},e}(Q1);function F2(t,e,i,n,r,s,o){for(var a,l,c,h,u,d,p,f=r[s+1],m=[],g=0,A=i.length;g<A;++g){var v=i[g];for(h=t[v-n],d=t[v-n+1],a=e;a<v;a+=n)u=t[a],p=t[a+1],(f<=d&&p<=f||d<=f&&f<=p)&&m.push(c=(f-d)/(p-d)*(u-h)+h),h=u,d=p}var _=NaN,y=-1/0;for(m.sort(NB),h=m[0],a=1,l=m.length;a<l;++a){u=m[a];var b=Math.abs(u-h);b>y&&_2(t,e,i,n,c=(h+u)/2,f)&&(_=c,y=b),h=u}return isNaN(_)&&(_=r[s]),o?(o.push(_,f,y),o):[_,f,y]}function L2(t,e,i,n){for(;e<i-n;){for(var r=0;r<n;++r){var s=t[e+r];t[e+r]=t[i-n+r],t[i-n+r]=s}e+=n,i-=n}}function B2(t,e,i,n){for(var r=0,s=t[i-n],o=t[i-n+1];e<i;e+=n){var a=t[e],l=t[e+1];r+=(a-s)*(l+o),s=a,o=l}return 0===r?void 0:r>0}function N2(t,e,i,n,r){for(var s=void 0!==r&&r,o=0,a=i.length;o<a;++o){var l=i[o],c=B2(t,e,l,n);if(0===o){if(s&&c||!s&&!c)return!1}else if(s&&!c||!s&&c)return!1;e=l}return!0}function z2(t,e,i,n,r){for(var s=void 0!==r&&r,o=0,a=i.length;o<a;++o){var l=i[o],c=B2(t,e,l,n);(0===o?s&&c||!s&&!c:s&&!c||!s&&c)&&L2(t,e,l,n),e=l}return e}function V2(t,e,i,n,r){for(var s=0,o=i.length;s<o;++s)e=z2(t,e,i[s],n,r);return e}var j2=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),$2=function(t){function e(e,i,n){var r=t.call(this)||this;return r.ends_=[],r.flatInteriorPointRevision_=-1,r.flatInteriorPoint_=null,r.maxDelta_=-1,r.maxDeltaRevision_=-1,r.orientedRevision_=-1,r.orientedFlatCoordinates_=null,void 0!==i&&n?(r.setFlatCoordinates(i,e),r.ends_=n):r.setCoordinates(e,i),r}return j2(e,t),e.prototype.appendLinearRing=function(t){this.flatCoordinates?$B(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,i,n){return n<IN(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(e2(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),n2(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,n))},e.prototype.containsXY=function(t,e){return _2(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},e.prototype.getArea=function(){return P2(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?z2(e=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):e=this.flatCoordinates,p2(e,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=YN(this.getExtent());this.flatInteriorPoint_=F2(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},e.prototype.getInteriorPoint=function(){return new M2(this.getFlatInteriorPoint(),\"XYM\")},e.prototype.getLinearRingCount=function(){return this.ends_.length},e.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new R2(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.ends_,n=[],r=0,s=0,o=i.length;s<o;++s){var a=i[s],l=new R2(e.slice(r,a),t);n.push(l),r=a}return n},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;N2(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=z2(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[],n=[];return i.length=h2(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),i,0,n),new e(i,\"XY\",n)},e.prototype.getType=function(){return\"Polygon\"},e.prototype.intersectsExtent=function(t){return b2(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var i=o2(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()},e}(Q1),U2=$2;function H2(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=[e,i,e,r,n,r,n,i,e,i];return new $2(s,\"XY\",[s.length])}function G2(t,e,i){for(var n=e||32,r=t.getStride(),s=t.getLayout(),o=t.getCenter(),a=r*(n+1),l=new Array(a),c=0;c<a;c+=r){l[c]=0,l[c+1]=0;for(var h=2;h<r;h++)l[c+h]=o[h]}var u=new $2(l,s,[l.length]);return function(t,e,i,n){for(var r=t.getFlatCoordinates(),s=t.getStride(),o=r.length/s-1,a=n||0,l=0;l<=o;++l){var c=l*s,h=a+2*wz(l,o)*Math.PI/o;r[c]=e[0]+i*Math.cos(h),r[c+1]=e[1]+i*Math.sin(h)}t.changed()}(u,o,t.getRadius(),i),u}var q2=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),W2=function(t){function e(e,i,n){var r=t.call(this)||this;if(r.endss_=[],r.flatInteriorPointsRevision_=-1,r.flatInteriorPoints_=null,r.maxDelta_=-1,r.maxDeltaRevision_=-1,r.orientedRevision_=-1,r.orientedFlatCoordinates_=null,!n&&!Array.isArray(e[0])){for(var s=r.getLayout(),o=e,a=[],l=[],c=0,h=o.length;c<h;++c){var u=o[c];0===c&&(s=u.getLayout());for(var d=a.length,p=u.getEnds(),f=0,m=p.length;f<m;++f)p[f]+=d;$B(a,u.getFlatCoordinates()),l.push(p)}i=s,e=a,n=l}return void 0!==i&&n?(r.setFlatCoordinates(i,e),r.endss_=n):r.setCoordinates(e,i),r}return q2(e,t),e.prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var i=this.flatCoordinates.length;$B(this.flatCoordinates,t.getFlatCoordinates());for(var n=0,r=(e=t.getEnds().slice()).length;n<r;++n)e[n]+=i}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()},e.prototype.clone=function(){for(var t=this.endss_.length,i=new Array(t),n=0;n<t;++n)i[n]=this.endss_[n].slice();var r=new e(this.flatCoordinates.slice(),this.layout,i);return r.applyProperties(this),r},e.prototype.closestPointXY=function(t,e,i,n){return n<IN(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,i,n,r){for(var s=0,o=i.length;s<o;++s){var a=i[s];r=e2(t,e,a,n,r),e=a[a.length-1]}return r}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,i,n,r,s,o,a,l,c,h){for(var u=[NaN,NaN],d=0,p=i.length;d<p;++d){var f=i[d];c=n2(t,e,f,n,r,true,o,a,l,c,u),e=f[f.length-1]}return c}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,0,t,e,i,n))},e.prototype.containsXY=function(t,e){return function(t,e,i,n,r,s){if(0===i.length)return!1;for(var o=0,a=i.length;o<a;++o){var l=i[o];if(_2(t,e,l,n,r,s))return!0;e=l[l.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},e.prototype.getArea=function(){return function(t,e,i,n){for(var r=0,s=0,o=i.length;s<o;++s){var a=i[s];r+=P2(t,e,a,n),e=a[a.length-1]}return r}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?V2(e=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,t):e=this.flatCoordinates,f2(e,0,this.endss_,this.stride)},e.prototype.getEndss=function(){return this.endss_},e.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=function(t,e,i,n){for(var r=[],s=[1/0,1/0,-1/0,-1/0],o=0,a=i.length;o<a;++o){var l=i[o];s=NN(t,e,l[0],n),r.push((s[0]+s[2])/2,(s[1]+s[3])/2),e=l[l.length-1]}return r}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=function(t,e,i,n,r){for(var s=[],o=0,a=i.length;o<a;++o){var l=i[o];s=F2(t,e,l,n,r,2*o,s),e=l[l.length-1]}return s}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},e.prototype.getInteriorPoints=function(){return new I2(this.getFlatInteriorPoints().slice(),\"XYM\")},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;!function(t,e,i,n,r){for(var s=0,o=i.length;s<o;++s){var a=i[s];if(!N2(t,e,a,n,undefined))return!1;a.length&&(e=a[a.length-1])}return!0}(t,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=V2(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[],n=[];return i.length=function(t,e,i,n,r,s,o,a){for(var l=0,c=i.length;l<c;++l){var h=i[l],u=[];o=h2(t,e,h,n,r,s,o,u),a.push(u),e=h[h.length-1]}return o}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),i,0,n),new e(i,\"XY\",n)},e.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var i=this.endss_[t-1];e=i[i.length-1]}var n=this.endss_[t].slice(),r=n[n.length-1];if(0!==e)for(var s=0,o=n.length;s<o;++s)n[s]-=e;return new U2(this.flatCoordinates.slice(e,r),this.layout,n)},e.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.endss_,n=[],r=0,s=0,o=i.length;s<o;++s){var a=i[s].slice(),l=a[a.length-1];if(0!==r)for(var c=0,h=a.length;c<h;++c)a[c]-=r;var u=new U2(e.slice(r,l),t,a);n.push(u),r=l}return n},e.prototype.getType=function(){return\"MultiPolygon\"},e.prototype.intersectsExtent=function(t){return function(t,e,i,n,r){for(var s=0,o=i.length;s<o;++s){var a=i[s];if(b2(t,e,a,n,r))return!0;e=a[a.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var i=function(t,e,i,n,r){for(var s=r||[],o=0,a=0,l=i.length;a<l;++a){var c=o2(t,e,i[a],n,s[o]);s[o++]=c,e=c[c.length-1]}return s.length=o,s}(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{var n=i[i.length-1];this.flatCoordinates.length=0===n.length?0:n[n.length-1]}this.changed()},e}(Q1),Y2=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function Z2(t,e){if(!t)return null;var i;switch(t.type){case\"Point\":i=function(t){return new M2(t.coordinates)}(t);break;case\"LineString\":i=function(t){return new S2(t.coordinates)}(t);break;case\"Polygon\":i=function(t){return new U2(t.coordinates)}(t);break;case\"MultiPoint\":i=function(t){return new I2(t.coordinates)}(t);break;case\"MultiLineString\":i=function(t){return new k2(t.coordinates)}(t);break;case\"MultiPolygon\":i=function(t){return new W2(t.coordinates)}(t);break;case\"GeometryCollection\":i=function(t,e){var i=t.geometries.map(function(t){return Z2(t,undefined)});return new H1(i)}(t);break;default:throw new Error(\"Unsupported GeoJSON type: \"+t.type)}return q1(i,!1,e)}function X2(t,e){var i,n=(t=q1(t,!0,e)).getType();switch(n){case\"Point\":i=function(t,e){return{type:\"Point\",coordinates:t.getCoordinates()}}(t);break;case\"LineString\":i=function(t,e){return{type:\"LineString\",coordinates:t.getCoordinates()}}(t);break;case\"Polygon\":i=function(t,e){var i;return e&&(i=e.rightHanded),{type:\"Polygon\",coordinates:t.getCoordinates(i)}}(t,e);break;case\"MultiPoint\":i=function(t,e){return{type:\"MultiPoint\",coordinates:t.getCoordinates()}}(t);break;case\"MultiLineString\":i=function(t,e){return{type:\"MultiLineString\",coordinates:t.getCoordinates()}}(t);break;case\"MultiPolygon\":i=function(t,e){var i;return e&&(i=e.rightHanded),{type:\"MultiPolygon\",coordinates:t.getCoordinates(i)}}(t,e);break;case\"GeometryCollection\":i=function(t,e){return{type:\"GeometryCollection\",geometries:t.getGeometriesArray().map(function(t){var i=WB({},e);return delete i.featureProjection,X2(t,i)})}}(t,e);break;case\"Circle\":i={type:\"GeometryCollection\",geometries:[]};break;default:throw new Error(\"Unsupported geometry type: \"+n)}return i}var K2=function(t){function e(e){var i=this,n=e||{};return(i=t.call(this)||this).dataProjection=Yz(n.dataProjection?n.dataProjection:\"EPSG:4326\"),n.featureProjection&&(i.defaultFeatureProjection=Yz(n.featureProjection)),i.geometryName_=n.geometryName,i.extractGeometryName_=n.extractGeometryName,i.supportedMediaTypes=[\"application/geo+json\",\"application/vnd.geo+json\"],i}return Y2(e,t),e.prototype.readFeatureFromObject=function(t,e){var i,n=Z2((i=\"Feature\"===t.type?t:{type:\"Feature\",geometry:t,properties:null}).geometry,e),r=new E1;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&\"geometry_name\"in i!==void 0&&r.setGeometryName(i.geometry_name),r.setGeometry(n),\"id\"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r},e.prototype.readFeaturesFromObject=function(t,e){var i=null;if(\"FeatureCollection\"===t.type){i=[];for(var n=t.features,r=0,s=n.length;r<s;++r)i.push(this.readFeatureFromObject(n[r],e))}else i=[this.readFeatureFromObject(t,e)];return i},e.prototype.readGeometryFromObject=function(t,e){return Z2(t,e)},e.prototype.readProjectionFromObject=function(t){var e,i=t.crs;return i?\"name\"==i.type?e=Yz(i.properties.name):\"EPSG\"===i.type?e=Yz(\"EPSG:\"+i.properties.code):kN(!1,36):e=this.dataProjection,e},e.prototype.writeFeatureObject=function(t,e){e=this.adaptOptions(e);var i={type:\"Feature\",geometry:null,properties:null},n=t.getId();if(void 0!==n&&(i.id=n),!t.hasProperties())return i;var r=t.getProperties(),s=t.getGeometry();return s&&(i.geometry=X2(s,e),delete r[t.getGeometryName()]),XB(r)||(i.properties=r),i},e.prototype.writeFeaturesObject=function(t,e){e=this.adaptOptions(e);for(var i=[],n=0,r=t.length;n<r;++n)i.push(this.writeFeatureObject(t[n],e));return{type:\"FeatureCollection\",features:i}},e.prototype.writeGeometryObject=function(t,e){return X2(t,this.adaptOptions(e))},e}(Z1);const Q2=new K2({featureProjection:\"EPSG:3857\"});function J2(t,e){1&t&&Ra(0,\"mat-spinner\",7)}function t3(t,e){1&t&&(Pa(0,\"p\",10),bl(1,\"Vous n'avez pas encore cr\\xe9\\xe9 d'annotation.\"),Da())}function e3(t,e){if(1&t){const t=Na();Pa(0,\"div\",13),Pa(1,\"button\",14),$a(\"click\",function(){const e=Fe(t).$implicit;return Wa(3).locateAnnotation(e)}),bl(2),Da(),Pa(3,\"button\",15),$a(\"click\",function(){const e=Fe(t).$implicit;return Wa(3).editAnnotation(e)}),Pa(4,\"mat-icon\"),bl(5,\"edit\"),Da(),Da(),Pa(6,\"button\",16),$a(\"click\",function(){const e=Fe(t).$implicit;return Wa(3).deleteAnnotation(e)}),Pa(7,\"mat-icon\"),bl(8,\"delete\"),Da(),Da(),Da()}if(2&t){const t=e.$implicit,i=Wa(3);Ia(\"@fadeAnimation\",void 0),Ss(2),xl(\" \",t.name,\" \"),Ss(1),Ia(\"disabled\",i.isEditingAnnotation),Ss(3),Ia(\"disabled\",i.isEditingAnnotation)}}function i3(t,e){if(1&t&&(Pa(0,\"div\",11),na(1,e3,9,4,\"div\",12),Da()),2&t){const t=Wa(2);Ss(1),Ia(\"ngForOf\",t.annotations)(\"ngForTrackBy\",t.trackById)}}function n3(t,e){if(1&t&&(na(0,t3,2,0,\"p\",8),na(1,i3,2,2,\"div\",9)),2&t){const t=Wa();Ia(\"ngIf\",0===t.annotations.length),Ss(1),Ia(\"ngIf\",t.annotations.length>0)}}let r3=(()=>{class t extends Lq{constructor(t,e,i,n){super(),this.titleService=t,this.annotationsService=e,this.mapService=i,this.uiService=n,this.annotations=[],this.isEditingAnnotation=!1,this.showCreateAnnotationForm=!1,this.annotationsEditable=!0}ngOnInit(){return Vp(this,void 0,void 0,function*(){this.titleService.setTitle(\"Liste des annotations - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.subscriptions.push(this.annotationsService.annotations$.subscribe(t=>{this.annotations=t}),this.annotationsService.editedAnnotation$.pipe(E(t=>!!t)).subscribe(t=>{this.isEditingAnnotation=t}))})}ngOnDestroy(){super.ngOnDestroy()}displayCreateAnnotationForm(){this.showCreateAnnotationForm=!0}hideCreateAnnotationForm(){this.showCreateAnnotationForm=!1}trackById(t,e){return e.id}locateAnnotation(t){switch(t.geom.type){case\"Point\":this.mapService.pingLocation(t.geom.coordinates),this.mapService.centerOnLonLat(t.geom.coordinates);break;case\"LineString\":case\"Polygon\":this.mapService.fitOn(Q2.readGeometry(t.geom));break;default:throw new Error(`Type d'annotation inconnu : \\`${t.geom.type}\\``)}}editAnnotation(t){this.locateAnnotation(t),this.annotationsService.editAnnotation(t)}deleteAnnotation(t){this.uiService.confirm({title:\"Suppression\",message:\"Confirmez-vous la suppression de cette annotation ?\",action:e=>Vp(this,void 0,void 0,function*(){e&&(yield this.annotationsService.deleteAnnotation(t.id))})})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(zp),Ta(fH),Ta(T$),Ta(AU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-annotations-panel\"]],features:[Vo],decls:9,vars:3,consts:[[\"joyrideStep\",\"annotations-panel\",\"title\",\"Gestion des annotations\",\"text\",\"C'est ici que vous pouvez g\\xe9rer vos annotations sur la carte.\",1,\"panel\"],[1,\"panel__header\",\"panel__header--blue\"],[1,\"panel__title\",\"u-flex\"],[1,\"scrollable\",\"d-flex-column\"],[\"class\",\"spinner\",\"strokeWidth\",\"4\",\"diameter\",\"80\",4,\"ngIf\"],[3,\"ngIf\"],[\"mat-stroked-button\",\"\",\"color\",\"primary\",\"title\",\"Cr\\xe9er une annotation\",1,\"ma-2\",3,\"disabled\",\"click\"],[\"strokeWidth\",\"4\",\"diameter\",\"80\",1,\"spinner\"],[\"class\",\"panel__content\",4,\"ngIf\"],[\"class\",\"d-flex-column\",4,\"ngIf\"],[1,\"panel__content\"],[1,\"d-flex-column\"],[\"class\",\"d-flex\",\"style\",\"transition: .5s\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[1,\"d-flex\",2,\"transition\",\".5s\"],[\"mat-button\",\"\",\"title\",\"Localiser l'annotation\",1,\"u-flex\",3,\"click\"],[\"mat-button\",\"\",\"title\",\"\\xc9diter la zone\",3,\"disabled\",\"click\"],[\"mat-button\",\"\",\"title\",\"Supprimer la zone\",3,\"disabled\",\"click\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"div\",1),Pa(2,\"h2\",2),bl(3,\"Annotations\"),Da(),Da(),Pa(4,\"div\",3),na(5,J2,1,0,\"mat-spinner\",4),na(6,n3,2,2,\"ng-template\",5),Pa(7,\"button\",6),$a(\"click\",function(){return e.annotationsService.createNewAnnotation()}),bl(8,\" Nouvelle annotation \"),Da(),Da(),Da()),2&t&&(Ss(5),Ia(\"ngIf\",!e.annotations),Ss(1),Ia(\"ngIf\",e.annotations),Ss(1),Ia(\"disabled\",e.isEditingAnnotation))},directives:[tL,Bd,vb,KY,Fd,Yk],encapsulation:2,data:{animation:[bA(\"fadeAnimation\",[EA(\":enter\",[SA({opacity:0}),wA(500,SA({opacity:1}))]),EA(\":leave\",[SA({pointerEvents:\"none\",transform:\"scale(1)\"}),wA(500,SA({opacity:0,transform:\"scale(0)\",height:0}))])])]}}),t})();const s3=/@(.+),(.+),(.+)z(?:,(.+Z))?/;let o3=(()=>{class t extends Lq{constructor(t,e,i,n,r,s){super(),this.location=t,this.titleService=e,this.historyService=i,this.mapService=n,this.mapConfigService=r,this.routeService=s}ngOnInit(){if(!this.mapService.hasBooted$.value){const t=this.location.path().match(s3);if(t){const e=function(t,e){if(0!==e){const i=e+180;t[0]<e-180&&(t[0]+=360),t[0]>i&&(t[0]-=360)}return t}([+t[2],+t[1]],this.mapConfigService.longitudeCenter$.value);this.mapService.centerOnLonLat(e,+t[3]);const i=t[4];i&&this.historyService.setTimestamp(Math.ceil(new Date(i).getTime()/1e3))}else this.mapService.resetToDefaultView()}this.subscriptions.push(this.routeService.viewURL$.pipe(pf(t=>!!t)).subscribe(t=>{this.location.replaceState(`/${t}`),this.titleService.setTitle(`${t} - ANAIS`)}))}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Yu),Ta(zp),Ta(R$),Ta(T$),Ta(k$),Ta(F$))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-empty-panel\"]],features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})();const a3=/(?:\\W|^)([0-9]{9})(?!\\w)/g;function l3(t,e){if(1&t&&(Pa(0,\"div\"),bl(1),Da()),2&t){const t=Wa();Ss(1),Cl(\" \",t.extractedMMSIs.length,\" MMSI d\\xe9tect\\xe9\",t.extractedMMSIs.length>1?\"s\":\"\",\" : \",t.extractedMMSIs.length>0?t.extractedMMSIs.join(\", \"):\"-\",\" \")}}let c3=(()=>{class t{constructor(t,e){this.dialogRef=t,this.workerService=e,this.textFormControl=new Ow(\"\"),this.extractedMMSIs=null,this.save=()=>Vp(this,void 0,void 0,function*(){const t=yield Promise.all(this.extractedMMSIs.map(t=>Vp(this,void 0,void 0,function*(){try{return yield this.workerService.ships.getShip(t)}catch(e){if(e.name!==OB.NotFound)throw e}})));this.dialogRef.close(t)})}ngOnInit(){this.textFormControl.valueChanges.subscribe(t=>{this.extractedMMSIs=function(t){let e;const i=[];for(;null!==(e=a3.exec(t));)e.index===a3.lastIndex&&a3.lastIndex++,i.push(e[1]);return i}(t)})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(PC),Ta(iU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-fleet-ships-bulk-import-dialog\"]],decls:18,vars:5,consts:[[\"mat-dialog-title\",\"\"],[\"mat-dialog-content\",\"\",2,\"min-width\",\"600px\"],[1,\"d-flex-column-center\"],[\"appearance\",\"outline\",1,\"pa-1\",\"d-block\"],[\"matInput\",\"\",\"name\",\"text\",\"cdkTextareaAutosize\",\"\",\"cdkAutosizeMinRows\",\"4\",\"cdkAutosizeMaxRows\",\"15\",3,\"formControl\"],[4,\"ngIf\"],[\"mat-dialog-actions\",\"\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"color\",\"primary\",3,\"disabled\",\"app-async-action\"],[\"mat-button\",\"\",3,\"mat-dialog-close\"]],template:function(t,e){1&t&&(Pa(0,\"h1\",0),bl(1,\"Import en masse\"),Da(),Pa(2,\"div\",1),Pa(3,\"p\"),bl(4,\"Utilisez la zone de texte ci-apr\\xe8s pour copiez-coller une liste de MMSI (text, CSV). Les MMSI seront extraits automatiquement avec le format de 9 chiffres.\"),Da(),Pa(5,\"div\",2),Pa(6,\"mat-form-field\",3),Pa(7,\"mat-label\"),bl(8,\"Liste de MMSI (CSV, etc)\"),Da(),Pa(9,\"textarea\",4),bl(10,\"      \"),Da(),Da(),na(11,l3,2,3,\"div\",5),Da(),Da(),Pa(12,\"div\",6),Ra(13,\"div\",7),Pa(14,\"button\",8),bl(15,\" Enregistrer \"),Da(),Pa(16,\"button\",9),bl(17,\" Annuler \"),Da(),Da()),2&t&&(Ss(9),Ia(\"formControl\",e.textFormControl),Ss(2),Ia(\"ngIf\",e.extractedMMSIs),Ss(3),Ia(\"disabled\",!e.extractedMMSIs||0===e.extractedMMSIs.length)(\"app-async-action\",e.save),Ss(2),Ia(\"mat-dialog-close\",null))},directives:[$C,UC,tS,Hx,hS,rS,Mb,aw,Ww,Bd,HC,vb,cW,jC],styles:[\"\"]}),t})();function h3(t){return{id:t.id,name:t.name,ships:t.ships.map(t=>t.mmsi)}}const u3={0:\"Under way using engine\",1:\"At anchor\",2:\"Not under command\",3:\"Restricted manoeuverability\",4:\"Constrained by her draught\",5:\"Moored\",6:\"Aground\",7:\"Engaged in Fishing\",8:\"Under way sailing\",9:\"Reserved for future amendment of Navigational Status for HSC\",10:\"Reserved for future amendment of Navigational Status for WIG\",11:\"Reserved for future use\",12:\"Reserved for future use\",13:\"Reserved for future use\",14:\"AIS-SART is active\",15:\"Not defined (default)\"},d3=Object.values(u3).filter((t,e)=>e<9||15===e).map((t,e)=>({key:e,label:t}));function p3(t,e){if(1&t){const t=Na();Pa(0,\"button\",9),$a(\"click\",function(){Fe(t);const e=Wa();return e.deleteItem.emit(e.ship)}),Pa(1,\"mat-icon\"),bl(2,\"delete\"),Da(),Da()}}const f3=function(t){return[\"./ships/\",t]};function m3(t,e){if(1&t&&(Pa(0,\"button\",10),Pa(1,\"mat-icon\"),bl(2,\"info\"),Da(),Da()),2&t){const t=Wa();Ia(\"routerLink\",Jc(1,f3,t.ship.mmsi))}}let g3=(()=>{class t{constructor(t){this.mapService=t,this.editable=!1,this.deleteItem=new ph,this.navigationStatusByKey=u3,this.vesselTypeLabelsByType=zj,this.hasPosition=!0}ngOnChanges(t){var e,i;t.ship&&(this.hasPosition=Zj(null===(e=t.ship.currentValue)||void 0===e?void 0:e.lon)&&Zj(null===(i=t.ship.currentValue)||void 0===i?void 0:i.lat))}locateShip(){this.mapService.centerOnLonLat([this.ship.lon,this.ship.lat])}locateAndZoomToShip(){this.mapService.locate([this.ship.lon,this.ship.lat])}}return t.\\u0275fac=function(e){return new(e||t)(Ta(T$))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-fleet-ship-item\"]],inputs:{ship:\"ship\",editable:\"editable\"},outputs:{deleteItem:\"deleteItem\"},features:[ce],decls:14,vars:8,consts:[[1,\"fleet-ship-item\"],[\"mat-button\",\"\",1,\"fleet-ship-item__link\",3,\"title\",\"disabled\",\"click\",\"dblclick\"],[1,\"fleet-ship-item__flag\",3,\"mmsi\"],[1,\"fleet-ship-item__title\"],[1,\"fleet-ship-item__name\"],[1,\"fleet-ship-item__type\"],[\"mat-button\",\"\",3,\"click\",4,\"ngIf\"],[\"mat-button\",\"\",3,\"routerLink\",4,\"ngIf\"],[1,\"fleet-ship-item\",\"ml-2\",\"mb-2\",\"mat-small\"],[\"mat-button\",\"\",3,\"click\"],[\"mat-button\",\"\",3,\"routerLink\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"button\",1),$a(\"click\",function(){return e.locateShip()})(\"dblclick\",function(){return e.locateAndZoomToShip()}),Ra(2,\"app-flag\",2),Pa(3,\"div\",3),Pa(4,\"strong\",4),bl(5),Da(),Pa(6,\"small\",5),bl(7),Da(),Da(),Da(),na(8,p3,3,0,\"button\",6),na(9,m3,3,3,\"button\",7),Da(),Pa(10,\"div\",8),bl(11,\" Statut :\\xa0\"),Pa(12,\"strong\"),bl(13),Da(),Da()),2&t&&(Ss(1),Ia(\"title\",e.hasPosition?\"Localiser le navire\":\"Ce navire n'a pas de position\")(\"disabled\",!e.hasPosition),Ss(1),Ia(\"mmsi\",e.ship.mmsi),Ss(3),wl(e.ship.name||\"?\"),Ss(2),wl(e.ship.cargo?e.vesselTypeLabelsByType[e.ship.cargo]:\"?\"),Ss(1),Ia(\"ngIf\",e.editable),Ss(1),Ia(\"ngIf\",!e.editable),Ss(4),wl(e.navigationStatusByKey[e.ship.status]||\"?\"))},directives:[vb,TZ,Bd,Yk,QR],styles:[\".fleet-ship-item[_ngcontent-%COMP%]{display:flex}.fleet-ship-item__button-content[_ngcontent-%COMP%]{display:flex}.fleet-ship-item__link[_ngcontent-%COMP%]{flex:1;padding:0;line-height:inherit;text-align:inherit;font-size:inherit;font-weight:inherit}.fleet-ship-item__link[_ngcontent-%COMP%]     .mat-button-wrapper{display:flex}.fleet-ship-item__flag[_ngcontent-%COMP%]{margin:5px}.fleet-ship-item__title[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:5px 0;flex:1}.fleet-ship-item__name[_ngcontent-%COMP%]{font-size:1.2em}.fleet-ship-item__type[_ngcontent-%COMP%]{font-size:.9em;color:#555}\"],changeDetection:0}),t})();function A3(t,e){1&t&&Ra(0,\"mat-spinner\",5)}function v3(t,e){1&t&&(Pa(0,\"mat-error\",20),bl(1,\" Ce champ ne peut \\xeatre vide. \"),Da())}function _3(t,e){if(1&t){const t=Na();Pa(0,\"mat-form-field\",14),Pa(1,\"input\",15,16),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).fleet.name=e}),Da(),na(3,v3,2,0,\"mat-error\",17),Da(),Pa(4,\"button\",18),Pa(5,\"mat-icon\"),bl(6,\"check\"),Da(),Da(),Pa(7,\"button\",19),Pa(8,\"mat-icon\"),bl(9,\"clear\"),Da(),Da()}if(2&t){const t=ra(2);Wa();const e=ra(1),i=Wa();Ss(1),Ia(\"ngModel\",i.fleet.name),Ss(2),Ia(\"ngIf\",null==t.errors?null:t.errors.required),Ss(1),Ia(\"app-async-action\",i.saveFleet)(\"disabled\",!e.form.valid),Ss(3),Ia(\"routerLink\",i.newFleet?\"/fleets\":\"/fleets/\"+i.fleet.id)}}function y3(t,e){if(1&t){const t=Na();Pa(0,\"button\",22),Pa(1,\"mat-icon\"),bl(2,\"create\"),Da(),Da(),Pa(3,\"button\",23),Pa(4,\"mat-icon\"),bl(5,\"more_vert\"),Da(),Da(),Pa(6,\"mat-menu\",null,24),Pa(8,\"button\",25),$a(\"click\",function(){return Fe(t),Wa(3).exportFleet()}),Pa(9,\"mat-icon\"),bl(10,\"cloud_download\"),Da(),Pa(11,\"span\"),bl(12,\"Exporter la flotte\"),Da(),Da(),Pa(13,\"button\",26),$a(\"click\",function(){return Fe(t),Wa(3).deleteFleet()}),Pa(14,\"mat-icon\",27),bl(15,\"delete\"),Da(),Pa(16,\"span\",27),bl(17,\"Supprimer\"),Da(),Da(),Da()}if(2&t){const t=ra(7);Ia(\"routerLink\",\"/fleets/\"+Wa(3).fleet.id+\"/edit\"),Ss(3),Ia(\"matMenuTriggerFor\",t)}}function b3(t,e){if(1&t&&(Pa(0,\"h2\",21),bl(1),Da(),na(2,y3,18,2,\"ng-template\",4)),2&t){const t=Wa(2);Ss(1),xl(\" \",t.fleet.name,\" \"),Ss(1),Ia(\"ngIf\",!t.offlineService.isOffline$.value)}}function w3(t,e){if(1&t){const t=Na();Pa(0,\"div\",28),Pa(1,\"button\",29),$a(\"click\",function(){return Fe(t),Wa(2).fitOnFleet()}),Pa(2,\"mat-icon\"),bl(3,\"center_focus_strong\"),Da(),Da(),Pa(4,\"button\",30),Pa(5,\"mat-icon\"),bl(6,\"stacked_line_chart\"),Da(),Da(),Pa(7,\"button\",31),$a(\"click\",function(){return Fe(t),Wa(2).mapConfigService.toggleOtherShips()}),Pa(8,\"mat-icon\"),bl(9,\"directions_boat\"),Da(),Da(),Da()}if(2&t){const t=Wa(2);Ss(4),ll(\"button-active\",t.fleetsService.displayFleetTrail$.value),Ia(\"title\",t.fleetsService.displayFleetTrail$.value?\"Masquer les traces des navires de la flotte\":\"Afficher les traces des navires de la flotte (le rafraichissement n'est pas automatique)\")(\"app-async-action\",t.fleetsService.toggleDisplayFleetTrails),Ss(3),ll(\"button-active\",t.mapConfigService.showOtherShips$.value),Qa(\"title\",\"\",t.mapConfigService.showOtherShips$.value?\"Masquer\":\"Afficher\",\" les autres navires\")}}function x3(t,e){1&t&&(Pa(0,\"p\",32),bl(1,\"Aucun navire n'a \\xe9t\\xe9 configur\\xe9\"),Da())}function S3(t,e){if(1&t){const t=Na();Pa(0,\"app-fleet-ship-item\",33),$a(\"deleteItem\",function(e){return Fe(t),Wa(2).deleteShip(e)}),Da()}if(2&t){const t=e.$implicit,i=Wa(2);Ia(\"ship\",t)(\"editable\",i.editMode)}}function C3(t,e){if(1&t){const t=Na();Pa(0,\"div\",32),Pa(1,\"h3\"),bl(2,\"Ajouter des navires\"),Da(),Pa(3,\"button\",34),$a(\"click\",function(){return Fe(t),Wa(2).openBulkImportDialog()}),Pa(4,\"mat-icon\",35),bl(5,\"post_add\"),Da(),Pa(6,\"span\"),bl(7,\"Import en masse\"),Da(),Da(),Pa(8,\"app-ship-identifier-input\",36),$a(\"selectItem\",function(e){return Fe(t),Wa(2).addShipToFleet(e)}),Da(),Da()}if(2&t){const t=Wa(2);Ss(8),Ia(\"existingItems\",t.fleetShipsIds)}}function k3(t,e){if(1&t&&(Pa(0,\"div\",40),Pa(1,\"div\",41),Pa(2,\"mat-icon\",42),bl(3,\"warning\"),Da(),bl(4),Da(),Pa(5,\"div\"),bl(6),Da(),Da()),2&t){const t=e.alert;Ss(4),xl(\" \",t.rule_name,\" \"),Ss(2),wl(t.ship_name)}}const E3=function(t){return[\"/ships/\",t]},M3=function(t){return[\"/alerts/rules/\",t]};function T3(t,e){if(1&t&&(Pa(0,\"button\",43),Pa(1,\"mat-icon\"),bl(2,\"info\"),Da(),bl(3,\" Voir d\\xe9tail Navire \"),Da(),Pa(4,\"button\",43),Pa(5,\"mat-icon\"),bl(6,\"info\"),Da(),bl(7,\" Voir la r\\xe8gle \"),Da()),2&t){const t=e.alert;Ia(\"routerLink\",Jc(2,E3,t.mmsi)),Ss(4),Ia(\"routerLink\",Jc(4,M3,t.rule_id))}}function I3(t,e){if(1&t&&(Pa(0,\"h3\",11),bl(1,\"Alertes\"),Da(),Ra(2,\"app-alerts-list\",37),na(3,k3,7,2,\"ng-template\",null,38,Ph),na(5,T3,8,6,\"ng-template\",null,39,Ph)),2&t){const t=ra(4),e=ra(6),i=Wa(2);Ss(2),Ia(\"alerts$\",i.alerts$)(\"alertTitleRef\",t)(\"alertMenuItemsRef\",e)}}function O3(t,e){if(1&t&&(Pa(0,\"ng-form\",6,7),Pa(2,\"div\",8),na(3,_3,10,5,\"ng-template\",4),na(4,b3,3,2,\"ng-template\",4),Da(),Ra(5,\"mat-divider\"),na(6,w3,10,7,\"div\",9),Pa(7,\"div\",10),Pa(8,\"h3\",11),bl(9,\"Navires\"),Da(),na(10,x3,2,0,\"p\",12),na(11,S3,1,2,\"app-fleet-ship-item\",13),Ra(12,\"mat-divider\"),na(13,C3,9,1,\"div\",12),na(14,I3,7,3,\"ng-template\",4),Da(),Da()),2&t){const t=Wa();Ss(3),Ia(\"ngIf\",t.editMode),Ss(1),Ia(\"ngIf\",!t.editMode),Ss(2),Ia(\"ngIf\",!t.editMode),Ss(4),Ia(\"ngIf\",0===t.fleet.ships.length),Ss(1),Ia(\"ngForOf\",t.fleet.ships),Ss(2),Ia(\"ngIf\",t.editMode),Ss(1),Ia(\"ngIf\",!t.editMode)}}let P3=(()=>{class t extends Lq{constructor(t,e,i,n,r,s,o,a,l,c,h,d){super(),this.activatedRoute=t,this.router=e,this.dialog=i,this.titleService=n,this.configService=r,this.fleetsService=s,this.interactionsService=o,this.mapService=a,this.mapConfigService=l,this.offlineService=c,this.timeRangeService=h,this.uiService=d,this.timeRangeSubscription=new u,this.componentDestroyed=!1,this.alerts$=new Zp([]),this.editMode=!1,this.newFleet=!1,this.saveFleet=()=>Vp(this,void 0,void 0,function*(){const t=h3(this.fleet);if(this.newFleet){const e=yield this.fleetsService.createFleet(t);yield this.router.navigateByUrl(`/fleets/${e}`)}else yield this.fleetsService.updateFleet(t),yield this.router.navigateByUrl(`/fleets/${this.fleet.id}`)})}ngOnInit(){this.subscriptions.push(this.activatedRoute.data.subscribe(t=>{this.editMode=!!t.edit,this.newFleet=!!t.new})),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.subscriptions.push(this.activatedRoute.paramMap.subscribe(t=>Vp(this,void 0,void 0,function*(){this.fleetsService.resetDisplayFleetTrails(),this.newFleet?(this.fleet={name:\"\",ships:[]},this.titleService.setTitle(\"Nouvelle flotte - ANAIS\")):(this.fleetId=t.get(\"fleetId\"),yield this.fetchFleet())})))}ngOnDestroy(){super.ngOnDestroy(),this.componentDestroyed=!0,this.fleetsService.deselectFleet(),this.timeRangeSubscription.unsubscribe(),this.fleetsService.resetDisplayFleetTrails()}get fleetShipsIds(){return this.fleet.ships.map(t=>t.mmsi)}fetchFleet(){return Vp(this,void 0,void 0,function*(){try{this.timeRangeSubscription.unsubscribe();const{fleet:t,alerts:e}=yield this.fleetsService.selectFleet(this.fleetId);if(this.componentDestroyed)return;this.fleet=t,this.alerts$.next(e),this.titleService.setTitle(`Flotte ${this.fleet.name} - ANAIS`),this.offlineService.isOffline$.value||(this.timeRangeSubscription=this.timeRangeService.timeRange$.pipe(wf(1)).subscribe(()=>Vp(this,void 0,void 0,function*(){this.fleet&&!this.editMode&&(yield this.fetchFleet())})))}catch(k6){throw k6.notfound?(this.router.navigateByUrl(\"/fleets\").catch(()=>{}),new Error(`La flotte <${this.fleetId}> n'existe pas.`)):k6}})}deleteFleet(){this.uiService.confirm({title:\"Suppression\",message:\"Une fois supprim\\xe9e, cette flotte ne sera plus accessible. Confirmez-vous la suppression de cette flotte ?\",action:t=>Vp(this,void 0,void 0,function*(){t&&(yield this.fleetsService.deleteFleet(this.fleet.id),yield this.router.navigateByUrl(\"/fleets\"))})})}exportFleet(){const t=h3(this.fleet);delete t.id;const e=(new Date).toISOString().substr(0,19).replace(/:/g,\"-\");aq(t,`ANAIS-flotte-${this.fleet.name}-${e}.json`)}addShipToFleet(t){t&&!this.fleet.ships.some(e=>e.mmsi===t.mmsi)&&this.fleet.ships.push(t)}deleteShip(t){this.fleet.ships=this.fleet.ships.filter(e=>e!==t)}fitOnFleet(){if(this.fleet.ships.length>0){const{lon:t,lat:e}=this.fleet.ships[0],i=l$.New(t,e,t,e);this.fleet.ships.filter(t=>Zj(t.lon)&&Zj(t.lat)).forEach(t=>{i.addPoint(t.lon,t.lat)}),this.mapService.fitOn(i.toExtent())}}openBulkImportDialog(){this.dialog.open(c3,{autoFocus:!1,closeOnNavigation:!0}).afterClosed().subscribe(t=>{t instanceof Array&&t.forEach(t=>{this.addShipToFleet(t)})})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(MD),Ta(XR),Ta(zC),Ta(zp),Ta(C$),Ta(Tq),Ta(Cq),Ta(T$),Ta(k$),Ta(fq),Ta(_q),Ta(AU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-fleet-panel\"]],features:[Vo],decls:9,vars:2,consts:[[1,\"panel\",\"fleet-panel\",\"u-flex\"],[1,\"d-flex\",2,\"background-color\",\"#fff\"],[\"mat-button\",\"\",\"title\",\"Revenir \\xe0 la liste\",\"routerLink\",\"/fleets\",1,\"back-button\"],[\"class\",\"spinner\",\"strokeWidth\",\"4\",\"diameter\",\"80\",4,\"ngIf\"],[3,\"ngIf\"],[\"strokeWidth\",\"4\",\"diameter\",\"80\",1,\"spinner\"],[\"name\",\"form\",1,\"d-flex-column\",\"unscrollable\"],[\"form\",\"ngForm\"],[1,\"panel__header\",\"panel__header--blue\"],[\"class\",\"d-flex\",4,\"ngIf\"],[1,\"scrollable\"],[1,\"panel__subtitle\"],[\"class\",\"panel__content\",4,\"ngIf\"],[3,\"ship\",\"editable\",\"deleteItem\",4,\"ngFor\",\"ngForOf\"],[1,\"fleet-panel__name-input\"],[\"matInput\",\"\",\"name\",\"name\",\"placeholder\",\"Nom de la flotte\",\"required\",\"\",\"maxlength\",\"64\",3,\"ngModel\",\"ngModelChange\"],[\"name\",\"ngModel\"],[\"class\",\"input-error\",4,\"ngIf\"],[\"mat-button\",\"\",\"color\",\"primary\",\"title\",\"Enregistrer les changements\",\"data-test\",\"save-fleet\",3,\"app-async-action\",\"disabled\"],[\"mat-button\",\"\",\"title\",\"Annuler l'\\xe9dition\",3,\"routerLink\"],[1,\"input-error\"],[1,\"panel__title\",\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Modifier\",3,\"routerLink\"],[\"mat-button\",\"\",\"title\",\"Autres actions\",3,\"matMenuTriggerFor\"],[\"menu\",\"matMenu\"],[\"mat-menu-item\",\"\",\"title\",\"Exporter la flotte au format JSON\",3,\"click\"],[\"mat-menu-item\",\"\",\"title\",\"Supprimer la flotte\",3,\"click\"],[\"color\",\"warn\"],[1,\"d-flex\"],[\"mat-button\",\"\",\"title\",\"Centrer sur la flotte\",1,\"d-block\",3,\"click\"],[\"mat-button\",\"\",1,\"d-block\",3,\"title\",\"app-async-action\"],[\"mat-button\",\"\",1,\"d-block\",3,\"title\",\"click\"],[1,\"panel__content\"],[3,\"ship\",\"editable\",\"deleteItem\"],[\"mat-button\",\"\",\"title\",\"Ouvrir la fen\\xeatre d'import en masse\",1,\"d-block\",3,\"click\"],[1,\"mr-1\"],[2,\"width\",\"95%\",3,\"existingItems\",\"selectItem\"],[3,\"alerts$\",\"alertTitleRef\",\"alertMenuItemsRef\"],[\"alertTitleRef\",\"\"],[\"alertMenuItemsRef\",\"\"],[1,\"fleet-panel__alert-item\"],[1,\"d-flex-center\"],[1,\"rule-name-icon\"],[\"mat-menu-item\",\"\",3,\"routerLink\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"div\",1),Pa(2,\"a\",2),Pa(3,\"mat-icon\"),bl(4,\"arrow_back_ios\"),Da(),bl(5,\" Flottes \"),Da(),Da(),na(6,A3,1,0,\"mat-spinner\",3),na(7,O3,15,7,\"ng-template\",4),Da(),Ra(8,\"router-outlet\")),2&t&&(Ss(6),Ia(\"ngIf\",!e.fleet),Ss(1),Ia(\"ngIf\",e.fleet))},directives:[_b,JR,Yk,Bd,iF,KY,Lw,Hq,Fd,tS,hS,Mb,hx,fx,aw,Vw,vb,cW,QR,Nx,jX,LX,PX,g3,cJ,t0],styles:[\"[_nghost-%COMP%]{display:flex;height:100%}.back-button[_ngcontent-%COMP%]{line-height:36px}.fleet-panel[_ngcontent-%COMP%]{min-width:270px}.fleet-panel__name-input[_ngcontent-%COMP%]{margin:.5em;flex:1;font-size:20px}.rule-name-icon[_ngcontent-%COMP%]{font-size:20px;height:20px;width:20px;margin-right:.3em}  router-outlet+app-ship-details-panel{border-left:1px solid rgba(0,0,0,.12)}\"]}),t})();function D3(t,e){if(1&t){const t=Na();Pa(0,\"div\",4),Pa(1,\"mat-form-field\",13),Pa(2,\"mat-label\"),bl(3,\"Nom\"),Da(),Pa(4,\"input\",14),$a(\"ngModelChange\",function(e){return Fe(t),Wa().$implicit.newName=e}),Da(),Da(),Da(),Pa(5,\"div\",5),Pa(6,\"button\",15),$a(\"click\",function(){Fe(t);const e=Wa().$implicit;return Wa().applyRenaming(e)}),Pa(7,\"mat-icon\"),bl(8,\"done\"),Da(),bl(9,\" Valider \"),Da(),Pa(10,\"button\",16),$a(\"click\",function(){Fe(t);const e=Wa().$implicit;return Wa().cancelRenaming(e)}),Pa(11,\"mat-icon\"),bl(12,\"clear\"),Da(),bl(13,\" Annuler \"),Da(),Da()}if(2&t){const t=Wa(),e=t.$implicit,i=t.index,n=Wa();Ss(4),Ia(\"ngModel\",e.newName),Ss(2),Ia(\"disabled\",n.isFleetNameTaken(e.newName,i))}}function R3(t,e){if(1&t&&(Pa(0,\"mat-icon\"),bl(1,\"arrow_right_alt\"),Da(),bl(2)),2&t){const t=Wa(2).$implicit;Ss(2),xl(\" \",t.newName,\" \")}}function F3(t,e){if(1&t){const t=Na();Pa(0,\"div\",4),bl(1),na(2,R3,3,1,\"ng-template\",12),Da(),Pa(3,\"div\",5),Pa(4,\"button\",17),$a(\"click\",function(){Fe(t);const e=Wa().$implicit,i=Wa();return i.toggleResolution(e,i.ConflictResolution.Update)}),Pa(5,\"mat-icon\"),bl(6,\"update\"),Da(),bl(7,\" Mettre \\xe0 jour \"),Da(),Pa(8,\"button\",18),$a(\"click\",function(){Fe(t);const e=Wa().$implicit;return Wa().openRenamingForm(e)}),Pa(9,\"mat-icon\"),bl(10,\"edit\"),Da(),bl(11,\" Renommer \"),Da(),Da()}if(2&t){const t=Wa().$implicit,e=Wa();Ss(1),xl(\" \",t.fleet.name,\" \"),Ss(1),Ia(\"ngIf\",t.newName),Ss(2),ll(\"pressed-button\",t.resolution===e.ConflictResolution.Update),Ss(4),ll(\"pressed-button\",t.resolution===e.ConflictResolution.Rename)}}function L3(t,e){if(1&t&&(Pa(0,\"div\",11),na(1,D3,14,2,\"ng-template\",12),na(2,F3,12,6,\"ng-template\",12),Da()),2&t){const t=e.$implicit;Ss(1),Ia(\"ngIf\",t.renaming),Ss(1),Ia(\"ngIf\",!t.renaming)}}var B3=(()=>(function(t){t.Rename=\"rename\",t.Update=\"update\"}(B3||(B3={})),B3))();let N3=(()=>{class t{constructor(t){this.data=t,this.ConflictResolution=B3,this.displayedColumns=[\"name\",\"action\"]}ngOnInit(){this.conflicts=this.data.fleets.map(t=>({fleet:t,resolution:null,renaming:!1,newName:\"\"})),this.fleetNames=this.data.fleetNames}toggleResolution(t,e){t.resolution=e,t.resolution===B3.Update&&(t.newName=\"\")}isFormValid(){return this.conflicts.every(t=>null!==t.resolution)}openRenamingForm(t){t.resolution=null,t.renaming=!0,t.newName=t.fleet.name}cancelRenaming(t){t.renaming=!1,t.newName=\"\"}applyRenaming(t){t.renaming=!1,t.resolution=B3.Rename}isFleetNameTaken(t,e){return this.fleetNames.includes(t)||this.conflicts.filter((t,i)=>i!==e).some(e=>e.newName===t)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(RC))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-import-fleet-dialog\"]],decls:18,vars:4,consts:[[\"mat-dialog-title\",\"\"],[\"mat-dialog-content\",\"\",2,\"min-width\",\"600px\"],[1,\"d-flex-column-center\"],[1,\"d-flex\",\"mb-2\"],[1,\"column-name\"],[1,\"column-resolution\"],[\"class\",\"d-flex-center mt-2\",4,\"ngFor\",\"ngForOf\"],[\"mat-dialog-actions\",\"\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"color\",\"primary\",3,\"disabled\",\"mat-dialog-close\"],[\"mat-button\",\"\",3,\"mat-dialog-close\"],[1,\"d-flex-center\",\"mt-2\"],[3,\"ngIf\"],[1,\"mr-3\"],[\"matInput\",\"\",\"placeholder\",\"Ma flotte\",\"required\",\"\",3,\"ngModel\",\"ngModelChange\"],[\"mat-raised-button\",\"\",\"color\",\"primary\",1,\"mx-2\",3,\"disabled\",\"click\"],[\"mat-button\",\"\",1,\"mx-2\",3,\"click\"],[\"mat-stroked-button\",\"\",\"title\",\"Mettre \\xe0 jour\",1,\"mx-2\",3,\"click\"],[\"mat-stroked-button\",\"\",\"title\",\"Renommer\",1,\"mx-2\",3,\"click\"]],template:function(t,e){1&t&&(Pa(0,\"h1\",0),bl(1,\"Mise \\xe0 jour des flottes\"),Da(),Pa(2,\"div\",1),Pa(3,\"p\"),bl(4,\"Certaines flottes que vous voulez importer existent d\\xe9j\\xe0. Vous devez choisir entre mettre \\xe0 jour les flottes existantes et les remplacer, ou bien renommer les nouvelles flottes.\"),Da(),Pa(5,\"div\",2),Pa(6,\"div\",3),Pa(7,\"div\",4),bl(8,\" Nom de flotte \"),Da(),Pa(9,\"div\",5),bl(10,\" Action \"),Da(),Da(),na(11,L3,3,2,\"div\",6),Da(),Da(),Pa(12,\"div\",7),Ra(13,\"div\",8),Pa(14,\"button\",9),bl(15,\" Importer \"),Da(),Pa(16,\"button\",10),bl(17,\" Annuler \"),Da(),Da()),2&t&&(Ss(11),Ia(\"ngForOf\",e.conflicts),Ss(3),Ia(\"disabled\",!e.isFormValid())(\"mat-dialog-close\",e.conflicts),Ss(2),Ia(\"mat-dialog-close\",null))},directives:[$C,UC,Fd,HC,vb,jC,Bd,tS,Hx,hS,Mb,hx,aw,Vw,Yk],styles:[\".pressed-button[_ngcontent-%COMP%]{background-color:#94cba5}.column-name[_ngcontent-%COMP%]{min-width:200px;display:inline-flex;align-items:center}.column-resolution[_ngcontent-%COMP%]{min-width:300px;text-align:center}\"]}),t})();const z3=[\"importFileInput\"];function V3(t,e){if(1&t){const t=Na();Pa(0,\"button\",9),$a(\"click\",function(){return Fe(t),Wa().triggerImportFleetDialog()}),bl(1,\"Importer\"),Da()}}function j3(t,e){1&t&&Ra(0,\"mat-spinner\",10)}function $3(t,e){1&t&&(Pa(0,\"p\",12),bl(1,\"Aucune flotte n'a \\xe9t\\xe9 configur\\xe9e.\"),Da())}function U3(t,e){if(1&t&&(Pa(0,\"button\",15),bl(1),Pa(2,\"em\"),bl(3),Da(),Da()),2&t){const t=e.$implicit;Qa(\"routerLink\",\"/fleets/\",t.id,\"\"),Ss(1),xl(\" \",t.name,\" \"),Ss(2),Sl(\"(\",t.ships.length,\" navire\",t.ships.length>1?\"s\":\"\",\")\")}}function H3(t,e){if(1&t&&(Pa(0,\"div\",13),na(1,U3,4,4,\"button\",14),Da()),2&t){const t=Wa(2);Ss(1),Ia(\"ngForOf\",t.fleets)}}function G3(t,e){if(1&t&&(na(0,$3,2,0,\"p\",11),na(1,H3,2,1,\"ng-template\",8)),2&t){const t=Wa();Ia(\"ngIf\",0===t.fleets.length),Ss(1),Ia(\"ngIf\",t.fleets.length>0)}}let q3=(()=>{class t extends Lq{constructor(t,e,i,n,r,s){super(),this.titleService=t,this.dialog=e,this.fleetsService=i,this.mapService=n,this.offlineService=r,this.uiService=s}ngOnInit(){return Vp(this,void 0,void 0,function*(){this.titleService.setTitle(\"Liste des flottes - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.fleets=this.offlineService.isOffline$.value?this.fleetsService.fleets$.value:yield this.fleetsService.refreshFleets()})}triggerImportFleetDialog(){this.importFileInput.nativeElement.click()}onFilesChange(t){return Vp(this,void 0,void 0,function*(){const e=t.target.files||t.dataTransfer.files;!e.length||(yield Promise.all(Array.from(e).map(t=>Vp(this,void 0,void 0,function*(){try{const e=JSON.parse(yield hq(t));if(\"string\"==typeof e.name&&e.ships instanceof Array&&e.ships.every(t=>\"string\"==typeof t))return e;throw new Error(\"Structure JSON incorrecte\")}catch(e){throw new Error(`Import du fichier \\`${t.name}\\` \\xe9chou\\xe9: ${e.message}`)}}))).then(t=>Vp(this,void 0,void 0,function*(){const e=this.fleets.map(t=>t.name),i=t.filter(t=>e.includes(t.name)),n=t.filter(t=>!i.includes(t)),r=[];if(i.length>0){const t=yield this.openImportFleetDialog(i,e);if(null==t)return!0;t.forEach(t=>{t.resolution===B3.Update?(t.fleet.id=this.fleets.find(e=>e.name===t.fleet.name).id,r.push(t.fleet)):t.resolution===B3.Rename&&(t.fleet.name=t.newName,n.push(t.fleet))})}yield Promise.all([...n.map(t=>Vp(this,void 0,void 0,function*(){yield this.fleetsService.createFleet(t)})),...r.map(t=>Vp(this,void 0,void 0,function*(){yield this.fleetsService.updateFleet(t)}))])})))||(this.fleets=yield this.fleetsService.refreshFleets(),this.uiService.success(\"Les flottes ont \\xe9t\\xe9 import\\xe9es\"),t.target.value=\"\")})}openImportFleetDialog(t,e){return Vp(this,void 0,void 0,function*(){return new Promise(i=>{this.dialogRef=this.dialog.open(N3,{data:{fleets:t,fleetNames:e},autoFocus:!1,closeOnNavigation:!0}),this.dialogRef.afterClosed().subscribe(t=>{i(t)})})})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(zp),Ta(zC),Ta(Tq),Ta(T$),Ta(fq),Ta(AU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-fleets-panel\"]],viewQuery:function(t,e){if(1&t&&kh(z3,7),2&t){let t;Ch(t=Mh())&&(e.importFileInput=t.first)}},features:[Vo],decls:11,vars:3,consts:[[\"joyrideStep\",\"fleets-panel\",\"title\",\"Flottes de navires\",\"text\",\"C'est ici que vous pouvez cr\\xe9er et suivre vos flottes de navires.\",1,\"panel\"],[1,\"panel__header\",\"panel__header--blue\"],[1,\"panel__title\",\"u-flex\"],[\"mat-button\",\"\",\"color\",\"primary\",\"title\",\"Cr\\xe9er une flotte\",\"joyrideStep\",\"create-fleet-button\",\"text\",\"Ce bouton permet de cr\\xe9er une flotte de navires.\",\"routerLink\",\"/fleets/new\"],[\"type\",\"file\",\"accept\",\"application/json\",\"multiple\",\"\",\"hidden\",\"\",3,\"change\"],[\"importFileInput\",\"\"],[\"mat-button\",\"\",\"title\",\"Importer une flotte (JSON)\",\"joyrideStep\",\"import-fleet-button\",\"text\",\"Ce bouton permet d'importer un fichier export\\xe9 depuis une flotte ANAIS existante (JSON dans les t\\xe9l\\xe9chargements). L'export sert \\xe0 partager des flottes entre plusieurs comptes par simple transfert et import du fichier. Ce fichier peut aussi \\xeatre exploit\\xe9 en dehors d'ANAIS.\",3,\"click\",4,\"ngIf\"],[\"class\",\"spinner\",\"strokeWidth\",\"4\",\"diameter\",\"80\",4,\"ngIf\"],[3,\"ngIf\"],[\"mat-button\",\"\",\"title\",\"Importer une flotte (JSON)\",\"joyrideStep\",\"import-fleet-button\",\"text\",\"Ce bouton permet d'importer un fichier export\\xe9 depuis une flotte ANAIS existante (JSON dans les t\\xe9l\\xe9chargements). L'export sert \\xe0 partager des flottes entre plusieurs comptes par simple transfert et import du fichier. Ce fichier peut aussi \\xeatre exploit\\xe9 en dehors d'ANAIS.\",3,\"click\"],[\"strokeWidth\",\"4\",\"diameter\",\"80\",1,\"spinner\"],[\"class\",\"panel__content\",4,\"ngIf\"],[1,\"panel__content\"],[1,\"d-flex-column\",\"scrollable\"],[\"mat-button\",\"\",3,\"routerLink\",4,\"ngFor\",\"ngForOf\"],[\"mat-button\",\"\",3,\"routerLink\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"div\",1),Pa(2,\"h2\",2),bl(3,\"Flottes\"),Da(),Da(),Pa(4,\"button\",3),bl(5,\"Nouvelle flotte\"),Da(),Pa(6,\"input\",4,5),$a(\"change\",function(t){return e.onFilesChange(t)}),Da(),na(8,V3,2,0,\"button\",6),na(9,j3,1,0,\"mat-spinner\",7),na(10,G3,2,2,\"ng-template\",8),Da()),2&t&&(Ss(8),Ia(\"ngIf\",!e.offlineService.isOffline$.value),Ss(1),Ia(\"ngIf\",!e.fleets),Ss(1),Ia(\"ngIf\",e.fleets))},directives:[tL,vb,QR,Bd,KY,Fd],styles:[\"\"]}),t})(),W3=(()=>{class t extends Lq{constructor(t,e,i,n,r){super(),this.titleService=t,this.historyService=e,this.mapService=i,this.offlineService=n,this.selectionService=r}ngOnInit(){this.titleService.setTitle(\"Mode hors-ligne - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.historyService.resetTimestamp(),this.selectionService.clear(),setTimeout(()=>{this.offlineService.enterSetupMode()})}ngOnDestroy(){this.offlineService.exitSetupMode()}}return t.\\u0275fac=function(e){return new(e||t)(Ta(zp),Ta(R$),Ta(T$),Ta(fq),Ta(bq))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-offline-loader\"]],features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})(),Y3=(()=>{class t extends Lq{constructor(t,e,i,n,r){super(),this.titleService=t,this.historyService=e,this.mapService=i,this.playbackService=n,this.selectionService=r}ngOnInit(){this.titleService.setTitle(\"Rejeu de situation - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.historyService.resetTimestamp(),this.selectionService.clear(),setTimeout(()=>{this.playbackService.enterPlaybackMode()})}ngOnDestroy(){this.playbackService.exitPlaybackMode()}}return t.\\u0275fac=function(e){return new(e||t)(Ta(zp),Ta(R$),Ta(T$),Ta(YG),Ta(bq))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-playback-loader\"]],features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})(),Z3=(()=>{class t{constructor(t,e,i){this.mapConfigService=t,this.mapService=e,this.uiService=i,this.isSelectingArea$=new Zp(!1),this.isSelectingArea$.pipe(wf(1)).subscribe(t=>{this.uiService.setDrawingMode(t)})}startSelectingArea(){this.isSelectingArea$.next(!0)}cancelSelectingArea(){this.isSelectingArea$.next(!1)}finishSelectingArea(){this.mapConfigService.updateRestrictedAreas(l$.fromOLExtent(this.mapService.view$.value.extent).toLatLonExtent()),this.cancelSelectingArea()}removeArea(){this.mapConfigService.updateRestrictedAreas(null)}}return t.\\u0275fac=function(e){return new(e||t)(En(k$),En(T$),En(AU))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const X3=[\"sliderWrapper\"],K3=Zf({passive:!1}),Q3={provide:Cb,useExisting:ot(()=>e5),multi:!0};class J3{}const t5=xy(by(yy(class{constructor(t){this._elementRef=t}}),\"accent\"));let e5=(()=>{class t extends t5{constructor(t,e,i,n,r,s,o,a){super(t),this._focusMonitor=e,this._changeDetectorRef=i,this._dir=n,this._ngZone=s,this._animationMode=a,this._invert=!1,this._max=100,this._min=0,this._step=1,this._thumbLabel=!1,this._tickInterval=0,this._value=null,this._vertical=!1,this.change=new ph,this.input=new ph,this.valueChange=new ph,this.onTouched=()=>{},this._percent=0,this._isSliding=null,this._isActive=!1,this._tickIntervalPercent=0,this._sliderDimensions=null,this._controlValueAccessorChangeFn=()=>{},this._dirChangeSubscription=u.EMPTY,this._pointerDown=t=>{this.disabled||this._isSliding||!i5(t)&&0!==t.button||this._ngZone.run(()=>{this._touchId=i5(t)?function(t,e){for(let i=0;i<t.touches.length;i++){const n=t.touches[i].target;if(e===n||e.contains(n))return t.touches[i].identifier}}(t,this._elementRef.nativeElement):void 0;const e=n5(t,this._touchId);if(e){const i=this.value;this._isSliding=\"pointer\",this._lastPointerEvent=t,t.preventDefault(),this._focusHostElement(),this._onMouseenter(),this._bindGlobalEvents(t),this._focusHostElement(),this._updateValueFromPosition(e),this._valueOnSlideStart=i,i!=this.value&&this._emitInputEvent()}})},this._pointerMove=t=>{if(\"pointer\"===this._isSliding){const e=n5(t,this._touchId);if(e){t.preventDefault();const i=this.value;this._lastPointerEvent=t,this._updateValueFromPosition(e),i!=this.value&&this._emitInputEvent()}}},this._pointerUp=t=>{\"pointer\"===this._isSliding&&(!i5(t)||\"number\"!=typeof this._touchId||r5(t.changedTouches,this._touchId))&&(t.preventDefault(),this._removeGlobalEvents(),this._isSliding=null,this._touchId=void 0,this._valueOnSlideStart!=this.value&&!this.disabled&&this._emitChangeEvent(),this._valueOnSlideStart=this._lastPointerEvent=null)},this._windowBlur=()=>{this._lastPointerEvent&&this._pointerUp(this._lastPointerEvent)},this._document=o,this.tabIndex=parseInt(r)||0,s.runOutsideAngular(()=>{const e=t.nativeElement;e.addEventListener(\"mousedown\",this._pointerDown,K3),e.addEventListener(\"touchstart\",this._pointerDown,K3)})}get invert(){return this._invert}set invert(t){this._invert=Of(t)}get max(){return this._max}set max(t){this._max=Pf(t,this._max),this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}get min(){return this._min}set min(t){this._min=Pf(t,this._min),this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}get step(){return this._step}set step(t){this._step=Pf(t,this._step),this._step%1!=0&&(this._roundToDecimal=this._step.toString().split(\".\").pop().length),this._changeDetectorRef.markForCheck()}get thumbLabel(){return this._thumbLabel}set thumbLabel(t){this._thumbLabel=Of(t)}get tickInterval(){return this._tickInterval}set tickInterval(t){this._tickInterval=\"auto\"===t?\"auto\":\"number\"==typeof t||\"string\"==typeof t?Pf(t,this._tickInterval):0}get value(){return null===this._value&&(this.value=this._min),this._value}set value(t){if(t!==this._value){let e=Pf(t,0);this._roundToDecimal&&e!==this.min&&e!==this.max&&(e=parseFloat(e.toFixed(this._roundToDecimal))),this._value=e,this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}}get vertical(){return this._vertical}set vertical(t){this._vertical=Of(t)}get displayValue(){return this.displayWith?this.displayWith(this.value):this._roundToDecimal&&this.value&&this.value%1!=0?this.value.toFixed(this._roundToDecimal):this.value||0}focus(t){this._focusHostElement(t)}blur(){this._blurHostElement()}get percent(){return this._clamp(this._percent)}_shouldInvertAxis(){return this.vertical?!this.invert:this.invert}_isMinValue(){return 0===this.percent}_getThumbGap(){return this.disabled?7:this._isMinValue()&&!this.thumbLabel?this._isActive?10:7:0}_getTrackBackgroundStyles(){const t=this.vertical?`1, ${1-this.percent}, 1`:1-this.percent+\", 1, 1\";return{transform:`translate${this.vertical?\"Y\":\"X\"}(${this._shouldInvertMouseCoords()?\"-\":\"\"}${this._getThumbGap()}px) scale3d(${t})`}}_getTrackFillStyles(){const t=this.percent,e=this.vertical?`1, ${t}, 1`:`${t}, 1, 1`;return{transform:`translate${this.vertical?\"Y\":\"X\"}(${this._shouldInvertMouseCoords()?\"\":\"-\"}${this._getThumbGap()}px) scale3d(${e})`,display:0===t?\"none\":\"\"}}_getTicksContainerStyles(){return{transform:`translate${this.vertical?\"Y\":\"X\"}(${this.vertical||\"rtl\"!=this._getDirection()?\"-\":\"\"}${this._tickIntervalPercent/2*100}%)`}}_getTicksStyles(){let t=100*this._tickIntervalPercent,e={backgroundSize:this.vertical?`2px ${t}%`:`${t}% 2px`,transform:`translateZ(0) translate${this.vertical?\"Y\":\"X\"}(${this.vertical||\"rtl\"!=this._getDirection()?\"\":\"-\"}${t/2}%)${this.vertical||\"rtl\"!=this._getDirection()?\"\":\" rotate(180deg)\"}`};if(this._isMinValue()&&this._getThumbGap()){const t=this._shouldInvertAxis();let i;i=this.vertical?t?\"Bottom\":\"Top\":t?\"Right\":\"Left\",e[`padding${i}`]=`${this._getThumbGap()}px`}return e}_getThumbContainerStyles(){const t=this._shouldInvertAxis();return{transform:`translate${this.vertical?\"Y\":\"X\"}(-${100*((\"rtl\"!=this._getDirection()||this.vertical?t:!t)?this.percent:1-this.percent)}%)`}}_shouldInvertMouseCoords(){const t=this._shouldInvertAxis();return\"rtl\"!=this._getDirection()||this.vertical?t:!t}_getDirection(){return this._dir&&\"rtl\"==this._dir.value?\"rtl\":\"ltr\"}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{this._isActive=!!t&&\"keyboard\"!==t,this._changeDetectorRef.detectChanges()}),this._dir&&(this._dirChangeSubscription=this._dir.change.subscribe(()=>{this._changeDetectorRef.markForCheck()}))}ngOnDestroy(){const t=this._elementRef.nativeElement;t.removeEventListener(\"mousedown\",this._pointerDown,K3),t.removeEventListener(\"touchstart\",this._pointerDown,K3),this._lastPointerEvent=null,this._removeGlobalEvents(),this._focusMonitor.stopMonitoring(this._elementRef),this._dirChangeSubscription.unsubscribe()}_onMouseenter(){this.disabled||(this._sliderDimensions=this._getSliderDimensions(),this._updateTickIntervalPercent())}_onFocus(){this._sliderDimensions=this._getSliderDimensions(),this._updateTickIntervalPercent()}_onBlur(){this.onTouched()}_onKeydown(t){if(this.disabled||Kp(t)||this._isSliding&&\"keyboard\"!==this._isSliding)return;const e=this.value;switch(t.keyCode){case 33:this._increment(10);break;case 34:this._increment(-10);break;case 35:this.value=this.max;break;case 36:this.value=this.min;break;case 37:this._increment(\"rtl\"==this._getDirection()?1:-1);break;case 38:this._increment(1);break;case 39:this._increment(\"rtl\"==this._getDirection()?-1:1);break;case 40:this._increment(-1);break;default:return}e!=this.value&&(this._emitInputEvent(),this._emitChangeEvent()),this._isSliding=\"keyboard\",t.preventDefault()}_onKeyup(){\"keyboard\"===this._isSliding&&(this._isSliding=null)}_getWindow(){return this._document.defaultView||window}_bindGlobalEvents(t){const e=this._document,i=i5(t),n=i?\"touchend\":\"mouseup\";e.addEventListener(i?\"touchmove\":\"mousemove\",this._pointerMove,K3),e.addEventListener(n,this._pointerUp,K3),i&&e.addEventListener(\"touchcancel\",this._pointerUp,K3);const r=this._getWindow();void 0!==r&&r&&r.addEventListener(\"blur\",this._windowBlur)}_removeGlobalEvents(){const t=this._document;t.removeEventListener(\"mousemove\",this._pointerMove,K3),t.removeEventListener(\"mouseup\",this._pointerUp,K3),t.removeEventListener(\"touchmove\",this._pointerMove,K3),t.removeEventListener(\"touchend\",this._pointerUp,K3),t.removeEventListener(\"touchcancel\",this._pointerUp,K3);const e=this._getWindow();void 0!==e&&e&&e.removeEventListener(\"blur\",this._windowBlur)}_increment(t){this.value=this._clamp((this.value||0)+this.step*t,this.min,this.max)}_updateValueFromPosition(t){if(!this._sliderDimensions)return;let e=this._clamp(((this.vertical?t.y:t.x)-(this.vertical?this._sliderDimensions.top:this._sliderDimensions.left))/(this.vertical?this._sliderDimensions.height:this._sliderDimensions.width));if(this._shouldInvertMouseCoords()&&(e=1-e),0===e)this.value=this.min;else if(1===e)this.value=this.max;else{const t=this._calculateValue(e),i=Math.round((t-this.min)/this.step)*this.step+this.min;this.value=this._clamp(i,this.min,this.max)}}_emitChangeEvent(){this._controlValueAccessorChangeFn(this.value),this.valueChange.emit(this.value),this.change.emit(this._createChangeEvent())}_emitInputEvent(){this.input.emit(this._createChangeEvent())}_updateTickIntervalPercent(){if(this.tickInterval&&this._sliderDimensions)if(\"auto\"==this.tickInterval){let t=this.vertical?this._sliderDimensions.height:this._sliderDimensions.width,e=Math.ceil(30/(t*this.step/(this.max-this.min)))*this.step;this._tickIntervalPercent=e/t}else this._tickIntervalPercent=this.tickInterval*this.step/(this.max-this.min)}_createChangeEvent(t=this.value){let e=new J3;return e.source=this,e.value=t,e}_calculatePercentage(t){return((t||0)-this.min)/(this.max-this.min)}_calculateValue(t){return this.min+t*(this.max-this.min)}_clamp(t,e=0,i=1){return Math.max(e,Math.min(t,i))}_getSliderDimensions(){return this._sliderWrapper?this._sliderWrapper.nativeElement.getBoundingClientRect():null}_focusHostElement(t){this._elementRef.nativeElement.focus(t)}_blurHostElement(){this._elementRef.nativeElement.blur()}writeValue(t){this.value=t}registerOnChange(t){this._controlValueAccessorChangeFn=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(Bm),Ta(Cc),Ta(xg,8),Wi(\"tabindex\"),Ta(tu),Ta(Du),Ta(sy,8))},t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-slider\"]],viewQuery:function(t,e){if(1&t&&kh(X3,5),2&t){let t;Ch(t=Mh())&&(e._sliderWrapper=t.first)}},hostAttrs:[\"role\",\"slider\",1,\"mat-slider\",\"mat-focus-indicator\"],hostVars:29,hostBindings:function(t,e){1&t&&$a(\"focus\",function(){return e._onFocus()})(\"blur\",function(){return e._onBlur()})(\"keydown\",function(t){return e._onKeydown(t)})(\"keyup\",function(){return e._onKeyup()})(\"mouseenter\",function(){return e._onMouseenter()})(\"selectstart\",function(t){return t.preventDefault()}),2&t&&(El(\"tabIndex\",e.tabIndex),ta(\"aria-disabled\",e.disabled)(\"aria-valuemax\",e.max)(\"aria-valuemin\",e.min)(\"aria-valuenow\",e.value)(\"aria-valuetext\",null==e.valueText?e.displayValue:e.valueText)(\"aria-orientation\",e.vertical?\"vertical\":\"horizontal\"),ll(\"mat-slider-disabled\",e.disabled)(\"mat-slider-has-ticks\",e.tickInterval)(\"mat-slider-horizontal\",!e.vertical)(\"mat-slider-axis-inverted\",e._shouldInvertAxis())(\"mat-slider-invert-mouse-coords\",e._shouldInvertMouseCoords())(\"mat-slider-sliding\",e._isSliding)(\"mat-slider-thumb-label-showing\",e.thumbLabel)(\"mat-slider-vertical\",e.vertical)(\"mat-slider-min-value\",e._isMinValue())(\"mat-slider-hide-last-tick\",e.disabled||e._isMinValue()&&e._getThumbGap()&&e._shouldInvertAxis())(\"_mat-animation-noopable\",\"NoopAnimations\"===e._animationMode))},inputs:{disabled:\"disabled\",color:\"color\",tabIndex:\"tabIndex\",invert:\"invert\",max:\"max\",min:\"min\",step:\"step\",thumbLabel:\"thumbLabel\",tickInterval:\"tickInterval\",value:\"value\",vertical:\"vertical\",displayWith:\"displayWith\",valueText:\"valueText\"},outputs:{change:\"change\",input:\"input\",valueChange:\"valueChange\"},exportAs:[\"matSlider\"],features:[Gl([Q3]),Vo],decls:13,vars:6,consts:[[1,\"mat-slider-wrapper\"],[\"sliderWrapper\",\"\"],[1,\"mat-slider-track-wrapper\"],[1,\"mat-slider-track-background\",3,\"ngStyle\"],[1,\"mat-slider-track-fill\",3,\"ngStyle\"],[1,\"mat-slider-ticks-container\",3,\"ngStyle\"],[1,\"mat-slider-ticks\",3,\"ngStyle\"],[1,\"mat-slider-thumb-container\",3,\"ngStyle\"],[1,\"mat-slider-focus-ring\"],[1,\"mat-slider-thumb\"],[1,\"mat-slider-thumb-label\"],[1,\"mat-slider-thumb-label-text\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0,1),Pa(2,\"div\",2),Ra(3,\"div\",3),Ra(4,\"div\",4),Da(),Pa(5,\"div\",5),Ra(6,\"div\",6),Da(),Pa(7,\"div\",7),Ra(8,\"div\",8),Ra(9,\"div\",9),Pa(10,\"div\",10),Pa(11,\"span\",11),bl(12),Da(),Da(),Da(),Da()),2&t&&(Ss(3),Ia(\"ngStyle\",e._getTrackBackgroundStyles()),Ss(1),Ia(\"ngStyle\",e._getTrackFillStyles()),Ss(1),Ia(\"ngStyle\",e._getTicksContainerStyles()),Ss(1),Ia(\"ngStyle\",e._getTicksStyles()),Ss(1),Ia(\"ngStyle\",e._getThumbContainerStyles()),Ss(5),wl(e.displayValue))},directives:[Hd],styles:['.mat-slider{display:inline-block;position:relative;box-sizing:border-box;padding:8px;outline:none;vertical-align:middle}.mat-slider:not(.mat-slider-disabled):active,.mat-slider.mat-slider-sliding:not(.mat-slider-disabled){cursor:-webkit-grabbing;cursor:grabbing}.mat-slider-wrapper{-webkit-print-color-adjust:exact;color-adjust:exact;position:absolute}.mat-slider-track-wrapper{position:absolute;top:0;left:0;overflow:hidden}.mat-slider-track-fill{position:absolute;transform-origin:0 0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-track-background{position:absolute;transform-origin:100% 100%;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-ticks-container{position:absolute;left:0;top:0;overflow:hidden}.mat-slider-ticks{-webkit-background-clip:content-box;background-clip:content-box;background-repeat:repeat;box-sizing:border-box;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-thumb-container{position:absolute;z-index:1;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-focus-ring{position:absolute;width:30px;height:30px;border-radius:50%;transform:scale(0);opacity:0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider.cdk-keyboard-focused .mat-slider-focus-ring,.mat-slider.cdk-program-focused .mat-slider-focus-ring{transform:scale(1);opacity:1}.mat-slider:not(.mat-slider-disabled):not(.mat-slider-sliding) .mat-slider-thumb-label,.mat-slider:not(.mat-slider-disabled):not(.mat-slider-sliding) .mat-slider-thumb{cursor:-webkit-grab;cursor:grab}.mat-slider-thumb{position:absolute;right:-10px;bottom:-10px;box-sizing:border-box;width:20px;height:20px;border:3px solid transparent;border-radius:50%;transform:scale(0.7);transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),border-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-thumb-label{display:none;align-items:center;justify-content:center;position:absolute;width:28px;height:28px;border-radius:50%;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),border-radius 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.cdk-high-contrast-active .mat-slider-thumb-label{outline:solid 1px}.mat-slider-thumb-label-text{z-index:1;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-sliding .mat-slider-track-fill,.mat-slider-sliding .mat-slider-track-background,.mat-slider-sliding .mat-slider-thumb-container{transition-duration:0ms}.mat-slider-has-ticks .mat-slider-wrapper::after{content:\"\";position:absolute;border-width:0;border-style:solid;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-has-ticks.cdk-focused:not(.mat-slider-hide-last-tick) .mat-slider-wrapper::after,.mat-slider-has-ticks:hover:not(.mat-slider-hide-last-tick) .mat-slider-wrapper::after{opacity:1}.mat-slider-has-ticks.cdk-focused:not(.mat-slider-disabled) .mat-slider-ticks,.mat-slider-has-ticks:hover:not(.mat-slider-disabled) .mat-slider-ticks{opacity:1}.mat-slider-thumb-label-showing .mat-slider-focus-ring{display:none}.mat-slider-thumb-label-showing .mat-slider-thumb-label{display:flex}.mat-slider-axis-inverted .mat-slider-track-fill{transform-origin:100% 100%}.mat-slider-axis-inverted .mat-slider-track-background{transform-origin:0 0}.mat-slider:not(.mat-slider-disabled).cdk-focused.mat-slider-thumb-label-showing .mat-slider-thumb{transform:scale(0)}.mat-slider:not(.mat-slider-disabled).cdk-focused .mat-slider-thumb-label{border-radius:50% 50% 0}.mat-slider:not(.mat-slider-disabled).cdk-focused .mat-slider-thumb-label-text{opacity:1}.mat-slider:not(.mat-slider-disabled).cdk-mouse-focused .mat-slider-thumb,.mat-slider:not(.mat-slider-disabled).cdk-touch-focused .mat-slider-thumb,.mat-slider:not(.mat-slider-disabled).cdk-program-focused .mat-slider-thumb{border-width:2px;transform:scale(1)}.mat-slider-disabled .mat-slider-focus-ring{transform:scale(0);opacity:0}.mat-slider-disabled .mat-slider-thumb{border-width:4px;transform:scale(0.5)}.mat-slider-disabled .mat-slider-thumb-label{display:none}.mat-slider-horizontal{height:48px;min-width:128px}.mat-slider-horizontal .mat-slider-wrapper{height:2px;top:23px;left:8px;right:8px}.mat-slider-horizontal .mat-slider-wrapper::after{height:2px;border-left-width:2px;right:0;top:0}.mat-slider-horizontal .mat-slider-track-wrapper{height:2px;width:100%}.mat-slider-horizontal .mat-slider-track-fill{height:2px;width:100%;transform:scaleX(0)}.mat-slider-horizontal .mat-slider-track-background{height:2px;width:100%;transform:scaleX(1)}.mat-slider-horizontal .mat-slider-ticks-container{height:2px;width:100%}.cdk-high-contrast-active .mat-slider-horizontal .mat-slider-ticks-container{height:0;outline:solid 2px;top:1px}.mat-slider-horizontal .mat-slider-ticks{height:2px;width:100%}.mat-slider-horizontal .mat-slider-thumb-container{width:100%;height:0;top:50%}.mat-slider-horizontal .mat-slider-focus-ring{top:-15px;right:-15px}.mat-slider-horizontal .mat-slider-thumb-label{right:-14px;top:-40px;transform:translateY(26px) scale(0.01) rotate(45deg)}.mat-slider-horizontal .mat-slider-thumb-label-text{transform:rotate(-45deg)}.mat-slider-horizontal.cdk-focused .mat-slider-thumb-label{transform:rotate(45deg)}.cdk-high-contrast-active .mat-slider-horizontal.cdk-focused .mat-slider-thumb-label,.cdk-high-contrast-active .mat-slider-horizontal.cdk-focused .mat-slider-thumb-label-text{transform:none}.mat-slider-vertical{width:48px;min-height:128px}.mat-slider-vertical .mat-slider-wrapper{width:2px;top:8px;bottom:8px;left:23px}.mat-slider-vertical .mat-slider-wrapper::after{width:2px;border-top-width:2px;bottom:0;left:0}.mat-slider-vertical .mat-slider-track-wrapper{height:100%;width:2px}.mat-slider-vertical .mat-slider-track-fill{height:100%;width:2px;transform:scaleY(0)}.mat-slider-vertical .mat-slider-track-background{height:100%;width:2px;transform:scaleY(1)}.mat-slider-vertical .mat-slider-ticks-container{width:2px;height:100%}.cdk-high-contrast-active .mat-slider-vertical .mat-slider-ticks-container{width:0;outline:solid 2px;left:1px}.mat-slider-vertical .mat-slider-focus-ring{bottom:-15px;left:-15px}.mat-slider-vertical .mat-slider-ticks{width:2px;height:100%}.mat-slider-vertical .mat-slider-thumb-container{height:100%;width:0;left:50%}.mat-slider-vertical .mat-slider-thumb{-webkit-backface-visibility:hidden;backface-visibility:hidden}.mat-slider-vertical .mat-slider-thumb-label{bottom:-14px;left:-40px;transform:translateX(26px) scale(0.01) rotate(-45deg)}.mat-slider-vertical .mat-slider-thumb-label-text{transform:rotate(45deg)}.mat-slider-vertical.cdk-focused .mat-slider-thumb-label{transform:rotate(-45deg)}[dir=rtl] .mat-slider-wrapper::after{left:0;right:auto}[dir=rtl] .mat-slider-horizontal .mat-slider-track-fill{transform-origin:100% 100%}[dir=rtl] .mat-slider-horizontal .mat-slider-track-background{transform-origin:0 0}[dir=rtl] .mat-slider-horizontal.mat-slider-axis-inverted .mat-slider-track-fill{transform-origin:0 0}[dir=rtl] .mat-slider-horizontal.mat-slider-axis-inverted .mat-slider-track-background{transform-origin:100% 100%}.mat-slider._mat-animation-noopable .mat-slider-track-fill,.mat-slider._mat-animation-noopable .mat-slider-track-background,.mat-slider._mat-animation-noopable .mat-slider-ticks,.mat-slider._mat-animation-noopable .mat-slider-thumb-container,.mat-slider._mat-animation-noopable .mat-slider-focus-ring,.mat-slider._mat-animation-noopable .mat-slider-thumb,.mat-slider._mat-animation-noopable .mat-slider-thumb-label,.mat-slider._mat-animation-noopable .mat-slider-thumb-label-text,.mat-slider._mat-animation-noopable .mat-slider-has-ticks .mat-slider-wrapper::after{transition:none}\\n'],encapsulation:2,changeDetection:0}),t})();function i5(t){return\"t\"===t.type[0]}function n5(t,e){let i;return i=i5(t)?\"number\"==typeof e?r5(t.touches,e)||r5(t.changedTouches,e):t.touches[0]||t.changedTouches[0]:t,i?{x:i.clientX,y:i.clientY}:void 0}function r5(t,e){for(let i=0;i<t.length;i++)if(t[i].identifier===e)return t[i]}let s5=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({imports:[[Jd,_y],_y]}),t})(),o5=(()=>{class t{validate(t){return function(t){const e=parseInt(t.value,10);return!isNaN(e)&&e>=-180&&e<=180?null:{invalidLongitude:{value:t.value}}}(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"appLongitude\",\"\"]],features:[Gl([{provide:Ob,useExisting:t,multi:!0}])]}),t})();var a5=i(3887),l5=i.n(a5);let c5=(()=>{class t{constructor(){this.sampleCode=\"const fs = require('fs')\\nconst http = require('http')\\n\\n// Avec cette configuration, l'URL \\xe0 configurer dans l'interface ANAIS est : http://localhost:3001/mysecret\\nconst accessKey = 'mysecret'\\nconst listenPort = 3001\\nconst geoPositionFilePath = '/tmp/position.log'\\n\\nconst headers = {\\n  'access-control-allow-origin': '*'\\n}\\nconst server = http.createServer(async (req, res) => {\\n  const key = req.url.slice(1)\\n  if (key !== accessKey) {\\n    res.writeHead(401, headers)\\n    res.end('')\\n  } else {\\n    res.writeHead(200, headers)\\n    // La r\\xe9ponse doit \\xeatre au format 'latitude,longitude' en projection EPSG:4326\\n    fs.createReadStream(geoPositionFilePath).pipe(res)\\n  }\\n})\\n\\nserver.listen(listenPort, '127.0.0.1', () => {\\n  console.log('GeoServer started on port %d', listenPort)\\n})\\n\"}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-geolocation-sample-server-dialog\"]],decls:19,vars:1,consts:[[\"mat-dialog-title\",\"\",1,\"d-flex\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Fermer le panneau\",3,\"mat-dialog-close\"],[1,\"mat-typography\"],[\"href\",\"https://nodejs.org/\"]],template:function(t,e){1&t&&(Pa(0,\"h2\",0),bl(1,\" Configuration d'un serveur HTTP pour exposer la position \"),Ra(2,\"div\",1),Pa(3,\"button\",2),Pa(4,\"mat-icon\"),bl(5,\"close\"),Da(),Da(),Da(),Pa(6,\"mat-dialog-content\",3),Pa(7,\"p\"),bl(8,\"Le code JavaScript ci-dessous est a ex\\xe9cuter par \"),Pa(9,\"a\",4),bl(10,\"Node.js\"),Da(),bl(11,\" et permet de d\\xe9marrer un serveur HTTP en local et exposer la position latitude et longitude \\xe0 partir d'un fichier.\"),Da(),Pa(12,\"p\"),bl(13,\"Afin que l'interface d'ANAIS reconnaisse bien cette position, il faut que le serveur renvoie bien la position au format \"),Pa(14,\"em\"),bl(15,\"longitude,latitude\"),Da(),bl(16,\" en projection EPSG:4326.\"),Da(),Pa(17,\"pre\"),bl(18),Da(),Da()),2&t&&(Ss(18),wl(e.sampleCode))},directives:[$C,vb,jC,Yk,UC],styles:[\"\"]}),t})();var h5=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),u5=function(t){function e(e){var i=t.call(this,\"error\")||this;return i.code=e.code,i.message=e.message,i}return h5(e,t),e}(BB),d5=function(t){function e(e){var i=t.call(this)||this,n=e||{};return i.position_=null,i.transform_=qz,i.watchId_=void 0,i.addChangeListener(\"projection\",i.handleProjectionChanged_),i.addChangeListener(\"tracking\",i.handleTrackingChanged_),void 0!==n.projection&&i.setProjection(n.projection),void 0!==n.trackingOptions&&i.setTrackingOptions(n.trackingOptions),i.setTracking(void 0!==n.tracking&&n.tracking),i}return h5(e,t),e.prototype.disposeInternal=function(){this.setTracking(!1),t.prototype.disposeInternal.call(this)},e.prototype.handleProjectionChanged_=function(){var t=this.getProjection();t&&(this.transform_=eV(Yz(\"EPSG:4326\"),t),this.position_&&this.set(\"position\",this.transform_(this.position_)))},e.prototype.handleTrackingChanged_=function(){if(\"geolocation\"in navigator){var t=this.getTracking();t&&void 0===this.watchId_?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!t&&void 0!==this.watchId_&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}},e.prototype.positionChange_=function(t){var e=t.coords;this.set(\"accuracy\",e.accuracy),this.set(\"altitude\",null===e.altitude?void 0:e.altitude),this.set(\"altitudeAccuracy\",null===e.altitudeAccuracy?void 0:e.altitudeAccuracy),this.set(\"heading\",null===e.heading?void 0:bz(e.heading)),this.position_?(this.position_[0]=e.longitude,this.position_[1]=e.latitude):this.position_=[e.longitude,e.latitude];var i=this.transform_(this.position_);this.set(\"position\",i),this.set(\"speed\",null===e.speed?void 0:e.speed);var n=function(t,e,i,n){for(var r=[],s=0;s<32;++s)$B(r,Hz(t,e,2*Math.PI*s/32,undefined));return r.push(r[0],r[1]),new $2(r,\"XY\",[r.length])}(this.position_,e.accuracy);n.applyTransform(this.transform_),this.set(\"accuracyGeometry\",n),this.changed()},e.prototype.positionError_=function(t){this.dispatchEvent(new u5(t))},e.prototype.getAccuracy=function(){return this.get(\"accuracy\")},e.prototype.getAccuracyGeometry=function(){return this.get(\"accuracyGeometry\")||null},e.prototype.getAltitude=function(){return this.get(\"altitude\")},e.prototype.getAltitudeAccuracy=function(){return this.get(\"altitudeAccuracy\")},e.prototype.getHeading=function(){return this.get(\"heading\")},e.prototype.getPosition=function(){return this.get(\"position\")},e.prototype.getProjection=function(){return this.get(\"projection\")},e.prototype.getSpeed=function(){return this.get(\"speed\")},e.prototype.getTracking=function(){return this.get(\"tracking\")},e.prototype.getTrackingOptions=function(){return this.get(\"trackingOptions\")},e.prototype.setProjection=function(t){this.set(\"projection\",Yz(t))},e.prototype.setTracking=function(t){this.set(\"tracking\",t)},e.prototype.setTrackingOptions=function(t){this.set(\"trackingOptions\",t)},e}(FV),p5=(()=>(function(t){t.Browser=\"browser\",t.FixedLocation=\"fixed_location\",t.Server=\"server\"}(p5||(p5={})),p5))();class f5{constructor(t={}){Object.assign(this,t)}}function m5(t){const e=Uz(t);return e<926?Math.round(100*e)/100+\" m\":Math.round(e/1852*100)/100+\" Nq\"}function g5(t,e){return Math.round(jz(Jz(t),Jz(e))/1852*100)/100}function A5(t,e){return`${v5(e[0]-t[0],e[1]-t[1])}\\xb0 ${m5(new S2([t,e]))}`}function v5(t,e){return Math.round((450-180*Math.atan2(e,t)/Math.PI)%360)}let _5=(()=>{class t{constructor(t){this.configService=t,this.enable$=new Zp(!1),this.source$=new Zp(p5.Browser),this.serverURL$=new Zp(\"\"),this.fixedLocation$=new Zp(null),this.showBearing$=new Zp(!1),this.location$=new Zp(null),this.headingAngle$=new Zp(-1),this.retrievalError$=new Zp(\"\"),this.validConfiguration$=new Zp(!1),this.locationFetchInterval=2e3,this.location$.subscribe(t=>{this.oldLocation&&t&&this.headingAngle$.next(v5(t.lon-this.oldLocation.lon,t.lat-this.oldLocation.lat)),this.oldLocation=t}),this.source$.subscribe(()=>{this.oldLocation=null,this.headingAngle$.next(-1)}),this.geolocation=new d5({trackingOptions:{enableHighAccuracy:!0},tracking:!1}),this.geolocation.on(\"change:position\",()=>{const t=this.geolocation.getPosition();this.location$.next(t?new a$(t[0],t[1]):null)}),LT([this.enable$,this.serverURL$,this.fixedLocation$,this.source$]).subscribe(([t,e,i,n])=>{let r=!1;t&&n===p5.Server&&e?(this.fetchTimer&&window.clearInterval(this.fetchTimer),this.fetchTimer=window.setInterval(()=>Vp(this,void 0,void 0,function*(){if(this.serverURL$.value)try{this.location$.next(yield this.fetchLocation(this.serverURL$.value)),\"\"!==this.retrievalError$.value&&this.retrievalError$.next(\"\")}catch(t){this.retrievalError$.next(t.message)}}),this.locationFetchInterval),r=!0):(window.clearInterval(this.fetchTimer),this.fetchTimer=null);const s=t&&n===p5.Browser;if(s&&!this.geolocation.getTracking()){const t=this.geolocation.getPosition();this.location$.next(t?new a$(t[0],t[1]):null)}if(s&&(r=!0),this.geolocation.setTracking(s),t&&n===p5.FixedLocation&&i){const{lon:t,lat:e}=l5()(i);this.location$.next(new a$(t,e)),r=!0}t||\"\"!==this.retrievalError$.value&&this.retrievalError$.next(\"\"),this.validConfiguration$.next(r)}),this.loadConfig(),q(this.enable$,this.fixedLocation$,this.serverURL$,this.showBearing$,this.source$).subscribe(()=>{this.configService.set(\"geolocationConfig\",new f5({enable:this.enable$.value,fixedLocation:this.fixedLocation$.value,serverURL:this.serverURL$.value,showBearing:this.showBearing$.value,source:this.source$.value}))})}loadConfig(){const t=this.configService.geolocationConfig;t&&(Zj(t.enable)&&this.enable$.next(t.enable),Zj(t.fixedLocation)&&this.fixedLocation$.next(t.fixedLocation),Zj(t.serverURL)&&this.serverURL$.next(t.serverURL),Zj(t.showBearing)&&this.showBearing$.next(t.showBearing),Zj(t.source)&&this.source$.next(t.source))}fetchLocation(t){return Vp(this,void 0,void 0,function*(){let e;try{e=yield fetch(t)}catch(n){throw new Error(`Impossible de r\\xe9cup\\xe9rer la position : ${n.message}. Le serveur est-il joignable ?`)}if(!e.ok)throw new Error(`Mauvais code retour (${e.status}). Une r\\xe9ponse de type 200 est attendue.`);const i=yield e.text();try{const t=i.split(\",\");if(2!==t.length)throw new Error(`Mauvais format. R\\xe9ponse re\\xe7ue : '${i.slice(0,50)}'`);const e=parseFloat(t[0]),n=parseFloat(t[1]);if(isNaN(e))throw new Error(`La latitude '${t[0]}' n'est pas un nombre valide`);if(isNaN(n))throw new Error(`La longitude '${t[0]}' n'est pas un nombre valide`);return new a$(n,e)}catch(n){throw new Error(`Impossible de d\\xe9coder la position : ${n.message}. Le format \"latitude,longitude\" est attendu.`)}})}updateEnable(t){this.enable$.next(t)}updateServerURL(t){this.serverURL$.next(t)}updateFixedLocation(t){this.fixedLocation$.next(t)}updateSource(t){this.source$.next(t),this.retrievalError$.next(\"\")}toggleShowBearing(){this.showBearing$.next(!this.showBearing$.value)}}return t.\\u0275fac=function(e){return new(e||t)(En(C$))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();function y5(t,e){if(1&t){const t=Na();Pa(0,\"mat-form-field\",2),Pa(1,\"mat-label\"),bl(2,\"URL du serveur\"),Da(),Pa(3,\"input\",10),$a(\"ngModelChange\",function(e){return Fe(t),Wa(2).serverURL=e}),Da(),Da(),Pa(4,\"button\",11),$a(\"click\",function(){return Fe(t),Wa(2).saveServerLocation()}),bl(5,\" Enregistrer \"),Da(),Pa(6,\"button\",12),$a(\"click\",function(){return Fe(t),Wa(2).tryFetchLocation()}),bl(7,\" Tester l'URL \"),Da()}if(2&t){const t=Wa(2);Ss(3),Ia(\"ngModel\",t.serverURL)(\"disabled\",!t.geolocationLayerService.enable$.value),Ss(1),Ia(\"disabled\",!t.geolocationLayerService.enable$.value),Ss(2),Ia(\"disabled\",!t.serverURL||!t.geolocationLayerService.enable$.value)}}function b5(t,e){if(1&t){const t=Na();Pa(0,\"div\",13),bl(1),Da(),Pa(2,\"button\",14),$a(\"click\",function(){return Fe(t),Wa(2).editMode=!0}),bl(3,\" \\xc9diter \"),Da()}if(2&t){const t=Wa(2);Ss(1),wl(t.serverURL||\"Aucune URL configur\\xe9e\"),Ss(1),Ia(\"disabled\",!t.geolocationLayerService.enable$.value)}}function w5(t,e){if(1&t&&(Pa(0,\"div\",15),bl(1),Da()),2&t){const t=Wa(2);Ss(1),xl(\" \",t.fetchAttempt,\" \")}}function x5(t,e){1&t&&(Pa(0,\"p\",16),Pa(1,\"mat-icon\",2),bl(2,\"warning\"),Da(),bl(3,\" Avec certaines versions de Firefox, il faut autoriser le chargement de contenu non s\\xe9curis\\xe9 (HTTP) afin d'acc\\xe9der \\xe0 votre serveur en local. \"),Da(),Ra(4,\"img\",17))}function S5(t,e){if(1&t){const t=Na();Pa(0,\"div\",1),Pa(1,\"div\",2),bl(2,\"URL du serveur :\"),Da(),na(3,y5,8,4,\"ng-template\",7),na(4,b5,4,2,\"ng-template\",7),Da(),na(5,w5,2,1,\"div\",8),Pa(6,\"div\"),bl(7,\" Pour mettre en oeuvre un serveur qui expose une position \\xe0 partir d'un fichier local, veuillez vous r\\xe9f\\xe9rer \\xe0 cet \"),Pa(8,\"button\",9),$a(\"click\",function(){return Fe(t),Wa().openGeolocationSampleServerDialog()}),bl(9,\"exemple de serveur HTTP\"),Da(),bl(10,\". \"),Ra(11,\"br\"),bl(12,\" Sinon pour tester cette fonctionnalit\\xe9, vous pouvez \"),Pa(13,\"button\",9),$a(\"click\",function(){return Fe(t),Wa().useSampleServer()}),bl(14,\"utiliser l'URL de test\"),Da(),bl(15,\" qui simule une position GPS : \"),Pa(16,\"em\"),bl(17),Da(),bl(18,\". \"),Da(),na(19,x5,5,0,\"ng-template\",7)}if(2&t){const t=Wa();Ss(3),Ia(\"ngIf\",t.editMode),Ss(1),Ia(\"ngIf\",!t.editMode),Ss(1),Ia(\"ngIf\",t.fetchAttempt),Ss(3),Ia(\"disabled\",!t.geolocationLayerService.enable$.value),Ss(5),Ia(\"disabled\",!t.geolocationLayerService.enable$.value),Ss(4),wl(t.sampleServerURL),Ss(2),Ia(\"ngIf\",t.isFirefox)}}function C5(t,e){1&t&&(Pa(0,\"mat-error\"),bl(1,\"Ce champ est n\\xe9cessaire\"),Da())}function k5(t,e){if(1&t){const t=Na();Pa(0,\"mat-form-field\",2),Pa(1,\"input\",18),$a(\"accept\",function(e){return Fe(t),Wa(2).onFixedLocationUpdate(e)})(\"complete\",function(e){return Fe(t),Wa(2).onFixedLocationComplete(e)}),Da(),na(2,C5,2,0,\"mat-error\",19),Da(),Pa(3,\"button\",20),$a(\"click\",function(){return Fe(t),Wa(2).saveFixedLocation()}),bl(4,\" Enregistrer \"),Da()}if(2&t){const t=Wa(2);Ss(1),Ia(\"formControl\",t.fixedLocation)(\"imask\",t.lonLatMask),Ss(1),Ia(\"ngIf\",null==t.fixedLocation.errors?null:t.fixedLocation.errors.mandatory),Ss(1),Ia(\"disabled\",!t.fixedLocation.valid||!t.geolocationLayerService.enable$.value)}}function E5(t,e){if(1&t){const t=Na();Pa(0,\"div\",13),bl(1),Da(),Pa(2,\"button\",14),$a(\"click\",function(){return Fe(t),Wa(2).editMode=!0}),bl(3,\" \\xc9diter \"),Da()}if(2&t){const t=Wa(2);Ss(1),wl(t.fixedLocation.value||\"Aucune position configur\\xe9e\"),Ss(1),Ia(\"disabled\",!t.geolocationLayerService.enable$.value)}}function M5(t,e){if(1&t&&(Pa(0,\"div\",1),Pa(1,\"div\",2),bl(2,\"Position :\"),Da(),na(3,k5,5,4,\"ng-template\",7),na(4,E5,4,2,\"ng-template\",7),Da()),2&t){const t=Wa();Ss(3),Ia(\"ngIf\",t.editMode),Ss(1),Ia(\"ngIf\",!t.editMode)}}let T5=(()=>{class t{constructor(t,e){this.dialog=t,this.geolocationLayerService=e,this.editMode=!1,this.fixedLocation=new Ow(\"\"),this.fetchAttempt=null,this.sampleServerURL=\"https://sample-geoserver.anais.fabnum.fr/\",this.lonLatMask={mask:\"LAT\\xb0`MIN'`MIN\\\"NS LON\\xb0`MIN'`MIN\\\"EW\",lazy:!1,blocks:{LON:{mask:KI,from:0,to:180},LAT:{mask:KI,from:0,to:85},NS:{mask:nO,enum:[\"N\",\"S\"]},EW:{mask:nO,enum:[\"E\",\"W\"]},MIN:{mask:KI,from:0,to:59}}}}ngOnInit(){this.geolocationLayerService.enable$.subscribe(t=>{t?this.fixedLocation.enable():this.fixedLocation.disable()}),this.geolocationLayerService.fixedLocation$.subscribe(t=>{this.fixedLocation.setValue(null!=t?t:\"\")}),this.geolocationLayerService.serverURL$.subscribe(t=>{this.serverURL=t}),this.geolocationLayerService.source$.subscribe(t=>{this.source=t,this.editMode=!1}),this.isFirefox=oq.getParser(window.navigator.userAgent).isBrowser(\"firefox\")}updateEnable(t){this.geolocationLayerService.updateEnable(t)}updateSource(t){this.geolocationLayerService.updateSource(t)}saveServerLocation(){return Vp(this,void 0,void 0,function*(){try{\"\"!==this.serverURL&&(yield this.geolocationLayerService.fetchLocation(this.serverURL)),this.geolocationLayerService.updateServerURL(this.serverURL),this.editMode=!1,this.fetchAttempt=\"\"}catch(k6){this.fetchAttempt=k6.message}})}tryFetchLocation(){return Vp(this,void 0,void 0,function*(){try{const t=yield this.geolocationLayerService.fetchLocation(this.serverURL);this.fetchAttempt=`Position r\\xe9cup\\xe9r\\xe9e: latitude=${t.lat}, longitude=${t.lon}`}catch(k6){this.fetchAttempt=k6.message}})}openGeolocationSampleServerDialog(){this.dialog.open(c5)}useSampleServer(){return Vp(this,void 0,void 0,function*(){this.serverURL=this.sampleServerURL,yield this.saveServerLocation()})}saveFixedLocation(){return Vp(this,void 0,void 0,function*(){this.fixedLocation.valid&&this.geolocationLayerService.updateFixedLocation(this.fixedLocation.value),this.editMode=!1})}onFixedLocationUpdate(t){this.fixedLocation.setErrors({mandatory:!0})}onFixedLocationComplete(t){try{l5()(t),this.fixedLocation.setErrors({mandatory:null}),this.fixedLocation.setValue(t,{emitEvent:!1})}catch(e){}}}return t.\\u0275fac=function(e){return new(e||t)(Ta(zC),Ta(_5))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-geolocation-settings\"]],decls:14,vars:5,consts:[[\"color\",\"primary\",1,\"d-block\",\"mt-2\",3,\"ngModel\",\"ngModelChange\"],[1,\"d-flex-center\",\"mt-2\"],[1,\"mr-2\"],[3,\"ngModel\",\"disabled\",\"ngModelChange\"],[\"color\",\"primary\",\"value\",\"browser\"],[\"color\",\"primary\",\"value\",\"server\"],[\"color\",\"primary\",\"value\",\"fixed_location\"],[3,\"ngIf\"],[\"class\",\"mt-1\",4,\"ngIf\"],[\"mat-stroked-button\",\"\",1,\"text-link\",3,\"disabled\",\"click\"],[\"matInput\",\"\",3,\"ngModel\",\"disabled\",\"ngModelChange\"],[\"mat-stroked-button\",\"\",\"title\",\"Enregistrer l'URL du serveur\",3,\"disabled\",\"click\"],[\"mat-stroked-button\",\"\",\"title\",\"Tester la r\\xe9cup\\xe9ration de cette URL\",3,\"disabled\",\"click\"],[2,\"min-width\",\"180px\"],[\"mat-stroked-button\",\"\",1,\"ml-2\",3,\"disabled\",\"click\"],[1,\"mt-1\"],[1,\"firefox-warning-geolocation\"],[\"src\",\"assets/images/help-firefox-mixed-content-tutorial.png\",\"alt\",\"Configuration Firefox\",1,\"ml-3\"],[\"matInput\",\"\",3,\"formControl\",\"imask\",\"accept\",\"complete\"],[4,\"ngIf\"],[\"type\",\"submit\",\"mat-stroked-button\",\"\",\"title\",\"Enregistrer\",3,\"disabled\",\"click\"]],template:function(t,e){1&t&&(Pa(0,\"mat-slide-toggle\",0),$a(\"ngModelChange\",function(t){return e.updateEnable(t)}),bl(1,\" Afficher la position GPS sur la carte\\n\"),Da(),Pa(2,\"div\",1),Pa(3,\"label\",2),bl(4,\"Source :\"),Da(),Pa(5,\"mat-radio-group\",3),$a(\"ngModelChange\",function(t){return e.updateSource(t)}),Pa(6,\"mat-radio-button\",4),bl(7,\"API Navigateur\"),Da(),Pa(8,\"mat-radio-button\",5),bl(9,\"Serveur\"),Da(),Pa(10,\"mat-radio-button\",6),bl(11,\"Point de r\\xe9f\\xe9rence\"),Da(),Da(),Da(),na(12,S5,20,7,\"ng-template\",7),na(13,M5,5,2,\"ng-template\",7)),2&t&&(Ia(\"ngModel\",e.geolocationLayerService.enable$.value),Ss(5),Ia(\"ngModel\",e.geolocationLayerService.source$.value)(\"disabled\",!e.geolocationLayerService.enable$.value),Ss(7),Ia(\"ngIf\",\"server\"===e.source),Ss(1),Ia(\"ngIf\",\"fixed_location\"===e.source))},directives:[bX,aw,Vw,nW,aW,Bd,vb,tS,Hx,hS,Mb,Yk,Ww,dO,Nx],styles:[\".mat-radio-button[_ngcontent-%COMP%] ~ .mat-radio-button[_ngcontent-%COMP%]{margin-left:16px}.firefox-warning-geolocation[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:.9em;color:#d41a1a}.text-link[_ngcontent-%COMP%]{padding:0 8px;line-height:2em}\"]}),t})();function I5(t,e){if(1&t&&(Pa(0,\"mat-option\",20),bl(1),Da()),2&t){const t=e.$implicit;Ia(\"value\",t.value),Ss(1),xl(\" \",t.label,\" \")}}function O5(t,e){1&t&&(Pa(0,\"mat-chip\",25),bl(1,\"Restriction active\"),Da())}function P5(t,e){if(1&t){const t=Na();Pa(0,\"mat-chip-list\",21),na(1,O5,2,0,\"mat-chip\",22),Da(),Pa(2,\"button\",23),$a(\"click\",function(){return Fe(t),Wa(2).mapRestrictionService.removeArea()}),Pa(3,\"mat-icon\"),bl(4,\"delete\"),Da(),Da(),Pa(5,\"button\",24),$a(\"click\",function(){return Fe(t),Wa(2).mapRestrictionService.startSelectingArea()}),Pa(6,\"mat-icon\"),bl(7,\"edit\"),Da(),Da()}if(2&t){const t=Wa(2);Ss(1),Ia(\"ngIf\",t.mapConfigService.restrictedAreas$.value)}}function D5(t,e){if(1&t){const t=Na();Pa(0,\"button\",26),$a(\"click\",function(){return Fe(t),Wa(2).mapRestrictionService.startSelectingArea()}),bl(1,\" S\\xe9lectionner une zone \"),Da()}}function R5(t,e){if(1&t){const t=Na();Pa(0,\"h5\"),bl(1,\"Intervalle de rafraichissement des derni\\xe8res positions des navires\"),Da(),Pa(2,\"div\"),bl(3,\"En vue temps r\\xe9el, les positions des navires sont rafraichies selon cet intervalle.\"),Da(),Pa(4,\"mat-form-field\"),Pa(5,\"mat-select\",5),$a(\"ngModelChange\",function(e){return Fe(t),Wa().mapConfigService.updateShipRefreshInterval(e)}),na(6,I5,2,2,\"mat-option\",6),Da(),Da(),Pa(7,\"h5\"),bl(8,\"Restriction de la carte\"),Da(),Pa(9,\"p\"),bl(10,\" Cette option permet de limiter la r\\xe9cup\\xe9ration des navires \\xe0 une zone de la carte. Notez que la zone restreinte va d\\xe9signer les tuiles de donn\\xe9es \\xe0 charger. Il est donc normal que la zone charg\\xe9e soit un peu plus grande que la zone choisie. \"),Da(),Pa(11,\"div\",18),na(12,P5,8,1,\"ng-template\",4),na(13,D5,2,0,\"button\",19),Da()}if(2&t){const t=Wa();Ss(5),Ia(\"ngModel\",t.mapConfigService.shipRefreshInterval$.value),Ss(1),Ia(\"ngForOf\",t.shipRefreshIntervals),Ss(6),Ia(\"ngIf\",t.mapConfigService.restrictedAreas$.value),Ss(1),Ia(\"ngIf\",!t.mapConfigService.restrictedAreas$.value)}}function F5(t,e){if(1&t&&(Pa(0,\"mat-option\",20),bl(1),Da()),2&t){const t=e.$implicit;Ia(\"value\",t.key),Ss(1),xl(\" \",t.label,\" \")}}function L5(t,e){if(1&t&&(Pa(0,\"mat-option\",20),bl(1),Da()),2&t){const t=e.$implicit;Ia(\"value\",t.key),Ss(1),xl(\" \",t.label,\" \")}}function B5(t,e){1&t&&(Pa(0,\"mat-error\"),bl(1,\"La longitude est invalide\"),Da())}const N5=[{label:\"30 secondes\",value:3e4},{label:\"1 minute\",value:6e4},{label:\"2 minutes\",value:12e4},{label:\"5 minutes\",value:3e5},{label:\"10 minutes\",value:6e5},{label:\"20 minutes\",value:12e5},{label:\"D\\xe9sactiv\\xe9\",value:2147483647}];let z5=(()=>{class t{constructor(t,e,i){this.configService=t,this.mapConfigService=e,this.mapRestrictionService=i,this.shipRefreshIntervals=N5,this.availableTimeRanges=p$.filter(t=>!t.isCustom),this.coordinateSystems=kj}}return t.\\u0275fac=function(e){return new(e||t)(Ta(C$),Ta(k$),Ta(Z3))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-settings-dialog\"]],decls:89,vars:22,consts:[[\"mat-dialog-title\",\"\",1,\"d-flex\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Fermer le panneau\",3,\"mat-dialog-close\"],[\"color\",\"primary\",1,\"d-block\",3,\"ngModel\",\"ngModelChange\"],[3,\"ngIf\"],[3,\"ngModel\",\"ngModelChange\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[1,\"my-3\"],[\"color\",\"primary\",\"title\",\"Ce param\\xe8tre permet d'afficher des hexagones plus petits lors de la s\\xe9lection de zones.\",1,\"d-block\",3,\"ngModel\",\"ngModelChange\"],[\"color\",\"primary\",\"title\",\"Ce param\\xe8tre permet d'afficher les traces des navires traduites en arcs dirig\\xe9s dans la grille hexagonale.\",1,\"d-block\",3,\"ngModel\",\"ngModelChange\"],[1,\"d-flex-center\",\"my-2\"],[1,\"mr-2\"],[\"color\",\"primary\",\"thumbLabel\",\"true\",2,\"width\",\"300px\",3,\"min\",\"max\",\"step\",\"tickInterval\",\"value\",\"change\"],[\"gid\",\"coordinate-system\",\"date\",\"2021-10-13\"],[1,\"d-inline\"],[\"type\",\"number\",\"matInput\",\"\",\"appLongitude\",\"\",3,\"ngModel\",\"ngModelChange\"],[\"longitudeCenter\",\"ngModel\"],[4,\"ngIf\"],[1,\"d-flex-center\"],[\"mat-raised-button\",\"\",3,\"click\",4,\"ngIf\"],[3,\"value\"],[1,\"d-inline\",\"mr-2\"],[\"color\",\"primary\",\"selected\",\"\",4,\"ngIf\"],[\"mat-button\",\"\",\"color\",\"warn\",\"title\",\"Supprimer la zone de restriction\",3,\"click\"],[\"mat-button\",\"\",\"title\",\"Mettre \\xe0 jour la zone de restriction\",3,\"click\"],[\"color\",\"primary\",\"selected\",\"\"],[\"mat-raised-button\",\"\",3,\"click\"]],template:function(t,e){if(1&t&&(Pa(0,\"h1\",0),bl(1,\" Param\\xe8tres g\\xe9n\\xe9raux \"),Ra(2,\"div\",1),Pa(3,\"button\",2),Pa(4,\"mat-icon\"),bl(5,\"close\"),Da(),Da(),Da(),Pa(6,\"div\"),Pa(7,\"h3\"),bl(8,\"Bande passante\"),Da(),Pa(9,\"p\"),bl(10,\" Ces param\\xe8tres peuvent \\xeatre utilis\\xe9s pour r\\xe9duire la bande passante utilis\\xe9e quand le d\\xe9bit de la connexion internet est faible (par exemple dans un avion ou un navire). \"),Da(),Pa(11,\"h5\"),bl(12,\"Chargement manuel\"),Da(),Pa(13,\"p\"),bl(14,\" Par d\\xe9faut, les donn\\xe9es navires et a\\xe9ronefs sont charg\\xe9s par tuiles \\xe0 chaque d\\xe9placement de carte, et rafraichis r\\xe9guli\\xe8rement. Le chargement manuel d\\xe9sactive la r\\xe9cup\\xe9ration automatique des donn\\xe9es et permet \\xe0 l'utilisateur de d\\xe9clencher manuellement cette r\\xe9cup\\xe9ration. \"),Da(),Pa(15,\"mat-slide-toggle\",3),$a(\"ngModelChange\",function(t){return e.mapConfigService.updateManualMapFetch(t)}),bl(16,\" Chargement manuel actif \"),Da(),na(17,R5,14,4,\"ng-template\",4),Pa(18,\"h5\"),bl(19,\"P\\xe9riode de temps par d\\xe9faut\"),Da(),Pa(20,\"div\"),bl(21,\"Cette p\\xe9riode de temps permet d'afficher l'historique des traces et des alertes affich\\xe9 lorsque l'on visualise le d\\xe9tail d'un navire.\"),Da(),Pa(22,\"mat-form-field\"),Pa(23,\"mat-select\",5),$a(\"ngModelChange\",function(t){return e.configService.set(\"defaultTimeRange\",t)}),na(24,F5,2,2,\"mat-option\",6),Da(),Da(),Pa(25,\"h5\"),bl(26,\"Limite de zoom minimum\"),Da(),Pa(27,\"div\"),bl(28,\"Par d\\xe9faut le zoom minimum est limit\\xe9 afin de r\\xe9duire la consommation r\\xe9seau et m\\xe9moire de l'application. Si vous d\\xe9sactivez cette option, vous pourrez alors d\\xe9zoomer mais cela aura un co\\xfbt en termes de bande passante et de capacit\\xe9s de traitement (CPU et m\\xe9moire). Il se peut que votre navigateur se bloque si vous n'avez pas assez de m\\xe9moire !\"),Da(),Pa(29,\"mat-slide-toggle\",3),$a(\"ngModelChange\",function(t){return e.mapConfigService.updateLimitMinimumZoom(t)}),bl(30,\" Limite de zoom active \"),Da(),Ra(31,\"mat-divider\",7),Pa(32,\"h3\"),bl(33,\"Affichage\"),Da(),Pa(34,\"mat-slide-toggle\",3),$a(\"ngModelChange\",function(t){return e.mapConfigService.updatePreloadMapTiles(t)}),Pa(35,\"div\"),bl(36,\"Pr\\xe9charger les tuiles du fond de carte (affichage plus rapide mais bande passante x2 environ)\"),Da(),Da(),Pa(37,\"mat-slide-toggle\",3),$a(\"ngModelChange\",function(t){return e.mapConfigService.updateZoomOnLocationEvents(t)}),bl(38,\" Zoomer sur la carte lors d'\\xe9v\\xe9nements de localisation \"),Da(),Pa(39,\"mat-slide-toggle\",3),$a(\"ngModelChange\",function(t){return e.mapConfigService.updateHidePositionsInLowZooms(t)}),bl(40,\" Masquer les points des traces quand le zoom est bas \"),Da(),Pa(41,\"mat-slide-toggle\",8),$a(\"ngModelChange\",function(t){return e.mapConfigService.updateHighHexagonsResolution(t)}),bl(42,\" Utiliser des hexagones de haute r\\xe9solution \"),Da(),Pa(43,\"mat-slide-toggle\",9),$a(\"ngModelChange\",function(t){return e.mapConfigService.updateDebugH3Trace(t)}),bl(44,\" Voir l'analyse des traces des navires dans la grille hexagonale (fonction de Debug) \"),Da(),Pa(45,\"mat-slide-toggle\",3),$a(\"ngModelChange\",function(t){return e.mapConfigService.updateShowMarineTrafficPhotos(t)}),bl(46,\" Afficher les photos de Marine Traffic dans la fiche navire \"),Da(),Pa(47,\"mat-slide-toggle\",3),$a(\"ngModelChange\",function(t){return e.mapConfigService.updateShowMarineTrafficDeparture(t)}),bl(48,\" Afficher le bouton pour r\\xe9cup\\xe9rer la provenance de Marine Traffic \"),Da(),Pa(49,\"div\",10),Pa(50,\"label\",11),bl(51,\"Transparence des \\xe9tiquettes et infobulles :\"),Da(),bl(52,\" Transparent \"),Pa(53,\"mat-slider\",12),$a(\"change\",function(t){return e.mapConfigService.updateTooltipsOpacity(t.value)}),Da(),bl(54,\" Opaque \"),Da(),Pa(55,\"mat-slide-toggle\",3),$a(\"ngModelChange\",function(t){return e.mapConfigService.updateUseUTCDates(t)}),bl(56,\" Afficher les dates en UTC \"),Da(),Pa(57,\"app-glitter\",13),Pa(58,\"div\",14),Pa(59,\"label\",11),bl(60,\"Syst\\xe8me de coordonn\\xe9es : \"),Da(),Pa(61,\"mat-form-field\"),Pa(62,\"mat-select\",5),$a(\"ngModelChange\",function(t){return e.mapConfigService.updateCoordinateSystem(t)}),na(63,L5,2,2,\"mat-option\",6),Da(),Da(),Da(),Da(),Pa(64,\"h5\"),bl(65,\"D\\xe9calage de longitude\"),Da(),Pa(66,\"div\"),bl(67,\" Par d\\xe9faut, les donn\\xe9es sont affich\\xe9es de la longitude -180 \\xe0 la longitude +180. Or cet affichage occasionne une coupure de l'affichage au milieu de l'oc\\xe9an pacifique. Si vous travaillez r\\xe9guli\\xe8rement sur cette zone, alors pour pouvez d\\xe9caler le centre afin de d\\xe9placer la coupure \\xe0 un endroit moins important pour vous. \"),Da(),Pa(68,\"mat-form-field\"),Pa(69,\"mat-label\"),bl(70,\"Longitude\"),Da(),Pa(71,\"input\",15,16),$a(\"ngModelChange\",function(t){return e.mapConfigService.updateLongitudeCenter(t)}),Da(),na(73,B5,2,0,\"mat-error\",17),Da(),Ra(74,\"mat-divider\",7),Pa(75,\"h3\"),bl(76,\"G\\xe9olocalisation\"),Da(),Pa(77,\"div\"),bl(78,\"L'option ci-dessous permet d'afficher une position en temps-r\\xe9el sur la carte, en utilisant un point de r\\xe9f\\xe9rence, l'API navigateur, ou bien un serveur HTTP en local.\"),Da(),Pa(79,\"div\"),bl(80,\"Si vous \\xeates dans un avion ou dans un navire, cette option permet par exemple d'afficher la position de l'avion ou du navire embarquant ANAIS.\"),Da(),Pa(81,\"div\"),bl(82,\"Notez bien que cette information de position est utilis\\xe9e localement pour \\xeatre affich\\xe9e sur la carte.\"),Da(),Pa(83,\"div\"),bl(84,\"Cette position n'est \"),Pa(85,\"strong\"),bl(86,\"jamais\"),Da(),bl(87,\" envoy\\xe9e sur internet (serveur ANAIS ou autre)\"),Da(),Ra(88,\"app-geolocation-settings\"),Da()),2&t){const t=ra(72);Ss(15),Ia(\"ngModel\",e.mapConfigService.manualMapFetch$.value),Ss(2),Ia(\"ngIf\",!e.mapConfigService.manualMapFetch$.value),Ss(6),Ia(\"ngModel\",e.configService.defaultTimeRange),Ss(1),Ia(\"ngForOf\",e.availableTimeRanges),Ss(5),Ia(\"ngModel\",e.mapConfigService.limitMinimumZoom$.value),Ss(5),Ia(\"ngModel\",e.mapConfigService.preloadMapTiles$.value),Ss(3),Ia(\"ngModel\",e.mapConfigService.zoomOnLocationEvents$.value),Ss(2),Ia(\"ngModel\",e.mapConfigService.hidePositionsInLowZooms$.value),Ss(2),Ia(\"ngModel\",e.mapConfigService.highHexagonsResolution$.value),Ss(2),Ia(\"ngModel\",e.mapConfigService.debugH3Trace$.value),Ss(2),Ia(\"ngModel\",e.mapConfigService.showMarineTrafficPhotos$.value),Ss(2),Ia(\"ngModel\",e.mapConfigService.showMarineTrafficDeparture$.value),Ss(6),Ia(\"min\",0)(\"max\",1)(\"step\",.1)(\"tickInterval\",1)(\"value\",e.mapConfigService.tooltipsOpacity$.value),Ss(2),Ia(\"ngModel\",e.mapConfigService.useUTCDates$.value),Ss(7),Ia(\"ngModel\",e.mapConfigService.coordinateSystem$.value),Ss(1),Ia(\"ngForOf\",e.coordinateSystems),Ss(8),Ia(\"ngModel\",e.mapConfigService.longitudeCenter$.value),Ss(2),Ia(\"ngIf\",t.invalid&&t.errors.invalidLongitude)}},directives:[$C,vb,jC,Yk,bX,aw,Vw,Bd,tS,IT,Fd,Hq,e5,hX,Hx,Uw,hS,Mb,o5,T5,cb,eX,ZZ,Nx],styles:[\"\"]}),t})(),V5=(()=>{class t extends Lq{constructor(t,e,i,n,r,s){super(),this.titleService=t,this.router=e,this.dialog=i,this.mapService=n,this.routeService=r,this.uiService=s}ngOnInit(){this.titleService.setTitle(\"Param\\xe8tres - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.subscriptions.push(this.uiService.drawingMode$.pipe(Cf()).subscribe(t=>{t?this.dialogRef&&(this.dialogRef.close(!1),this.dialogRef=null):this.dialogRef||this.createDialog()}))}createDialog(){this.dialogRef=this.dialog.open(z5,{height:\"90vh\",width:\"90vw\",maxWidth:\"90vw\",closeOnNavigation:!0}),this.dialogRef.afterClosed().subscribe((t=!0)=>Vp(this,void 0,void 0,function*(){if(t){const t=this.routeService.previousUrl||\"\";yield this.router.navigateByUrl(t)}}))}}return t.\\u0275fac=function(e){return new(e||t)(Ta(zp),Ta(XR),Ta(zC),Ta(T$),Ta(F$),Ta(AU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-settings-loader\"]],features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})();function j5(t){return e=>e.lift(new $5(t))}class $5{constructor(t){this.value=t}call(t,e){return e.subscribe(new U5(t,this.value))}}class U5 extends m{constructor(t,e){super(t),this.value=e}_next(t){this.destination.next(this.value)}}const H5=[\"*\"];function G5(t,e){if(1&t){const t=Na();Pa(0,\"div\",2),$a(\"click\",function(){return Fe(t),Wa()._onBackdropClicked()}),Da()}2&t&&ll(\"mat-drawer-shown\",Wa()._isShowingBackdrop())}function q5(t,e){1&t&&(Pa(0,\"mat-drawer-content\"),Xa(1,2),Da())}const W5=[[[\"mat-drawer\"]],[[\"mat-drawer-content\"]],\"*\"],Y5=[\"mat-drawer\",\"mat-drawer-content\",\"*\"],Z5={transformDrawer:bA(\"transform\",[CA(\"open, open-instant\",SA({transform:\"none\",visibility:\"visible\"})),CA(\"void\",SA({\"box-shadow\":\"none\",visibility:\"hidden\"})),EA(\"void => open-instant\",wA(\"0ms\")),EA(\"void <=> open, open-instant => void\",wA(\"400ms cubic-bezier(0.25, 0.8, 0.25, 1)\"))])},X5=new Qi(\"MAT_DRAWER_DEFAULT_AUTOSIZE\",{providedIn:\"root\",factory:function(){return!1}}),K5=new Qi(\"MAT_DRAWER_CONTAINER\");let Q5=(()=>{class t extends Og{constructor(t,e,i,n,r){super(i,n,r),this._changeDetectorRef=t,this._container=e}ngAfterContentInit(){this._container._contentMarginChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Cc),Ta(ot(()=>t4)),Ta(Jl),Ta(Ig),Ta(tu))},t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-drawer-content\"]],hostAttrs:[1,\"mat-drawer-content\"],hostVars:4,hostBindings:function(t,e){2&t&&al(\"margin-left\",e._container._contentMargins.left,\"px\")(\"margin-right\",e._container._contentMargins.right,\"px\")},features:[Vo],ngContentSelectors:H5,decls:1,vars:0,template:function(t,e){1&t&&(Za(),Xa(0))},encapsulation:2,changeDetection:0}),t})(),J5=(()=>{class t{constructor(t,e,i,n,r,s,o){this._elementRef=t,this._focusTrapFactory=e,this._focusMonitor=i,this._platform=n,this._ngZone=r,this._doc=s,this._container=o,this._elementFocusedBeforeDrawerWasOpened=null,this._enableAnimations=!1,this._position=\"start\",this._mode=\"over\",this._disableClose=!1,this._opened=!1,this._animationStarted=new S,this._animationEnd=new S,this._animationState=\"void\",this.openedChange=new ph(!0),this._openedStream=this.openedChange.pipe(pf(t=>t),E(()=>{})),this.openedStart=this._animationStarted.pipe(pf(t=>t.fromState!==t.toState&&0===t.toState.indexOf(\"open\")),j5(void 0)),this._closedStream=this.openedChange.pipe(pf(t=>!t),E(()=>{})),this.closedStart=this._animationStarted.pipe(pf(t=>t.fromState!==t.toState&&\"void\"===t.toState),j5(void 0)),this._destroyed=new S,this.onPositionChanged=new ph,this._modeChanged=new S,this.openedChange.subscribe(t=>{t?(this._doc&&(this._elementFocusedBeforeDrawerWasOpened=this._doc.activeElement),this._takeFocus()):this._isFocusWithinDrawer()&&this._restoreFocus()}),this._ngZone.runOutsideAngular(()=>{Hm(this._elementRef.nativeElement,\"keydown\").pipe(pf(t=>27===t.keyCode&&!this.disableClose&&!Kp(t)),Mf(this._destroyed)).subscribe(t=>this._ngZone.run(()=>{this.close(),t.stopPropagation(),t.preventDefault()}))}),this._animationEnd.pipe(Cf((t,e)=>t.fromState===e.fromState&&t.toState===e.toState)).subscribe(t=>{const{fromState:e,toState:i}=t;(0===i.indexOf(\"open\")&&\"void\"===e||\"void\"===i&&0===e.indexOf(\"open\"))&&this.openedChange.emit(this._opened)})}get position(){return this._position}set position(t){(t=\"end\"===t?\"end\":\"start\")!=this._position&&(this._position=t,this.onPositionChanged.emit())}get mode(){return this._mode}set mode(t){this._mode=t,this._updateFocusTrapState(),this._modeChanged.next()}get disableClose(){return this._disableClose}set disableClose(t){this._disableClose=Of(t)}get autoFocus(){const t=this._autoFocus;return null==t?\"side\"!==this.mode:t}set autoFocus(t){this._autoFocus=Of(t)}get opened(){return this._opened}set opened(t){this.toggle(Of(t))}_takeFocus(){!this.autoFocus||!this._focusTrap||this._focusTrap.focusInitialElementWhenReady().then(t=>{!t&&\"function\"==typeof this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()})}_restoreFocus(){!this.autoFocus||(this._elementFocusedBeforeDrawerWasOpened?this._focusMonitor.focusVia(this._elementFocusedBeforeDrawerWasOpened,this._openedVia):this._elementRef.nativeElement.blur(),this._elementFocusedBeforeDrawerWasOpened=null,this._openedVia=null)}_isFocusWithinDrawer(){var t;const e=null===(t=this._doc)||void 0===t?void 0:t.activeElement;return!!e&&this._elementRef.nativeElement.contains(e)}ngAfterContentInit(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._updateFocusTrapState()}ngAfterContentChecked(){this._platform.isBrowser&&(this._enableAnimations=!0)}ngOnDestroy(){this._focusTrap&&this._focusTrap.destroy(),this._animationStarted.complete(),this._animationEnd.complete(),this._modeChanged.complete(),this._destroyed.next(),this._destroyed.complete()}open(t){return this.toggle(!0,t)}close(){return this.toggle(!1)}_closeViaBackdropClick(){return this._setOpen(!1,!0)}toggle(t=!this.opened,e){return this._setOpen(t,!t&&this._isFocusWithinDrawer(),e)}_setOpen(t,e,i=\"program\"){return this._opened=t,t?(this._animationState=this._enableAnimations?\"open\":\"open-instant\",this._openedVia=i):(this._animationState=\"void\",e&&this._restoreFocus()),this._updateFocusTrapState(),new Promise(t=>{this.openedChange.pipe(_f(1)).subscribe(e=>t(e?\"open\":\"close\"))})}_getWidth(){return this._elementRef.nativeElement&&this._elementRef.nativeElement.offsetWidth||0}_updateFocusTrapState(){this._focusTrap&&(this._focusTrap.enabled=this.opened&&\"side\"!==this.mode)}_animationStartListener(t){this._animationStarted.next(t)}_animationDoneListener(t){this._animationEnd.next(t)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Jl),Ta(xm),Ta(Bm),Ta(Vf),Ta(tu),Ta(Du,8),Ta(K5,8))},t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-drawer\"]],hostAttrs:[\"tabIndex\",\"-1\",1,\"mat-drawer\"],hostVars:12,hostBindings:function(t,e){1&t&&Ua(\"@transform.start\",function(t){return e._animationStartListener(t)})(\"@transform.done\",function(t){return e._animationDoneListener(t)}),2&t&&(ta(\"align\",null),Ml(\"@transform\",e._animationState),ll(\"mat-drawer-end\",\"end\"===e.position)(\"mat-drawer-over\",\"over\"===e.mode)(\"mat-drawer-push\",\"push\"===e.mode)(\"mat-drawer-side\",\"side\"===e.mode)(\"mat-drawer-opened\",e.opened))},inputs:{position:\"position\",mode:\"mode\",disableClose:\"disableClose\",autoFocus:\"autoFocus\",opened:\"opened\"},outputs:{openedChange:\"openedChange\",_openedStream:\"opened\",openedStart:\"openedStart\",_closedStream:\"closed\",closedStart:\"closedStart\",onPositionChanged:\"positionChanged\"},exportAs:[\"matDrawer\"],ngContentSelectors:H5,decls:2,vars:0,consts:[[\"cdkScrollable\",\"\",1,\"mat-drawer-inner-container\"]],template:function(t,e){1&t&&(Za(),Pa(0,\"div\",0),Xa(1),Da())},directives:[Og],encapsulation:2,data:{animation:[Z5.transformDrawer]},changeDetection:0}),t})(),t4=(()=>{class t{constructor(t,e,i,n,r,s=!1,o){this._dir=t,this._element=e,this._ngZone=i,this._changeDetectorRef=n,this._animationMode=o,this._drawers=new mh,this.backdropClick=new ph,this._destroyed=new S,this._doCheckSubject=new S,this._contentMargins={left:null,right:null},this._contentMarginChanges=new S,t&&t.change.pipe(Mf(this._destroyed)).subscribe(()=>{this._validateDrawers(),this.updateContentMargins()}),r.change().pipe(Mf(this._destroyed)).subscribe(()=>this.updateContentMargins()),this._autosize=s}get start(){return this._start}get end(){return this._end}get autosize(){return this._autosize}set autosize(t){this._autosize=Of(t)}get hasBackdrop(){return null==this._backdropOverride?!this._start||\"side\"!==this._start.mode||!this._end||\"side\"!==this._end.mode:this._backdropOverride}set hasBackdrop(t){this._backdropOverride=null==t?null:Of(t)}get scrollable(){return this._userContent||this._content}ngAfterContentInit(){this._allDrawers.changes.pipe(og(this._allDrawers),Mf(this._destroyed)).subscribe(t=>{this._drawers.reset(t.filter(t=>!t._container||t._container===this)),this._drawers.notifyOnChanges()}),this._drawers.changes.pipe(og(null)).subscribe(()=>{this._validateDrawers(),this._drawers.forEach(t=>{this._watchDrawerToggle(t),this._watchDrawerPosition(t),this._watchDrawerMode(t)}),(!this._drawers.length||this._isDrawerOpen(this._start)||this._isDrawerOpen(this._end))&&this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),this._ngZone.runOutsideAngular(()=>{this._doCheckSubject.pipe(cf(10),Mf(this._destroyed)).subscribe(()=>this.updateContentMargins())})}ngOnDestroy(){this._contentMarginChanges.complete(),this._doCheckSubject.complete(),this._drawers.destroy(),this._destroyed.next(),this._destroyed.complete()}open(){this._drawers.forEach(t=>t.open())}close(){this._drawers.forEach(t=>t.close())}updateContentMargins(){let t=0,e=0;if(this._left&&this._left.opened)if(\"side\"==this._left.mode)t+=this._left._getWidth();else if(\"push\"==this._left.mode){const i=this._left._getWidth();t+=i,e-=i}if(this._right&&this._right.opened)if(\"side\"==this._right.mode)e+=this._right._getWidth();else if(\"push\"==this._right.mode){const i=this._right._getWidth();e+=i,t-=i}t=t||null,e=e||null,(t!==this._contentMargins.left||e!==this._contentMargins.right)&&(this._contentMargins={left:t,right:e},this._ngZone.run(()=>this._contentMarginChanges.next(this._contentMargins)))}ngDoCheck(){this._autosize&&this._isPushed()&&this._ngZone.runOutsideAngular(()=>this._doCheckSubject.next())}_watchDrawerToggle(t){t._animationStarted.pipe(pf(t=>t.fromState!==t.toState),Mf(this._drawers.changes)).subscribe(t=>{\"open-instant\"!==t.toState&&\"NoopAnimations\"!==this._animationMode&&this._element.nativeElement.classList.add(\"mat-drawer-transition\"),this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),\"side\"!==t.mode&&t.openedChange.pipe(Mf(this._drawers.changes)).subscribe(()=>this._setContainerClass(t.opened))}_watchDrawerPosition(t){!t||t.onPositionChanged.pipe(Mf(this._drawers.changes)).subscribe(()=>{this._ngZone.onMicrotaskEmpty.pipe(_f(1)).subscribe(()=>{this._validateDrawers()})})}_watchDrawerMode(t){t&&t._modeChanged.pipe(Mf(q(this._drawers.changes,this._destroyed))).subscribe(()=>{this.updateContentMargins(),this._changeDetectorRef.markForCheck()})}_setContainerClass(t){const e=this._element.nativeElement.classList,i=\"mat-drawer-container-has-open\";t?e.add(i):e.remove(i)}_validateDrawers(){this._start=this._end=null,this._drawers.forEach(t=>{\"end\"==t.position?this._end=t:this._start=t}),this._right=this._left=null,this._dir&&\"rtl\"===this._dir.value?(this._left=this._end,this._right=this._start):(this._left=this._start,this._right=this._end)}_isPushed(){return this._isDrawerOpen(this._start)&&\"over\"!=this._start.mode||this._isDrawerOpen(this._end)&&\"over\"!=this._end.mode}_onBackdropClicked(){this.backdropClick.emit(),this._closeModalDrawersViaBackdrop()}_closeModalDrawersViaBackdrop(){[this._start,this._end].filter(t=>t&&!t.disableClose&&this._canHaveBackdrop(t)).forEach(t=>t._closeViaBackdropClick())}_isShowingBackdrop(){return this._isDrawerOpen(this._start)&&this._canHaveBackdrop(this._start)||this._isDrawerOpen(this._end)&&this._canHaveBackdrop(this._end)}_canHaveBackdrop(t){return\"side\"!==t.mode||!!this._backdropOverride}_isDrawerOpen(t){return null!=t&&t.opened}}return t.\\u0275fac=function(e){return new(e||t)(Ta(xg,8),Ta(Jl),Ta(tu),Ta(Cc),Ta(Pg),Ta(X5),Ta(sy,8))},t.\\u0275cmp=Ht({type:t,selectors:[[\"mat-drawer-container\"]],contentQueries:function(t,e,i){if(1&t&&(Eh(i,Q5,5),Eh(i,J5,5)),2&t){let t;Ch(t=Mh())&&(e._content=t.first),Ch(t=Mh())&&(e._allDrawers=t)}},viewQuery:function(t,e){if(1&t&&kh(Q5,5),2&t){let t;Ch(t=Mh())&&(e._userContent=t.first)}},hostAttrs:[1,\"mat-drawer-container\"],hostVars:2,hostBindings:function(t,e){2&t&&ll(\"mat-drawer-container-explicit-backdrop\",e._backdropOverride)},inputs:{autosize:\"autosize\",hasBackdrop:\"hasBackdrop\"},outputs:{backdropClick:\"backdropClick\"},exportAs:[\"matDrawerContainer\"],features:[Gl([{provide:K5,useExisting:t}])],ngContentSelectors:Y5,decls:4,vars:2,consts:[[\"class\",\"mat-drawer-backdrop\",3,\"mat-drawer-shown\",\"click\",4,\"ngIf\"],[4,\"ngIf\"],[1,\"mat-drawer-backdrop\",3,\"click\"]],template:function(t,e){1&t&&(Za(W5),na(0,G5,1,2,\"div\",0),Xa(1),Xa(2,1),na(3,q5,2,0,\"mat-drawer-content\",1)),2&t&&(Ia(\"ngIf\",e.hasBackdrop),Ss(3),Ia(\"ngIf\",!e._content))},directives:[Bd,Q5],styles:[\".mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\\n\"],encapsulation:2,changeDetection:0}),t})(),e4=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Yt({type:t}),t.\\u0275inj=mt({imports:[[Jd,_y,jf,Dg],Dg,_y]}),t})();var i4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),n4=function(t){function e(e,i,n){var r=t.call(this,e)||this;return r.element=i,r.index=n,r}return i4(e,t),e}(BB),r4=function(t){function e(e,i){var n=t.call(this)||this;if(n.unique_=!!(i||{}).unique,n.array_=e||[],n.unique_)for(var r=0,s=n.array_.length;r<s;++r)n.assertUnique_(n.array_[r],r);return n.updateLength_(),n}return i4(e,t),e.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},e.prototype.extend=function(t){for(var e=0,i=t.length;e<i;++e)this.push(t[e]);return this},e.prototype.forEach=function(t){for(var e=this.array_,i=0,n=e.length;i<n;++i)t(e[i],i,e)},e.prototype.getArray=function(){return this.array_},e.prototype.item=function(t){return this.array_[t]},e.prototype.getLength=function(){return this.get(\"length\")},e.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new n4(\"add\",e,t))},e.prototype.pop=function(){return this.removeAt(this.getLength()-1)},e.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()},e.prototype.remove=function(t){for(var e=this.array_,i=0,n=e.length;i<n;++i)if(e[i]===t)return this.removeAt(i)},e.prototype.removeAt=function(t){var e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new n4(\"remove\",e,t)),e},e.prototype.setAt=function(t,e){var i=this.getLength();if(t<i){this.unique_&&this.assertUnique_(e,t);var n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new n4(\"remove\",n,t)),this.dispatchEvent(new n4(\"add\",e,t))}else{for(var r=i;r<t;++r)this.insertAt(r,void 0);this.insertAt(t,e)}},e.prototype.updateLength_=function(){this.set(\"length\",this.array_.length)},e.prototype.assertUnique_=function(t,e){for(var i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===t&&i!==e)throw new CN(58)},e}(FV),s4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function o4(t,e,i,n){var r=t.getZoom();if(void 0!==r){var s=t.getConstrainedZoom(r+e),o=t.getResolutionForZoom(s);t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:o,anchor:i,duration:void 0!==n?n:250,easing:nN})}}var a4=function(t){function e(e){var i=t.call(this)||this;return e&&e.handleEvent&&(i.handleEvent=e.handleEvent),i.map_=null,i.setActive(!0),i}return s4(e,t),e.prototype.getActive=function(){return this.get(\"active\")},e.prototype.getMap=function(){return this.map_},e.prototype.handleEvent=function(t){return!0},e.prototype.setActive=function(t){this.set(\"active\",t)},e.prototype.setMap=function(t){this.map_=t},e}(FV),l4={SINGLECLICK:\"singleclick\",CLICK:\"click\",DBLCLICK:\"dblclick\",POINTERDRAG:\"pointerdrag\",POINTERMOVE:\"pointermove\",POINTERDOWN:\"pointerdown\",POINTERUP:\"pointerup\",POINTEROVER:\"pointerover\",POINTEROUT:\"pointerout\",POINTERENTER:\"pointerenter\",POINTERLEAVE:\"pointerleave\",POINTERCANCEL:\"pointercancel\"},c4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),h4=function(t){function e(e){var i=t.call(this)||this,n=e||{};return i.delta_=n.delta?n.delta:1,i.duration_=void 0!==n.duration?n.duration:250,i}return c4(e,t),e.prototype.handleEvent=function(t){var e=!1;if(t.type==l4.DBLCLICK){var i=t.originalEvent,n=t.coordinate,r=i.shiftKey?-this.delta_:this.delta_;o4(t.map.getView(),r,n,this.duration_),i.preventDefault(),e=!0}return!e},e}(a4),u4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function d4(t){for(var e=t.length,i=0,n=0,r=0;r<e;r++)i+=t[r].clientX,n+=t[r].clientY;return[i/e,n/e]}var p4=function(t){function e(e){var i=this,n=e||{};return i=t.call(this,n)||this,n.handleDownEvent&&(i.handleDownEvent=n.handleDownEvent),n.handleDragEvent&&(i.handleDragEvent=n.handleDragEvent),n.handleMoveEvent&&(i.handleMoveEvent=n.handleMoveEvent),n.handleUpEvent&&(i.handleUpEvent=n.handleUpEvent),n.stopDown&&(i.stopDown=n.stopDown),i.handlingDownUpSequence=!1,i.trackedPointers_={},i.targetPointers=[],i}return u4(e,t),e.prototype.getPointerCount=function(){return this.targetPointers.length},e.prototype.handleDownEvent=function(t){return!1},e.prototype.handleDragEvent=function(t){},e.prototype.handleEvent=function(t){if(!t.originalEvent)return!0;var e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==l4.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==l4.POINTERUP){var i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==l4.POINTERDOWN){var n=this.handleDownEvent(t);this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==l4.POINTERMOVE&&this.handleMoveEvent(t);return!e},e.prototype.handleMoveEvent=function(t){},e.prototype.handleUpEvent=function(t){return!1},e.prototype.stopDown=function(t){return t},e.prototype.updateTrackedPointers_=function(t){if(function(t){var e=t.type;return e===l4.POINTERDOWN||e===l4.POINTERDRAG||e===l4.POINTERUP}(t)){var e=t.originalEvent,i=e.pointerId.toString();t.type==l4.POINTERUP?delete this.trackedPointers_[i]:(t.type==l4.POINTERDOWN||i in this.trackedPointers_)&&(this.trackedPointers_[i]=e),this.targetPointers=ZB(this.trackedPointers_)}},e}(a4);function f4(t){var e=arguments;return function(t){for(var i=!0,n=0,r=e.length;n<r&&(i=i&&e[n](t));++n);return i}}var m4=function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},g4=function(t){return!t.map.getTargetElement().hasAttribute(\"tabindex\")||function(t){return t.target.getTargetElement().contains(document.activeElement)}(t)},A4=HB,v4=function(t){var e=t.originalEvent;return 0==e.button&&!(hN&&uN&&e.ctrlKey)},_4=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},y4=function(t){var e=t.originalEvent;return!e.altKey&&(uN?e.metaKey:e.ctrlKey)&&!e.shiftKey},b4=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},w4=function(t){var e=t.originalEvent.target.tagName;return\"INPUT\"!==e&&\"SELECT\"!==e&&\"TEXTAREA\"!==e},x4=function(t){var e=t.originalEvent;return kN(void 0!==e,56),\"mouse\"==e.pointerType},S4=function(t){var e=t.originalEvent;return kN(void 0!==e,56),e.isPrimary&&0===e.button},C4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),k4=function(t){function e(e){var i=t.call(this,{stopDown:GB})||this,n=e||{};i.kinetic_=n.kinetic,i.lastCentroid=null,i.panning_=!1;var r=n.condition?n.condition:f4(_4,S4);return i.condition_=n.onFocusOnly?f4(g4,r):r,i.noKinetic_=!1,i}return C4(e,t),e.prototype.handleDragEvent=function(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var e=this.targetPointers,i=d4(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){var n=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],r=t.map.getView();(function(t,e){t[0]*=e,t[1]*=e})(n,r.getResolution()),yj(n,r.getRotation()),r.adjustCenterInternal(n)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()},e.prototype.handleUpEvent=function(t){var e=t.map,i=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var n=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),s=i.getCenterInternal(),o=e.getPixelFromCoordinateInternal(s),a=e.getCoordinateFromPixelInternal([o[0]-n*Math.cos(r),o[1]-n*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(a),duration:500,easing:nN})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>0&&this.condition_(t)){var e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1},e}(p4);function E4(t){if(void 0!==t)return 0}function M4(t){if(void 0!==t)return t}var T4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),I4=function(t){function e(e){var i=this,n=e||{};return(i=t.call(this,{stopDown:GB})||this).condition_=n.condition?n.condition:m4,i.lastAngle_=void 0,i.duration_=void 0!==n.duration?n.duration:250,i}return T4(e,t),e.prototype.handleDragEvent=function(t){if(x4(t)){var e=t.map,i=e.getView();if(i.getConstraints().rotation!==E4){var n=e.getSize(),r=t.pixel,s=Math.atan2(n[1]/2-r[1],r[0]-n[0]/2);void 0!==this.lastAngle_&&i.adjustRotationInternal(-(s-this.lastAngle_)),this.lastAngle_=s}}},e.prototype.handleUpEvent=function(t){return!x4(t)||(t.map.getView().endInteraction(this.duration_),!1)},e.prototype.handleDownEvent=function(t){return!(!x4(t)||!v4(t)||!this.condition_(t)||(t.map.getView().beginInteraction(),this.lastAngle_=void 0,0))},e}(p4),O4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),P4=function(t){function e(e){var i=t.call(this)||this;return i.geometry_=null,i.element_=document.createElement(\"div\"),i.element_.style.position=\"absolute\",i.element_.style.pointerEvents=\"auto\",i.element_.className=\"ol-box \"+e,i.map_=null,i.startPixel_=null,i.endPixel_=null,i}return O4(e,t),e.prototype.disposeInternal=function(){this.setMap(null)},e.prototype.render_=function(){var t=this.startPixel_,e=this.endPixel_,i=\"px\",n=this.element_.style;n.left=Math.min(t[0],e[0])+i,n.top=Math.min(t[1],e[1])+i,n.width=Math.abs(e[0]-t[0])+i,n.height=Math.abs(e[1]-t[1])+i},e.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var e=this.element_.style;e.left=\"inherit\",e.top=\"inherit\",e.width=\"inherit\",e.height=\"inherit\"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},e.prototype.setPixels=function(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()},e.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,e=this.endPixel_,i=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new U2([i])},e.prototype.getGeometry=function(){return this.geometry_},e}(LB),D4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),R4=function(t){function e(e,i,n){var r=t.call(this,e)||this;return r.coordinate=i,r.mapBrowserEvent=n,r}return D4(e,t),e}(BB),F4=function(t){function e(e){var i=t.call(this)||this,n=e||{};return i.box_=new P4(n.className||\"ol-dragbox\"),i.minArea_=void 0!==n.minArea?n.minArea:64,n.onBoxEnd&&(i.onBoxEnd=n.onBoxEnd),i.startPixel_=null,i.condition_=n.condition?n.condition:v4,i.boxEndCondition_=n.boxEndCondition?n.boxEndCondition:i.defaultBoxEndCondition,i}return D4(e,t),e.prototype.defaultBoxEndCondition=function(t,e,i){var n=i[0]-e[0],r=i[1]-e[1];return n*n+r*r>=this.minArea_},e.prototype.getGeometry=function(){return this.box_.getGeometry()},e.prototype.handleDragEvent=function(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new R4(\"boxdrag\",t.coordinate,t))},e.prototype.handleUpEvent=function(t){this.box_.setMap(null);var e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new R4(e?\"boxend\":\"boxcancel\",t.coordinate,t)),!1},e.prototype.handleDownEvent=function(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new R4(\"boxstart\",t.coordinate,t)),!0)},e.prototype.onBoxEnd=function(t){},e}(p4),L4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),B4=function(t){function e(e){var i=this,n=e||{};return(i=t.call(this,{condition:n.condition?n.condition:b4,className:n.className||\"ol-dragzoom\",minArea:n.minArea})||this).duration_=void 0!==n.duration?n.duration:200,i.out_=void 0!==n.out&&n.out,i}return L4(e,t),e.prototype.onBoxEnd=function(t){var e=this.getMap().getView(),i=this.getGeometry();if(this.out_){var n=e.rotatedExtentForGeometry(i),r=e.getResolutionForExtentInternal(n),s=e.getResolution()/r;(i=i.clone()).scale(s*s)}e.fitInternal(i,{duration:this.duration_,easing:nN})},e}(F4),N4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),z4=function(t){function e(e){var i=t.call(this)||this,n=e||{};return i.defaultCondition_=function(t){return _4(t)&&w4(t)},i.condition_=void 0!==n.condition?n.condition:i.defaultCondition_,i.duration_=void 0!==n.duration?n.duration:100,i.pixelDelta_=void 0!==n.pixelDelta?n.pixelDelta:128,i}return N4(e,t),e.prototype.handleEvent=function(t){var e=!1;if(\"keydown\"==t.type){var i=t.originalEvent,n=i.keyCode;if(this.condition_(t)&&(40==n||37==n||39==n||38==n)){var r=t.map.getView(),s=r.getResolution()*this.pixelDelta_,o=0,a=0;40==n?a=-s:37==n?o=-s:39==n?o=s:a=s;var l=[o,a];yj(l,r.getRotation()),function(t,e,i){var n=t.getCenterInternal();n&&t.animateInternal({duration:void 0!==i?i:250,easing:sN,center:t.getConstrainedCenter([n[0]+e[0],n[1]+e[1]])})}(r,l,this.duration_),i.preventDefault(),e=!0}}return!e},e}(a4),V4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),j4=function(t){function e(e){var i=t.call(this)||this,n=e||{};return i.condition_=n.condition?n.condition:w4,i.delta_=n.delta?n.delta:1,i.duration_=void 0!==n.duration?n.duration:100,i}return V4(e,t),e.prototype.handleEvent=function(t){var e=!1;if(\"keydown\"==t.type||\"keypress\"==t.type){var i=t.originalEvent,n=i.charCode;if(this.condition_(t)&&(n==\"+\".charCodeAt(0)||n==\"-\".charCodeAt(0))){var r=t.map,s=n==\"+\".charCodeAt(0)?this.delta_:-this.delta_;o4(r.getView(),s,void 0,this.duration_),i.preventDefault(),e=!0}}return!e},e}(a4),$4=function(){function t(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}return t.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},t.prototype.update=function(t,e){this.points_.push(t,e,Date.now())},t.prototype.end=function(){if(this.points_.length<6)return!1;var t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;for(var i=e-3;i>0&&this.points_[i+2]>t;)i-=3;var n=this.points_[e+2]-this.points_[i+2];if(n<1e3/60)return!1;var r=this.points_[e]-this.points_[i],s=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(s,r),this.initialVelocity_=Math.sqrt(r*r+s*s)/n,this.initialVelocity_>this.minVelocity_},t.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},t.prototype.getAngle=function(){return this.angle_},t}(),U4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),H4=function(t){function e(e){var i=this,n=e||{};(i=t.call(this,n)||this).totalDelta_=0,i.lastDelta_=0,i.maxDelta_=void 0!==n.maxDelta?n.maxDelta:1,i.duration_=void 0!==n.duration?n.duration:250,i.timeout_=void 0!==n.timeout?n.timeout:80,i.useAnchor_=void 0===n.useAnchor||n.useAnchor,i.constrainResolution_=void 0!==n.constrainResolution&&n.constrainResolution;var r=n.condition?n.condition:A4;return i.condition_=n.onFocusOnly?f4(g4,r):r,i.lastAnchor_=null,i.startTime_=void 0,i.mode_=void 0,i.trackpadEventGap_=400,i.deltaPerZoom_=300,i}return U4(e,t),e.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0,this.getMap().getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)},e.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;if(\"wheel\"!==t.type)return!0;var e,i=t.map,n=t.originalEvent;if(n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate),\"wheel\"==t.type&&(e=n.deltaY,cN&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(e/=dN),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(e*=40)),0===e)return!1;this.lastDelta_=e;var r=Date.now();void 0===this.startTime_&&(this.startTime_=r),(!this.mode_||r-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(e)<4?\"trackpad\":\"wheel\");var s=i.getView();if(\"trackpad\"===this.mode_&&!s.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(s.getAnimating()&&s.cancelAnimations(),s.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),s.adjustZoom(-e/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=r,!1;this.totalDelta_+=e;var o=Math.max(this.timeout_-(r-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),o),!1},e.prototype.handleWheelZoom_=function(t){var e=t.getView();e.getAnimating()&&e.cancelAnimations();var i=-mz(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),o4(e,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},e.prototype.setMouseAnchor=function(t){this.useAnchor_=t,t||(this.lastAnchor_=null)},e}(a4),G4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),q4=function(t){function e(e){var i=this,n=e||{},r=n;return r.stopDown||(r.stopDown=GB),(i=t.call(this,r)||this).anchor_=null,i.lastAngle_=void 0,i.rotating_=!1,i.rotationDelta_=0,i.threshold_=void 0!==n.threshold?n.threshold:.3,i.duration_=void 0!==n.duration?n.duration:250,i}return G4(e,t),e.prototype.handleDragEvent=function(t){var e=0,i=this.targetPointers[0],n=this.targetPointers[1],r=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(void 0!==this.lastAngle_){var s=r-this.lastAngle_;this.rotationDelta_+=s,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=s}this.lastAngle_=r;var o=t.map,a=o.getView();if(a.getConstraints().rotation!==E4){var l=o.getViewport().getBoundingClientRect(),c=d4(this.targetPointers);c[0]-=l.left,c[1]-=l.top,this.anchor_=o.getCoordinateFromPixelInternal(c),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_))}},e.prototype.handleUpEvent=function(t){return!(this.targetPointers.length<2&&(t.map.getView().endInteraction(this.duration_),1))},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1},e}(p4),W4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Y4=function(t){function e(e){var i=this,n=e||{},r=n;return r.stopDown||(r.stopDown=GB),(i=t.call(this,r)||this).anchor_=null,i.duration_=void 0!==n.duration?n.duration:400,i.lastDistance_=void 0,i.lastScaleDelta_=1,i}return W4(e,t),e.prototype.handleDragEvent=function(t){var e=1,i=this.targetPointers[0],n=this.targetPointers[1],r=i.clientX-n.clientX,s=i.clientY-n.clientY,o=Math.sqrt(r*r+s*s);void 0!==this.lastDistance_&&(e=this.lastDistance_/o),this.lastDistance_=o;var a=t.map,l=a.getView();1!=e&&(this.lastScaleDelta_=e);var c=a.getViewport().getBoundingClientRect(),h=d4(this.targetPointers);h[0]-=c.left,h[1]-=c.top,this.anchor_=a.getCoordinateFromPixelInternal(h),a.render(),l.adjustResolutionInternal(e,this.anchor_)},e.prototype.handleUpEvent=function(t){return!(this.targetPointers.length<2&&(t.map.getView().endInteraction(this.duration_,this.lastScaleDelta_>1?1:-1),1))},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1},e}(p4);function Z4(t){var e=t||{},i=new r4,n=new $4(-.005,.05,100);return(void 0===e.altShiftDragRotate||e.altShiftDragRotate)&&i.push(new I4),(void 0===e.doubleClickZoom||e.doubleClickZoom)&&i.push(new h4({delta:e.zoomDelta,duration:e.zoomDuration})),(void 0===e.dragPan||e.dragPan)&&i.push(new k4({onFocusOnly:e.onFocusOnly,kinetic:n})),(void 0===e.pinchRotate||e.pinchRotate)&&i.push(new q4),(void 0===e.pinchZoom||e.pinchZoom)&&i.push(new Y4({duration:e.zoomDuration})),(void 0===e.keyboard||e.keyboard)&&(i.push(new z4),i.push(new j4({delta:e.zoomDelta,duration:e.zoomDuration}))),(void 0===e.mouseWheelZoom||e.mouseWheelZoom)&&i.push(new H4({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(void 0===e.shiftDragZoom||e.shiftDragZoom)&&i.push(new B4({duration:e.zoomDuration})),i}var X4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),K4=function(t){function e(e){var i=t.call(this)||this,n=WB({},e);return\"object\"==typeof e.properties&&(delete n.properties,WB(n,e.properties)),n.opacity=void 0!==e.opacity?e.opacity:1,kN(\"number\"==typeof n.opacity,64),n.visible=void 0===e.visible||e.visible,n.zIndex=e.zIndex,n.maxResolution=void 0!==e.maxResolution?e.maxResolution:1/0,n.minResolution=void 0!==e.minResolution?e.minResolution:0,n.minZoom=void 0!==e.minZoom?e.minZoom:-1/0,n.maxZoom=void 0!==e.maxZoom?e.maxZoom:1/0,i.className_=void 0!==n.className?e.className:\"ol-layer\",delete n.className,i.setProperties(n),i.state_=null,i}return X4(e,t),e.prototype.getClassName=function(){return this.className_},e.prototype.getLayerState=function(t){var e=this.state_||{layer:this,managed:void 0===t||t},i=this.getZIndex();return e.opacity=mz(Math.round(100*this.getOpacity())/100,0,1),e.sourceState=this.getSourceState(),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==i||e.managed?i:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e},e.prototype.getLayersArray=function(t){return JB()},e.prototype.getLayerStatesArray=function(t){return JB()},e.prototype.getExtent=function(){return this.get(\"extent\")},e.prototype.getMaxResolution=function(){return this.get(\"maxResolution\")},e.prototype.getMinResolution=function(){return this.get(\"minResolution\")},e.prototype.getMinZoom=function(){return this.get(\"minZoom\")},e.prototype.getMaxZoom=function(){return this.get(\"maxZoom\")},e.prototype.getOpacity=function(){return this.get(\"opacity\")},e.prototype.getSourceState=function(){return JB()},e.prototype.getVisible=function(){return this.get(\"visible\")},e.prototype.getZIndex=function(){return this.get(\"zIndex\")},e.prototype.setExtent=function(t){this.set(\"extent\",t)},e.prototype.setMaxResolution=function(t){this.set(\"maxResolution\",t)},e.prototype.setMinResolution=function(t){this.set(\"minResolution\",t)},e.prototype.setMaxZoom=function(t){this.set(\"maxZoom\",t)},e.prototype.setMinZoom=function(t){this.set(\"minZoom\",t)},e.prototype.setOpacity=function(t){kN(\"number\"==typeof t,64),this.set(\"opacity\",t)},e.prototype.setVisible=function(t){this.set(\"visible\",t)},e.prototype.setZIndex=function(t){this.set(\"zIndex\",t)},e.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),t.prototype.disposeInternal.call(this)},e}(FV),Q4=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function J4(t,e){if(!t.visible)return!1;var i=e.resolution;if(i<t.minResolution||i>=t.maxResolution)return!1;var n=e.zoom;return n>t.minZoom&&n<=t.maxZoom}var t6=function(t){function e(e){var i=this,n=WB({},e);return delete n.source,(i=t.call(this,n)||this).mapPrecomposeKey_=null,i.mapRenderKey_=null,i.sourceChangeKey_=null,i.renderer_=null,e.render&&(i.render=e.render),e.map&&i.setMap(e.map),i.addChangeListener(\"source\",i.handleSourcePropertyChange_),i.setSource(e.source?e.source:null),i}return Q4(e,t),e.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},e.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},e.prototype.getSource=function(){return this.get(\"source\")||null},e.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():\"undefined\"},e.prototype.handleSourceChange_=function(){this.changed()},e.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(oz(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=rz(t,\"change\",this.handleSourceChange_,this)),this.changed()},e.prototype.getFeatures=function(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(function(t){return t([])})},e.prototype.render=function(t,e){var i=this.getRenderer();if(i.prepareFrame(t))return i.renderFrame(t,e)},e.prototype.setMap=function(t){this.mapPrecomposeKey_&&(oz(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(oz(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=rz(t,\"precompose\",function(t){var e=t.frameState.layerStatesArray,i=this.getLayerState(!1);kN(!e.some(function(t){return t.layer===i.layer}),67),e.push(i)},this),this.mapRenderKey_=rz(this,\"change\",t.render,t),this.changed())},e.prototype.setSource=function(t){this.set(\"source\",t)},e.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},e.prototype.hasRenderer=function(){return!!this.renderer_},e.prototype.createRenderer=function(){return null},e.prototype.disposeInternal=function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),t.prototype.disposeInternal.call(this)},e}(K4),e6=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),i6=function(t){function e(e){var i=this,n=e||{},r=WB({},n);return delete r.preload,delete r.useInterimTilesOnError,(i=t.call(this,r)||this).setPreload(void 0!==n.preload?n.preload:0),i.setUseInterimTilesOnError(void 0===n.useInterimTilesOnError||n.useInterimTilesOnError),i}return e6(e,t),e.prototype.getPreload=function(){return this.get(\"preload\")},e.prototype.setPreload=function(t){this.set(\"preload\",t)},e.prototype.getUseInterimTilesOnError=function(){return this.get(\"useInterimTilesOnError\")},e.prototype.setUseInterimTilesOnError=function(t){this.set(\"useInterimTilesOnError\",t)},e}(t6),n6=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),r6=function(t){function e(e){var i=t.call(this)||this;return i.boundHandleImageChange_=i.handleImageChange_.bind(i),i.layer_=e,i.declutterExecutorGroup=null,i}return n6(e,t),e.prototype.getFeatures=function(t){return JB()},e.prototype.prepareFrame=function(t){return JB()},e.prototype.renderFrame=function(t,e){return JB()},e.prototype.loadedTileCallback=function(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i},e.prototype.createLoadedTileFinder=function(t,e,i){return(function(n,r){var s=this.loadedTileCallback.bind(this,i,n);return t.forEachLoadedTile(e,n,r,s)}).bind(this)},e.prototype.forEachFeatureAtCoordinate=function(t,e,i,n,r){},e.prototype.getDataAtPixel=function(t,e,i){return null},e.prototype.getLayer=function(){return this.layer_},e.prototype.handleFontsChanged=function(){},e.prototype.handleImageChange_=function(t){2===t.target.getState()&&this.renderIfReadyAndVisible()},e.prototype.loadImage=function(t){var e=t.getState();return 2!=e&&3!=e&&t.addEventListener(\"change\",this.boundHandleImageChange_),0==e&&(t.load(),e=t.getState()),2==e},e.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&\"ready\"==t.getSourceState()&&t.changed()},e}(PV),s6=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),o6=function(t){function e(e,i,n,r){var s=t.call(this,e)||this;return s.inversePixelTransform=i,s.frameState=n,s.context=r,s}return s6(e,t),e}(BB),a6=\"ol-hidden\",l6=\"ol-unselectable\",c6=\"ol-control\",h6=\"ol-collapsed\",u6=new RegExp([\"^\\\\s*(?=(?:(?:[-a-z]+\\\\s*){0,2}(italic|oblique))?)\",\"(?=(?:(?:[-a-z]+\\\\s*){0,2}(small-caps))?)\",\"(?=(?:(?:[-a-z]+\\\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)\",\"(?:(?:normal|\\\\1|\\\\2|\\\\3)\\\\s*){0,3}((?:xx?-)?\",\"(?:small|large)|medium|smaller|larger|[\\\\.\\\\d]+(?:\\\\%|in|[cem]m|ex|p[ctx]))\",\"(?:\\\\s*\\\\/\\\\s*(normal|[\\\\.\\\\d]+(?:\\\\%|in|[cem]m|ex|p[ctx])?))\",\"?\\\\s*([-,\\\\\\\"\\\\'\\\\sa-z]+?)\\\\s*$\"].join(\"\"),\"i\"),d6=[\"style\",\"variant\",\"weight\",\"size\",\"lineHeight\",\"family\"],p6=function(t){var e=t.match(u6);if(!e)return null;for(var i={lineHeight:\"normal\",size:\"1.2em\",style:\"normal\",weight:\"normal\",variant:\"normal\"},n=0,r=d6.length;n<r;++n){var s=e[n+1];void 0!==s&&(i[d6[n]]=s)}return i.families=i.family.split(/,\\s?/),i};function f6(t){return 1===t?\"\":String(Math.round(100*t)/100)}var m6=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),g6=function(t){function e(e){var i=t.call(this,e)||this;return i.container=null,i.tempTransform=[1,0,0,1,0,0],i.pixelTransform=[1,0,0,1,0,0],i.inversePixelTransform=[1,0,0,1,0,0],i.context=null,i.containerReused=!1,i}return m6(e,t),e.prototype.useContainer=function(t,e,i){var n,r,s=this.getLayer().getClassName();if(t&&t.style.opacity===f6(i)&&t.className===s&&(o=t.firstElementChild)instanceof HTMLCanvasElement&&(r=o.getContext(\"2d\")),r&&r.canvas.style.transform===e?(this.container=t,this.context=r,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){(n=document.createElement(\"div\")).className=s;var o,a=n.style;a.position=\"absolute\",a.width=\"100%\",a.height=\"100%\",r=gN(),n.appendChild(o=r.canvas),(a=o.style).position=\"absolute\",a.left=\"0\",a.transformOrigin=\"top left\",this.container=n,this.context=r}},e.prototype.clipUnrotated=function(t,e,i){var n=JN(i),r=tz(i),s=WN(i),o=qN(i);P1(e.coordinateToPixelTransform,n),P1(e.coordinateToPixelTransform,r),P1(e.coordinateToPixelTransform,s),P1(e.coordinateToPixelTransform,o);var a=this.inversePixelTransform;P1(a,n),P1(a,r),P1(a,s),P1(a,o),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.clip()},e.prototype.dispatchRenderEvent_=function(t,e,i){var n=this.getLayer();if(n.hasListener(t)){var r=new o6(t,this.inversePixelTransform,i,e);n.dispatchEvent(r)}},e.prototype.preRender=function(t,e){this.dispatchRenderEvent_(\"prerender\",t,e)},e.prototype.postRender=function(t,e){this.dispatchRenderEvent_(\"postrender\",t,e)},e.prototype.getRenderTransform=function(t,e,i,n,r,s,o){var a=n/e;return D1(this.tempTransform,r/2,s/2,a,-a,-i,-t[0]+o,-t[1])},e.prototype.getDataAtPixel=function(t,e,i){var n,r=P1(this.inversePixelTransform,t.slice()),s=this.context,o=this.getLayer().getExtent();if(o&&!ON(o,P1(e.pixelToCoordinateTransform,t.slice())))return null;try{var a=Math.round(r[0]),l=Math.round(r[1]),c=document.createElement(\"canvas\"),h=c.getContext(\"2d\");c.width=1,c.height=1,h.clearRect(0,0,1,1),h.drawImage(s.canvas,a,l,1,1,0,0,1,1),n=h.getImageData(0,0,1,1).data}catch(u){return\"SecurityError\"===u.name?new Uint8Array:n}return 0===n[3]?null:n},e}(r6),A6=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),v6=function(t){function e(e){var i=t.call(this,e)||this;return i.extentChanged=!0,i.renderedExtent_=null,i.renderedProjection=null,i.renderedTiles=[],i.newTiles_=!1,i.tmpExtent=[1/0,1/0,-1/0,-1/0],i.tmpTileRange_=new jV(0,0,0,0),i}return A6(e,t),e.prototype.isDrawableTile=function(t){var e=this.getLayer(),i=t.getState(),n=e.getUseInterimTilesOnError();return 2==i||4==i||3==i&&!n},e.prototype.getTile=function(t,e,i,n){var r=n.pixelRatio,s=n.viewState.projection,o=this.getLayer(),a=o.getSource().getTile(t,e,i,r,s);return 3==a.getState()&&(o.getUseInterimTilesOnError()?o.getPreload()>0&&(this.newTiles_=!0):a.setState(2)),this.isDrawableTile(a)||(a=a.getInterimTile()),a},e.prototype.loadedTileCallback=function(e,i,n){return!!this.isDrawableTile(n)&&t.prototype.loadedTileCallback.call(this,e,i,n)},e.prototype.prepareFrame=function(t){return!!this.getLayer().getSource()},e.prototype.renderFrame=function(t,e){var i=t.layerStatesArray[t.layerIndex],n=t.viewState,r=n.projection,s=n.resolution,o=n.center,a=n.rotation,l=t.pixelRatio,c=this.getLayer(),h=c.getSource(),u=h.getRevision(),d=h.getTileGridForProjection(r),p=d.getZForResolution(s,h.zDirection),f=d.getResolution(p),m=t.extent,g=i.extent&&dV(i.extent);g&&(m=QN(m,dV(i.extent)));var A=h.getTilePixelRatio(l),v=Math.round(t.size[0]*A),_=Math.round(t.size[1]*A);if(a){var y=Math.round(Math.sqrt(v*v+_*_));v=y,_=y}var b=f*v/2/A,w=f*_/2/A,x=[o[0]-b,o[1]-w,o[0]+b,o[1]+w],S=d.getTileRangeForExtentAndZ(m,p),C={};C[p]={};var k=this.createLoadedTileFinder(h,r,C),E=this.tmpExtent,M=this.tmpTileRange_;this.newTiles_=!1;for(var T=S.minX;T<=S.maxX;++T)for(var I=S.minY;I<=S.maxY;++I){var O=this.getTile(p,T,I,t);if(this.isDrawableTile(O)){var P=eN(this);if(2==O.getState()){C[p][O.tileCoord.toString()]=O;var D=O.inTransition(P);!this.newTiles_&&(D||-1===this.renderedTiles.indexOf(O))&&(this.newTiles_=!0)}if(1===O.getAlpha(P,t.time))continue}var R=d.getTileCoordChildTileRange(O.tileCoord,M,E),F=!1;R&&(F=k(p+1,R)),F||d.forEachTileCoordParentTileRange(O.tileCoord,k,M,E)}var L=f/s;D1(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/A,1/A,a,-v/2,-_/2);var B=F1(this.pixelTransform);this.useContainer(e,B,i.opacity);var N=this.context,z=N.canvas;R1(this.inversePixelTransform,this.pixelTransform),D1(this.tempTransform,v/2,_/2,L,L,0,-v/2,-_/2),z.width!=v||z.height!=_?(z.width=v,z.height=_):this.containerReused||N.clearRect(0,0,v,_),g&&this.clipUnrotated(N,t,g),WB(N,h.getContextOptions()),this.preRender(N,t),this.renderedTiles.length=0;var V,j,$,U=Object.keys(C).map(Number);U.sort(NB),1!==i.opacity||this.containerReused&&!h.getOpaque(t.viewState.projection)?(V=[],j=[]):U=U.reverse();for(var H=U.length-1;H>=0;--H){var G=U[H],q=h.getTilePixelSize(G,l,r),W=d.getResolution(G)/f,Y=q[0]*W*L,Z=q[1]*W*L,X=d.getTileCoordForCoordAndZ(JN(x),G),K=d.getTileCoordExtent(X),Q=P1(this.tempTransform,[A*(K[0]-x[0])/f,A*(x[3]-K[3])/f]),J=A*h.getGutterForProjection(r),tt=C[G];for(var et in tt){var it=(O=tt[et]).tileCoord,nt=X[1]-it[1],rt=Math.round(Q[0]-(nt-1)*Y),st=X[2]-it[2],ot=Math.round(Q[1]-(st-1)*Z),at=rt-(T=Math.round(Q[0]-nt*Y)),lt=ot-(I=Math.round(Q[1]-st*Z)),ct=p===G;if(!(D=ct&&1!==O.getAlpha(eN(this),t.time)))if(V){N.save(),$=[T,I,T+at,I,T+at,I+lt,T,I+lt];for(var ht=0,ut=V.length;ht<ut;++ht)if(p!==G&&G<j[ht]){var dt=V[ht];N.beginPath(),N.moveTo($[0],$[1]),N.lineTo($[2],$[3]),N.lineTo($[4],$[5]),N.lineTo($[6],$[7]),N.moveTo(dt[6],dt[7]),N.lineTo(dt[4],dt[5]),N.lineTo(dt[2],dt[3]),N.lineTo(dt[0],dt[1]),N.clip()}V.push($),j.push(G)}else N.clearRect(T,I,at,lt);this.drawTileImage(O,t,T,I,at,lt,J,ct),V&&!D?(N.restore(),this.renderedTiles.unshift(O)):this.renderedTiles.push(O),this.updateUsedTiles(t.usedTiles,h,O)}}this.renderedRevision=u,this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!zN(this.renderedExtent_,x),this.renderedExtent_=x,this.renderedPixelRatio=l,this.renderedProjection=r,this.manageTilePyramid(t,h,d,l,r,m,p,c.getPreload()),this.scheduleExpireCache(t,h),this.postRender(N,t),i.extent&&N.restore(),B!==z.style.transform&&(z.style.transform=B);var pt=f6(i.opacity),ft=this.container;return pt!==ft.style.opacity&&(ft.style.opacity=pt),this.container},e.prototype.drawTileImage=function(t,e,i,n,r,s,o,a){var l=this.getTileImage(t);if(l){var c=eN(this),h=a?t.getAlpha(c,e.time):1,u=h!==this.context.globalAlpha;u&&(this.context.save(),this.context.globalAlpha=h),this.context.drawImage(l,o,o,l.width-2*o,l.height-2*o,i,n,r,s),u&&this.context.restore(),1!==h?e.animate=!0:a&&t.endTransition(c)}},e.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},e.prototype.getTileImage=function(t){return t.getImage()},e.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var i=(function(t,e,i){var n=eN(t);n in i.usedTiles&&t.expireCache(i.viewState.projection,i.usedTiles[n])}).bind(null,e);t.postRenderFunctions.push(i)}},e.prototype.updateUsedTiles=function(t,e,i){var n=eN(e);n in t||(t[n]={}),t[n][i.getKey()]=!0},e.prototype.manageTilePyramid=function(t,e,i,n,r,s,o,a,l){var c=eN(e);c in t.wantedTiles||(t.wantedTiles[c]={});var h,u,d,p,f,m,g=t.wantedTiles[c],A=t.tileQueue,v=0;for(m=i.getMinZoom();m<=o;++m)for(u=i.getTileRangeForExtentAndZ(s,m,u),d=i.getResolution(m),p=u.minX;p<=u.maxX;++p)for(f=u.minY;f<=u.maxY;++f)o-m<=a?(++v,0==(h=e.getTile(m,p,f,n,r)).getState()&&(g[h.getKey()]=!0,A.isKeyQueued(h.getKey())||A.enqueue([h,c,i.getTileCoordCenter(h.tileCoord),d])),void 0!==l&&l(h)):e.useTile(m,p,f,r);e.updateCacheSize(v,r)},e}(g6),_6=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),y6=function(t){function e(e){return t.call(this,e)||this}return _6(e,t),e.prototype.createRenderer=function(){return new v6(this)},e}(i6),b6=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,w6=/^([a-z]*)$|^hsla?\\(.*\\)$/i;function x6(t){return\"string\"==typeof t?t:I6(t)}function S6(t){var e=document.createElement(\"div\");if(e.style.color=t,\"\"!==e.style.color){document.body.appendChild(e);var i=getComputedStyle(e).color;return document.body.removeChild(e),i}return\"\"}var C6,k6,E6=(C6={},k6=0,function(t){var e;if(C6.hasOwnProperty(t))e=C6[t];else{if(k6>=1024){var i=0;for(var n in C6)0==(3&i++)&&(delete C6[n],--k6)}e=function(t){var e,i,n,r,s;if(w6.exec(t)&&(t=S6(t)),b6.exec(t)){var o,a=t.length-1;o=a<=4?1:2;var l=4===a||8===a;e=parseInt(t.substr(1+0*o,o),16),i=parseInt(t.substr(1+1*o,o),16),n=parseInt(t.substr(1+2*o,o),16),r=l?parseInt(t.substr(1+3*o,o),16):255,1==o&&(e=(e<<4)+e,i=(i<<4)+i,n=(n<<4)+n,l&&(r=(r<<4)+r)),s=[e,i,n,r/255]}else 0==t.indexOf(\"rgba(\")?T6(s=t.slice(5,-1).split(\",\").map(Number)):0==t.indexOf(\"rgb(\")?((s=t.slice(4,-1).split(\",\").map(Number)).push(1),T6(s)):kN(!1,14);return s}(t),C6[t]=e,++k6}return e});function M6(t){return Array.isArray(t)?t:E6(t)}function T6(t){return t[0]=mz(t[0]+.5|0,0,255),t[1]=mz(t[1]+.5|0,0,255),t[2]=mz(t[2]+.5|0,0,255),t[3]=mz(t[3],0,1),t}function I6(t){var e=t[0];e!=(0|e)&&(e=e+.5|0);var i=t[1];i!=(0|i)&&(i=i+.5|0);var n=t[2];return n!=(0|n)&&(n=n+.5|0),\"rgba(\"+e+\",\"+i+\",\"+n+\",\"+(void 0===t[3]?1:t[3])+\")\"}function O6(t,e,i){return e+\":\"+t+\":\"+(i?x6(i):\"null\")}var P6=new(function(){function t(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return t.prototype.clear=function(){this.cache_={},this.cacheSize_=0},t.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},t.prototype.expire=function(){if(this.canExpireCache()){var t=0;for(var e in this.cache_)0==(3&t++)&&!this.cache_[e].hasListener()&&(delete this.cache_[e],--this.cacheSize_)}},t.prototype.get=function(t,e,i){var n=O6(t,e,i);return n in this.cache_?this.cache_[n]:null},t.prototype.set=function(t,e,i,n){var r=O6(t,e,i);this.cache_[r]=n,++this.cacheSize_},t.prototype.setSize=function(t){this.maxCacheSize_=t,this.expire()},t}()),D6=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function R6(t,e){P6.expire()}var F6=function(t){function e(e){var i=t.call(this)||this;return i.map_=e,i}return D6(e,t),e.prototype.dispatchRenderEvent=function(t,e){JB()},e.prototype.calculateMatrices2D=function(t){var e=t.viewState,i=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;D1(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),R1(n,i)},e.prototype.forEachFeatureAtCoordinate=function(t,e,i,n,r,s,o,a){var l,c=e.viewState;function h(t,e,i,n){return r.call(s,e,t?i:null,n)}var u=c.projection,d=Cj(t.slice(),u),p=[[0,0]];if(u.canWrapX()&&n){var f=ez(u.getExtent());p.push([-f,0],[f,0])}for(var m=e.layerStatesArray,g=m.length,A=[],v=[],_=0;_<p.length;_++)for(var y=g-1;y>=0;--y){var b=m[y],w=b.layer;if(w.hasRenderer()&&J4(b,c)&&o.call(a,w)){var x=w.getRenderer(),S=w.getSource();if(x&&S){var C=S.getWrapX()?d:t,k=h.bind(null,b.managed);v[0]=C[0]+p[_][0],v[1]=C[1]+p[_][1],l=x.forEachFeatureAtCoordinate(v,e,i,k,A)}if(l)return l}}if(0!==A.length){var E=1/A.length;return A.forEach(function(t,e){return t.distanceSq+=e*E}),A.sort(function(t,e){return t.distanceSq-e.distanceSq}),A.some(function(t){return l=t.callback(t.feature,t.layer,t.geometry)}),l}},e.prototype.forEachLayerAtPixel=function(t,e,i,n,r){return JB()},e.prototype.hasFeatureAtCoordinate=function(t,e,i,n,r,s){return void 0!==this.forEachFeatureAtCoordinate(t,e,i,n,HB,this,r,s)},e.prototype.getMap=function(){return this.map_},e.prototype.renderFrame=function(t){JB()},e.prototype.scheduleExpireIconCache=function(t){P6.canExpireCache()&&t.postRenderFunctions.push(R6)},e}(LB),L6=\"10px sans-serif\",B6=\"#000\",N6=\"round\",z6=[],V6=\"round\",j6=\"#000\",$6=\"center\",U6=\"middle\",H6=[0,0,0,0],G6=new FV;(new QB).setSize=function(){console.warn(\"labelCache is deprecated.\")};var q6,W6=null,Y6={},Z6=function(){var t,e,i=\"32px \",n=[\"monospace\",\"serif\"],r=n.length,s=\"wmytzilWMYTZIL@#/&?$%10\\uf013\";function o(t,o,a){for(var l=!0,c=0;c<r;++c){var h=n[c];if(e=Q6(t+\" \"+o+\" \"+i+h,s),a!=h){var u=Q6(t+\" \"+o+\" \"+i+a+\",\"+h,s);l=l&&u!=e}}return!!l}function a(){for(var e=!0,i=G6.getKeys(),n=0,r=i.length;n<r;++n){var s=i[n];G6.get(s)<100&&(o.apply(this,s.split(\"\\n\"))?(YB(Y6),W6=null,q6=void 0,G6.set(s,100)):(G6.set(s,G6.get(s)+1,!0),e=!1))}e&&(clearInterval(t),t=void 0)}return function(e){var i=p6(e);if(i)for(var n=i.families,r=0,s=n.length;r<s;++r){var l=n[r],c=i.style+\"\\n\"+i.weight+\"\\n\"+l;void 0===G6.get(c)&&(G6.set(c,100,!0),o(i.style,i.weight,l)||(G6.set(c,0,!0),void 0===t&&(t=setInterval(a,32))))}}}(),X6=function(){var t;return function(e){var i=Y6[e];if(null==i){if(pN){var n=p6(e),r=K6(e,\"\\u017dg\");i=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else t||((t=document.createElement(\"div\")).innerHTML=\"M\",t.style.minHeight=\"0\",t.style.maxHeight=\"none\",t.style.height=\"auto\",t.style.padding=\"0\",t.style.border=\"none\",t.style.position=\"absolute\",t.style.display=\"block\",t.style.left=\"-99999px\"),t.style.font=e,document.body.appendChild(t),i=t.offsetHeight,document.body.removeChild(t);Y6[e]=i}return i}}();function K6(t,e){return W6||(W6=gN(1,1)),t!=q6&&(W6.font=t,q6=W6.font),W6.measureText(e)}function Q6(t,e){return K6(t,e).width}function J6(t,e,i){if(e in i)return i[e];var n=Q6(t,e);return i[e]=n,n}var t8=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),e8=function(t){function e(e){var i=t.call(this,e)||this;i.fontChangeListenerKey_=rz(G6,\"propertychange\",e.redrawText.bind(e)),i.element_=document.createElement(\"div\");var n=i.element_.style;n.position=\"absolute\",n.width=\"100%\",n.height=\"100%\",n.zIndex=\"0\",i.element_.className=l6+\" ol-layers\";var r=e.getViewport();return r.insertBefore(i.element_,r.firstChild||null),i.children_=[],i.renderedVisible_=!0,i}return t8(e,t),e.prototype.dispatchRenderEvent=function(t,e){var i=this.getMap();if(i.hasListener(t)){var n=new o6(t,void 0,e);i.dispatchEvent(n)}},e.prototype.disposeInternal=function(){oz(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),t.prototype.disposeInternal.call(this)},e.prototype.renderFrame=function(t){if(t){this.calculateMatrices2D(t),this.dispatchRenderEvent(\"precompose\",t);var e=t.layerStatesArray.sort(function(t,e){return t.zIndex-e.zIndex}),i=t.viewState;this.children_.length=0;for(var n=[],r=null,s=0,o=e.length;s<o;++s){var a=e[s];if(t.layerIndex=s,J4(a,i)&&(\"ready\"==a.sourceState||\"undefined\"==a.sourceState)){var l=a.layer,c=l.render(t,r);!c||(c!==r&&(this.children_.push(c),r=c),\"getDeclutter\"in l&&n.push(l))}}for(s=n.length-1;s>=0;--s)n[s].renderDeclutter(t);(function(t,e){for(var i=t.childNodes,n=0;;++n){var r=i[n],s=e[n];if(!r&&!s)break;if(r!==s){if(!r){t.appendChild(s);continue}if(!s){t.removeChild(r),--n;continue}t.insertBefore(s,r)}}})(this.element_,this.children_),this.dispatchRenderEvent(\"postcompose\",t),this.renderedVisible_||(this.element_.style.display=\"\",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}else this.renderedVisible_&&(this.element_.style.display=\"none\",this.renderedVisible_=!1)},e.prototype.forEachLayerAtPixel=function(t,e,i,n,r){for(var s=e.viewState,o=e.layerStatesArray,a=o.length-1;a>=0;--a){var l=o[a],c=l.layer;if(c.hasRenderer()&&J4(l,s)&&r(c)){var h=c.getRenderer().getDataAtPixel(t,e,i);if(h){var u=n(c,h);if(u)return u}}}},e}(F6),i8=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),n8=function(t){function e(e){var i=this,n=e||{},r=WB({},n);delete r.layers;var s=n.layers;return(i=t.call(this,r)||this).layersListenerKeys_=[],i.listenerKeys_={},i.addChangeListener(\"layers\",i.handleLayersChanged_),s?Array.isArray(s)?s=new r4(s.slice(),{unique:!0}):kN(\"function\"==typeof s.getArray,43):s=new r4(void 0,{unique:!0}),i.setLayers(s),i}return i8(e,t),e.prototype.handleLayerChange_=function(){this.changed()},e.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(oz),this.layersListenerKeys_.length=0;var t=this.getLayers();for(var e in this.layersListenerKeys_.push(rz(t,\"add\",this.handleLayersAdd_,this),rz(t,\"remove\",this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[e].forEach(oz);YB(this.listenerKeys_);for(var i=t.getArray(),n=0,r=i.length;n<r;n++){var s=i[n];this.listenerKeys_[eN(s)]=[rz(s,\"propertychange\",this.handleLayerChange_,this),rz(s,\"change\",this.handleLayerChange_,this)]}this.changed()},e.prototype.handleLayersAdd_=function(t){var e=t.element;this.listenerKeys_[eN(e)]=[rz(e,\"propertychange\",this.handleLayerChange_,this),rz(e,\"change\",this.handleLayerChange_,this)],this.changed()},e.prototype.handleLayersRemove_=function(t){var e=eN(t.element);this.listenerKeys_[e].forEach(oz),delete this.listenerKeys_[e],this.changed()},e.prototype.getLayers=function(){return this.get(\"layers\")},e.prototype.setLayers=function(t){this.set(\"layers\",t)},e.prototype.getLayersArray=function(t){var e=void 0!==t?t:[];return this.getLayers().forEach(function(t){t.getLayersArray(e)}),e},e.prototype.getLayerStatesArray=function(t){var e=void 0!==t?t:[],i=e.length;this.getLayers().forEach(function(t){t.getLayerStatesArray(e)});var n=this.getLayerState(),r=n.zIndex;!t&&void 0===n.zIndex&&(r=0);for(var s=i,o=e.length;s<o;s++){var a=e[s];a.opacity*=n.opacity,a.visible=a.visible&&n.visible,a.maxResolution=Math.min(a.maxResolution,n.maxResolution),a.minResolution=Math.max(a.minResolution,n.minResolution),a.minZoom=Math.max(a.minZoom,n.minZoom),a.maxZoom=Math.min(a.maxZoom,n.maxZoom),void 0!==n.extent&&(a.extent=void 0!==a.extent?QN(a.extent,n.extent):n.extent),void 0===a.zIndex&&(a.zIndex=r)}return e},e.prototype.getSourceState=function(){return\"ready\"},e}(K4),r8=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),s8=function(t){function e(e,i,n){var r=t.call(this,e)||this;return r.map=i,r.frameState=void 0!==n?n:null,r}return r8(e,t),e}(BB),o8=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),a8=function(t){function e(e,i,n,r,s){var o=t.call(this,e,i,s)||this;return o.originalEvent=n,o.pixel_=null,o.coordinate_=null,o.dragging=void 0!==r&&r,o}return o8(e,t),Object.defineProperty(e.prototype,\"pixel\",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(t){this.pixel_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"coordinate\",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(t){this.coordinate_=t},enumerable:!1,configurable:!0}),e.prototype.preventDefault=function(){t.prototype.preventDefault.call(this),\"preventDefault\"in this.originalEvent&&this.originalEvent.preventDefault()},e.prototype.stopPropagation=function(){t.prototype.stopPropagation.call(this),\"stopPropagation\"in this.originalEvent&&this.originalEvent.stopPropagation()},e}(s8),l8=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),c8=function(t){function e(e,i){var n=t.call(this,e)||this;n.map_=e,n.emulateClicks_=!1,n.dragging_=!1,n.dragListenerKeys_=[],n.moveTolerance_=void 0===i?1:i,n.down_=null;var r=n.map_.getViewport();return n.activePointers_=0,n.trackedTouches_={},n.element_=r,n.pointerdownListenerKey_=rz(r,\"pointerdown\",n.handlePointerDown_,n),n.relayedListenerKey_=rz(r,\"pointermove\",n.relayEvent_,n),n.boundHandleTouchMove_=n.handleTouchMove_.bind(n),n.element_.addEventListener(\"touchmove\",n.boundHandleTouchMove_,!!mN&&{passive:!1}),n}return l8(e,t),e.prototype.emulateClick_=function(t){var e=new a8(l4.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new a8(l4.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout((function(){this.clickTimeoutId_=void 0;var e=new a8(l4.SINGLECLICK,this.map_,t);this.dispatchEvent(e)}).bind(this),250)},e.prototype.updateActivePointers_=function(t){var e=t;e.type==l4.POINTERUP||e.type==l4.POINTERCANCEL?delete this.trackedTouches_[e.pointerId]:e.type==l4.POINTERDOWN&&(this.trackedTouches_[e.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},e.prototype.handlePointerUp_=function(t){this.updateActivePointers_(t);var e=new a8(l4.POINTERUP,this.map_,t);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(oz),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},e.prototype.isMouseActionButton_=function(t){return 0===t.button},e.prototype.handlePointerDown_=function(t){this.emulateClicks_=0===this.activePointers_,this.updateActivePointers_(t);var e=new a8(l4.POINTERDOWN,this.map_,t);for(var i in this.dispatchEvent(e),this.down_={},t){var n=t[i];this.down_[i]=\"function\"==typeof n?qB:n}if(0===this.dragListenerKeys_.length){var r=this.map_.getOwnerDocument();this.dragListenerKeys_.push(rz(r,l4.POINTERMOVE,this.handlePointerMove_,this),rz(r,l4.POINTERUP,this.handlePointerUp_,this),rz(this.element_,l4.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==r&&this.dragListenerKeys_.push(rz(this.element_.getRootNode(),l4.POINTERUP,this.handlePointerUp_,this))}},e.prototype.handlePointerMove_=function(t){if(this.isMoving_(t)){this.dragging_=!0;var e=new a8(l4.POINTERDRAG,this.map_,t,this.dragging_);this.dispatchEvent(e)}},e.prototype.relayEvent_=function(t){this.originalPointerMoveEvent_=t;var e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new a8(t.type,this.map_,t,e))},e.prototype.handleTouchMove_=function(t){var e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(\"boolean\"!=typeof t.cancelable||!0===t.cancelable)&&t.preventDefault()},e.prototype.isMoving_=function(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_},e.prototype.disposeInternal=function(){this.relayedListenerKey_&&(oz(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(\"touchmove\",this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(oz(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(oz),this.dragListenerKeys_.length=0,this.element_=null,t.prototype.disposeInternal.call(this)},e}(QB),h8=1/0,u8=function(){function t(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return t.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,YB(this.queuedElements_)},t.prototype.dequeue=function(){var t=this.elements_,e=this.priorities_,i=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));var n=this.keyFunction_(i);return delete this.queuedElements_[n],i},t.prototype.enqueue=function(t){kN(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);return e!=h8&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},t.prototype.getCount=function(){return this.elements_.length},t.prototype.getLeftChildIndex_=function(t){return 2*t+1},t.prototype.getRightChildIndex_=function(t){return 2*t+2},t.prototype.getParentIndex_=function(t){return t-1>>1},t.prototype.heapify_=function(){var t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)},t.prototype.isEmpty=function(){return 0===this.elements_.length},t.prototype.isKeyQueued=function(t){return t in this.queuedElements_},t.prototype.isQueued=function(t){return this.isKeyQueued(this.keyFunction_(t))},t.prototype.siftUp_=function(t){for(var e=this.elements_,i=this.priorities_,n=e.length,r=e[t],s=i[t],o=t;t<n>>1;){var a=this.getLeftChildIndex_(t),l=this.getRightChildIndex_(t),c=l<n&&i[l]<i[a]?l:a;e[t]=e[c],i[t]=i[c],t=c}e[t]=r,i[t]=s,this.siftDown_(o,t)},t.prototype.siftDown_=function(t,e){for(var i=this.elements_,n=this.priorities_,r=i[e],s=n[e];e>t;){var o=this.getParentIndex_(e);if(!(n[o]>s))break;i[e]=i[o],n[e]=n[o],e=o}i[e]=r,n[e]=s},t.prototype.reprioritize=function(){var t,e,i,n=this.priorityFunction_,r=this.elements_,s=this.priorities_,o=0,a=r.length;for(e=0;e<a;++e)(i=n(t=r[e]))==h8?delete this.queuedElements_[this.keyFunction_(t)]:(s[o]=i,r[o++]=t);r.length=o,s.length=o,this.heapify_()},t}(),d8=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),p8=function(t){function e(e,i){var n=t.call(this,function(t){return e.apply(null,t)},function(t){return t[0].getKey()})||this;return n.boundHandleTileChange_=n.handleTileChange.bind(n),n.tileChangeCallback_=i,n.tilesLoading_=0,n.tilesLoadingKeys_={},n}return d8(e,t),e.prototype.enqueue=function(e){var i=t.prototype.enqueue.call(this,e);return i&&e[0].addEventListener(\"change\",this.boundHandleTileChange_),i},e.prototype.getTilesLoading=function(){return this.tilesLoading_},e.prototype.handleTileChange=function(t){var e=t.target,i=e.getState();if(2===i||3===i||4===i){e.removeEventListener(\"change\",this.boundHandleTileChange_);var n=e.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}},e.prototype.loadMoreTiles=function(t,e){for(var i,n,r=0;this.tilesLoading_<t&&r<e&&this.getCount()>0;)n=(i=this.dequeue()[0]).getKey(),0===i.getState()&&!(n in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[n]=!0,++this.tilesLoading_,++r,i.load())},e}(u8);function f8(t,e,i){return function(n,r,s,o,a){if(n){var l=e?0:s[0]*r,c=e?0:s[1]*r,h=a?a[0]:0,u=a?a[1]:0,d=t[0]+l/2+h,p=t[2]-l/2+h,f=t[1]+c/2+u,m=t[3]-c/2+u;d>p&&(p=d=(p+d)/2),f>m&&(m=f=(m+f)/2);var g=mz(n[0],d,p),A=mz(n[1],f,m),v=30*r;return o&&i&&(g+=-v*Math.log(1+Math.max(0,d-n[0])/v)+v*Math.log(1+Math.max(0,n[0]-p)/v),A+=-v*Math.log(1+Math.max(0,f-n[1])/v)+v*Math.log(1+Math.max(0,n[1]-m)/v)),[g,A]}}}function m8(t){return t}function g8(t,e,i,n){var r=ez(e)/i[0],s=KN(e)/i[1];return n?Math.min(t,Math.max(r,s)):Math.min(t,Math.min(r,s))}function A8(t,e,i){var n=Math.min(t,e);return n*=Math.log(1+50*Math.max(0,t/e-1))/50+1,i&&(n=Math.max(n,i),n/=Math.log(1+50*Math.max(0,i/t-1))/50+1),mz(n,i/2,2*e)}function v8(t,e,i,n,r){return function(s,o,a,l){if(void 0!==s){var c=n?g8(t,n,a,r):t;return(void 0===i||i)&&l?A8(s,c,e):mz(s,e,c)}}}var _8=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function y8(t,e){setTimeout(function(){t(e)},0)}function b8(t){return!(t.sourceCenter&&t.targetCenter&&!_j(t.sourceCenter,t.targetCenter)||t.sourceResolution!==t.targetResolution||t.sourceRotation!==t.targetRotation)}function w8(t,e,i,n,r){var s=Math.cos(-r),o=Math.sin(-r),a=t[0]*s-t[1]*o,l=t[1]*s+t[0]*o;return[(a+=(e[0]/2-i[0])*n)*s-(l+=(i[1]-e[1]/2)*n)*(o=-o),l*s+a*o]}var x8=function(t){function e(e){var i=t.call(this)||this,n=WB({},e);return i.hints_=[0,0],i.animations_=[],i.projection_=Kz(n.projection,\"EPSG:3857\"),i.viewportSize_=[100,100],i.targetCenter_=null,i.nextCenter_=null,i.cancelAnchor_=void 0,n.center&&(n.center=hV(n.center)),n.extent&&(n.extent=dV(n.extent)),i.applyOptions_(n),i}return _8(e,t),e.prototype.applyOptions_=function(t){var e=function(t){var e,i,n,r=void 0!==t.minZoom?t.minZoom:0,s=void 0!==t.maxZoom?t.maxZoom:28,o=void 0!==t.zoomFactor?t.zoomFactor:2,a=void 0!==t.multiWorld&&t.multiWorld,l=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint,c=void 0!==t.showFullExtent&&t.showFullExtent,h=Kz(t.projection,\"EPSG:3857\"),u=h.getExtent(),d=t.constrainOnlyCenter,p=t.extent;if(!a&&!p&&h.isGlobal()&&(d=!1,p=u),void 0!==t.resolutions){var f=t.resolutions;i=f[r],n=void 0!==f[s]?f[s]:f[f.length-1],e=t.constrainResolution?function(t,e,i,n){return function(r,s,o,a){if(void 0!==r){var l=t[0],c=t[t.length-1],h=i?g8(l,i,o,n):l;if(a)return void 0===e||e?A8(r,h,c):mz(r,c,h);var u=Math.min(h,r),d=Math.floor(VB(t,u,s));return t[d]>h&&d<t.length-1?t[d+1]:t[d]}}}(f,l,!d&&p,c):v8(i,n,l,!d&&p,c)}else{var m=(u?Math.max(ez(u),KN(u)):360*dz[pz.DEGREES]/h.getMetersPerUnit())/256/Math.pow(2,0),g=m/Math.pow(2,28);void 0!==(i=t.maxResolution)?r=0:i=m/Math.pow(o,r),void 0===(n=t.minResolution)&&(n=void 0!==t.maxZoom?void 0!==t.maxResolution?i/Math.pow(o,s):m/Math.pow(o,s):g),s=r+Math.floor(Math.log(i/n)/Math.log(o)),n=i/Math.pow(o,s-r),e=t.constrainResolution?function(t,e,i,n,r,s){return function(o,a,l,c){if(void 0!==o){var h=r?g8(e,r,l,s):e,u=void 0!==i?i:0;if(c)return void 0===n||n?A8(o,h,u):mz(o,u,h);var d=Math.ceil(Math.log(e/h)/Math.log(t)-1e-9),p=-a*(.5-1e-9)+.5,f=Math.min(h,o),m=Math.floor(Math.log(e/f)/Math.log(t)+p),g=Math.max(d,m);return mz(e/Math.pow(t,g),u,h)}}}(o,i,n,l,!d&&p,c):v8(i,n,l,!d&&p,c)}return{constraint:e,maxResolution:i,minResolution:n,minZoom:r,zoomFactor:o}}(t);this.maxResolution_=e.maxResolution,this.minResolution_=e.minResolution,this.zoomFactor_=e.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=e.minZoom;var i=function(t){if(void 0!==t.extent)return f8(t.extent,t.constrainOnlyCenter,void 0===t.smoothExtentConstraint||t.smoothExtentConstraint);var e=Kz(t.projection,\"EPSG:3857\");if(!0!==t.multiWorld&&e.isGlobal()){var i=e.getExtent().slice();return i[0]=-1/0,i[2]=1/0,f8(i,!1,!1)}return m8}(t),n=e.constraint,r=function(t){if(void 0===t.enableRotation||t.enableRotation){var e=t.constrainRotation;return void 0===e||!0===e?function(t){var e=bz(5);return function(t,i){return i?t:void 0!==t?Math.abs(t)<=e?0:t:void 0}}():!1===e?M4:\"number\"==typeof e?function(t){var e=2*Math.PI/t;return function(t,i){return i?t:void 0!==t?t=Math.floor(t/e+.5)*e:void 0}}(e):M4}return E4}(t);this.constraints_={center:i,resolution:n,rotation:r},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom),this.setProperties({}),this.options_=t},Object.defineProperty(e.prototype,\"padding\",{get:function(){return this.padding_},set:function(t){var e=this.padding_;this.padding_=t;var i=this.getCenter();if(i){var n=t||[0,0,0,0];e=e||[0,0,0,0];var r=this.getResolution();this.setCenterInternal([i[0]+r/2*(n[3]-e[3]+e[1]-n[1]),i[1]-r/2*(n[0]-e[0]+e[2]-n[2])])}},enumerable:!1,configurable:!0}),e.prototype.getUpdatedOptions_=function(t){var e=WB({},this.options_);return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),WB({},e,t)},e.prototype.animate=function(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var e=new Array(arguments.length),i=0;i<e.length;++i){var n=arguments[i];n.center&&((n=WB({},n)).center=hV(n.center,this.getProjection())),n.anchor&&((n=WB({},n)).anchor=hV(n.anchor,this.getProjection())),e[i]=n}this.animateInternal.apply(this,e)},e.prototype.animateInternal=function(t){var e,i=arguments.length;i>1&&\"function\"==typeof arguments[i-1]&&(e=arguments[i-1],--i);for(var n=0;n<i&&!this.isDef();++n){var r=arguments[n];r.center&&this.setCenterInternal(r.center),void 0!==r.zoom?this.setZoom(r.zoom):r.resolution&&this.setResolution(r.resolution),void 0!==r.rotation&&this.setRotation(r.rotation)}if(n!==i){for(var s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_,c=[];n<i;++n){var h=arguments[n],u={start:s,complete:!1,anchor:h.anchor,duration:void 0!==h.duration?h.duration:1e3,easing:h.easing||rN,callback:e};if(h.center&&(u.sourceCenter=o,u.targetCenter=h.center.slice(),o=u.targetCenter),void 0!==h.zoom?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(h.zoom),a=u.targetResolution):h.resolution&&(u.sourceResolution=a,u.targetResolution=h.resolution,a=u.targetResolution),void 0!==h.rotation){u.sourceRotation=l;var d=wz(h.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}b8(u)?u.complete=!0:s+=u.duration,c.push(u)}this.animations_.push(c),this.setHint(0,1),this.updateAnimations_()}else e&&y8(e,!0)},e.prototype.getAnimating=function(){return this.hints_[0]>0},e.prototype.getInteracting=function(){return this.hints_[1]>0},e.prototype.cancelAnimations=function(){this.setHint(0,-this.hints_[0]);for(var t,e=0,i=this.animations_.length;e<i;++e){var n=this.animations_[e];if(n[0].callback&&y8(n[0].callback,!1),!t)for(var r=0,s=n.length;r<s;++r){var o=n[r];if(!o.complete){t=o.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN},e.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var t=Date.now(),e=!1,i=this.animations_.length-1;i>=0;--i){for(var n=this.animations_[i],r=!0,s=0,o=n.length;s<o;++s){var a=n[s];if(!a.complete){var l=a.duration>0?(t-a.start)/a.duration:1;l>=1?(a.complete=!0,l=1):r=!1;var c=a.easing(l);if(a.sourceCenter){var h=a.sourceCenter[0],u=a.sourceCenter[1],d=a.targetCenter[0],p=a.targetCenter[1];this.nextCenter_=a.targetCenter,this.targetCenter_=[h+c*(d-h),u+c*(p-u)]}if(a.sourceResolution&&a.targetResolution){var f=1===c?a.targetResolution:a.sourceResolution+c*(a.targetResolution-a.sourceResolution);if(a.anchor){var m=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(f,0,m,!0);this.targetCenter_=this.calculateCenterZoom(g,a.anchor)}this.nextResolution_=a.targetResolution,this.targetResolution_=f,this.applyTargetState_(!0)}if(void 0!==a.sourceRotation&&void 0!==a.targetRotation){var A=1===c?wz(a.targetRotation+Math.PI,2*Math.PI)-Math.PI:a.sourceRotation+c*(a.targetRotation-a.sourceRotation);if(a.anchor){var v=this.constraints_.rotation(A,!0);this.targetCenter_=this.calculateCenterRotate(v,a.anchor)}this.nextRotation_=a.targetRotation,this.targetRotation_=A}if(this.applyTargetState_(!0),e=!0,!a.complete)break}}if(r){this.animations_[i]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;var _=n[0].callback;_&&y8(_,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}},e.prototype.calculateCenterRotate=function(t,e){var i,n=this.getCenterInternal();return void 0!==n&&(yj(i=[n[0]-e[0],n[1]-e[1]],t-this.getRotation()),function(t,e){t[0]+=+e[0],t[1]+=+e[1]}(i,e)),i},e.prototype.calculateCenterZoom=function(t,e){var i,n=this.getCenterInternal(),r=this.getResolution();return void 0!==n&&void 0!==r&&(i=[e[0]-t*(e[0]-n[0])/r,e[1]-t*(e[1]-n[1])/r]),i},e.prototype.getViewportSize_=function(t){var e=this.viewportSize_;if(t){var i=e[0],n=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(n*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(n*Math.cos(t))]}return e},e.prototype.setViewportSize=function(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)},e.prototype.getCenter=function(){var t=this.getCenterInternal();return t&&aV(t,this.getProjection())},e.prototype.getCenterInternal=function(){return this.get(\"center\")},e.prototype.getConstraints=function(){return this.constraints_},e.prototype.getConstrainResolution=function(){return this.options_.constrainResolution},e.prototype.getHints=function(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()},e.prototype.calculateExtent=function(t){return uV(this.calculateExtentInternal(t),this.getProjection())},e.prototype.calculateExtentInternal=function(t){var e=t||this.getViewportSizeMinusPadding_(),i=this.getCenterInternal();kN(i,1);var n=this.getResolution();kN(void 0!==n,2);var r=this.getRotation();return kN(void 0!==r,3),XN(i,n,r,e)},e.prototype.getMaxResolution=function(){return this.maxResolution_},e.prototype.getMinResolution=function(){return this.minResolution_},e.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},e.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))},e.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},e.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))},e.prototype.setConstrainResolution=function(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))},e.prototype.getProjection=function(){return this.projection_},e.prototype.getResolution=function(){return this.get(\"resolution\")},e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.getResolutionForExtent=function(t,e){return this.getResolutionForExtentInternal(dV(t,this.getProjection()),e)},e.prototype.getResolutionForExtentInternal=function(t,e){var i=e||this.getViewportSizeMinusPadding_(),n=ez(t)/i[0],r=KN(t)/i[1];return Math.max(n,r)},e.prototype.getResolutionForValueFunction=function(t){var e=t||2,i=this.getConstrainedResolution(this.maxResolution_),n=Math.log(i/this.minResolution_)/Math.log(e);return function(t){return i/Math.pow(e,t*n)}},e.prototype.getRotation=function(){return this.get(\"rotation\")},e.prototype.getValueForResolutionFunction=function(t){var e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),n=Math.log(i/this.minResolution_)/e;return function(t){return Math.log(i/t)/e/n}},e.prototype.getViewportSizeMinusPadding_=function(t){var e=this.getViewportSize_(t),i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e},e.prototype.getState=function(){var t=this.getProjection(),e=this.getResolution(),i=this.getRotation(),n=this.getCenterInternal(),r=this.padding_;if(r){var s=this.getViewportSizeMinusPadding_();n=w8(n,this.getViewportSize_(),[s[0]/2+r[3],s[1]/2+r[0]],e,i)}return{center:n.slice(0),projection:void 0!==t?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}},e.prototype.getZoom=function(){var t,e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t},e.prototype.getZoomForResolution=function(t){var e,i,n=this.minZoom_||0;if(this.resolutions_){var r=VB(this.resolutions_,t,1);n=r,e=this.resolutions_[r],i=r==this.resolutions_.length-1?2:e/this.resolutions_[r+1]}else e=this.maxResolution_,i=this.zoomFactor_;return n+Math.log(e/t)/Math.log(i)},e.prototype.getResolutionForZoom=function(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var e=mz(Math.floor(t),0,this.resolutions_.length-2);return this.resolutions_[e]/Math.pow(this.resolutions_[e]/this.resolutions_[e+1],mz(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)},e.prototype.fit=function(t,e){var i;if(kN(Array.isArray(t)||\"function\"==typeof t.getSimplifiedGeometry,24),Array.isArray(t))kN(!nz(t),25),i=H2(n=dV(t,this.getProjection()));else if(\"Circle\"===t.getType()){var n;(i=H2(n=dV(t.getExtent(),this.getProjection()))).rotate(this.getRotation(),YN(n))}else{var r=oV();i=r?t.clone().transform(r,this.getProjection()):t}this.fitInternal(i,e)},e.prototype.rotatedExtentForGeometry=function(t){for(var e=this.getRotation(),i=Math.cos(e),n=Math.sin(-e),r=t.getFlatCoordinates(),s=t.getStride(),o=1/0,a=1/0,l=-1/0,c=-1/0,h=0,u=r.length;h<u;h+=s){var d=r[h]*i-r[h+1]*n,p=r[h]*n+r[h+1]*i;o=Math.min(o,d),a=Math.min(a,p),l=Math.max(l,d),c=Math.max(c,p)}return[o,a,l,c]},e.prototype.fitInternal=function(t,e){var i=e||{},n=i.size;n||(n=this.getViewportSizeMinusPadding_());var r,s=void 0!==i.padding?i.padding:[0,0,0,0],o=void 0!==i.nearest&&i.nearest;r=void 0!==i.minResolution?i.minResolution:void 0!==i.maxZoom?this.getResolutionForZoom(i.maxZoom):0;var a=this.rotatedExtentForGeometry(t),l=this.getResolutionForExtentInternal(a,[n[0]-s[1]-s[3],n[1]-s[0]-s[2]]);l=isNaN(l)?r:Math.max(l,r),l=this.getConstrainedResolution(l,o?0:1);var c=this.getRotation(),h=Math.sin(c),u=Math.cos(c),d=YN(a);d[0]+=(s[1]-s[3])/2*l,d[1]+=(s[0]-s[2])/2*l;var p=this.getConstrainedCenter([d[0]*u-d[1]*h,d[1]*u+d[0]*h],l),f=i.callback?i.callback:qB;void 0!==i.duration?this.animateInternal({resolution:l,center:p,duration:i.duration,easing:i.easing},f):(this.targetResolution_=l,this.targetCenter_=p,this.applyTargetState_(!1,!0),y8(f,!0))},e.prototype.centerOn=function(t,e,i){this.centerOnInternal(hV(t,this.getProjection()),e,i)},e.prototype.centerOnInternal=function(t,e,i){this.setCenterInternal(w8(t,e,i,this.getResolution(),this.getRotation()))},e.prototype.calculateCenterShift=function(t,e,i,n){var r,s=this.padding_;if(s&&t){var o=this.getViewportSizeMinusPadding_(-i),a=w8(t,n,[o[0]/2+s[3],o[1]/2+s[0]],e,i);r=[t[0]-a[0],t[1]-a[1]]}return r},e.prototype.isDef=function(){return!!this.getCenterInternal()&&void 0!==this.getResolution()},e.prototype.adjustCenter=function(t){var e=aV(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])},e.prototype.adjustCenterInternal=function(t){var e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])},e.prototype.adjustResolution=function(t,e){var i=e&&hV(e,this.getProjection());this.adjustResolutionInternal(t,i)},e.prototype.adjustResolutionInternal=function(t,e){var i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,n,i);e&&(this.targetCenter_=this.calculateCenterZoom(r,e)),this.targetResolution_*=t,this.applyTargetState_()},e.prototype.adjustZoom=function(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)},e.prototype.adjustRotation=function(t,e){e&&(e=hV(e,this.getProjection())),this.adjustRotationInternal(t,e)},e.prototype.adjustRotationInternal=function(t,e){var i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(n,e)),this.targetRotation_+=t,this.applyTargetState_()},e.prototype.setCenter=function(t){this.setCenterInternal(hV(t,this.getProjection()))},e.prototype.setCenterInternal=function(t){this.targetCenter_=t,this.applyTargetState_()},e.prototype.setHint=function(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]},e.prototype.setResolution=function(t){this.targetResolution_=t,this.applyTargetState_()},e.prototype.setRotation=function(t){this.targetRotation_=t,this.applyTargetState_()},e.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))},e.prototype.applyTargetState_=function(t,e){var i=this.getAnimating()||this.getInteracting()||e,n=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(n),s=this.constraints_.resolution(this.targetResolution_,0,r,i),o=this.constraints_.center(this.targetCenter_,s,r,i,this.calculateCenterShift(this.targetCenter_,s,n,r));this.get(\"rotation\")!==n&&this.set(\"rotation\",n),this.get(\"resolution\")!==s&&this.set(\"resolution\",s),(!this.get(\"center\")||!_j(this.get(\"center\"),o))&&this.set(\"center\",o),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0},e.prototype.resolveConstraints=function(t,e,i){var n=void 0!==t?t:200,r=e||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,r,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(0===n&&!this.cancelAnchor_)return this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,void this.applyTargetState_();var c=i||(0===n?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!_j(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:n,easing:nN,anchor:c}))},e.prototype.beginInteraction=function(){this.resolveConstraints(0),this.setHint(1,1)},e.prototype.endInteraction=function(t,e,i){var n=i&&hV(i,this.getProjection());this.endInteractionInternal(t,e,n)},e.prototype.endInteractionInternal=function(t,e,i){this.setHint(1,-1),this.resolveConstraints(t,e,i)},e.prototype.getConstrainedCenter=function(t,e){var i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)},e.prototype.getConstrainedZoom=function(t,e){var i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))},e.prototype.getConstrainedResolution=function(t,e){var i=e||0,n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,i,n)},e}(FV),S8=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),C8=function(t){function e(e){var i=t.call(this)||this,n=function(t){var e=null;void 0!==t.keyboardEventTarget&&(e=\"string\"==typeof t.keyboardEventTarget?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);var i,n,r,s={},o=t.layers&&\"function\"==typeof t.layers.getLayers?t.layers:new n8({layers:t.layers});return s.layergroup=o,s.target=t.target,s.view=t.view instanceof x8?t.view:new x8,void 0!==t.controls&&(Array.isArray(t.controls)?i=new r4(t.controls.slice()):(kN(\"function\"==typeof t.controls.getArray,47),i=t.controls)),void 0!==t.interactions&&(Array.isArray(t.interactions)?n=new r4(t.interactions.slice()):(kN(\"function\"==typeof t.interactions.getArray,48),n=t.interactions)),void 0!==t.overlays?Array.isArray(t.overlays)?r=new r4(t.overlays.slice()):(kN(\"function\"==typeof t.overlays.getArray,49),r=t.overlays):r=new r4,{controls:i,interactions:n,keyboardEventTarget:e,overlays:r,values:s}}(e);i.boundHandleBrowserEvent_=i.handleBrowserEvent.bind(i),i.maxTilesLoading_=void 0!==e.maxTilesLoading?e.maxTilesLoading:16,i.pixelRatio_=void 0!==e.pixelRatio?e.pixelRatio:dN,i.animationDelay_=(function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}).bind(i),i.coordinateToPixelTransform_=[1,0,0,1,0,0],i.pixelToCoordinateTransform_=[1,0,0,1,0,0],i.frameIndex_=0,i.frameState_=null,i.previousExtent_=null,i.viewPropertyListenerKey_=null,i.viewChangeListenerKey_=null,i.layerGroupPropertyListenerKeys_=null,i.viewport_=document.createElement(\"div\"),i.viewport_.className=\"ol-viewport\"+(\"ontouchstart\"in window?\" ol-touch\":\"\"),i.viewport_.style.position=\"relative\",i.viewport_.style.overflow=\"hidden\",i.viewport_.style.width=\"100%\",i.viewport_.style.height=\"100%\",i.overlayContainer_=document.createElement(\"div\"),i.overlayContainer_.style.position=\"absolute\",i.overlayContainer_.style.zIndex=\"0\",i.overlayContainer_.style.width=\"100%\",i.overlayContainer_.style.height=\"100%\",i.overlayContainer_.style.pointerEvents=\"none\",i.overlayContainer_.className=\"ol-overlaycontainer\",i.viewport_.appendChild(i.overlayContainer_),i.overlayContainerStopEvent_=document.createElement(\"div\"),i.overlayContainerStopEvent_.style.position=\"absolute\",i.overlayContainerStopEvent_.style.zIndex=\"0\",i.overlayContainerStopEvent_.style.width=\"100%\",i.overlayContainerStopEvent_.style.height=\"100%\",i.overlayContainerStopEvent_.style.pointerEvents=\"none\",i.overlayContainerStopEvent_.className=\"ol-overlaycontainer-stopevent\",i.viewport_.appendChild(i.overlayContainerStopEvent_),i.mapBrowserEventHandler_=null,i.moveTolerance_=e.moveTolerance,i.keyboardEventTarget_=n.keyboardEventTarget,i.keyHandlerKeys_=null,i.controls=n.controls||new r4,i.interactions=n.interactions||new r4,i.overlays_=n.overlays,i.overlayIdIndex_={},i.renderer_=null,i.postRenderFunctions_=[],i.tileQueue_=new p8(i.getTilePriority.bind(i),i.handleTileChange_.bind(i)),i.addChangeListener(\"layergroup\",i.handleLayerGroupChanged_),i.addChangeListener(\"view\",i.handleViewChanged_),i.addChangeListener(\"size\",i.handleSizeChanged_),i.addChangeListener(\"target\",i.handleTargetChanged_),i.setProperties(n.values);var r=i;return e.view&&!(e.view instanceof x8)&&e.view.then(function(t){r.setView(new x8(t))}),i.controls.addEventListener(\"add\",(function(t){t.element.setMap(this)}).bind(i)),i.controls.addEventListener(\"remove\",(function(t){t.element.setMap(null)}).bind(i)),i.interactions.addEventListener(\"add\",(function(t){t.element.setMap(this)}).bind(i)),i.interactions.addEventListener(\"remove\",(function(t){t.element.setMap(null)}).bind(i)),i.overlays_.addEventListener(\"add\",(function(t){this.addOverlayInternal_(t.element)}).bind(i)),i.overlays_.addEventListener(\"remove\",(function(t){var e=t.element.getId();void 0!==e&&delete this.overlayIdIndex_[e.toString()],t.element.setMap(null)}).bind(i)),i.controls.forEach((function(t){t.setMap(this)}).bind(i)),i.interactions.forEach((function(t){t.setMap(this)}).bind(i)),i.overlays_.forEach(i.addOverlayInternal_.bind(i)),i}return S8(e,t),e.prototype.createRenderer=function(){throw new Error(\"Use a map type that has a createRenderer method\")},e.prototype.addControl=function(t){this.getControls().push(t)},e.prototype.addInteraction=function(t){this.getInteractions().push(t)},e.prototype.addLayer=function(t){this.getLayerGroup().getLayers().push(t)},e.prototype.addOverlay=function(t){this.getOverlays().push(t)},e.prototype.addOverlayInternal_=function(t){var e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)},e.prototype.disposeInternal=function(){this.setTarget(null),t.prototype.disposeInternal.call(this)},e.prototype.forEachFeatureAtPixel=function(t,e,i){if(this.frameState_){var n=this.getCoordinateFromPixelInternal(t);return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,void 0!==(i=void 0!==i?i:{}).hitTolerance?i.hitTolerance:0,!1!==i.checkWrapped,e,null,void 0!==i.layerFilter?i.layerFilter:HB,null)}},e.prototype.getFeaturesAtPixel=function(t,e){var i=[];return this.forEachFeatureAtPixel(t,function(t){i.push(t)},e),i},e.prototype.forEachLayerAtPixel=function(t,e,i){if(this.frameState_){var n=i||{};return this.renderer_.forEachLayerAtPixel(t,this.frameState_,void 0!==n.hitTolerance?n.hitTolerance:0,e,n.layerFilter||HB)}},e.prototype.hasFeatureAtPixel=function(t,e){if(!this.frameState_)return!1;var i=this.getCoordinateFromPixelInternal(t);return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,void 0!==(e=void 0!==e?e:{}).hitTolerance?e.hitTolerance:0,!1!==e.checkWrapped,void 0!==e.layerFilter?e.layerFilter:HB,null)},e.prototype.getEventCoordinate=function(t){return this.getCoordinateFromPixel(this.getEventPixel(t))},e.prototype.getEventCoordinateInternal=function(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))},e.prototype.getEventPixel=function(t){var e=this.viewport_.getBoundingClientRect(),i=\"changedTouches\"in t?t.changedTouches[0]:t;return[i.clientX-e.left,i.clientY-e.top]},e.prototype.getTarget=function(){return this.get(\"target\")},e.prototype.getTargetElement=function(){var t=this.getTarget();return void 0!==t?\"string\"==typeof t?document.getElementById(t):t:null},e.prototype.getCoordinateFromPixel=function(t){return aV(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())},e.prototype.getCoordinateFromPixelInternal=function(t){var e=this.frameState_;return e?P1(e.pixelToCoordinateTransform,t.slice()):null},e.prototype.getControls=function(){return this.controls},e.prototype.getOverlays=function(){return this.overlays_},e.prototype.getOverlayById=function(t){var e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null},e.prototype.getInteractions=function(){return this.interactions},e.prototype.getLayerGroup=function(){return this.get(\"layergroup\")},e.prototype.setLayers=function(t){var e=this.getLayerGroup();if(t instanceof r4)e.setLayers(t);else{var i=e.getLayers();i.clear(),i.extend(t)}},e.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},e.prototype.getLoading=function(){for(var t=this.getLayerGroup().getLayerStatesArray(),e=0,i=t.length;e<i;++e){var n=t[e].layer.getSource();if(n&&n.loading)return!0}return!1},e.prototype.getPixelFromCoordinate=function(t){var e=hV(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)},e.prototype.getPixelFromCoordinateInternal=function(t){var e=this.frameState_;return e?P1(e.coordinateToPixelTransform,t.slice(0,2)):null},e.prototype.getRenderer=function(){return this.renderer_},e.prototype.getSize=function(){return this.get(\"size\")},e.prototype.getView=function(){return this.get(\"view\")},e.prototype.getViewport=function(){return this.viewport_},e.prototype.getOverlayContainer=function(){return this.overlayContainer_},e.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},e.prototype.getOwnerDocument=function(){var t=this.getTargetElement();return t?t.ownerDocument:document},e.prototype.getTilePriority=function(t,e,i,n){return function(t,e,i,n,r){if(!t||!(i in t.wantedTiles)||!t.wantedTiles[i][e.getKey()])return h8;var s=t.viewState.center,o=n[0]-s[0],a=n[1]-s[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}(this.frameState_,t,e,i,n)},e.prototype.handleBrowserEvent=function(t,e){var i=new a8(e||t.type,this,t);this.handleMapBrowserEvent(i)},e.prototype.handleMapBrowserEvent=function(t){if(this.frameState_){var e=t.originalEvent,i=e.type;if(\"pointerdown\"===i||\"wheel\"===i||\"keydown\"===i){var n=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():n,s=e.target;if(this.overlayContainerStopEvent_.contains(s)||!(r===n?n.documentElement:r).contains(s))return}if(t.frameState=this.frameState_,!1!==this.dispatchEvent(t))for(var o=this.getInteractions().getArray().slice(),a=o.length-1;a>=0;a--){var l=o[a];if(l.getMap()===this&&l.getActive()&&this.getTargetElement()&&(!l.handleEvent(t)||t.propagationStopped))break}}},e.prototype.handlePostRender=function(){var t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){var i=this.maxTilesLoading_,n=i;if(t){var r=t.viewHints;if(r[0]||r[1]){var s=Date.now()-t.time>8;i=s?0:8,n=s?0:2}}e.getTilesLoading()<i&&(e.reprioritize(),e.loadMoreTiles(i,n))}t&&this.hasListener(\"rendercomplete\")&&!t.animate&&!this.tileQueue_.getTilesLoading()&&!this.getLoading()&&this.renderer_.dispatchRenderEvent(\"rendercomplete\",t);for(var o=this.postRenderFunctions_,a=0,l=o.length;a<l;++a)o[a](this,t);o.length=0},e.prototype.handleSizeChanged_=function(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()},e.prototype.handleTargetChanged_=function(){var t;if(this.getTarget()&&(t=this.getTargetElement()),this.mapBrowserEventHandler_){for(var e=0,i=this.keyHandlerKeys_.length;e<i;++e)oz(this.keyHandlerKeys_[e]);this.keyHandlerKeys_=null,this.viewport_.removeEventListener(\"contextmenu\",this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(\"wheel\",this.boundHandleBrowserEvent_),void 0!==this.handleResize_&&(removeEventListener(\"resize\",this.handleResize_,!1),this.handleResize_=void 0),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,yN(this.viewport_)}if(t){for(var n in t.appendChild(this.viewport_),this.renderer_||(this.renderer_=this.createRenderer()),this.mapBrowserEventHandler_=new c8(this,this.moveTolerance_),l4)this.mapBrowserEventHandler_.addEventListener(l4[n],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(\"contextmenu\",this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(\"wheel\",this.boundHandleBrowserEvent_,!!mN&&{passive:!1});var r=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.keyHandlerKeys_=[rz(r,\"keydown\",this.handleBrowserEvent,this),rz(r,\"keypress\",this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener(\"resize\",this.handleResize_,!1))}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()},e.prototype.handleTileChange_=function(){this.render()},e.prototype.handleViewPropertyChanged_=function(){this.render()},e.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(oz(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(oz(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=rz(t,\"propertychange\",this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=rz(t,\"change\",this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()},e.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(oz),this.layerGroupPropertyListenerKeys_=null);var t=this.getLayerGroup();t&&(this.layerGroupPropertyListenerKeys_=[rz(t,\"propertychange\",this.render,this),rz(t,\"change\",this.render,this)]),this.render()},e.prototype.isRendered=function(){return!!this.frameState_},e.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},e.prototype.redrawText=function(){for(var t=this.getLayerGroup().getLayerStatesArray(),e=0,i=t.length;e<i;++e){var n=t[e].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}},e.prototype.render=function(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},e.prototype.removeControl=function(t){return this.getControls().remove(t)},e.prototype.removeInteraction=function(t){return this.getInteractions().remove(t)},e.prototype.removeLayer=function(t){return this.getLayerGroup().getLayers().remove(t)},e.prototype.removeOverlay=function(t){return this.getOverlays().remove(t)},e.prototype.renderFrame_=function(t){var e=this,i=this.getSize(),n=this.getView(),r=this.frameState_,s=null;if(void 0!==i&&UV(i)&&n&&n.isDef()){var o=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:XN(a.center,a.resolution,a.rotation,i),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:i,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{}},a.nextCenter&&a.nextResolution){var l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=XN(a.nextCenter,a.nextResolution,l,i)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),r&&(!this.previousExtent_||!nz(this.previousExtent_)&&!zN(s.extent,this.previousExtent_))&&(this.dispatchEvent(new s8(\"movestart\",this,r)),this.previousExtent_=LN(this.previousExtent_)),this.previousExtent_&&!s.viewHints[0]&&!s.viewHints[1]&&!zN(s.extent,this.previousExtent_)&&(this.dispatchEvent(new s8(\"moveend\",this,s)),TN(s.extent,this.previousExtent_))),this.dispatchEvent(new s8(\"postrender\",this,s)),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(function(){e.postRenderTimeoutHandle_=void 0,e.handlePostRender()},0))},e.prototype.setLayerGroup=function(t){this.set(\"layergroup\",t)},e.prototype.setSize=function(t){this.set(\"size\",t)},e.prototype.setTarget=function(t){this.set(\"target\",t)},e.prototype.setView=function(t){if(!t||t instanceof x8)this.set(\"view\",t);else{this.set(\"view\",new x8);var e=this;t.then(function(t){e.setView(new x8(t))})}},e.prototype.updateSize=function(){var t=this.getTargetElement(),e=void 0;if(t){var i=getComputedStyle(t),n=t.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),r=t.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(n)&&!isNaN(r)&&!UV(e=[n,r])&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&console.warn(\"No map visible because the map container's width or height are 0.\")}this.setSize(e),this.updateViewportSize_()},e.prototype.updateViewportSize_=function(){var t=this.getView();if(t){var e=void 0,i=getComputedStyle(this.viewport_);i.width&&i.height&&(e=[parseInt(i.width,10),parseInt(i.height,10)]),t.setViewportSize(e)}},e}(FV),k8=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),E8=function(t){function e(e){var i=t.call(this)||this,n=e.element;return n&&!e.target&&!n.style.pointerEvents&&(n.style.pointerEvents=\"auto\"),i.element=n||null,i.target_=null,i.map_=null,i.listenerKeys=[],e.render&&(i.render=e.render),e.target&&i.setTarget(e.target),i}return k8(e,t),e.prototype.disposeInternal=function(){yN(this.element),t.prototype.disposeInternal.call(this)},e.prototype.getMap=function(){return this.map_},e.prototype.setMap=function(t){this.map_&&yN(this.element);for(var e=0,i=this.listenerKeys.length;e<i;++e)oz(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,this.map_&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==qB&&this.listenerKeys.push(rz(t,\"postrender\",this.render,this)),t.render())},e.prototype.render=function(t){},e.prototype.setTarget=function(t){this.target_=\"string\"==typeof t?document.getElementById(t):t},e}(FV),M8=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),T8=function(t){function e(e){var i=this,n=e||{};(i=t.call(this,{element:document.createElement(\"div\"),render:n.render,target:n.target})||this).ulElement_=document.createElement(\"ul\"),i.collapsed_=void 0===n.collapsed||n.collapsed,i.userCollapsed_=i.collapsed_,i.overrideCollapsible_=void 0!==n.collapsible,i.collapsible_=void 0===n.collapsible||n.collapsible,i.collapsible_||(i.collapsed_=!1);var r=void 0!==n.className?n.className:\"ol-attribution\",s=void 0!==n.tipLabel?n.tipLabel:\"Attributions\",o=void 0!==n.expandClassName?n.expandClassName:r+\"-expand\",a=void 0!==n.collapseLabel?n.collapseLabel:\"\\u203a\",l=void 0!==n.collapseClassName?n.collapseClassName:r+\"-collpase\";\"string\"==typeof a?(i.collapseLabel_=document.createElement(\"span\"),i.collapseLabel_.textContent=a,i.collapseLabel_.className=l):i.collapseLabel_=a;var c=void 0!==n.label?n.label:\"i\";\"string\"==typeof c?(i.label_=document.createElement(\"span\"),i.label_.textContent=c,i.label_.className=o):i.label_=c;var h=i.collapsible_&&!i.collapsed_?i.collapseLabel_:i.label_;i.toggleButton_=document.createElement(\"button\"),i.toggleButton_.setAttribute(\"type\",\"button\"),i.toggleButton_.setAttribute(\"aria-expanded\",String(!i.collapsed_)),i.toggleButton_.title=s,i.toggleButton_.appendChild(h),i.toggleButton_.addEventListener(\"click\",i.handleClick_.bind(i),!1);var u=i.element;return u.className=r+\" \"+l6+\" \"+c6+(i.collapsed_&&i.collapsible_?\" \"+h6:\"\")+(i.collapsible_?\"\":\" ol-uncollapsible\"),u.appendChild(i.toggleButton_),u.appendChild(i.ulElement_),i.renderedAttributions_=[],i.renderedVisible_=!0,i}return M8(e,t),e.prototype.collectSourceAttributions_=function(t){for(var e={},i=[],n=!0,r=t.layerStatesArray,s=0,o=r.length;s<o;++s){var a=r[s];if(J4(a,t.viewState)){var l=a.layer.getSource();if(l){var c=l.getAttributions();if(c){var h=c(t);if(h)if(n=n&&!1!==l.getAttributionsCollapsible(),Array.isArray(h))for(var u=0,d=h.length;u<d;++u)h[u]in e||(i.push(h[u]),e[h[u]]=!0);else h in e||(i.push(h),e[h]=!0)}}}}return this.overrideCollapsible_||this.setCollapsible(n),i},e.prototype.updateElement_=function(t){if(t){var e=this.collectSourceAttributions_(t),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?\"\":\"none\",this.renderedVisible_=i),!UB(e,this.renderedAttributions_)){bN(this.ulElement_);for(var n=0,r=e.length;n<r;++n){var s=document.createElement(\"li\");s.innerHTML=e[n],this.ulElement_.appendChild(s)}this.renderedAttributions_=e}}else this.renderedVisible_&&(this.element.style.display=\"none\",this.renderedVisible_=!1)},e.prototype.handleClick_=function(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_},e.prototype.handleToggle_=function(){this.element.classList.toggle(h6),this.collapsed_?_N(this.collapseLabel_,this.label_):_N(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute(\"aria-expanded\",String(!this.collapsed_))},e.prototype.getCollapsible=function(){return this.collapsible_},e.prototype.setCollapsible=function(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle(\"ol-uncollapsible\"),this.userCollapsed_&&this.handleToggle_())},e.prototype.setCollapsed=function(t){this.userCollapsed_=t,this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()},e.prototype.getCollapsed=function(){return this.collapsed_},e.prototype.render=function(t){this.updateElement_(t.frameState)},e}(E8),I8=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),O8=function(t){function e(e){var i=this,n=e||{};i=t.call(this,{element:document.createElement(\"div\"),render:n.render,target:n.target})||this;var r=void 0!==n.className?n.className:\"ol-rotate\",s=void 0!==n.label?n.label:\"\\u21e7\",o=void 0!==n.compassClassName?n.compassClassName:\"ol-compass\";i.label_=null,\"string\"==typeof s?(i.label_=document.createElement(\"span\"),i.label_.className=o,i.label_.textContent=s):(i.label_=s,i.label_.classList.add(o));var a=n.tipLabel?n.tipLabel:\"Reset rotation\",l=document.createElement(\"button\");l.className=r+\"-reset\",l.setAttribute(\"type\",\"button\"),l.title=a,l.appendChild(i.label_),l.addEventListener(\"click\",i.handleClick_.bind(i),!1);var c=i.element;return c.className=r+\" \"+l6+\" \"+c6,c.appendChild(l),i.callResetNorth_=n.resetNorth?n.resetNorth:void 0,i.duration_=void 0!==n.duration?n.duration:250,i.autoHide_=void 0===n.autoHide||n.autoHide,i.rotation_=void 0,i.autoHide_&&i.element.classList.add(a6),i}return I8(e,t),e.prototype.handleClick_=function(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},e.prototype.resetNorth_=function(){var t=this.getMap().getView();if(t){var e=t.getRotation();void 0!==e&&(this.duration_>0&&e%(2*Math.PI)!=0?t.animate({rotation:0,duration:this.duration_,easing:nN}):t.setRotation(0))}},e.prototype.render=function(t){var e=t.frameState;if(e){var i=e.viewState.rotation;if(i!=this.rotation_){var n=\"rotate(\"+i+\"rad)\";if(this.autoHide_){var r=this.element.classList.contains(a6);r||0!==i?r&&0!==i&&this.element.classList.remove(a6):this.element.classList.add(a6)}this.label_.style.transform=n}this.rotation_=i}},e}(E8),P8=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),D8=function(t){function e(e){var i=this,n=e||{};i=t.call(this,{element:document.createElement(\"div\"),target:n.target})||this;var r=void 0!==n.className?n.className:\"ol-zoom\",s=void 0!==n.delta?n.delta:1,o=void 0!==n.zoomInClassName?n.zoomInClassName:r+\"-in\",a=void 0!==n.zoomOutClassName?n.zoomOutClassName:r+\"-out\",l=void 0!==n.zoomInLabel?n.zoomInLabel:\"+\",c=void 0!==n.zoomOutLabel?n.zoomOutLabel:\"\\u2013\",h=void 0!==n.zoomInTipLabel?n.zoomInTipLabel:\"Zoom in\",u=void 0!==n.zoomOutTipLabel?n.zoomOutTipLabel:\"Zoom out\",d=document.createElement(\"button\");d.className=o,d.setAttribute(\"type\",\"button\"),d.title=h,d.appendChild(\"string\"==typeof l?document.createTextNode(l):l),d.addEventListener(\"click\",i.handleClick_.bind(i,s),!1);var p=document.createElement(\"button\");p.className=a,p.setAttribute(\"type\",\"button\"),p.title=u,p.appendChild(\"string\"==typeof c?document.createTextNode(c):c),p.addEventListener(\"click\",i.handleClick_.bind(i,-s),!1);var f=i.element;return f.className=r+\" \"+l6+\" \"+c6,f.appendChild(d),f.appendChild(p),i.duration_=void 0!==n.duration?n.duration:250,i}return P8(e,t),e.prototype.handleClick_=function(t,e){e.preventDefault(),this.zoomByDelta_(t)},e.prototype.zoomByDelta_=function(t){var e=this.getMap().getView();if(e){var i=e.getZoom();if(void 0!==i){var n=e.getConstrainedZoom(i+t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({zoom:n,duration:this.duration_,easing:nN})):e.setZoom(n)}}},e}(E8),R8=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),F8=function(t){function e(e){return(e=WB({},e)).controls||(e.controls=function(t){var e={},i=new r4;return(void 0===e.zoom||e.zoom)&&i.push(new D8(e.zoomOptions)),(void 0===e.rotate||e.rotate)&&i.push(new O8(e.rotateOptions)),(void 0===e.attribution||e.attribution)&&i.push(new T8(e.attributionOptions)),i}()),e.interactions||(e.interactions=Z4({onFocusOnly:!0})),t.call(this,e)||this}return R8(e,t),e.prototype.createRenderer=function(){return new e8(this)},e}(C8);class L8{constructor(t){Object.assign(this,t)}static fromOLView(t){return new L8({zoom:t.getZoom(),center:t.getProperties().center,extent:t.calculateExtent(),resolution:t.getResolution(),minResolution:t.getMinResolution(),maxResolution:t.getMaxResolution(),projection:t.getProjection(),viewportSize:t.viewportSize_})}toURL(){const t=Jz(this.center);return`@${t[1].toFixed(7)},${t[0].toFixed(7)},${this.zoom}z`}toLocateEvent(){return new M$({center:this.center,zoom:this.zoom})}}const B8=[\"root\"],N8=[\"*\"];let z8=(()=>{class t extends Lq{constructor(t,e,i,n,r,s,o){super(),this.ngZone=t,this.changeDetectionRef=e,this.mapService=i,this.mapConfigService=n,this.mapStateService=r,this.offlineService=s,this.workerService=o,this.horizontalCenterShiftPixels=0,this.cursor=\"default\",this.viewChange$=new S,this.animatingMinimumZoom=!1}ngOnInit(){this.changeDetectionRef.detach(),this.mapService.init(),this.mapService.locateEvents$.pipe(_P(),I$(0)).subscribe(t=>{this.ngZone.runOutsideAngular(()=>{if(!function(){const e=document.createElement(\"canvas\");for(const i of V8)try{const t=e.getContext(i);if(t)return t.getExtension(\"WEBGL_lose_context\").loseContext(),!0}catch(t){}return!1}())throw new Error(\"Impossible de r\\xe9cup\\xe9rer le contexte WebGL. Veuillez rafraichir l'onglet ou fermer puis r\\xe9ouvrir votre navigateur.\");this.createMap(t.center,t.zoom)})}),this.subscriptions.push(this.workerService.applicationHealth$.pipe(E(t=>!!(null==t?void 0:t.maintenance)),Cf(),wf(1)).subscribe(t=>{this.map.updateSize()}))}ngOnDestroy(){super.ngOnDestroy(),this.mapService.destroy()}createMap(t,e){let i=1;this.mapStateService.minimumZoom$.pipe(_P()).subscribe(t=>{i=t});const n=new x8({minZoom:i,maxZoom:21,smoothResolutionConstraint:!1}),r=this.computeRealCenter(new M$({center:t,zoom:e}),n);n.setCenter(r.center),n.setZoom(r.zoom);const s=new y6;this.map=new F8({target:this.rootElement.nativeElement,view:n,layers:[s],controls:[],interactions:Z4({keyboard:!1,doubleClickZoom:!1,pinchRotate:!1,shiftDragZoom:!1})}),n.on(\"change\",()=>this.viewChange$.next()),n.on(\"change:resolution\",()=>this.viewChange$.next()),this.map.on(\"pointerdrag\",()=>this.viewChange$.next()),this.subscriptions.push(Hm(this.map,\"pointermove\").pipe(_M(16,af,{leading:!1,trailing:!0})).subscribe(t=>{t.dragging?\"grabbing\"!==this.cursor&&(this.cursor=this.map.getTargetElement().style.cursor=\"move\"):(this.mapService.emitPointerMoveEvent(t),this.map.hasFeatureAtPixel(this.map.getEventPixel(t.originalEvent),{hitTolerance:3,layerFilter:t=>t.selectable})?\"pointer\"!==this.cursor&&(this.cursor=this.map.getTargetElement().style.cursor=\"pointer\"):\"default\"!==this.cursor&&(this.cursor=this.map.getTargetElement().style.cursor=\"default\"))})),this.subscriptions.push(Hm(this.map.getTargetElement(),\"mouseup\").subscribe(()=>{\"default\"!==this.cursor&&(this.cursor=this.map.getTargetElement().style.cursor=\"default\")})),this.subscriptions.push(this.mapService.locateEvents$.subscribe(t=>{n.cancelAnimations(),n.animate(this.computeRealCenter(t,n))})),this.subscriptions.push(this.mapService.fitEvents$.subscribe(t=>{n.cancelAnimations(),n.fit(t.polygon,{duration:t.duration,padding:[100,100,100,100+this.horizontalCenterShiftPixels]})})),this.subscriptions.push(this.mapService.zoomEvents$.subscribe(t=>{const e=n.getConstrainedResolution(n.getResolutionForZoom(n.getZoom()+t));n.cancelAnimations();const i=n.getCenter();n.animate({resolution:e,center:[i[0]+this.horizontalCenterShiftPixels/2*(t>0?1:-.5)*e,i[1]],duration:250,easing:nN})})),this.subscriptions.push(this.mapConfigService.preloadMapTiles$.subscribe(t=>{s.setPreload(t?1/0:0)}),this.mapConfigService.baseLayer$.subscribe(t=>{s.setSource(t.source)}),this.offlineService.offlineConfig$.subscribe(t=>{t?(s.setExtent(t.mercatorExtent),s.getSource().tileGrid=ZV({minZoom:t.minZoom,maxZoom:t.maxZoom})):(s.setExtent(null),s.getSource().tileGrid=ZV())})),this.subscriptions.push(this.mapStateService.minimumZoom$.pipe(wf(1),cf(60)).subscribe(t=>{t!==n.getMinZoom()&&(n.getZoom()<t?(this.animatingMinimumZoom=!0,n.cancelAnimations(),n.animate({zoom:t,duration:250,easing:nN}),setTimeout(()=>{n.setMinZoom(t),this.animatingMinimumZoom=!1,this.viewChange$.next()},250)):n.setMinZoom(t))})),this.subscriptions.push(this.viewChange$.pipe(pf(()=>!this.animatingMinimumZoom),_M(50,af,{leading:!1,trailing:!0})).subscribe(()=>{this.mapService.updateViewState(L8.fromOLView(this.map.getView()))}));const o=mq(10).subscribe(()=>{this.map.isRendered()?(this.viewChange$.next(),o.unsubscribe()):this.map.updateSize()});dj.production||(window.map=this.map)}onWindowResize(){this.map&&this.viewChange$.next()}computeRealCenter(t,e){const i=t.zoom?e.getResolutionForZoom(t.zoom):e.getResolution();return t.center[0]-=this.horizontalCenterShiftPixels/2*i,t}}return t.\\u0275fac=function(e){return new(e||t)(Ta(tu),Ta(Cc),Ta(T$),Ta(k$),Ta(KG),Ta(fq),Ta(iU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-map\"]],viewQuery:function(t,e){if(1&t&&kh(B8,7),2&t){let t;Ch(t=Mh())&&(e.rootElement=t.first)}},hostBindings:function(t,e){1&t&&$a(\"resize\",function(){return e.onWindowResize()},!1,Rr)},inputs:{horizontalCenterShiftPixels:\"horizontalCenterShiftPixels\"},exportAs:[\"map\"],features:[Vo],ngContentSelectors:N8,decls:3,vars:0,consts:[[1,\"map\"],[\"root\",\"\"]],template:function(t,e){1&t&&(Za(),Pa(0,\"div\",0,1),Xa(2),Da())},styles:[\".map[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;overflow:hidden}\"],changeDetection:0}),t})();const V8=[\"experimental-webgl\",\"webgl\",\"webkit-3d\",\"moz-webgl\"];function j8(t,e){if(1&t&&(Pa(0,\"div\",10),Pa(1,\"mat-icon\",11),bl(2,\"access_time\"),Da(),Pa(3,\"div\",12),oh(4,\"timeago\"),bl(5),oh(6,\"date\"),Da(),Da()),2&t){const t=Wa();Ss(3),Ka(\"title\",ah(4,2,1e3*t.aircraft.timestamp)),Ss(2),xl(\" \",ch(6,4,1e3*t.aircraft.timestamp,\"yyyy-MM-dd HH:mm:ss z\",t.useUTCDates&&\"+00\"),\" \")}}let $8=(()=>{class t extends Lq{constructor(t,e){super(),this.changeDetectorRef=t,this.mapConfigService=e,this.showTimestamp=!1,this.useUTCDates=!1}ngOnInit(){this.ensureMandatoryInputParams(\"aircraft\"),this.subscriptions.push(this.mapConfigService.useUTCDates$.subscribe(t=>{this.useUTCDates=t,this.changeDetectorRef.markForCheck()}))}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Cc),Ta(k$))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-aircraft-item-small\"]],inputs:{aircraft:\"aircraft\",showTimestamp:\"showTimestamp\"},features:[Vo],decls:23,vars:8,consts:[[1,\"aircraft-item\"],[1,\"aircraft-item__col1\"],[1,\"u-flex\",\"d-flex-center\"],[1,\"aircraft-item__flag\",3,\"flag\"],[1,\"d-flex-column\"],[1,\"aircraft-item__name\"],[1,\"aircraft-item__type\"],[\"class\",\"aircraft-item__timestamp\",\"title\",\"Derni\\xe8re r\\xe9ception\",4,\"ngIf\"],[1,\"aircraft-item__col2\"],[1,\"aircraft-item__label\"],[\"title\",\"Derni\\xe8re r\\xe9ception\",1,\"aircraft-item__timestamp\"],[1,\"mini-icon\",\"mr-1\"],[3,\"title\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"div\",1),Pa(2,\"div\",2),Ra(3,\"app-flag\",3),Pa(4,\"div\",4),Pa(5,\"strong\",5),bl(6),Da(),Pa(7,\"small\",6),bl(8),Da(),Da(),Da(),na(9,j8,7,8,\"div\",7),Da(),Pa(10,\"div\",8),Pa(11,\"div\"),Pa(12,\"span\",9),bl(13,\"ICAO\"),Da(),bl(14),Da(),Pa(15,\"div\"),Pa(16,\"span\",9),bl(17,\"Reg\"),Da(),bl(18),Da(),Pa(19,\"div\"),Pa(20,\"span\",9),bl(21,\"Callsign\"),Da(),bl(22),Da(),Da(),Da()),2&t&&(Ss(3),Ia(\"flag\",e.aircraft.country.flag),Ss(3),Sl(\"\",e.aircraft.callsign||\"?\",\" / \",e.aircraft.icao,\"\"),Ss(2),wl(e.aircraft.type||\"?\"),Ss(1),Ia(\"ngIf\",e.showTimestamp),Ss(5),xl(\" \",e.aircraft.icao,\"\"),Ss(4),xl(\" \",e.aircraft.registration||\"?\",\"\"),Ss(4),xl(\" \",e.aircraft.callsign||\"?\",\"\"))},directives:[TZ,Bd,Yk],pipes:[SL,Qd],styles:[\"[_nghost-%COMP%]{flex:1;display:block;position:relative}.aircraft-item[_ngcontent-%COMP%]{font-size:12px;line-height:16px;display:flex}.aircraft-item__col1[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.aircraft-item__col2[_ngcontent-%COMP%]{display:flex;flex-direction:column;text-align:right}.aircraft-item__flag[_ngcontent-%COMP%]{margin-right:4px}.aircraft-item__name[_ngcontent-%COMP%]{font-size:14px}.aircraft-item__type[_ngcontent-%COMP%]{line-height:1em;font-size:11px}.aircraft-item__timestamp[_ngcontent-%COMP%]{margin-top:4px;display:flex;align-items:center;color:gray}.aircraft-item__timestamp[_ngcontent-%COMP%] > .mat-icon[_ngcontent-%COMP%]{font-size:1em;height:1em;width:1em;margin-right:.3em;margin-left:.3em}.aircraft-item__label[_ngcontent-%COMP%]{color:gray;font-size:10px}\"],changeDetection:0}),t})();function U8(t,e){1&t&&(Pa(0,\"div\",9),bl(1,\" Chargement en cours... \"),Da())}function H8(t,e){if(1&t&&(Pa(0,\"div\",10),bl(1),Da()),2&t){const t=Wa(2);Ss(1),xl(\" \",t.entitySelection.error,\" \")}}function G8(t,e){if(1&t&&(na(0,U8,2,0,\"div\",7),na(1,H8,2,1,\"div\",8)),2&t){const t=Wa();Ia(\"ngIf\",!t.entitySelection.error),Ss(1),Ia(\"ngIf\",t.entitySelection.error)}}function q8(t,e){1&t&&Ra(0,\"app-ship-item-small\",13),2&t&&Ia(\"ship\",Wa(2).entitySelection.entity)(\"showTimestamp\",!0)}function W8(t,e){1&t&&Ra(0,\"app-aircraft-item-small\",14),2&t&&Ia(\"aircraft\",Wa(2).entitySelection.entity)(\"showTimestamp\",!0)}function Y8(t,e){if(1&t&&(na(0,q8,1,2,\"app-ship-item-small\",11),na(1,W8,1,2,\"app-aircraft-item-small\",12)),2&t){const t=Wa();Ia(\"ngIf\",t.entitySelection.type===t.EntityType.Ship),Ss(1),Ia(\"ngIf\",t.entitySelection.type===t.EntityType.Aircraft)}}const Z8=function(t,e){return[t,e]};let X8=(()=>{class t extends Lq{constructor(t,e){super(),this.mapService=t,this.selectionService=e,this.EntityType=pH,this.hasPosition=!0}ngOnChanges(t){var e,i,n,r;t.entitySelection&&(this.hasPosition=Zj(null===(i=null===(e=t.entitySelection.currentValue)||void 0===e?void 0:e.entity)||void 0===i?void 0:i.lon)&&Zj(null===(r=null===(n=t.entitySelection.currentValue)||void 0===n?void 0:n.entity)||void 0===r?void 0:r.lat))}locate(){this.mapService.pingLocation([this.entitySelection.entity.lon,this.entitySelection.entity.lat]),this.mapService.centerOnLonLat([this.entitySelection.entity.lon,this.entitySelection.entity.lat])}locateAndZoom(){this.mapService.locate([this.entitySelection.entity.lon,this.entitySelection.entity.lat])}removeSelection(){this.selectionService.toggleSelection(this.entitySelection.type,this.entitySelection.id)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(T$),Ta(bq))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-entity-selection\"]],inputs:{entitySelection:\"entitySelection\"},features:[Vo,ce],decls:15,vars:9,consts:[[1,\"entity-selection\",\"mat-elevation-z8\"],[1,\"entity-selection__background-icon\"],[3,\"ngIf\"],[1,\"d-flex\"],[\"mat-button\",\"\",1,\"entity-selection__action\",3,\"title\",\"disabled\",\"click\",\"dblclick\"],[\"mat-button\",\"\",\"title\",\"Ouvrir la fiche d\\xe9taill\\xe9e\",1,\"entity-selection__action\",3,\"routerLink\"],[\"mat-button\",\"\",\"title\",\"Supprimer de la s\\xe9lection\",1,\"entity-selection__action\",3,\"click\"],[\"class\",\"pa-3 u-relative u-flex\",4,\"ngIf\"],[\"class\",\"pa-1 u-relative u-flex error-message mat-small\",4,\"ngIf\"],[1,\"pa-3\",\"u-relative\",\"u-flex\"],[1,\"pa-1\",\"u-relative\",\"u-flex\",\"error-message\",\"mat-small\"],[\"class\",\"pa-1\",3,\"ship\",\"showTimestamp\",4,\"ngIf\"],[\"class\",\"pa-1\",3,\"aircraft\",\"showTimestamp\",4,\"ngIf\"],[1,\"pa-1\",3,\"ship\",\"showTimestamp\"],[1,\"pa-1\",3,\"aircraft\",\"showTimestamp\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"mat-icon\",1),bl(2),Da(),na(3,G8,2,2,\"ng-template\",2),na(4,Y8,2,2,\"ng-template\",2),Pa(5,\"div\",3),Pa(6,\"button\",4),$a(\"click\",function(){return e.locate()})(\"dblclick\",function(){return e.locateAndZoom()}),Pa(7,\"mat-icon\"),bl(8,\"center_focus_strong\"),Da(),Da(),Pa(9,\"button\",5),Pa(10,\"mat-icon\"),bl(11,\"info\"),Da(),Da(),Pa(12,\"button\",6),$a(\"click\",function(){return e.removeSelection()}),Pa(13,\"mat-icon\"),bl(14,\"close\"),Da(),Da(),Da(),Da()),2&t&&(Ss(2),wl(e.entitySelection.type===e.EntityType.Ship?\"directions_boat\":\"flight\"),Ss(1),Ia(\"ngIf\",!e.entitySelection.entity),Ss(1),Ia(\"ngIf\",e.entitySelection.entity),Ss(2),Ia(\"title\",e.hasPosition?\"Centrer la vue (double-clic = zoom)\":\"Ce navire n'a pas de position\")(\"disabled\",!e.entitySelection.entity||!e.hasPosition),Ss(3),Ia(\"routerLink\",th(6,Z8,e.entitySelection.type+\"s\",e.entitySelection.id)))},directives:[Yk,Bd,vb,QR,K0,$8],styles:[\"[_nghost-%COMP%]{display:block;position:relative;overflow:hidden}.entity-selection[_ngcontent-%COMP%]{background-color:#f7f7f7;width:292px;min-height:93px;margin-bottom:8px;position:relative;overflow:hidden;display:flex;flex-direction:column;pointer-events:all}.entity-selection__background-icon[_ngcontent-%COMP%]{position:absolute;font-size:136px;left:-64px;color:#ededed;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.entity-selection__action[_ngcontent-%COMP%]{flex:1;min-width:inherit;padding:inherit}\"],changeDetection:0}),t})();var K8=i(3036),Q8=function(){function t(t){this.rbush_=new K8(t),this.items_={}}return t.prototype.insert=function(t,e){var i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[eN(e)]=i},t.prototype.load=function(t,e){for(var i=new Array(e.length),n=0,r=e.length;n<r;n++){var s=t[n],o=e[n],a={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],value:o};i[n]=a,this.items_[eN(o)]=a}this.rbush_.load(i)},t.prototype.remove=function(t){var e=eN(t),i=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(i)},t.prototype.update=function(t,e){var i=this.items_[eN(e)];zN([i.minX,i.minY,i.maxX,i.maxY],t)||(this.remove(e),this.insert(t,e))},t.prototype.getAll=function(){return this.rbush_.all().map(function(t){return t.value})},t.prototype.getInExtent=function(t){return this.rbush_.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}).map(function(t){return t.value})},t.prototype.forEach=function(t){return this.forEach_(this.getAll(),t)},t.prototype.forEachInExtent=function(t,e){return this.forEach_(this.getInExtent(t),e)},t.prototype.forEach_=function(t,e){for(var i,n=0,r=t.length;n<r;n++)if(i=e(t[n]))return i;return i},t.prototype.isEmpty=function(){return XB(this.items_)},t.prototype.clear=function(){this.rbush_.clear(),this.items_={}},t.prototype.getExtent=function(t){var e=this.rbush_.toJSON();return FN(e.minX,e.minY,e.maxX,e.maxY,t)},t.prototype.concat=function(t){for(var e in this.rbush_.load(t.rbush_.all()),t.items_)this.items_[e]=t.items_[e]},t}(),J8=function(){function t(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=GV(t.scale),this.displacement_=t.displacement}return t.prototype.clone=function(){var e=this.getScale();return new t({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},t.prototype.getOpacity=function(){return this.opacity_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.getRotation=function(){return this.rotation_},t.prototype.getScale=function(){return this.scale_},t.prototype.getScaleArray=function(){return this.scaleArray_},t.prototype.getDisplacement=function(){return this.displacement_},t.prototype.getAnchor=function(){return JB()},t.prototype.getImage=function(t){return JB()},t.prototype.getHitDetectionImage=function(){return JB()},t.prototype.getPixelRatio=function(t){return 1},t.prototype.getImageState=function(){return JB()},t.prototype.getImageSize=function(){return JB()},t.prototype.getOrigin=function(){return JB()},t.prototype.getSize=function(){return JB()},t.prototype.setOpacity=function(t){this.opacity_=t},t.prototype.setRotateWithView=function(t){this.rotateWithView_=t},t.prototype.setRotation=function(t){this.rotation_=t},t.prototype.setScale=function(t){this.scale_=t,this.scaleArray_=GV(t)},t.prototype.listenImageChange=function(t){JB()},t.prototype.load=function(){JB()},t.prototype.unlistenImageChange=function(t){JB()},t}();function t7(t){return Array.isArray(t)?I6(t):t}var e7=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),i7=function(t){function e(e){var i=this;return(i=t.call(this,{opacity:1,rotateWithView:void 0!==e.rotateWithView&&e.rotateWithView,rotation:void 0!==e.rotation?e.rotation:0,scale:void 0!==e.scale?e.scale:1,displacement:void 0!==e.displacement?e.displacement:[0,0]})||this).canvas_=void 0,i.hitDetectionCanvas_=null,i.fill_=void 0!==e.fill?e.fill:null,i.origin_=[0,0],i.points_=e.points,i.radius_=void 0!==e.radius?e.radius:e.radius1,i.radius2_=e.radius2,i.angle_=void 0!==e.angle?e.angle:0,i.stroke_=void 0!==e.stroke?e.stroke:null,i.anchor_=null,i.size_=null,i.renderOptions_=null,i.render(),i}return e7(e,t),e.prototype.clone=function(){var t=this.getScale(),i=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice()});return i.setOpacity(this.getOpacity()),i},e.prototype.getAnchor=function(){return this.anchor_},e.prototype.getAngle=function(){return this.angle_},e.prototype.getFill=function(){return this.fill_},e.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},e.prototype.getImage=function(t){var e=this.canvas_[t];if(!e){var i=this.renderOptions_,n=gN(i.size*t,i.size*t);this.draw_(i,n,t),this.canvas_[t]=e=n.canvas}return e},e.prototype.getPixelRatio=function(t){return t},e.prototype.getImageSize=function(){return this.size_},e.prototype.getImageState=function(){return 2},e.prototype.getOrigin=function(){return this.origin_},e.prototype.getPoints=function(){return this.points_},e.prototype.getRadius=function(){return this.radius_},e.prototype.getRadius2=function(){return this.radius2_},e.prototype.getSize=function(){return this.size_},e.prototype.getStroke=function(){return this.stroke_},e.prototype.listenImageChange=function(t){},e.prototype.load=function(){},e.prototype.unlistenImageChange=function(t){},e.prototype.calculateLineJoinSize_=function(t,e,i){if(0===e||this.points_===1/0||\"bevel\"!==t&&\"miter\"!==t)return e;var n=this.radius_,r=void 0===this.radius2_?n:this.radius2_;if(n<r){var s=n;n=r,r=s}var o=2*Math.PI/(void 0===this.radius2_?this.points_:2*this.points_),a=r*Math.sin(o),l=n-Math.sqrt(r*r-a*a),c=Math.sqrt(a*a+l*l),h=c/a;if(\"miter\"===t&&h<=i)return h*e;var u=e/2/h,d=e/2*(l/c),p=Math.sqrt((n+u)*(n+u)+d*d)-n;if(void 0===this.radius2_||\"bevel\"===t)return 2*p;var f=n*Math.sin(o),m=r-Math.sqrt(n*n-f*f),g=Math.sqrt(f*f+m*m)/f;return g<=i?2*Math.max(p,g*e/2-r-n):2*p},e.prototype.createRenderOptions=function(){var t,e=V6,i=0,n=null,r=0,s=0;this.stroke_&&(null===(t=this.stroke_.getColor())&&(t=j6),t=t7(t),void 0===(s=this.stroke_.getWidth())&&(s=1),n=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset(),void 0===(e=this.stroke_.getLineJoin())&&(e=V6),void 0===(i=this.stroke_.getMiterLimit())&&(i=10));var o=this.calculateLineJoinSize_(e,s,i),a=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:s,size:Math.ceil(2*a+o),lineDash:n,lineDashOffset:r,lineJoin:e,miterLimit:i}},e.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var t=this.renderOptions_.size,e=this.getDisplacement();this.canvas_={},this.anchor_=[t/2-e[0],t/2+e[1]],this.size_=[t,t]},e.prototype.draw_=function(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){var n=this.fill_.getColor();null===n&&(n=B6),e.fillStyle=t7(n),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},e.prototype.createHitDetectionCanvas_=function(t){if(this.fill_){var e=this.fill_.getColor(),i=0;if(\"string\"==typeof e&&(e=M6(e)),null===e?i=1:Array.isArray(e)&&(i=4===e.length?e[3]:1),0===i){var n=gN(t.size,t.size);this.hitDetectionCanvas_=n.canvas,this.drawHitDetectionCanvas_(t,n)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},e.prototype.createPath_=function(t){var e=this.points_,i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{var n=void 0===this.radius2_?i:this.radius2_;void 0!==this.radius2_&&(e*=2);for(var r=this.angle_-Math.PI/2,s=2*Math.PI/e,o=0;o<e;o++){var a=r+o*s,l=o%2==0?i:n;t.lineTo(l*Math.cos(a),l*Math.sin(a))}t.closePath()}},e.prototype.drawHitDetectionCanvas_=function(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=B6,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},e}(J8),n7=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),r7=function(t){function e(e){var i=e||{};return t.call(this,{points:1/0,fill:i.fill,radius:i.radius,stroke:i.stroke,scale:void 0!==i.scale?i.scale:1,rotation:void 0!==i.rotation?i.rotation:0,rotateWithView:void 0!==i.rotateWithView&&i.rotateWithView,displacement:void 0!==i.displacement?i.displacement:[0,0]})||this}return n7(e,t),e.prototype.clone=function(){var t=this.getScale(),i=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return i.setOpacity(this.getOpacity()),i},e.prototype.setRadius=function(t){this.radius_=t,this.render()},e}(i7),s7=function(){function t(t){var e=t||{};this.color_=void 0!==e.color?e.color:null}return t.prototype.clone=function(){var e=this.getColor();return new t({color:Array.isArray(e)?e.slice():e||void 0})},t.prototype.getColor=function(){return this.color_},t.prototype.setColor=function(t){this.color_=t},t}(),o7=function(){function t(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}return t.prototype.clone=function(){var e=this.getColor();return new t({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},t.prototype.getColor=function(){return this.color_},t.prototype.getLineCap=function(){return this.lineCap_},t.prototype.getLineDash=function(){return this.lineDash_},t.prototype.getLineDashOffset=function(){return this.lineDashOffset_},t.prototype.getLineJoin=function(){return this.lineJoin_},t.prototype.getMiterLimit=function(){return this.miterLimit_},t.prototype.getWidth=function(){return this.width_},t.prototype.setColor=function(t){this.color_=t},t.prototype.setLineCap=function(t){this.lineCap_=t},t.prototype.setLineDash=function(t){this.lineDash_=t},t.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t},t.prototype.setLineJoin=function(t){this.lineJoin_=t},t.prototype.setMiterLimit=function(t){this.miterLimit_=t},t.prototype.setWidth=function(t){this.width_=t},t}(),a7=function(){function t(t){var e=t||{};this.geometry_=null,this.geometryFunction_=u7,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.hitDetectionRenderer_=void 0!==e.hitDetectionRenderer?e.hitDetectionRenderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex}return t.prototype.clone=function(){var e=this.getGeometry();return e&&\"object\"==typeof e&&(e=e.clone()),new t({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},t.prototype.getRenderer=function(){return this.renderer_},t.prototype.setRenderer=function(t){this.renderer_=t},t.prototype.setHitDetectionRenderer=function(t){this.hitDetectionRenderer_=t},t.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},t.prototype.getGeometry=function(){return this.geometry_},t.prototype.getGeometryFunction=function(){return this.geometryFunction_},t.prototype.getFill=function(){return this.fill_},t.prototype.setFill=function(t){this.fill_=t},t.prototype.getImage=function(){return this.image_},t.prototype.setImage=function(t){this.image_=t},t.prototype.getStroke=function(){return this.stroke_},t.prototype.setStroke=function(t){this.stroke_=t},t.prototype.getText=function(){return this.text_},t.prototype.setText=function(t){this.text_=t},t.prototype.getZIndex=function(){return this.zIndex_},t.prototype.setGeometry=function(t){\"function\"==typeof t?this.geometryFunction_=t:\"string\"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=u7,this.geometry_=t},t.prototype.setZIndex=function(t){this.zIndex_=t},t}(),l7=null;function c7(t,e){if(!l7){var i=new s7({color:\"rgba(255,255,255,0.4)\"}),n=new o7({color:\"#3399CC\",width:1.25});l7=[new a7({image:new r7({fill:i,stroke:n,radius:5}),fill:i,stroke:n})]}return l7}function h7(){var t={},e=[255,255,255,1],i=[0,153,255,1];return t.Polygon=[new a7({fill:new s7({color:[255,255,255,.5]})})],t.MultiPolygon=t.Polygon,t.LineString=[new a7({stroke:new o7({color:e,width:5})}),new a7({stroke:new o7({color:i,width:3})})],t.MultiLineString=t.LineString,t.Circle=t.Polygon.concat(t.LineString),t.Point=[new a7({image:new r7({radius:6,fill:new s7({color:i}),stroke:new o7({color:e,width:1.5})}),zIndex:1/0})],t.MultiPoint=t.Point,t.GeometryCollection=t.Polygon.concat(t.LineString,t.Point),t}function u7(t){return t.getGeometry()}var d7=a7,p7=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),f7=function(t){function e(e){var i=this,n=e||{},r=WB({},n);return delete r.style,delete r.renderBuffer,delete r.updateWhileAnimating,delete r.updateWhileInteracting,(i=t.call(this,r)||this).declutter_=void 0!==n.declutter&&n.declutter,i.renderBuffer_=void 0!==n.renderBuffer?n.renderBuffer:100,i.style_=null,i.styleFunction_=void 0,i.setStyle(n.style),i.updateWhileAnimating_=void 0!==n.updateWhileAnimating&&n.updateWhileAnimating,i.updateWhileInteracting_=void 0!==n.updateWhileInteracting&&n.updateWhileInteracting,i}return p7(e,t),e.prototype.getDeclutter=function(){return this.declutter_},e.prototype.getFeatures=function(e){return t.prototype.getFeatures.call(this,e)},e.prototype.getRenderBuffer=function(){return this.renderBuffer_},e.prototype.getRenderOrder=function(){return this.get(\"renderOrder\")},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},e.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},e.prototype.renderDeclutter=function(t){t.declutterTree||(t.declutterTree=new K8(9)),this.getRenderer().renderDeclutter(t)},e.prototype.setRenderOrder=function(t){this.set(\"renderOrder\",t)},e.prototype.setStyle=function(t){this.style_=void 0!==t?t:c7,this.styleFunction_=null===t?void 0:function(t){var e,i;\"function\"==typeof t?e=t:(Array.isArray(t)?i=t:(kN(\"function\"==typeof t.getZIndex,41),i=[t]),e=function(){return i});return e}(this.style_),this.changed()},e}(t6),m7={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},g7=[m7.FILL],A7=[m7.STROKE],v7=[m7.BEGIN_PATH],_7=[m7.CLOSE_PATH],y7=m7,b7=function(){function t(){}return t.prototype.drawCustom=function(t,e,i,n){},t.prototype.drawGeometry=function(t){},t.prototype.setStyle=function(t){},t.prototype.drawCircle=function(t,e){},t.prototype.drawFeature=function(t,e){},t.prototype.drawGeometryCollection=function(t,e){},t.prototype.drawLineString=function(t,e){},t.prototype.drawMultiLineString=function(t,e){},t.prototype.drawMultiPoint=function(t,e){},t.prototype.drawMultiPolygon=function(t,e){},t.prototype.drawPoint=function(t,e){},t.prototype.drawPolygon=function(t,e){},t.prototype.drawText=function(t,e){},t.prototype.setFillStrokeStyle=function(t,e){},t.prototype.setImageStyle=function(t,e){},t.prototype.setTextStyle=function(t,e){},t}(),w7=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),x7=function(t){function e(e,i,n,r){var s=t.call(this)||this;return s.tolerance=e,s.maxExtent=i,s.pixelRatio=r,s.maxLineWidth=0,s.resolution=n,s.beginGeometryInstruction1_=null,s.beginGeometryInstruction2_=null,s.bufferedMaxExtent_=null,s.instructions=[],s.coordinates=[],s.tmpCoordinate_=[],s.hitDetectionInstructions=[],s.state={},s}return w7(e,t),e.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return 1==e?t:t.map(function(t){return t*e})},e.prototype.appendFlatPointCoordinates=function(t,e){for(var i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,r=this.coordinates,s=r.length,o=0,a=t.length;o<a;o+=e)n[0]=t[o],n[1]=t[o+1],ON(i,n)&&(r[s++]=n[0],r[s++]=n[1]);return s},e.prototype.appendFlatLineCoordinates=function(t,e,i,n,r,s){var o=this.coordinates,a=o.length,l=this.getBufferedMaxExtent();s&&(e+=n);var c,h,u,d=t[e],p=t[e+1],f=this.tmpCoordinate_,m=!0;for(c=e+n;c<i;c+=n)f[0]=t[c],f[1]=t[c+1],(u=RN(l,f))!==h?(m&&(o[a++]=d,o[a++]=p,m=!1),o[a++]=f[0],o[a++]=f[1]):1===u?(o[a++]=f[0],o[a++]=f[1],m=!1):m=!0,d=f[0],p=f[1],h=u;return(r&&m||c===e+n)&&(o[a++]=d,o[a++]=p),a},e.prototype.drawCustomCoordinates_=function(t,e,i,n,r){for(var s=0,o=i.length;s<o;++s){var a=i[s],l=this.appendFlatLineCoordinates(t,e,a,n,!1,!1);r.push(l),e=a}return e},e.prototype.drawCustom=function(t,e,i,n){this.beginGeometry(t,e);var r,s,o,a,l,c=t.getType(),h=t.getStride(),u=this.coordinates.length;switch(c){case\"MultiPolygon\":r=t.getOrientedFlatCoordinates(),a=[];var d=t.getEndss();l=0;for(var p=0,f=d.length;p<f;++p){var m=[];l=this.drawCustomCoordinates_(r,l,d[p],h,m),a.push(m)}this.instructions.push([y7.CUSTOM,u,a,t,i,f2]),this.hitDetectionInstructions.push([y7.CUSTOM,u,a,t,n||i,f2]);break;case\"Polygon\":case\"MultiLineString\":o=[],r=\"Polygon\"==c?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),l=this.drawCustomCoordinates_(r,0,t.getEnds(),h,o),this.instructions.push([y7.CUSTOM,u,o,t,i,p2]),this.hitDetectionInstructions.push([y7.CUSTOM,u,o,t,n||i,p2]);break;case\"LineString\":case\"Circle\":r=t.getFlatCoordinates(),s=this.appendFlatLineCoordinates(r,0,r.length,h,!1,!1),this.instructions.push([y7.CUSTOM,u,s,t,i,d2]),this.hitDetectionInstructions.push([y7.CUSTOM,u,s,t,n||i,d2]);break;case\"MultiPoint\":r=t.getFlatCoordinates(),(s=this.appendFlatPointCoordinates(r,h))>u&&(this.instructions.push([y7.CUSTOM,u,s,t,i,d2]),this.hitDetectionInstructions.push([y7.CUSTOM,u,s,t,n||i,d2]));break;case\"Point\":r=t.getFlatCoordinates(),this.coordinates.push(r[0],r[1]),this.instructions.push([y7.CUSTOM,u,s=this.coordinates.length,t,i]),this.hitDetectionInstructions.push([y7.CUSTOM,u,s,t,n||i])}this.endGeometry(e)},e.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[y7.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[y7.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},e.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},e.prototype.reverseHitDetectionInstructions=function(){var t=this.hitDetectionInstructions;t.reverse();var e,i,n,r=t.length,s=-1;for(e=0;e<r;++e)(n=(i=t[e])[0])==y7.END_GEOMETRY?s=e:n==y7.BEGIN_GEOMETRY&&(i[2]=e,jB(this.hitDetectionInstructions,s,e),s=-1)},e.prototype.setFillStrokeStyle=function(t,e){var i=this.state;if(t){var n=t.getColor();i.fillStyle=t7(n||B6)}else i.fillStyle=void 0;if(e){var r=e.getColor();i.strokeStyle=t7(r||j6);var s=e.getLineCap();i.lineCap=void 0!==s?s:N6;var o=e.getLineDash();i.lineDash=o?o.slice():z6;var a=e.getLineDashOffset();i.lineDashOffset=a||0;var l=e.getLineJoin();i.lineJoin=void 0!==l?l:V6;var c=e.getWidth();i.lineWidth=void 0!==c?c:1;var h=e.getMiterLimit();i.miterLimit=void 0!==h?h:10,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0},e.prototype.createFill=function(t){var e=t.fillStyle,i=[y7.SET_FILL_STYLE,e];return\"string\"!=typeof e&&i.push(!0),i},e.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},e.prototype.createStroke=function(t){return[y7.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},e.prototype.updateFillStyle=function(t,e){var i=t.fillStyle;(\"string\"!=typeof i||t.currentFillStyle!=i)&&(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)},e.prototype.updateStrokeStyle=function(t,e){var i=t.strokeStyle,n=t.lineCap,r=t.lineDash,s=t.lineDashOffset,o=t.lineJoin,a=t.lineWidth,l=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||r!=t.currentLineDash&&!UB(t.currentLineDash,r)||t.currentLineDashOffset!=s||t.currentLineJoin!=o||t.currentLineWidth!=a||t.currentMiterLimit!=l)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=r,t.currentLineDashOffset=s,t.currentLineJoin=o,t.currentLineWidth=a,t.currentMiterLimit=l)},e.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var e=[y7.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)},e.prototype.getBufferedMaxExtent=function(){return!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=TN(this.maxExtent),this.maxLineWidth>0)&&MN(this.bufferedMaxExtent_,this.resolution*(this.maxLineWidth+1)/2,this.bufferedMaxExtent_),this.bufferedMaxExtent_},e}(b7),S7=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),C7=function(t){function e(e,i,n,r){var s=t.call(this,e,i,n,r)||this;return s.hitDetectionImage_=null,s.image_=null,s.imagePixelRatio_=void 0,s.anchorX_=void 0,s.anchorY_=void 0,s.height_=void 0,s.opacity_=void 0,s.originX_=void 0,s.originY_=void 0,s.rotateWithView_=void 0,s.rotation_=void 0,s.scale_=void 0,s.width_=void 0,s.declutterImageWithText_=void 0,s}return S7(e,t),e.prototype.drawPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var i=t.getFlatCoordinates(),n=t.getStride(),r=this.coordinates.length,s=this.appendFlatPointCoordinates(i,n);this.instructions.push([y7.DRAW_IMAGE,r,s,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([y7.DRAW_IMAGE,r,s,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(e)}},e.prototype.drawMultiPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var i=t.getFlatCoordinates(),n=t.getStride(),r=this.coordinates.length,s=this.appendFlatPointCoordinates(i,n);this.instructions.push([y7.DRAW_IMAGE,r,s,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([y7.DRAW_IMAGE,r,s,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(e)}},e.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,t.prototype.finish.call(this)},e.prototype.setImageStyle=function(t,e){var i=t.getAnchor(),n=t.getSize(),r=t.getHitDetectionImage(),s=t.getImage(this.pixelRatio),o=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=r,this.image_=s,this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=o[0]*this.imagePixelRatio_,this.originY_=o[1]*this.imagePixelRatio_,this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterImageWithText_=e},e}(x7),k7=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),E7=function(t){function e(e,i,n,r){return t.call(this,e,i,n,r)||this}return k7(e,t),e.prototype.drawFlatCoordinates_=function(t,e,i,n){var r=this.coordinates.length,s=this.appendFlatLineCoordinates(t,e,i,n,!1,!1),o=[y7.MOVE_TO_LINE_TO,r,s];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i},e.prototype.drawLineString=function(t,e){var i=this.state;if(void 0!==i.strokeStyle&&void 0!==i.lineWidth){this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([y7.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,z6,0],v7);var n=t.getFlatCoordinates(),r=t.getStride();this.drawFlatCoordinates_(n,0,n.length,r),this.hitDetectionInstructions.push(A7),this.endGeometry(e)}},e.prototype.drawMultiLineString=function(t,e){var i=this.state;if(void 0!==i.strokeStyle&&void 0!==i.lineWidth){this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([y7.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],v7);for(var n=t.getEnds(),r=t.getFlatCoordinates(),s=t.getStride(),o=0,a=0,l=n.length;a<l;++a)o=this.drawFlatCoordinates_(r,o,n[a],s);this.hitDetectionInstructions.push(A7),this.endGeometry(e)}},e.prototype.finish=function(){var e=this.state;return null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&this.instructions.push(A7),this.reverseHitDetectionInstructions(),this.state=null,t.prototype.finish.call(this)},e.prototype.applyStroke=function(e){null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(A7),e.lastStroke=this.coordinates.length),e.lastStroke=0,t.prototype.applyStroke.call(this,e),this.instructions.push(v7)},e}(x7),M7=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),T7=function(t){function e(e,i,n,r){return t.call(this,e,i,n,r)||this}return M7(e,t),e.prototype.drawFlatCoordinatess_=function(t,e,i,n){var r=this.state,s=void 0!==r.fillStyle,o=void 0!==r.strokeStyle,a=i.length;this.instructions.push(v7),this.hitDetectionInstructions.push(v7);for(var l=0;l<a;++l){var c=i[l],h=this.coordinates.length,u=this.appendFlatLineCoordinates(t,e,c,n,!0,!o),d=[y7.MOVE_TO_LINE_TO,h,u];this.instructions.push(d),this.hitDetectionInstructions.push(d),o&&(this.instructions.push(_7),this.hitDetectionInstructions.push(_7)),e=c}return s&&(this.instructions.push(g7),this.hitDetectionInstructions.push(g7)),o&&(this.instructions.push(A7),this.hitDetectionInstructions.push(A7)),e},e.prototype.drawCircle=function(t,e){var i=this.state;if(void 0!==i.fillStyle||void 0!==i.strokeStyle){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([y7.SET_FILL_STYLE,B6]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([y7.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var n=t.getFlatCoordinates(),r=t.getStride(),s=this.coordinates.length;this.appendFlatLineCoordinates(n,0,n.length,r,!1,!1);var o=[y7.CIRCLE,s];this.instructions.push(v7,o),this.hitDetectionInstructions.push(v7,o),void 0!==i.fillStyle&&(this.instructions.push(g7),this.hitDetectionInstructions.push(g7)),void 0!==i.strokeStyle&&(this.instructions.push(A7),this.hitDetectionInstructions.push(A7)),this.endGeometry(e)}},e.prototype.drawPolygon=function(t,e){var i=this.state;if(void 0!==i.fillStyle||void 0!==i.strokeStyle){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([y7.SET_FILL_STYLE,B6]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([y7.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var n=t.getEnds(),r=t.getOrientedFlatCoordinates(),s=t.getStride();this.drawFlatCoordinatess_(r,0,n,s),this.endGeometry(e)}},e.prototype.drawMultiPolygon=function(t,e){var i=this.state;if(void 0!==i.fillStyle||void 0!==i.strokeStyle){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([y7.SET_FILL_STYLE,B6]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([y7.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);for(var n=t.getEndss(),r=t.getOrientedFlatCoordinates(),s=t.getStride(),o=0,a=0,l=n.length;a<l;++a)o=this.drawFlatCoordinatess_(r,o,n[a],s);this.endGeometry(e)}},e.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var e=this.tolerance;if(0!==e)for(var i=this.coordinates,n=0,r=i.length;n<r;++n)i[n]=l2(i[n],e);return t.prototype.finish.call(this)},e.prototype.setFillStrokeStyles_=function(){var t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)},e}(x7);function I7(t,e,i,n,r){var s,o,a,l,c,h,u,d,p,f=i,m=i,g=0,A=0,v=i;for(s=i;s<n;s+=r){var _=e[s],y=e[s+1];void 0!==l&&(d=_-l,p=y-c,a=Math.sqrt(d*d+p*p),void 0!==h&&(A+=o,Math.acos((h*d+u*p)/(o*a))>t&&(A>g&&(g=A,f=v,m=s),A=0,v=s-r)),o=a,h=d,u=p),l=_,c=y}return(A+=a)>g?[v,s]:[f,m]}var O7=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),P7={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},D7={Circle:T7,Default:x7,Image:C7,LineString:E7,Polygon:T7,Text:function(t){function e(e,i,n,r){var s=t.call(this,e,i,n,r)||this;return s.labels_=null,s.text_=\"\",s.textOffsetX_=0,s.textOffsetY_=0,s.textRotateWithView_=void 0,s.textRotation_=0,s.textFillState_=null,s.fillStates={},s.textStrokeState_=null,s.strokeStates={},s.textState_={},s.textStates={},s.textKey_=\"\",s.fillKey_=\"\",s.strokeKey_=\"\",s.declutterImageWithText_=void 0,s}return O7(e,t),e.prototype.finish=function(){var e=t.prototype.finish.call(this);return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e},e.prototype.drawText=function(t,e){var i=this.textState_;if(\"\"!==this.text_&&i&&(this.textFillState_||this.textStrokeState_)){var n=this.coordinates,r=n.length,s=t.getType(),o=null,a=t.getStride();if(\"line\"!==i.placement||\"LineString\"!=s&&\"MultiLineString\"!=s&&\"Polygon\"!=s&&\"MultiPolygon\"!=s){var l=i.overflow?null:[];switch(s){case\"Point\":case\"MultiPoint\":o=t.getFlatCoordinates();break;case\"LineString\":o=t.getFlatMidpoint();break;case\"Circle\":o=t.getCenter();break;case\"MultiLineString\":o=t.getFlatMidpoints(),a=2;break;case\"Polygon\":o=t.getFlatInteriorPoint(),i.overflow||l.push(o[2]/this.resolution),a=3;break;case\"MultiPolygon\":var c=t.getFlatInteriorPoints();for(o=[],y=0,b=c.length;y<b;y+=3)i.overflow||l.push(c[y+2]/this.resolution),o.push(c[y],c[y+1]);if(0===o.length)return;a=2}if((M=this.appendFlatPointCoordinates(o,a))===r)return;if(l&&(M-r)/2!=o.length/a){var h=r/2;l=l.filter(function(t,e){var i=n[2*(h+e)]===o[e*a]&&n[2*(h+e)+1]===o[e*a+1];return i||--h,i})}this.saveTextStates_(),(i.backgroundFill||i.backgroundStroke)&&(this.setFillStrokeStyle(i.backgroundFill,i.backgroundStroke),i.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),i.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);var u=i.padding;if(u!=H6&&(i.scale[0]<0||i.scale[1]<0)){var d=i.padding[0],p=i.padding[1],f=i.padding[2],m=i.padding[3];i.scale[0]<0&&(p=-p,m=-m),i.scale[1]<0&&(d=-d,f=-f),u=[d,p,f,m]}var g=this.pixelRatio;this.instructions.push([y7.DRAW_IMAGE,r,M,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterImageWithText_,u==H6?H6:u.map(function(t){return t*g}),!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,l]);var A=1/g;this.hitDetectionInstructions.push([y7.DRAW_IMAGE,r,M,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[A,A],NaN,this.declutterImageWithText_,u,!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,l]),this.endGeometry(e)}else{if(!iz(this.getBufferedMaxExtent(),t.getExtent()))return;var v=void 0;if(o=t.getFlatCoordinates(),\"LineString\"==s)v=[o.length];else if(\"MultiLineString\"==s)v=t.getEnds();else if(\"Polygon\"==s)v=t.getEnds().slice(0,1);else if(\"MultiPolygon\"==s){var _=t.getEndss();v=[];for(var y=0,b=_.length;y<b;++y)v.push(_[y][0])}this.beginGeometry(t,e);for(var w=i.textAlign,x=0,S=void 0,C=0,k=v.length;C<k;++C){if(null==w){var E=I7(i.maxAngle,o,x,v[C],a);x=E[0],S=E[1]}else S=v[C];for(y=x;y<S;y+=a)n.push(o[y],o[y+1]);var M;x=v[C],this.drawChars_(r,M=n.length),r=M}this.endGeometry(e)}}},e.prototype.saveTextStates_=function(){var t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var r=this.textKey_;r in this.textStates||(this.textStates[r]={font:e.font,textAlign:e.textAlign||$6,textBaseline:e.textBaseline||U6,scale:e.scale});var s=this.fillKey_;i&&(s in this.fillStates||(this.fillStates[s]={fillStyle:i.fillStyle}))},e.prototype.drawChars_=function(t,e){var i=this.textStrokeState_,n=this.textState_,r=this.strokeKey_,s=this.textKey_,o=this.fillKey_;this.saveTextStates_();var a=this.pixelRatio,l=P7[n.textBaseline],c=this.textOffsetY_*a,h=this.text_,u=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([y7.DRAW_CHARS,t,e,l,n.overflow,o,n.maxAngle,a,c,r,u*a,h,s,1]),this.hitDetectionInstructions.push([y7.DRAW_CHARS,t,e,l,n.overflow,o,n.maxAngle,1,c,r,u,h,s,1/a])},e.prototype.setTextStyle=function(t,e){var i,n,r;if(t){var s=t.getFill();s?((n=this.textFillState_)||(this.textFillState_=n={}),n.fillStyle=t7(s.getColor()||B6)):this.textFillState_=n=null;var o=t.getStroke();if(o){(r=this.textStrokeState_)||(this.textStrokeState_=r={});var a=o.getLineDash(),l=o.getLineDashOffset(),c=o.getWidth(),h=o.getMiterLimit();r.lineCap=o.getLineCap()||N6,r.lineDash=a?a.slice():z6,r.lineDashOffset=void 0===l?0:l,r.lineJoin=o.getLineJoin()||V6,r.lineWidth=void 0===c?1:c,r.miterLimit=void 0===h?10:h,r.strokeStyle=t7(o.getColor()||j6)}else this.textStrokeState_=r=null;i=this.textState_;var u=t.getFont()||L6;Z6(u);var d=t.getScaleArray();i.overflow=t.getOverflow(),i.font=u,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.textBaseline=t.getTextBaseline()||U6,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||H6,i.scale=void 0===d?[1,1]:d;var p=t.getOffsetX(),f=t.getOffsetY(),m=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||\"\",this.textOffsetX_=void 0===p?0:p,this.textOffsetY_=void 0===f?0:f,this.textRotateWithView_=void 0!==m&&m,this.textRotation_=void 0===g?0:g,this.strokeKey_=r?(\"string\"==typeof r.strokeStyle?r.strokeStyle:eN(r.strokeStyle))+r.lineCap+r.lineDashOffset+\"|\"+r.lineWidth+r.lineJoin+r.miterLimit+\"[\"+r.lineDash.join()+\"]\":\"\",this.textKey_=i.font+i.scale+(i.textAlign||\"?\")+(i.textBaseline||\"?\"),this.fillKey_=n?\"string\"==typeof n.fillStyle?n.fillStyle:\"|\"+eN(n.fillStyle):\"\"}else this.text_=\"\";this.declutterImageWithText_=e},e}(x7)},R7=function(){function t(t,e,i,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}return t.prototype.finish=function(){var t={};for(var e in this.buildersByZIndex_){t[e]=t[e]||{};var i=this.buildersByZIndex_[e];for(var n in i){var r=i[n].finish();t[e][n]=r}}return t},t.prototype.getBuilder=function(t,e){var i=void 0!==t?t.toString():\"0\",n=this.buildersByZIndex_[i];void 0===n&&(this.buildersByZIndex_[i]=n={});var r=n[e];return void 0===r&&(r=new(0,D7[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=r),r},t}();function F7(t,e,i,n,r,s,o,a,l,c,h,u){var d=t[e],p=t[e+1],f=0,m=0,g=0,A=0;function v(){f=d,m=p,d=t[e+=n],p=t[e+1],A+=g,g=Math.sqrt((d-f)*(d-f)+(p-m)*(p-m))}do{v()}while(e<i-n&&A+g<s);for(var _=0===g?0:(s-A)/g,y=xz(f,d,_),b=xz(m,p,_),w=e-n,x=A,S=s+a*l(c,r,h);e<i-n&&A+g<S;)v();var C,k=xz(f,d,_=0===g?0:(S-A)/g),E=xz(m,p,_);if(u){var M=[y,b,k,E];B1(M,0,4,2,u,M,M),C=M[0]>M[2]}else C=y>k;var T,I=Math.PI,O=[],P=w+n===e;if(g=0,A=x,d=t[e=w],p=t[e+1],P)return v(),T=Math.atan2(p-m,d-f),C&&(T+=T>0?-I:I),O[0]=[j=(k+y)/2,$=(E+b)/2,(S-s)/2,T,r],O;for(var D=0,R=r.length;D<R;){v();var F=Math.atan2(p-m,d-f);if(C&&(F+=F>0?-I:I),void 0!==T){var L=F-T;if(L+=L>I?-2*I:L<-I?2*I:0,Math.abs(L)>o)return null}T=F;for(var B=D,N=0;D<R;++D){var z=a*l(c,r[C?R-D-1:D],h);if(e+n<i&&A+g<s+N+z/2)break;N+=z}if(D!==B){var V=C?r.substring(R-B,R-D):r.substring(B,D),j=xz(f,d,_=0===g?0:(s+N/2-A)/g),$=xz(m,p,_);O.push([j,$,N/2,F,V]),s+=N}}return O}var L7=[1/0,1/0,-1/0,-1/0],B7=[],N7=[],z7=[],V7=[];function j7(t){return t[3].declutterBox}var $7=new RegExp(\"[\"+String.fromCharCode(1425)+\"-\"+String.fromCharCode(2303)+String.fromCharCode(64285)+\"-\"+String.fromCharCode(65023)+String.fromCharCode(65136)+\"-\"+String.fromCharCode(65276)+String.fromCharCode(67584)+\"-\"+String.fromCharCode(69631)+String.fromCharCode(124928)+\"-\"+String.fromCharCode(126975)+\"]\");function U7(t,e){return(\"start\"===e||\"end\"===e)&&!$7.test(t)&&(e=\"start\"===e?\"left\":\"right\"),P7[e]}var H7=function(){function t(t,e,i,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}return t.prototype.createLabel=function(t,e,i,n){var r=t+e+i+n;if(this.labels_[r])return this.labels_[r];var s=n?this.strokeStates[n]:null,o=i?this.fillStates[i]:null,a=this.textStates[e],l=this.pixelRatio,c=[a.scale[0]*l,a.scale[1]*l],h=U7(t,a.textAlign||$6),u=n&&s.lineWidth?s.lineWidth:0,d=t.split(\"\\n\"),p=d.length,f=[],m=function(t,e,i){for(var n=e.length,r=0,s=0;s<n;++s){var o=Q6(t,e[s]);r=Math.max(r,o),i.push(o)}return r}(a.font,d,f),g=X6(a.font),A=m+u,v=[],_=(A+2)*c[0],y=(g*p+u)*c[1],b={width:_<0?Math.floor(_):Math.ceil(_),height:y<0?Math.floor(y):Math.ceil(y),contextInstructions:v};(1!=c[0]||1!=c[1])&&v.push(\"scale\",c),v.push(\"font\",a.font),n&&(v.push(\"strokeStyle\",s.strokeStyle),v.push(\"lineWidth\",u),v.push(\"lineCap\",s.lineCap),v.push(\"lineJoin\",s.lineJoin),v.push(\"miterLimit\",s.miterLimit),(pN?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D).prototype.setLineDash&&(v.push(\"setLineDash\",[s.lineDash]),v.push(\"lineDashOffset\",s.lineDashOffset))),i&&v.push(\"fillStyle\",o.fillStyle),v.push(\"textBaseline\",\"middle\"),v.push(\"textAlign\",\"center\");var w,x=.5-h,S=h*A+x*u;if(n)for(w=0;w<p;++w)v.push(\"strokeText\",[d[w],S+x*f[w],.5*(u+g)+w*g]);if(i)for(w=0;w<p;++w)v.push(\"fillText\",[d[w],S+x*f[w],.5*(u+g)+w*g]);return this.labels_[r]=b,b},t.prototype.replayTextBackground_=function(t,e,i,n,r,s,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,r),t.lineTo.apply(t,e),s&&(this.alignFill_=s[2],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())},t.prototype.calculateImageOrLabelDimensions_=function(t,e,i,n,r,s,o,a,l,c,h,u,d,p,f,m){var g,A=i-(o*=u[0]),v=n-(a*=u[1]),_=r+l>t?t-l:r,y=s+c>e?e-c:s,b=p[3]+_*u[0]+p[1],w=p[0]+y*u[1]+p[2],x=A-p[3],S=v-p[0];return(f||0!==h)&&(B7[0]=x,V7[0]=x,B7[1]=S,N7[1]=S,N7[0]=x+b,z7[0]=N7[0],z7[1]=S+w,V7[1]=z7[1]),0!==h?(P1(g=D1([1,0,0,1,0,0],i,n,1,1,h,-i,-n),B7),P1(g,N7),P1(g,z7),P1(g,V7),FN(Math.min(B7[0],N7[0],z7[0],V7[0]),Math.min(B7[1],N7[1],z7[1],V7[1]),Math.max(B7[0],N7[0],z7[0],V7[0]),Math.max(B7[1],N7[1],z7[1],V7[1]),L7)):FN(Math.min(x,x+b),Math.min(S,S+w),Math.max(x,x+b),Math.max(S,S+w),L7),d&&(A=Math.round(A),v=Math.round(v)),{drawImageX:A,drawImageY:v,drawImageW:_,drawImageH:y,originX:l,originY:c,declutterBox:{minX:L7[0],minY:L7[1],maxX:L7[2],maxY:L7[3],value:m},canvasTransform:g,scale:u}},t.prototype.replayImageOrLabel_=function(t,e,i,n,r,s,o){var a=n.declutterBox,l=t.canvas,c=o?o[2]*n.scale[0]/2:0;return a.minX-c<=l.width/e&&a.maxX+c>=0&&a.minY-c<=l.height/e&&a.maxY+c>=0&&(!(!s&&!o)&&this.replayTextBackground_(t,B7,N7,z7,V7,s,o),function(t,e,i,n,r,s,o,a,l,c,h){t.save(),1!==i&&(t.globalAlpha*=i),e&&t.setTransform.apply(t,e),n.contextInstructions?(t.translate(l,c),t.scale(h[0],h[1]),function(t,e){for(var i=t.contextInstructions,n=0,r=i.length;n<r;n+=2)Array.isArray(i[n+1])?e[i[n]].apply(e,i[n+1]):e[i[n]]=i[n+1]}(n,t)):h[0]<0||h[1]<0?(t.translate(l,c),t.scale(h[0],h[1]),t.drawImage(n,r,s,o,a,0,0,o,a)):t.drawImage(n,r,s,o,a,l,c,o*h[0],a*h[1]),t.restore()}(t,n.canvasTransform,r,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0},t.prototype.fill_=function(t){if(this.alignFill_){var e=P1(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()},t.prototype.setStrokeStyle_=function(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.setLineDash&&(t.lineDashOffset=e[7],t.setLineDash(e[6]))},t.prototype.drawLabelWithPointPlacement_=function(t,e,i,n){var r=this.textStates[e],s=this.createLabel(t,e,n,i),o=this.strokeStates[i],a=this.pixelRatio,l=U7(t,r.textAlign||$6),c=P7[r.textBaseline||U6],h=o&&o.lineWidth?o.lineWidth:0;return{label:s,anchorX:l*(s.width/a-2*r.scale[0])+2*(.5-l)*h,anchorY:c*s.height/a+2*(.5-c)*h}},t.prototype.execute_=function(t,e,i,n,r,s,o,a){var l;this.pixelCoordinates_&&UB(i,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=L1(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5]}(this.renderedTransform_,i));for(var c,h,u,d,p,f,m,g,A,v,_,y,b,w,x,S,C=0,k=n.length,E=0,M=0,T=0,I=null,O=null,P=this.coordinateCache_,D=this.viewRotation_,R=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,F={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:D},L=this.instructions!=n||this.overlaps?0:200;C<k;){var B=n[C];switch(B[0]){case y7.BEGIN_GEOMETRY:S=B[3],(b=B[1]).getGeometry()?void 0===o||iz(o,S.getExtent())?++C:C=B[2]+1:C=B[2];break;case y7.BEGIN_PATH:M>L&&(this.fill_(t),M=0),T>L&&(t.stroke(),T=0),!M&&!T&&(t.beginPath(),d=NaN,p=NaN),++C;break;case y7.CIRCLE:var N=l[E=B[1]],z=l[E+1],V=l[E+2]-N,j=l[E+3]-z,$=Math.sqrt(V*V+j*j);t.moveTo(N+$,z),t.arc(N,z,$,0,2*Math.PI,!0),++C;break;case y7.CLOSE_PATH:t.closePath(),++C;break;case y7.CUSTOM:E=B[1],c=B[2];var U=B[4],H=6==B.length?B[5]:void 0;F.geometry=B[3],F.feature=b,C in P||(P[C]=[]);var G=P[C];H?H(l,E,c,2,G):(G[0]=l[E],G[1]=l[E+1],G.length=2),U(G,F),++C;break;case y7.DRAW_IMAGE:E=B[1],c=B[2],h=B[4],u=B[5];var q=B[6],W=B[7],Y=B[8],Z=B[9],X=B[10],K=B[11],Q=B[12],J=B[13],tt=B[14];if(!(g=B[3])&&B.length>=19){var et=this.drawLabelWithPointPlacement_(A=B[18],v=B[19],_=B[20],y=B[21]);B[3]=g=et.label,B[4]=h=(et.anchorX-B[22])*this.pixelRatio,B[5]=u=(et.anchorY-B[23])*this.pixelRatio,B[6]=q=g.height,B[13]=J=g.width}var it=void 0;B.length>24&&(it=B[24]);var nt=void 0,rt=void 0,st=void 0;B.length>16?(nt=B[15],rt=B[16],st=B[17]):(nt=H6,rt=!1,st=!1),X&&R?K+=D:!X&&!R&&(K-=D);for(var ot=0;E<c;E+=2)if(!(it&&it[ot++]<J/this.pixelRatio)){var at=[t,e,g,Pt=this.calculateImageOrLabelDimensions_(g.width,g.height,l[E],l[E+1],J,q,h,u,Y,Z,K,Q,r,nt,rt||st,b),W,rt?I:null,st?O:null],lt=void 0,ct=void 0;if(a&&tt){var ht=c-E;if(!tt[ht]){tt[ht]=at;continue}if(lt=tt[ht],delete tt[ht],ct=j7(lt),a.collides(ct))continue}a&&a.collides(Pt.declutterBox)||(lt&&(a&&a.insert(ct),this.replayImageOrLabel_.apply(this,lt)),a&&a.insert(Pt.declutterBox),this.replayImageOrLabel_.apply(this,at))}++C;break;case y7.DRAW_CHARS:var ut=B[1],dt=B[2],pt=B[3],ft=B[4];y=B[5];var mt=B[6],gt=B[7],At=B[8];_=B[9];var vt=B[10];A=B[11];var _t=[B[13],B[13]],yt=this.textStates[v=B[12]],bt=yt.font,wt=[yt.scale[0]*gt,yt.scale[1]*gt],xt=void 0;bt in this.widths_?xt=this.widths_[bt]:this.widths_[bt]=xt={};var St=w2(l,ut,dt,2),Ct=Math.abs(wt[0])*J6(bt,A,xt);if(ft||Ct<=St){var kt=F7(l,ut,dt,2,A,(St-Ct)*P7[this.textStates[v].textAlign],mt,Math.abs(wt[0]),J6,bt,xt,R?0:this.viewRotation_);t:if(kt){var Et=[],Mt=void 0,Tt=void 0,It=void 0,Ot=void 0;if(_)for(Mt=0,Tt=kt.length;Mt<Tt;++Mt){It=this.createLabel((Ot=kt[Mt])[4],v,\"\",_);var Pt=this.calculateImageOrLabelDimensions_(It.width,It.height,Ot[0],Ot[1],It.width,It.height,h=Ot[2]+(wt[0]<0?-vt:vt),u=pt*It.height+2*(.5-pt)*vt*wt[1]/wt[0]-At,0,0,Ot[3],_t,!1,H6,!1,b);if(a&&a.collides(Pt.declutterBox))break t;Et.push([t,e,It,Pt,1,null,null])}if(y)for(Mt=0,Tt=kt.length;Mt<Tt;++Mt){if(It=this.createLabel((Ot=kt[Mt])[4],v,y,\"\"),Pt=this.calculateImageOrLabelDimensions_(It.width,It.height,Ot[0],Ot[1],It.width,It.height,h=Ot[2],u=pt*It.height-At,0,0,Ot[3],_t,!1,H6,!1,b),a&&a.collides(Pt.declutterBox))break t;Et.push([t,e,It,Pt,1,null,null])}a&&a.load(Et.map(j7));for(var Dt=0,Rt=Et.length;Dt<Rt;++Dt)this.replayImageOrLabel_.apply(this,Et[Dt])}}++C;break;case y7.END_GEOMETRY:if(void 0!==s){var Ft=s(b=B[1],S);if(Ft)return Ft}++C;break;case y7.FILL:L?M++:this.fill_(t),++C;break;case y7.MOVE_TO_LINE_TO:for(c=B[2],m=(x=l[(E=B[1])+1])+.5|0,((f=(w=l[E])+.5|0)!==d||m!==p)&&(t.moveTo(w,x),d=f,p=m),E+=2;E<c;E+=2)f=(w=l[E])+.5|0,m=(x=l[E+1])+.5|0,(E==c-2||f!==d||m!==p)&&(t.lineTo(w,x),d=f,p=m);++C;break;case y7.SET_FILL_STYLE:I=B,this.alignFill_=B[2],M&&(this.fill_(t),M=0,T&&(t.stroke(),T=0)),t.fillStyle=B[1],++C;break;case y7.SET_STROKE_STYLE:O=B,T&&(t.stroke(),T=0),this.setStrokeStyle_(t,B),++C;break;case y7.STROKE:L?T++:t.stroke(),++C;break;default:++C}}M&&this.fill_(t),T&&t.stroke()},t.prototype.execute=function(t,e,i,n,r,s){this.viewRotation_=n,this.execute_(t,e,i,this.instructions,r,void 0,void 0,s)},t.prototype.executeHitDetection=function(t,e,i,n,r){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,n,r)},t}(),G7=[\"Polygon\",\"Circle\",\"LineString\",\"Image\",\"Text\",\"Default\"],q7=function(){function t(t,e,i,n,r,s){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=s,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(r)}return t.prototype.clip=function(t,e){var i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()},t.prototype.createExecutors_=function(t){for(var e in t){var i=this.executorsByZIndex_[e];void 0===i&&(this.executorsByZIndex_[e]=i={});var n=t[e];for(var r in n)i[r]=new H7(this.resolution_,this.pixelRatio_,this.overlaps_,n[r])}},t.prototype.hasExecutors=function(t){for(var e in this.executorsByZIndex_)for(var i=this.executorsByZIndex_[e],n=0,r=t.length;n<r;++n)if(t[n]in i)return!0;return!1},t.prototype.forEachFeatureAtCoordinate=function(t,e,i,n,r,s){var o=2*(n=Math.round(n))+1,a=D1(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]),l=!this.hitDetectionContext_;l&&(this.hitDetectionContext_=gN(o,o));var c,h=this.hitDetectionContext_;h.canvas.width!==o||h.canvas.height!==o?(h.canvas.width=o,h.canvas.height=o):l||h.clearRect(0,0,o,o),void 0!==this.renderBuffer_&&(jN(c=[1/0,1/0,-1/0,-1/0],t),MN(c,e*(this.renderBuffer_+n),c));var u,d=function(t){if(void 0!==W7[t])return W7[t];for(var e=2*t+1,i=t*t,n=new Array(i+1),r=0;r<=t;++r)for(var s=0;s<=t;++s){var o=r*r+s*s;if(o>i)break;var a=n[o];a||(n[o]=a=[]),a.push(4*((t+r)*e+(t+s))+3),r>0&&a.push(4*((t-r)*e+(t+s))+3),s>0&&(a.push(4*((t+r)*e+(t-s))+3),r>0&&a.push(4*((t-r)*e+(t-s))+3))}for(var l=[],c=(r=0,n.length);r<c;++r)n[r]&&l.push.apply(l,n[r]);return W7[t]=l,l}(n);function p(t,e){for(var i=h.getImageData(0,0,o,o).data,a=0,l=d.length;a<l;a++)if(i[d[a]]>0){if(!s||\"Image\"!==u&&\"Text\"!==u||-1!==s.indexOf(t)){var c=(d[a]-3)/4,p=n-c%o,f=n-(c/o|0),m=r(t,e,p*p+f*f);if(m)return m}h.clearRect(0,0,o,o);break}}var f,m,g,A,v,_=Object.keys(this.executorsByZIndex_).map(Number);for(_.sort(NB),f=_.length-1;f>=0;--f){var y=_[f].toString();for(g=this.executorsByZIndex_[y],m=G7.length-1;m>=0;--m)if(void 0!==(A=g[u=G7[m]])&&(v=A.executeHitDetection(h,a,i,p,c)))return v}},t.prototype.getClipCoords=function(t){var e=this.maxExtent_;if(!e)return null;var i=e[0],n=e[1],r=e[2],s=e[3],o=[i,n,i,s,r,s,r,n];return L1(o,0,8,2,t,o),o},t.prototype.isEmpty=function(){return XB(this.executorsByZIndex_)},t.prototype.execute=function(t,e,i,n,r,s,o){var a=Object.keys(this.executorsByZIndex_).map(Number);a.sort(NB),this.maxExtent_&&(t.save(),this.clip(t,i));var l,c,h,u,d,p,f=s||G7;for(o&&a.reverse(),l=0,c=a.length;l<c;++l){var m=a[l].toString();for(d=this.executorsByZIndex_[m],h=0,u=f.length;h<u;++h)void 0!==(p=d[f[h]])&&p.execute(t,e,i,n,r,o)}this.maxExtent_&&t.restore()},t}(),W7={},Y7=q7,Z7=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),X7=function(t){function e(e,i,n,r,s,o,a){var l=t.call(this)||this;return l.context_=e,l.pixelRatio_=i,l.extent_=n,l.transform_=r,l.viewRotation_=s,l.squaredTolerance_=o,l.userTransform_=a,l.contextFillState_=null,l.contextStrokeState_=null,l.contextTextState_=null,l.fillState_=null,l.strokeState_=null,l.image_=null,l.imageAnchorX_=0,l.imageAnchorY_=0,l.imageHeight_=0,l.imageOpacity_=0,l.imageOriginX_=0,l.imageOriginY_=0,l.imageRotateWithView_=!1,l.imageRotation_=0,l.imageScale_=[0,0],l.imageWidth_=0,l.text_=\"\",l.textOffsetX_=0,l.textOffsetY_=0,l.textRotateWithView_=!1,l.textRotation_=0,l.textScale_=[0,0],l.textFillState_=null,l.textStrokeState_=null,l.textState_=null,l.pixelCoordinates_=[],l.tmpLocalTransform_=[1,0,0,1,0,0],l}return Z7(e,t),e.prototype.drawImages_=function(t,e,i,n){if(this.image_){var r=L1(t,e,i,n,this.transform_,this.pixelCoordinates_),s=this.context_,o=this.tmpLocalTransform_,a=s.globalAlpha;1!=this.imageOpacity_&&(s.globalAlpha=a*this.imageOpacity_);var l=this.imageRotation_;this.imageRotateWithView_&&(l+=this.viewRotation_);for(var c=0,h=r.length;c<h;c+=2){var u=r[c]-this.imageAnchorX_,d=r[c+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_[0]||1!=this.imageScale_[1]){var p=u+this.imageAnchorX_,f=d+this.imageAnchorY_;D1(o,p,f,1,1,l,-p,-f),s.setTransform.apply(s,o),s.translate(p,f),s.scale(this.imageScale_[0],this.imageScale_[1]),s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),s.setTransform(1,0,0,1,0,0)}else s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,u,d,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(s.globalAlpha=a)}},e.prototype.drawText_=function(t,e,i,n){if(this.textState_&&\"\"!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var r=L1(t,e,i,n,this.transform_,this.pixelCoordinates_),s=this.context_,o=this.textRotation_;for(this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=n){var a=r[e]+this.textOffsetX_,l=r[e+1]+this.textOffsetY_;if(0!==o||1!=this.textScale_[0]||1!=this.textScale_[1]){var c=D1(this.tmpLocalTransform_,a,l,1,1,o,-a,-l);s.setTransform.apply(s,c),s.translate(a,l),s.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&s.strokeText(this.text_,0,0),this.textFillState_&&s.fillText(this.text_,0,0),s.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&s.strokeText(this.text_,a,l),this.textFillState_&&s.fillText(this.text_,a,l)}}},e.prototype.moveToLineTo_=function(t,e,i,n,r){var s=this.context_,o=L1(t,e,i,n,this.transform_,this.pixelCoordinates_);s.moveTo(o[0],o[1]);var a=o.length;r&&(a-=2);for(var l=2;l<a;l+=2)s.lineTo(o[l],o[l+1]);return r&&s.closePath(),i},e.prototype.drawRings_=function(t,e,i,n){for(var r=0,s=i.length;r<s;++r)e=this.moveToLineTo_(t,e,i[r],n,!0);return e},e.prototype.drawCircle=function(t){if(iz(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=function(t,e,i){var n=t.getFlatCoordinates();if(n){var r=t.getStride();return L1(n,0,n.length,r,e,i)}return null}(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],r=Math.sqrt(i*i+n*n),s=this.context_;s.beginPath(),s.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&s.fill(),this.strokeState_&&s.stroke()}\"\"!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}},e.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},e.prototype.setTransform=function(t){this.transform_=t},e.prototype.drawGeometry=function(t){switch(t.getType()){case\"Point\":this.drawPoint(t);break;case\"LineString\":this.drawLineString(t);break;case\"Polygon\":this.drawPolygon(t);break;case\"MultiPoint\":this.drawMultiPoint(t);break;case\"MultiLineString\":this.drawMultiLineString(t);break;case\"MultiPolygon\":this.drawMultiPolygon(t);break;case\"GeometryCollection\":this.drawGeometryCollection(t);break;case\"Circle\":this.drawCircle(t)}},e.prototype.drawFeature=function(t,e){var i=e.getGeometryFunction()(t);!i||!iz(this.extent_,i.getExtent())||(this.setStyle(e),this.drawGeometry(i))},e.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),i=0,n=e.length;i<n;++i)this.drawGeometry(e[i])},e.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),\"\"!==this.text_&&this.drawText_(e,0,e.length,i)},e.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),\"\"!==this.text_&&this.drawText_(e,0,e.length,i)},e.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),iz(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(\"\"!==this.text_){var n=t.getFlatMidpoint();this.drawText_(n,0,2,2)}}},e.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getExtent();if(iz(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,n=t.getFlatCoordinates(),r=0,s=t.getEnds(),o=t.getStride();i.beginPath();for(var a=0,l=s.length;a<l;++a)r=this.moveToLineTo_(n,r,s[a],o,!1);i.stroke()}if(\"\"!==this.text_){var c=t.getFlatMidpoints();this.drawText_(c,0,c.length,2)}}},e.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),iz(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(\"\"!==this.text_){var i=t.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}},e.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),iz(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getOrientedFlatCoordinates(),n=0,r=t.getEndss(),s=t.getStride();e.beginPath();for(var o=0,a=r.length;o<a;++o)n=this.drawRings_(i,n,r[o],s);this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(\"\"!==this.text_){var l=t.getFlatInteriorPoints();this.drawText_(l,0,l.length,2)}}},e.prototype.setContextFillState_=function(t){var e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},e.prototype.setContextStrokeState_=function(t){var e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),e.setLineDash&&(UB(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset)),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},e.prototype.setContextTextState_=function(t){var e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:$6;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})},e.prototype.setFillStrokeStyle=function(t,e){var i=this;if(t){var n=t.getColor();this.fillState_={fillStyle:t7(n||B6)}}else this.fillState_=null;if(e){var r=e.getColor(),s=e.getLineCap(),o=e.getLineDash(),a=e.getLineDashOffset(),l=e.getLineJoin(),c=e.getWidth(),h=e.getMiterLimit(),u=o||z6;this.strokeState_={lineCap:void 0!==s?s:N6,lineDash:1===this.pixelRatio_?u:u.map(function(t){return t*i.pixelRatio_}),lineDashOffset:(a||0)*this.pixelRatio_,lineJoin:void 0!==l?l:V6,lineWidth:(void 0!==c?c:1)*this.pixelRatio_,miterLimit:void 0!==h?h:10,strokeStyle:t7(r||j6)}}else this.strokeState_=null},e.prototype.setImageStyle=function(t){var e;if(t&&(e=t.getSize())){var i=t.getAnchor(),n=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*this.pixelRatio_,this.imageAnchorY_=i[1]*this.pixelRatio_,this.imageHeight_=e[1]*this.pixelRatio_,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScaleArray(),this.imageWidth_=e[0]*this.pixelRatio_}else this.image_=null},e.prototype.setTextStyle=function(t){if(t){var e=t.getFill();if(e){var i=e.getColor();this.textFillState_={fillStyle:t7(i||B6)}}else this.textFillState_=null;var n=t.getStroke();if(n){var r=n.getColor(),s=n.getLineCap(),o=n.getLineDash(),a=n.getLineDashOffset(),l=n.getLineJoin(),c=n.getWidth(),h=n.getMiterLimit();this.textStrokeState_={lineCap:void 0!==s?s:N6,lineDash:o||z6,lineDashOffset:a||0,lineJoin:void 0!==l?l:V6,lineWidth:void 0!==c?c:1,miterLimit:void 0!==h?h:10,strokeStyle:t7(r||j6)}}else this.textStrokeState_=null;var u=t.getFont(),d=t.getOffsetX(),p=t.getOffsetY(),f=t.getRotateWithView(),m=t.getRotation(),g=t.getScaleArray(),A=t.getText(),v=t.getTextAlign(),_=t.getTextBaseline();this.textState_={font:void 0!==u?u:L6,textAlign:void 0!==v?v:$6,textBaseline:void 0!==_?_:U6},this.text_=void 0!==A?A:\"\",this.textOffsetX_=void 0!==d?this.pixelRatio_*d:0,this.textOffsetY_=void 0!==p?this.pixelRatio_*p:0,this.textRotateWithView_=void 0!==f&&f,this.textRotation_=void 0!==m?m:0,this.textScale_=[this.pixelRatio_*g[0],this.pixelRatio_*g[1]]}else this.text_=\"\"},e}(b7),K7=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Q7=null,J7=function(t){function e(e,i,n,r,s,o){var a=t.call(this)||this;return a.hitDetectionImage_=null,a.image_=e||new Image,null!==r&&(a.image_.crossOrigin=r),a.canvas_={},a.color_=o,a.unlisten_=null,a.imageState_=s,a.size_=n,a.src_=i,a}return K7(e,t),e.prototype.isTainted_=function(){if(void 0===this.tainted_&&2===this.imageState_){Q7||(Q7=gN(1,1)),Q7.drawImage(this.image_,0,0);try{Q7.getImageData(0,0,1,1),this.tainted_=!1}catch(k6){Q7=null,this.tainted_=!0}}return!0===this.tainted_},e.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(\"change\")},e.prototype.handleImageError_=function(){this.imageState_=3,this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.handleImageLoad_=function(){this.imageState_=2,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.getImage=function(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_},e.prototype.getPixelRatio=function(t){return this.replaceColor_(t),this.canvas_[t]?t:1},e.prototype.getImageState=function(){return this.imageState_},e.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var t=this.size_[0],e=this.size_[1],i=gN(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},e.prototype.getSize=function(){return this.size_},e.prototype.getSrc=function(){return this.src_},e.prototype.load=function(){if(0==this.imageState_){this.imageState_=1;try{this.image_.src=this.src_}catch(k6){this.handleImageError_()}this.unlisten_=lz(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},e.prototype.replaceColor_=function(t){if(this.color_&&!this.canvas_[t]&&2===this.imageState_){var e=document.createElement(\"canvas\");this.canvas_[t]=e,e.width=Math.ceil(this.image_.width*t),e.height=Math.ceil(this.image_.height*t);var i=e.getContext(\"2d\");if(i.scale(t,t),i.drawImage(this.image_,0,0),i.globalCompositeOperation=\"multiply\",\"multiply\"===i.globalCompositeOperation||this.isTainted_())i.fillStyle=x6(this.color_),i.fillRect(0,0,e.width/t,e.height/t),i.globalCompositeOperation=\"destination-in\",i.drawImage(this.image_,0,0);else{for(var n=i.getImageData(0,0,e.width,e.height),r=n.data,s=this.color_[0]/255,o=this.color_[1]/255,a=this.color_[2]/255,l=this.color_[3],c=0,h=r.length;c<h;c+=4)r[c]*=s,r[c+1]*=o,r[c+2]*=a,r[c+3]*=l;i.putImageData(n,0,0)}}},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(QB),t9=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),e9=function(t){function e(e){var i=this,n=e||{};(i=t.call(this,{opacity:void 0!==n.opacity?n.opacity:1,rotation:void 0!==n.rotation?n.rotation:0,scale:void 0!==n.scale?n.scale:1,displacement:void 0!==n.displacement?n.displacement:[0,0],rotateWithView:void 0!==n.rotateWithView&&n.rotateWithView})||this).anchor_=void 0!==n.anchor?n.anchor:[.5,.5],i.normalizedAnchor_=null,i.anchorOrigin_=void 0!==n.anchorOrigin?n.anchorOrigin:\"top-left\",i.anchorXUnits_=void 0!==n.anchorXUnits?n.anchorXUnits:\"fraction\",i.anchorYUnits_=void 0!==n.anchorYUnits?n.anchorYUnits:\"fraction\",i.crossOrigin_=void 0!==n.crossOrigin?n.crossOrigin:null;var r=void 0!==n.img?n.img:null,s=void 0!==n.imgSize?n.imgSize:null,o=n.src;kN(!(void 0!==o&&r),4),kN(!r||r&&s,5),(void 0===o||0===o.length)&&r&&(o=r.src||eN(r)),kN(void 0!==o&&o.length>0,6);var a=void 0!==n.src?0:2;return i.color_=void 0!==n.color?M6(n.color):null,i.iconImage_=function(t,e,i,n,r,s){var o=P6.get(e,n,s);return o||(o=new J7(t,e,i,n,r,s),P6.set(e,n,s,o)),o}(r,o,s,i.crossOrigin_,a,i.color_),i.offset_=void 0!==n.offset?n.offset:[0,0],i.offsetOrigin_=void 0!==n.offsetOrigin?n.offsetOrigin:\"top-left\",i.origin_=null,i.size_=void 0!==n.size?n.size:null,i}return t9(e,t),e.prototype.clone=function(){var t=this.getScale();return new e({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},e.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var t=this.anchor_,e=this.getSize();if(\"fraction\"==this.anchorXUnits_||\"fraction\"==this.anchorYUnits_){if(!e)return null;t=this.anchor_.slice(),\"fraction\"==this.anchorXUnits_&&(t[0]*=e[0]),\"fraction\"==this.anchorYUnits_&&(t[1]*=e[1])}if(\"top-left\"!=this.anchorOrigin_){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),(\"top-right\"==this.anchorOrigin_||\"bottom-right\"==this.anchorOrigin_)&&(t[0]=-t[0]+e[0]),(\"bottom-left\"==this.anchorOrigin_||\"bottom-right\"==this.anchorOrigin_)&&(t[1]=-t[1]+e[1])}var i=this.getDisplacement();return t[0]-=i[0],t[1]+=i[1],this.normalizedAnchor_=t,this.normalizedAnchor_},e.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},e.prototype.getColor=function(){return this.color_},e.prototype.getImage=function(t){return this.iconImage_.getImage(t)},e.prototype.getPixelRatio=function(t){return this.iconImage_.getPixelRatio(t)},e.prototype.getImageSize=function(){return this.iconImage_.getSize()},e.prototype.getImageState=function(){return this.iconImage_.getImageState()},e.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},e.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(\"top-left\"!=this.offsetOrigin_){var e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(\"top-right\"==this.offsetOrigin_||\"bottom-right\"==this.offsetOrigin_)&&(t[0]=i[0]-e[0]-t[0]),(\"bottom-left\"==this.offsetOrigin_||\"bottom-right\"==this.offsetOrigin_)&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_},e.prototype.getSrc=function(){return this.iconImage_.getSrc()},e.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},e.prototype.listenImageChange=function(t){this.iconImage_.addEventListener(\"change\",t)},e.prototype.load=function(){this.iconImage_.load()},e.prototype.unlistenImageChange=function(t){this.iconImage_.removeEventListener(\"change\",t)},e}(J8),i9=.5,n9={Point:function(t,e,i,n,r){var s,o=i.getImage(),a=i.getText();if(r&&(t=r,s=o&&a&&a.getText()?{}:void 0),o){if(2!=o.getImageState())return;var l=t.getBuilder(i.getZIndex(),\"Image\");l.setImageStyle(o,s),l.drawPoint(e,n)}if(a&&a.getText()){var c=t.getBuilder(i.getZIndex(),\"Text\");c.setTextStyle(a,s),c.drawText(e,n)}},LineString:function(t,e,i,n,r){var s=i.getStroke();if(s){var o=t.getBuilder(i.getZIndex(),\"LineString\");o.setFillStrokeStyle(null,s),o.drawLineString(e,n)}var a=i.getText();if(a&&a.getText()){var l=(r||t).getBuilder(i.getZIndex(),\"Text\");l.setTextStyle(a),l.drawText(e,n)}},Polygon:function(t,e,i,n,r){var s=i.getFill(),o=i.getStroke();if(s||o){var a=t.getBuilder(i.getZIndex(),\"Polygon\");a.setFillStrokeStyle(s,o),a.drawPolygon(e,n)}var l=i.getText();if(l&&l.getText()){var c=(r||t).getBuilder(i.getZIndex(),\"Text\");c.setTextStyle(l),c.drawText(e,n)}},MultiPoint:function(t,e,i,n,r){var s,o=i.getImage(),a=i.getText();if(r&&(t=r,s=o&&a&&a.getText()?{}:void 0),o){if(2!=o.getImageState())return;var l=t.getBuilder(i.getZIndex(),\"Image\");l.setImageStyle(o,s),l.drawMultiPoint(e,n)}if(a&&a.getText()){var c=(r||t).getBuilder(i.getZIndex(),\"Text\");c.setTextStyle(a,s),c.drawText(e,n)}},MultiLineString:function(t,e,i,n,r){var s=i.getStroke();if(s){var o=t.getBuilder(i.getZIndex(),\"LineString\");o.setFillStrokeStyle(null,s),o.drawMultiLineString(e,n)}var a=i.getText();if(a&&a.getText()){var l=(r||t).getBuilder(i.getZIndex(),\"Text\");l.setTextStyle(a),l.drawText(e,n)}},MultiPolygon:function(t,e,i,n,r){var s=i.getFill(),o=i.getStroke();if(o||s){var a=t.getBuilder(i.getZIndex(),\"Polygon\");a.setFillStrokeStyle(s,o),a.drawMultiPolygon(e,n)}var l=i.getText();if(l&&l.getText()){var c=(r||t).getBuilder(i.getZIndex(),\"Text\");c.setTextStyle(l),c.drawText(e,n)}},GeometryCollection:function(t,e,i,n,r){var s,o,a=e.getGeometriesArray();for(s=0,o=a.length;s<o;++s)(0,n9[a[s].getType()])(t,a[s],i,n,r)},Circle:function(t,e,i,n,r){var s=i.getFill(),o=i.getStroke();if(s||o){var a=t.getBuilder(i.getZIndex(),\"Circle\");a.setFillStrokeStyle(s,o),a.drawCircle(e,n)}var l=i.getText();if(l&&l.getText()){var c=(r||t).getBuilder(i.getZIndex(),\"Text\");c.setTextStyle(l),c.drawText(e,n)}}};function r9(t,e){return parseInt(eN(t),10)-parseInt(eN(e),10)}function s9(t,e){var i=o9(t,e);return i*i}function o9(t,e){return.5*t/e}function a9(t,e,i,n,r,s,o){var a=!1,l=i.getImage();if(l){var c=l.getImageState();2==c||3==c?l.unlistenImageChange(r):(0==c&&l.load(),c=l.getImageState(),l.listenImageChange(r),a=!0)}return function(t,e,i,n,r,s){var o=i.getGeometryFunction()(e);if(o){var a=o.simplifyTransformed(n,r);i.getRenderer()?l9(t,a,i,e):(0,n9[a.getType()])(t,a,i,e,s)}}(t,e,i,n,s,o),a}function l9(t,e,i,n){if(\"GeometryCollection\"!=e.getType())t.getBuilder(i.getZIndex(),\"Default\").drawCustom(e,n,i.getRenderer(),i.getHitDetectionRenderer());else for(var r=e.getGeometries(),s=0,o=r.length;s<o;++s)l9(t,r[s],i,n)}var c9=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),h9=function(t){function e(e){var i=t.call(this,e)||this;return i.boundHandleStyleImageChange_=i.handleStyleImageChange_.bind(i),i.dirty_=!1,i.hitDetectionImageData_=null,i.renderedFeatures_=null,i.renderedRevision_=-1,i.renderedResolution_=NaN,i.renderedExtent_=[1/0,1/0,-1/0,-1/0],i.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],i.renderedCenter_=null,i.renderedProjection_=null,i.renderedRenderOrder_=null,i.replayGroup_=null,i.replayGroupChanged=!0,i.declutterExecutorGroup=null,i.clipping=!0,i}return c9(e,t),e.prototype.useContainer=function(e,i,n){n<1&&(e=null),t.prototype.useContainer.call(this,e,i,n)},e.prototype.renderWorlds=function(t,e,i){var n=e.extent,r=e.viewState,s=r.center,o=r.resolution,a=r.projection,l=r.rotation,c=a.getExtent(),h=this.getLayer().getSource(),u=e.pixelRatio,d=e.viewHints,p=!(d[0]||d[1]),f=this.context,m=Math.round(e.size[0]*u),g=Math.round(e.size[1]*u),A=h.getWrapX()&&a.canWrapX(),v=A?ez(c):null,_=A?Math.ceil((n[2]-c[2])/v)+1:1,y=A?Math.floor((n[0]-c[0])/v):0;do{var b=this.getRenderTransform(s,o,l,u,m,g,y*v);t.execute(f,1,b,l,p,void 0,i)}while(++y<_)},e.prototype.renderDeclutter=function(t){this.declutterExecutorGroup&&this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree)},e.prototype.renderFrame=function(t,e){var i=t.pixelRatio,n=t.layerStatesArray[t.layerIndex];(function(t,e,i){O1(t,e,0,0,i,0,0)})(this.pixelTransform,1/i,1/i),R1(this.inversePixelTransform,this.pixelTransform);var r=F1(this.pixelTransform);this.useContainer(e,r,n.opacity);var s=this.context,o=s.canvas,a=this.replayGroup_,l=this.declutterExecutorGroup;if((!a||a.isEmpty())&&(!l||l.isEmpty()))return null;var c=Math.round(t.size[0]*i),h=Math.round(t.size[1]*i);o.width!=c||o.height!=h?(o.width=c,o.height=h,o.style.transform!==r&&(o.style.transform=r)):this.containerReused||s.clearRect(0,0,c,h),this.preRender(s,t);var u=t.viewState,d=!1,p=!0;if(n.extent&&this.clipping){var f=dV(n.extent);(d=(p=iz(f,t.extent))&&!PN(f,t.extent))&&this.clipUnrotated(s,t,f)}p&&this.renderWorlds(a,t),d&&s.restore(),this.postRender(s,t);var m=f6(n.opacity),g=this.container;return m!==g.style.opacity&&(g.style.opacity=m),this.renderedRotation_!==u.rotation&&(this.renderedRotation_=u.rotation,this.hitDetectionImageData_=null),this.container},e.prototype.getFeatures=function(t){return new Promise((function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var i=[this.context.canvas.width,this.context.canvas.height];P1(this.pixelTransform,i);var n=this.renderedCenter_,r=this.renderedResolution_,s=this.renderedRotation_,o=this.renderedProjection_,a=this.wrappedRenderedExtent_,l=this.getLayer(),c=[],h=i[0]*i9,u=i[1]*i9;c.push(this.getRenderTransform(n,r,s,i9,h,u,0).slice());var d=l.getSource(),p=o.getExtent();if(d.getWrapX()&&o.canWrapX()&&!PN(p,a)){for(var f=a[0],m=ez(p),g=0;f<p[0];)--g,c.push(this.getRenderTransform(n,r,s,i9,h,u,m*g).slice()),f+=m;for(g=0,f=a[2];f>p[2];)++g,c.push(this.getRenderTransform(n,r,s,i9,h,u,m*g).slice()),f-=m}this.hitDetectionImageData_=function(t,e,i,n,r,s,o){var a=gN(t[0]*i9,t[1]*i9);a.imageSmoothingEnabled=!1;for(var l=a.canvas,c=new X7(a,i9,r,null,o),h=i.length,u=Math.floor(16777215/h),d={},p=1;p<=h;++p){var f=i[p-1],m=f.getStyleFunction()||n;if(n){var g=m(f,s);if(g){Array.isArray(g)||(g=[g]);for(var A=\"#\"+(\"000000\"+(p*u).toString(16)).slice(-6),v=0,_=g.length;v<_;++v){var y=g[v],b=y.getGeometryFunction()(f);if(b&&iz(r,b.getExtent())){var w=y.clone(),x=w.getFill();x&&x.setColor(A);var S=w.getStroke();S&&(S.setColor(A),S.setLineDash(null)),w.setText(void 0);var C=y.getImage();if(C&&0!==C.getOpacity()){var k=C.getImageSize();if(!k)continue;var E=gN(k[0],k[1],void 0,{alpha:!1}),M=E.canvas;E.fillStyle=A,E.fillRect(0,0,M.width,M.height),w.setImage(new e9({img:M,imgSize:k,anchor:C.getAnchor(),anchorXUnits:\"pixels\",anchorYUnits:\"pixels\",offset:C.getOrigin(),opacity:1,size:C.getSize(),scale:C.getScale(),rotation:C.getRotation(),rotateWithView:C.getRotateWithView()}))}var T=w.getZIndex()||0;(P=d[T])||(d[T]=P={},P.Polygon=[],P.Circle=[],P.LineString=[],P.Point=[]),P[b.getType().replace(\"Multi\",\"\")].push(b,w)}}}}}for(var I=Object.keys(d).map(Number).sort(NB),O=(p=0,I.length);p<O;++p){var P=d[I[p]];for(var D in P){var R=P[D];for(v=0,_=R.length;v<_;v+=2){c.setStyle(R[v+1]);for(var F=0,L=e.length;F<L;++F)c.setTransform(e[F]),c.drawGeometry(R[v])}}}return a.getImageData(0,0,l.width,l.height)}(i,c,this.renderedFeatures_,l.getStyleFunction(),a,r,s)}e(function(t,e,i){var n=[];if(i){var r=Math.floor(Math.round(t[0])*i9),s=Math.floor(Math.round(t[1])*i9),o=4*(mz(r,0,i.width-1)+mz(s,0,i.height-1)*i.width),a=i.data[o+2]+256*(i.data[o+1]+256*i.data[o]),l=Math.floor(16777215/e.length);a&&a%l==0&&n.push(e[a/l-1])}return n}(t,this.renderedFeatures_,this.hitDetectionImageData_))}).bind(this))},e.prototype.forEachFeatureAtCoordinate=function(t,e,i,n,r){var s=this;if(this.replayGroup_){var o,a=e.viewState.resolution,l=e.viewState.rotation,c=this.getLayer(),h={},u=function(t,e,i){var s=eN(t),o=h[s];if(o){if(!0!==o&&i<o.distanceSq){if(0===i)return h[s]=!0,r.splice(r.lastIndexOf(o),1),n(t,c,e);o.geometry=e,o.distanceSq=i}}else{if(0===i)return h[s]=!0,n(t,c,e);r.push(h[s]={feature:t,layer:c,geometry:e,distanceSq:i,callback:n})}},d=[this.replayGroup_];return this.declutterExecutorGroup&&d.push(this.declutterExecutorGroup),d.some(function(n){return o=n.forEachFeatureAtCoordinate(t,a,l,i,u,n===s.declutterExecutorGroup?e.declutterTree.all().map(function(t){return t.value}):null)}),o}},e.prototype.handleFontsChanged=function(){var t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()},e.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},e.prototype.prepareFrame=function(t){var e=this.getLayer(),i=e.getSource();if(!i)return!1;var n=t.viewHints[0],r=t.viewHints[1],s=e.getUpdateWhileAnimating(),o=e.getUpdateWhileInteracting();if(!this.dirty_&&!s&&n||!o&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var a=t.extent,l=t.viewState,c=l.projection,h=l.resolution,u=t.pixelRatio,d=e.getRevision(),p=e.getRenderBuffer(),f=e.getRenderOrder();void 0===f&&(f=r9);var m=l.center.slice(),g=MN(a,p*h),A=g.slice(),v=[g.slice()],_=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!PN(_,t.extent)){var y=ez(_),b=Math.max(ez(g)/2,y);g[0]=_[0]-b,g[2]=_[2]+b,Cj(m,c);var w=function(t,e){var i=e.getExtent(),n=YN(t);if(e.canWrapX()&&(n[0]<i[0]||n[0]>=i[2])){var r=ez(i),s=Math.floor((n[0]-i[0])/r)*r;t[0]-=s,t[2]-=s}return t}(v[0],c);w[0]<_[0]&&w[2]<_[2]?v.push([w[0]+y,w[1],w[2]+y,w[3]]):w[0]>_[0]&&w[2]>_[2]&&v.push([w[0]-y,w[1],w[2]-y,w[3]])}if(!this.dirty_&&this.renderedResolution_==h&&this.renderedRevision_==d&&this.renderedRenderOrder_==f&&PN(this.wrappedRenderedExtent_,g))return UB(this.renderedExtent_,A)||(this.hitDetectionImageData_=null,this.renderedExtent_=A),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var x,S=new R7(o9(h,u),g,h,u);this.getLayer().getDeclutter()&&(x=new R7(o9(h,u),g,h,u));var C,k=oV();if(k){for(var E=0,M=v.length;E<M;++E){var T=uV(v[E]);i.loadFeatures(T,pV(h),k)}C=eV(k,c)}else for(E=0,M=v.length;E<M;++E)i.loadFeatures(v[E],h,c);var I=s9(h,u),O=(function(t){var i,n=t.getStyleFunction()||e.getStyleFunction();if(n&&(i=n(t,h)),i){var r=this.renderFeature(t,I,i,S,C,x);this.dirty_=this.dirty_||r}}).bind(this),P=uV(g),D=i.getFeaturesInExtent(P);for(f&&D.sort(f),E=0,M=D.length;E<M;++E)O(D[E]);this.renderedFeatures_=D;var R=S.finish(),F=new Y7(g,h,u,i.getOverlaps(),R,e.getRenderBuffer());return x&&(this.declutterExecutorGroup=new Y7(g,h,u,i.getOverlaps(),x.finish(),e.getRenderBuffer())),this.renderedResolution_=h,this.renderedRevision_=d,this.renderedRenderOrder_=f,this.renderedExtent_=A,this.wrappedRenderedExtent_=g,this.renderedCenter_=m,this.renderedProjection_=c,this.replayGroup_=F,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},e.prototype.renderFeature=function(t,e,i,n,r,s){if(!i)return!1;var o=!1;if(Array.isArray(i))for(var a=0,l=i.length;a<l;++a)o=a9(n,t,i[a],e,this.boundHandleStyleImageChange_,r,s)||o;else o=a9(n,t,i,e,this.boundHandleStyleImageChange_,r,s);return o},e}(g6),u9=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),d9=function(t){function e(e){return t.call(this,e)||this}return u9(e,t),e.prototype.createRenderer=function(){return new h9(this)},e}(f7);function p9(t,e){return[[-1/0,-1/0,1/0,1/0]]}function f9(t,e){return function(i,n,r,s,o){var a=this;!function(t,e,i,n,r,s,o){var a=new XMLHttpRequest;a.open(\"GET\",\"function\"==typeof t?t(i,n,r):t,!0),\"arraybuffer\"==e.getType()&&(a.responseType=\"arraybuffer\"),a.withCredentials=false,a.onload=function(t){if(!a.status||a.status>=200&&a.status<300){var n=e.getType(),l=void 0;\"json\"==n||\"text\"==n?l=a.responseText:\"xml\"==n?(l=a.responseXML)||(l=(new DOMParser).parseFromString(a.responseText,\"application/xml\")):\"arraybuffer\"==n&&(l=a.response),l?s(e.readFeatures(l,{extent:i,featureProjection:r}),e.readProjection(l)):o()}else o()},a.onerror=o,a.send()}(t,e,i,n,r,function(t,e){a.addFeatures(t),void 0!==s&&s(t)},o||qB)}}var m9=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),g9=function(t){function e(e,i,n){var r=t.call(this,e)||this;return r.feature=i,r.features=n,r}return m9(e,t),e}(BB),A9=function(t){function e(e){var i=this,n=e||{};(i=t.call(this,{attributions:n.attributions,projection:void 0,state:\"ready\",wrapX:void 0===n.wrapX||n.wrapX})||this).loader_=qB,i.format_=n.format,i.overlaps_=void 0===n.overlaps||n.overlaps,i.url_=n.url,void 0!==n.loader?i.loader_=n.loader:void 0!==i.url_&&(kN(i.format_,7),i.loader_=f9(i.url_,i.format_)),i.strategy_=void 0!==n.strategy?n.strategy:p9;var r,s,o=void 0===n.useSpatialIndex||n.useSpatialIndex;return i.featuresRtree_=o?new Q8:null,i.loadedExtentsRtree_=new Q8,i.loadingExtentsCount_=0,i.nullGeometryFeatures_={},i.idIndex_={},i.uidIndex_={},i.featureChangeKeys_={},i.featuresCollection_=null,Array.isArray(n.features)?s=n.features:n.features&&(s=(r=n.features).getArray()),!o&&void 0===r&&(r=new r4(s)),void 0!==s&&i.addFeaturesInternal(s),void 0!==r&&i.bindFeaturesCollection_(r),i}return m9(e,t),e.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},e.prototype.addFeatureInternal=function(t){var e=eN(t);if(this.addToIndex_(e,t)){this.setupChangeEvents_(e,t);var i=t.getGeometry();if(i){var n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new g9(\"addfeature\",t))}else this.featuresCollection_&&this.featuresCollection_.remove(t)},e.prototype.setupChangeEvents_=function(t,e){this.featureChangeKeys_[t]=[rz(e,\"change\",this.handleFeatureChange_,this),rz(e,\"propertychange\",this.handleFeatureChange_,this)]},e.prototype.addToIndex_=function(t,e){var i=!0,n=e.getId();return void 0!==n&&(n.toString()in this.idIndex_?i=!1:this.idIndex_[n.toString()]=e),i&&(kN(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),i},e.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},e.prototype.addFeaturesInternal=function(t){for(var e=[],i=[],n=[],r=0,s=t.length;r<s;r++){var o=eN(l=t[r]);this.addToIndex_(o,l)&&i.push(l)}r=0;for(var a=i.length;r<a;r++){var l;o=eN(l=i[r]),this.setupChangeEvents_(o,l);var c=l.getGeometry();if(c){var h=c.getExtent();e.push(h),n.push(l)}else this.nullGeometryFeatures_[o]=l}this.featuresRtree_&&this.featuresRtree_.load(e,n),r=0;for(var u=i.length;r<u;r++)this.dispatchEvent(new g9(\"addfeature\",i[r]))},e.prototype.bindFeaturesCollection_=function(t){var e=!1;this.addEventListener(\"addfeature\",function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(\"removefeature\",function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(\"add\",(function(t){e||(e=!0,this.addFeature(t.element),e=!1)}).bind(this)),t.addEventListener(\"remove\",(function(t){e||(e=!0,this.removeFeature(t.element),e=!1)}).bind(this)),this.featuresCollection_=t},e.prototype.clear=function(t){if(t){for(var e in this.featureChangeKeys_)this.featureChangeKeys_[e].forEach(oz);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_)for(var i in this.featuresRtree_.forEach(this.removeFeatureInternal.bind(this)),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var n=new g9(\"clear\");this.dispatchEvent(n),this.changed()},e.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},e.prototype.forEachFeatureAtCoordinateDirect=function(t,e){return this.forEachFeatureInExtent([t[0],t[1],t[0],t[1]],function(i){if(i.getGeometry().intersectsCoordinate(t))return e(i)})},e.prototype.forEachFeatureInExtent=function(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},e.prototype.forEachFeatureIntersectingExtent=function(t,e){return this.forEachFeatureInExtent(t,function(i){if(i.getGeometry().intersectsExtent(t)){var n=e(i);if(n)return n}})},e.prototype.getFeaturesCollection=function(){return this.featuresCollection_},e.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),XB(this.nullGeometryFeatures_)||$B(t,ZB(this.nullGeometryFeatures_))),t},e.prototype.getFeaturesAtCoordinate=function(t){var e=[];return this.forEachFeatureAtCoordinateDirect(t,function(t){e.push(t)}),e},e.prototype.getFeaturesInExtent=function(t){return this.featuresRtree_?this.featuresRtree_.getInExtent(t):this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},e.prototype.getClosestFeatureToCoordinate=function(t,e){var i=t[0],n=t[1],r=null,s=[NaN,NaN],o=1/0,a=[-1/0,-1/0,1/0,1/0],l=e||HB;return this.featuresRtree_.forEachInExtent(a,function(t){if(l(t)){var e=t.getGeometry(),c=o;if((o=e.closestPointXY(i,n,s,o))<c){r=t;var h=Math.sqrt(o);a[0]=i-h,a[1]=n-h,a[2]=i+h,a[3]=n+h}}}),r},e.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},e.prototype.getFeatureById=function(t){var e=this.idIndex_[t.toString()];return void 0!==e?e:null},e.prototype.getFeatureByUid=function(t){var e=this.uidIndex_[t];return void 0!==e?e:null},e.prototype.getFormat=function(){return this.format_},e.prototype.getOverlaps=function(){return this.overlaps_},e.prototype.getUrl=function(){return this.url_},e.prototype.handleFeatureChange_=function(t){var e=t.target,i=eN(e),n=e.getGeometry();if(n){var r=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(r,e)):this.featuresRtree_&&this.featuresRtree_.update(r,e)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);var s=e.getId();if(void 0!==s){var o=s.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new g9(\"changefeature\",e))},e.prototype.hasFeature=function(t){var e=t.getId();return void 0!==e?e in this.idIndex_:eN(t)in this.uidIndex_},e.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&XB(this.nullGeometryFeatures_)},e.prototype.loadFeatures=function(t,e,i){for(var n=this.loadedExtentsRtree_,r=this.strategy_(t,e,i),s=function(t,s){var a=r[t];n.forEachInExtent(a,function(t){return PN(t.extent,a)})||(++o.loadingExtentsCount_,o.dispatchEvent(new g9(\"featuresloadstart\")),o.loader_.call(o,a,e,i,(function(t){--this.loadingExtentsCount_,this.dispatchEvent(new g9(\"featuresloadend\",void 0,t))}).bind(o),(function(){--this.loadingExtentsCount_,this.dispatchEvent(new g9(\"featuresloaderror\"))}).bind(o)),n.insert(a,{extent:a.slice()}))},o=this,a=0,l=r.length;a<l;++a)s(a);this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0},e.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),t.prototype.refresh.call(this)},e.prototype.removeLoadedExtent=function(t){var e,i=this.loadedExtentsRtree_;i.forEachInExtent(t,function(i){if(zN(i.extent,t))return e=i,!0}),e&&i.remove(e)},e.prototype.removeFeature=function(t){var e=eN(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t),this.changed()},e.prototype.removeFeatureInternal=function(t){var e=eN(t);this.featureChangeKeys_[e].forEach(oz),delete this.featureChangeKeys_[e];var i=t.getId();void 0!==i&&delete this.idIndex_[i.toString()],delete this.uidIndex_[e],this.dispatchEvent(new g9(\"removefeature\",t))},e.prototype.removeFromIdIndex_=function(t){var e=!1;for(var i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}return e},e.prototype.setLoader=function(t){this.loader_=t},e.prototype.setUrl=function(t){kN(this.format_,7),this.url_=t,this.setLoader(f9(t,this.format_))},e}(NV),v9=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),_9=[0,0,0,0],y9=[],b9=function(t){function e(e,i,n){var r=t.call(this,e)||this;return r.features=i,r.mapBrowserEvent=n,r}return v9(e,t),e}(BB);function w9(t,e){return t.index-e.index}function x9(t,e,i){var n=e.geometry;if(\"Circle\"===n.getType()){var r=n;if(1===e.index){var s=oV();s&&(r=r.clone().transform(s,i));var o=bj(r.getCenter(),hV(t)),a=Math.sqrt(o)-r.getRadius();return a*a}}var l=hV(t);return y9[0]=hV(e.segment[0]),y9[1]=hV(e.segment[1]),xj(l,y9)}function S9(t,e,i){var n=e.geometry;if(\"Circle\"===n.getType()&&1===e.index){var r=n,s=oV();return s&&(r=r.clone().transform(s,i)),aV(r.getClosestPoint(hV(t)))}var o=hV(t);return y9[0]=hV(e.segment[0]),y9[1]=hV(e.segment[1]),aV(Aj(o,y9))}function C9(){var t=h7();return function(e,i){return t.Point}}var k9=function(t){function e(e){var i,n=t.call(this,e)||this;if(n.boundHandleFeatureChange_=n.handleFeatureChange_.bind(n),n.condition_=e.condition?e.condition:S4,n.defaultDeleteCondition_=function(t){return function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey}(t)&&function(t){return t.type==l4.SINGLECLICK}(t)},n.deleteCondition_=e.deleteCondition?e.deleteCondition:n.defaultDeleteCondition_,n.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:A4,n.vertexFeature_=null,n.vertexSegments_=null,n.lastPixel_=[0,0],n.ignoreNextSingleClick_=!1,n.featuresBeingModified_=null,n.rBush_=new Q8,n.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,n.snappedToVertex_=!1,n.changingFeature_=!1,n.dragSegments_=[],n.overlay_=new d9({source:new A9({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:C9(),updateWhileAnimating:!0,updateWhileInteracting:!0}),n.SEGMENT_WRITERS_={Point:n.writePointGeometry_.bind(n),LineString:n.writeLineStringGeometry_.bind(n),LinearRing:n.writeLineStringGeometry_.bind(n),Polygon:n.writePolygonGeometry_.bind(n),MultiPoint:n.writeMultiPointGeometry_.bind(n),MultiLineString:n.writeMultiLineStringGeometry_.bind(n),MultiPolygon:n.writeMultiPolygonGeometry_.bind(n),Circle:n.writeCircleGeometry_.bind(n),GeometryCollection:n.writeGeometryCollectionGeometry_.bind(n)},n.source_=null,n.hitDetection_=null,e.features?i=e.features:e.source&&(n.source_=e.source,i=new r4(n.source_.getFeatures()),n.source_.addEventListener(\"addfeature\",n.handleSourceAdd_.bind(n)),n.source_.addEventListener(\"removefeature\",n.handleSourceRemove_.bind(n))),!i)throw new Error(\"The modify interaction requires features, a source or a layer\");return e.hitDetection&&(n.hitDetection_=e.hitDetection),n.features_=i,n.features_.forEach(n.addFeature_.bind(n)),n.features_.addEventListener(\"add\",n.handleFeatureAdd_.bind(n)),n.features_.addEventListener(\"remove\",n.handleFeatureRemove_.bind(n)),n.lastPointerEvent_=null,n.delta_=[0,0],n.snapToPointer_=void 0===e.snapToPointer?!n.hitDetection_:e.snapToPointer,n}return v9(e,t),e.prototype.addFeature_=function(t){var e=t.getGeometry();if(e){var i=this.SEGMENT_WRITERS_[e.getType()];i&&i(t,e)}var n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,n),t.addEventListener(\"change\",this.boundHandleFeatureChange_)},e.prototype.willModifyFeatures_=function(t,e){if(!this.featuresBeingModified_){this.featuresBeingModified_=new r4;for(var i=this.featuresBeingModified_.getArray(),n=0,r=e.length;n<r;++n)for(var s=e[n],o=0,a=s.length;o<a;++o){var l=s[o].feature;l&&-1===i.indexOf(l)&&this.featuresBeingModified_.push(l)}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new b9(\"modifystart\",this.featuresBeingModified_,t))}},e.prototype.removeFeature_=function(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.removeEventListener(\"change\",this.boundHandleFeatureChange_)},e.prototype.removeFeatureSegmentData_=function(t){var e=this.rBush_,i=[];e.forEach(function(e){t===e.feature&&i.push(e)});for(var n=i.length-1;n>=0;--n){for(var r=i[n],s=this.dragSegments_.length-1;s>=0;--s)this.dragSegments_[s][0]===r&&this.dragSegments_.splice(s,1);e.remove(r)}},e.prototype.setActive=function(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.prototype.setActive.call(this,e)},e.prototype.setMap=function(e){this.overlay_.setMap(e),t.prototype.setMap.call(this,e)},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleSourceAdd_=function(t){t.feature&&this.features_.push(t.feature)},e.prototype.handleSourceRemove_=function(t){t.feature&&this.features_.remove(t.feature)},e.prototype.handleFeatureAdd_=function(t){this.addFeature_(t.element)},e.prototype.handleFeatureChange_=function(t){if(!this.changingFeature_){var e=t.target;this.removeFeature_(e),this.addFeature_(e)}},e.prototype.handleFeatureRemove_=function(t){this.removeFeature_(t.element)},e.prototype.writePointGeometry_=function(t,e){var i=e.getCoordinates(),n={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),n)},e.prototype.writeMultiPointGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n){var s=i[n],o={feature:t,geometry:e,depth:[n],index:n,segment:[s,s]};this.rBush_.insert(e.getExtent(),o)}},e.prototype.writeLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length-1;n<r;++n){var s=i.slice(n,n+2),o={feature:t,geometry:e,index:n,segment:s};this.rBush_.insert(EN(s),o)}},e.prototype.writeMultiLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n)for(var s=i[n],o=0,a=s.length-1;o<a;++o){var l=s.slice(o,o+2),c={feature:t,geometry:e,depth:[n],index:o,segment:l};this.rBush_.insert(EN(l),c)}},e.prototype.writePolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n)for(var s=i[n],o=0,a=s.length-1;o<a;++o){var l=s.slice(o,o+2),c={feature:t,geometry:e,depth:[n],index:o,segment:l};this.rBush_.insert(EN(l),c)}},e.prototype.writeMultiPolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n)for(var s=i[n],o=0,a=s.length;o<a;++o)for(var l=s[o],c=0,h=l.length-1;c<h;++c){var u=l.slice(c,c+2),d={feature:t,geometry:e,depth:[o,n],index:c,segment:u};this.rBush_.insert(EN(u),d)}},e.prototype.writeCircleGeometry_=function(t,e){var i=e.getCenter(),n={feature:t,geometry:e,index:0,segment:[i,i]},r={feature:t,geometry:e,index:1,segment:[i,i]},s=[n,r];n.featureSegments=s,r.featureSegments=s,this.rBush_.insert(BN(i),n);var o=e,a=oV();if(a&&this.getMap()){var l=this.getMap().getView().getProjection();o=G2(o=o.clone().transform(a,l)).transform(l,a)}this.rBush_.insert(o.getExtent(),r)},e.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var i=e.getGeometriesArray(),n=0;n<i.length;++n){var r=i[n];(0,this.SEGMENT_WRITERS_[r.getType()])(t,r)}},e.prototype.createOrUpdateVertexFeature_=function(t,e,i){var n=this.vertexFeature_;return n?n.getGeometry().setCoordinates(t):(n=new E1(new M2(t)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n)),n.set(\"features\",e),n.set(\"geometries\",i),n},e.prototype.handleEvent=function(e){return!e.originalEvent||(this.lastPointerEvent_=e,!e.map.getView().getInteracting()&&e.type==l4.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(i=!(e.type!=l4.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),e.type==l4.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),t.prototype.handleEvent.call(this,e)&&!i);var i},e.prototype.handleDragEvent=function(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t,this.dragSegments_);for(var e=[t.coordinate[0]+this.delta_[0],t.coordinate[1]+this.delta_[1]],i=[],n=[],r=0,s=this.dragSegments_.length;r<s;++r){var o=this.dragSegments_[r],a=o[0],l=a.feature;-1===i.indexOf(l)&&i.push(l);var c=a.geometry;-1===n.indexOf(c)&&n.push(c);for(var h=a.depth,u=void 0,d=a.segment,p=o[1];e.length<c.getStride();)e.push(d[p][e.length]);switch(c.getType()){case\"Point\":u=e,d[0]=e,d[1]=e;break;case\"MultiPoint\":(u=c.getCoordinates())[a.index]=e,d[0]=e,d[1]=e;break;case\"LineString\":(u=c.getCoordinates())[a.index+p]=e,d[p]=e;break;case\"MultiLineString\":case\"Polygon\":(u=c.getCoordinates())[h[0]][a.index+p]=e,d[p]=e;break;case\"MultiPolygon\":(u=c.getCoordinates())[h[1]][h[0]][a.index+p]=e,d[p]=e;break;case\"Circle\":if(d[0]=e,d[1]=e,0===a.index)this.changingFeature_=!0,c.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0;var f=t.map.getView().getProjection(),m=wj(hV(c.getCenter()),hV(e)),g=oV();if(g){var A=c.clone().transform(g,f);A.setRadius(m),m=A.transform(f,g).getRadius()}c.setRadius(m),this.changingFeature_=!1}}u&&this.setGeometryCoordinates_(c,u)}this.createOrUpdateVertexFeature_(e,i,n)},e.prototype.handleDownEvent=function(t){if(!this.condition_(t))return!1;var e=t.coordinate;this.handlePointerAtPixel_(t.pixel,t.map,e),this.dragSegments_.length=0,this.featuresBeingModified_=null;var i=this.vertexFeature_;if(i){var n=t.map.getView().getProjection(),r=[],s=i.getGeometry().getCoordinates(),o=EN([s]),a=this.rBush_.getInExtent(o),l={};a.sort(w9);for(var c=0,h=a.length;c<h;++c){var u=a[c],d=u.segment,p=eN(u.geometry),f=u.depth;if(f&&(p+=\"-\"+f.join(\"-\")),l[p]||(l[p]=new Array(2)),\"Circle\"!==u.geometry.getType()||1!==u.index)if(!_j(d[0],s)||l[p][0])if(!_j(d[1],s)||l[p][1])eN(d)in this.vertexSegments_&&!l[p][0]&&!l[p][1]&&this.insertVertexCondition_(t)&&r.push(u);else{if((\"LineString\"===u.geometry.getType()||\"MultiLineString\"===u.geometry.getType())&&l[p][0]&&0===l[p][0].index)continue;this.dragSegments_.push([u,1]),l[p][1]=u}else this.dragSegments_.push([u,0]),l[p][0]=u;else _j(S9(e,u,n),s)&&!l[p][0]&&(this.dragSegments_.push([u,0]),l[p][0]=u)}r.length&&this.willModifyFeatures_(t,[r]);for(var m=r.length-1;m>=0;--m)this.insertVertex_(r[m],s)}return!!this.vertexFeature_},e.prototype.handleUpEvent=function(t){for(var e=this.dragSegments_.length-1;e>=0;--e){var i=this.dragSegments_[e][0],n=i.geometry;if(\"Circle\"===n.getType()){var r=n.getCenter(),s=i.featureSegments[0],o=i.featureSegments[1];s.segment[0]=r,s.segment[1]=r,o.segment[0]=r,o.segment[1]=r,this.rBush_.update(BN(r),s);var a=n,l=oV();if(l){var c=t.map.getView().getProjection();a=G2(a=a.clone().transform(l,c)).transform(c,l)}this.rBush_.update(a.getExtent(),o)}else this.rBush_.update(EN(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new b9(\"modifyend\",this.featuresBeingModified_,t)),this.featuresBeingModified_=null),!1},e.prototype.handlePointerMove_=function(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map,t.coordinate)},e.prototype.handlePointerAtPixel_=function(t,e,i){var n,r,s=this,o=i||e.getCoordinateFromPixel(t),a=e.getView().getProjection();if(this.hitDetection_&&e.forEachFeatureAtPixel(t,function(t,e,i){if(\"Point\"===(i=i||t.getGeometry()).getType()&&zB(s.features_.getArray(),t)){r=i;var o=i.getFlatCoordinates().slice(0,2);n=[{feature:t,geometry:i,segment:[o,o]}]}return!0},{layerFilter:\"object\"==typeof this.hitDetection_?function(t){return t===s.hitDetection_}:void 0}),!n){var l=uV(MN(dV(BN(o,_9)),e.getView().getResolution()*this.pixelTolerance_,_9));n=this.rBush_.getInExtent(l)}if(n&&n.length>0){var c=n.sort(function(t,e){return x9(o,t,a)-x9(o,e,a)})[0],h=c.segment,u=S9(o,c,a),d=e.getPixelFromCoordinate(u),p=wj(t,d);if(r||p<=this.pixelTolerance_){var f={};if(f[eN(h)]=!0,this.snapToPointer_||(this.delta_[0]=u[0]-o[0],this.delta_[1]=u[1]-o[1]),\"Circle\"===c.geometry.getType()&&1===c.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(u,[c.feature],[c.geometry]);else{var m=e.getPixelFromCoordinate(h[0]),g=e.getPixelFromCoordinate(h[1]),A=bj(d,m),v=bj(d,g);p=Math.sqrt(Math.min(A,v)),this.snappedToVertex_=p<=this.pixelTolerance_,this.snappedToVertex_&&(u=A>v?h[1]:h[0]),this.createOrUpdateVertexFeature_(u,[c.feature],[c.geometry]);var _={};_[eN(c.geometry)]=!0;for(var y=1,b=n.length;y<b;++y){var w=n[y].segment;if(!(_j(h[0],w[0])&&_j(h[1],w[1])||_j(h[0],w[1])&&_j(h[1],w[0])))break;var x=eN(n[y].geometry);x in _||(_[x]=!0,f[eN(w)]=!0)}}return void(this.vertexSegments_=f)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},e.prototype.insertVertex_=function(t,e){for(var i,n=t.segment,r=t.feature,s=t.geometry,o=t.depth,a=t.index;e.length<s.getStride();)e.push(0);switch(s.getType()){case\"MultiLineString\":case\"Polygon\":(i=s.getCoordinates())[o[0]].splice(a+1,0,e);break;case\"MultiPolygon\":(i=s.getCoordinates())[o[1]][o[0]].splice(a+1,0,e);break;case\"LineString\":(i=s.getCoordinates()).splice(a+1,0,e);break;default:return}this.setGeometryCoordinates_(s,i);var l=this.rBush_;l.remove(t),this.updateSegmentIndices_(s,a,o,1);var c={segment:[n[0],e],feature:r,geometry:s,depth:o,index:a};l.insert(EN(c.segment),c),this.dragSegments_.push([c,1]);var h={segment:[e,n[1]],feature:r,geometry:s,depth:o,index:a+1};l.insert(EN(h.segment),h),this.dragSegments_.push([h,0]),this.ignoreNextSingleClick_=!0},e.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=l4.POINTERDRAG){var t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_);var e=this.removeVertex_();return this.dispatchEvent(new b9(\"modifyend\",this.featuresBeingModified_,t)),this.featuresBeingModified_=null,e}return!1},e.prototype.removeVertex_=function(){var t,e,i,n,r,s,o,a,l,c,h,u=this.dragSegments_,d={},p=!1;for(r=u.length-1;r>=0;--r)h=eN((c=(i=u[r])[0]).feature),c.depth&&(h+=\"-\"+c.depth.join(\"-\")),h in d||(d[h]={}),0===i[1]?(d[h].right=c,d[h].index=c.index):1==i[1]&&(d[h].left=c,d[h].index=c.index+1);for(h in d){switch(l=d[h].right,(a=(s=d[h].index)-1)<0&&(a=0),t=e=(n=(c=void 0!==(o=d[h].left)?o:l).geometry).getCoordinates(),p=!1,n.getType()){case\"MultiLineString\":e[c.depth[0]].length>2&&(e[c.depth[0]].splice(s,1),p=!0);break;case\"LineString\":e.length>2&&(e.splice(s,1),p=!0);break;case\"MultiPolygon\":t=t[c.depth[1]];case\"Polygon\":(t=t[c.depth[0]]).length>4&&(s==t.length-1&&(s=0),t.splice(s,1),p=!0,0===s&&(t.pop(),t.push(t[0]),a=t.length-1))}if(p){this.setGeometryCoordinates_(n,e);var f=[];if(void 0!==o&&(this.rBush_.remove(o),f.push(o.segment[0])),void 0!==l&&(this.rBush_.remove(l),f.push(l.segment[1])),void 0!==o&&void 0!==l){var m={depth:c.depth,feature:c.feature,geometry:c.geometry,index:a,segment:f};this.rBush_.insert(EN(m.segment),m)}this.updateSegmentIndices_(n,s,c.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),u.length=0}}return p},e.prototype.setGeometryCoordinates_=function(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1},e.prototype.updateSegmentIndices_=function(t,e,i,n){this.rBush_.forEachInExtent(t.getExtent(),function(r){r.geometry===t&&(void 0===i||void 0===r.depth||UB(r.depth,i))&&r.index>e&&(r.index+=n)})},e}(p4),E9=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),M9=function(t){function e(e,i,n){var r=t.call(this)||this;return void 0!==n&&void 0===i?r.setFlatCoordinates(n,e):r.setCenterAndRadius(e,i||0,n),r}return E9(e,t),e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,i,n){var r=this.flatCoordinates,s=t-r[0],o=e-r[1],a=s*s+o*o;if(a<n){if(0===a)for(var l=0;l<this.stride;++l)i[l]=r[l];else{var c=this.getRadius()/Math.sqrt(a);for(i[0]=r[0]+c*s,i[1]=r[1]+c*o,l=2;l<this.stride;++l)i[l]=r[l]}return i.length=this.stride,a}return n},e.prototype.containsXY=function(t,e){var i=this.flatCoordinates,n=t-i[0],r=e-i[1];return n*n+r*r<=this.getRadiusSquared_()},e.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.computeExtent=function(t){var e=this.flatCoordinates,i=e[this.stride]-e[0];return FN(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)},e.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},e.prototype.getRadiusSquared_=function(){var t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e},e.prototype.getType=function(){return\"Circle\"},e.prototype.intersectsExtent=function(t){if(iz(t,this.getExtent())){var e=this.getCenter();return t[0]<=e[0]&&t[2]>=e[0]||t[1]<=e[1]&&t[3]>=e[1]||HN(t,this.intersectsCoordinate.bind(this))}return!1},e.prototype.setCenter=function(t){var e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],n=t.slice();n[e]=n[0]+i;for(var r=1;r<e;++r)n[e+r]=t[r];this.setFlatCoordinates(this.layout,n),this.changed()},e.prototype.setCenterAndRadius=function(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);var n=this.flatCoordinates,r=r2(n,0,t);n[r++]=n[0]+e;for(var s=1,o=this.stride;s<o;++s)n[r++]=n[s];n.length=r,this.changed()},e.prototype.getCoordinates=function(){return null},e.prototype.setCoordinates=function(t,e){},e.prototype.setRadius=function(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()},e.prototype.rotate=function(t,e){var i=this.getCenter(),n=this.getStride();this.setCenter(B1(i,0,i.length,n,t,e,i)),this.changed()},e.prototype.translate=function(t,e){var i=this.getCenter(),n=this.getStride();this.setCenter(N1(i,0,i.length,n,t,e,i)),this.changed()},e}(Q1),T9=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),I9=function(t){function e(e,i){var n=t.call(this,e)||this;return n.feature=i,n}return T9(e,t),e}(BB);function O9(){var t=h7();return function(e,i){return t[e.getGeometry().getType()]}}var P9=function(t){function e(e){var i=this,n=e;n.stopDown||(n.stopDown=GB),(i=t.call(this,n)||this).shouldHandle_=!1,i.downPx_=null,i.freehand_=!1,i.source_=e.source?e.source:null,i.features_=e.features?e.features:null,i.snapTolerance_=e.snapTolerance?e.snapTolerance:12,i.type_=e.type,i.mode_=function(t){switch(t){case\"Point\":case\"MultiPoint\":return\"Point\";case\"LineString\":case\"MultiLineString\":return\"LineString\";case\"Polygon\":case\"MultiPolygon\":return\"Polygon\";case\"Circle\":return\"Circle\";default:throw new Error(\"Invalid type: \"+t)}}(i.type_),i.stopClick_=!!e.stopClick,i.minPoints_=e.minPoints?e.minPoints:\"Polygon\"===i.mode_?3:2,i.maxPoints_=\"Circle\"===i.mode_?2:e.maxPoints?e.maxPoints:1/0,i.finishCondition_=e.finishCondition?e.finishCondition:HB;var r=e.geometryFunction;if(!r){var s,o=i.mode_;\"Circle\"===o?r=function(t,e,i){var n=e||new M9([NaN,NaN]),r=hV(t[0]),s=bj(r,hV(t[t.length-1]));n.setCenterAndRadius(r,Math.sqrt(s));var o=oV();return o&&n.transform(i,o),n}:(\"Point\"===o?s=M2:\"LineString\"===o?s=S2:\"Polygon\"===o&&(s=U2),r=function(t,e,i){return e?e.setCoordinates(\"Polygon\"===o?t[0].length?[t[0].concat([t[0][0]])]:[]:t):e=new s(t),e})}return i.geometryFunction_=r,i.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,i.finishCoordinate_=null,i.sketchFeature_=null,i.sketchPoint_=null,i.sketchCoords_=null,i.sketchLine_=null,i.sketchLineCoords_=null,i.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,i.overlay_=new d9({source:new A9({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:O9(),updateWhileInteracting:!0}),i.geometryName_=e.geometryName,i.condition_=e.condition?e.condition:_4,i.freehandCondition_=e.freehand?A4:e.freehandCondition?e.freehandCondition:b4,i.addChangeListener(\"active\",i.updateState_),i}return T9(e,t),e.prototype.setMap=function(e){t.prototype.setMap.call(this,e),this.updateState_()},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleEvent=function(e){\"contextmenu\"===e.originalEvent.type&&e.originalEvent.preventDefault(),this.freehand_=\"Point\"!==this.mode_&&this.freehandCondition_(e);var i=e.type===l4.POINTERMOVE,n=!0;return!this.freehand_&&this.lastDragTime_&&e.type===l4.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,i=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===l4.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e.coordinate),n=!1):this.freehand_&&e.type===l4.POINTERDOWN?n=!1:i&&this.getPointerCount()<2?(n=e.type===l4.POINTERMOVE)&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(\"mouse\"===e.originalEvent.pointerType||e.type===l4.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e):e.type===l4.DBLCLICK&&(n=!1),t.prototype.handleEvent.call(this,e)&&n},e.prototype.handleDownEvent=function(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t.coordinate),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout((function(){this.handlePointerMove_(new a8(l4.POINTERMOVE,t.map,t.originalEvent,!1,t.frameState))}).bind(this),this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)},e.prototype.handleUpEvent=function(t){var e=!0;if(0===this.getPointerCount())if(this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t),this.shouldHandle_){var i=!this.finishCoordinate_;i&&this.startDrawing_(t.coordinate),!i&&this.freehand_?this.finishDrawing():!this.freehand_&&(!i||\"Point\"===this.mode_)&&(this.atFinish_(t.pixel)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t.coordinate)),e=!1}else this.freehand_&&this.abortDrawing();return!e&&this.stopClick_&&t.preventDefault(),e},e.prototype.handlePointerMove_=function(t){if(this.pointerType_=t.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var e=this.downPx_,i=t.pixel,n=e[0]-i[0],r=e[1]-i[1],s=n*n+r*r;if(this.shouldHandle_=this.freehand_?s>this.squaredClickTolerance_:s<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?this.modifyDrawing_(t.coordinate):this.createOrUpdateSketchPoint_(t.coordinate.slice())},e.prototype.atFinish_=function(t){var e=!1;if(this.sketchFeature_){var i=!1,n=[this.finishCoordinate_],r=this.mode_;if(\"Point\"===r)e=!0;else if(\"Circle\"===r)e=2===this.sketchCoords_.length;else if(\"LineString\"===r)i=this.sketchCoords_.length>this.minPoints_;else if(\"Polygon\"===r){var s=this.sketchCoords_;i=s[0].length>this.minPoints_,n=[s[0][0],s[0][s[0].length-2]]}if(i)for(var o=this.getMap(),a=0,l=n.length;a<l;a++){var c=n[a],h=o.getPixelFromCoordinate(c),u=t[0]-h[0],d=t[1]-h[1],p=this.freehand_?1:this.snapTolerance_;if(e=Math.sqrt(u*u+d*d)<=p){this.finishCoordinate_=c;break}}}return e},e.prototype.createOrUpdateSketchPoint_=function(t){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(t):(this.sketchPoint_=new E1(new M2(t)),this.updateSketchFeatures_())},e.prototype.createOrUpdateCustomSketchLine_=function(t){this.sketchLine_||(this.sketchLine_=new E1);var e=t.getLinearRing(0),i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(e.getLayout(),e.getFlatCoordinates()),i.changed()):(i=new S2(e.getFlatCoordinates(),e.getLayout()),this.sketchLine_.setGeometry(i))},e.prototype.startDrawing_=function(t){var e=this.getMap().getView().getProjection();this.finishCoordinate_=t,\"Point\"===this.mode_?this.sketchCoords_=t.slice():\"Polygon\"===this.mode_?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new E1(new S2(this.sketchLineCoords_)));var i=this.geometryFunction_(this.sketchCoords_,void 0,e);this.sketchFeature_=new E1,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(i),this.updateSketchFeatures_(),this.dispatchEvent(new I9(\"drawstart\",this.sketchFeature_))},e.prototype.modifyDrawing_=function(t){var e,i,n=this.getMap(),r=this.sketchFeature_.getGeometry(),s=n.getView().getProjection();\"Point\"===this.mode_?i=this.sketchCoords_:\"Polygon\"===this.mode_?(i=(e=this.sketchCoords_[0])[e.length-1],this.atFinish_(n.getPixelFromCoordinate(t))&&(t=this.finishCoordinate_.slice())):i=(e=this.sketchCoords_)[e.length-1],i[0]=t[0],i[1]=t[1],this.geometryFunction_(this.sketchCoords_,r,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(t),\"Polygon\"===r.getType()&&\"Polygon\"!==this.mode_?this.createOrUpdateCustomSketchLine_(r):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()},e.prototype.addToDrawing_=function(t){var e,i,n=this.sketchFeature_.getGeometry(),r=this.getMap().getView().getProjection(),s=this.mode_;\"LineString\"===s||\"Circle\"===s?(this.finishCoordinate_=t.slice(),(i=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?i.pop():e=!0),i.push(t.slice()),this.geometryFunction_(i,n,r)):\"Polygon\"===s&&((i=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?i.pop():e=!0),i.push(t.slice()),e&&(this.finishCoordinate_=i[0]),this.geometryFunction_(this.sketchCoords_,n,r)),this.createOrUpdateSketchPoint_(t.slice()),this.updateSketchFeatures_(),e&&this.finishDrawing()},e.prototype.removeLastPoint=function(){if(this.sketchFeature_){var t,e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),n=this.mode_;if(\"LineString\"===n||\"Circle\"===n){if((t=this.sketchCoords_).splice(-2,1),t.length>=2){this.finishCoordinate_=t[t.length-2].slice();var r=this.finishCoordinate_.slice();t[t.length-1]=r,this.createOrUpdateSketchPoint_(r)}this.geometryFunction_(t,e,i),\"Polygon\"===e.getType()&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(e)}else if(\"Polygon\"===n){(t=this.sketchCoords_[0]).splice(-2,1);var s=this.sketchLine_.getGeometry();t.length>=2&&(r=t[t.length-2].slice(),t[t.length-1]=r,this.createOrUpdateSketchPoint_(r)),s.setCoordinates(t),this.geometryFunction_(this.sketchCoords_,e,i)}1===t.length&&this.abortDrawing(),this.updateSketchFeatures_()}},e.prototype.finishDrawing=function(){var t=this.abortDrawing_();if(t){var e=this.sketchCoords_,i=t.getGeometry(),n=this.getMap().getView().getProjection();\"LineString\"===this.mode_?(e.pop(),this.geometryFunction_(e,i,n)):\"Polygon\"===this.mode_&&(e[0].pop(),this.geometryFunction_(e,i,n),e=i.getCoordinates()),\"MultiPoint\"===this.type_?t.setGeometry(new I2([e])):\"MultiLineString\"===this.type_?t.setGeometry(new k2([e])):\"MultiPolygon\"===this.type_&&t.setGeometry(new W2([e])),this.dispatchEvent(new I9(\"drawend\",t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t)}},e.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var t=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),t},e.prototype.abortDrawing=function(){var t=this.abortDrawing_();t&&this.dispatchEvent(new I9(\"drawabort\",t))},e.prototype.appendCoordinates=function(t){var e,i=this.mode_,n=!this.sketchFeature_;if(n&&this.startDrawing_(t[0]),\"LineString\"===i||\"Circle\"===i)e=this.sketchCoords_;else{if(\"Polygon\"!==i)return;e=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}n&&e.shift(),e.pop();for(var r=0;r<t.length;r++)this.addToDrawing_(t[r]);var s=t[t.length-1];this.addToDrawing_(s),this.modifyDrawing_(s)},e.prototype.extend=function(t){var e=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=e.getCoordinates();var i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice(),this.sketchCoords_.push(i.slice()),this.sketchPoint_=new E1(new M2(i)),this.updateSketchFeatures_(),this.dispatchEvent(new I9(\"drawstart\",this.sketchFeature_))},e.prototype.updateSketchFeatures_=function(){var t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);var e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)},e.prototype.updateState_=function(){var t=this.getMap(),e=this.getActive();(!t||!e)&&this.abortDrawing(),this.overlay_.setMap(e?t:null)},e}(p4),D9=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function R9(t){return t.feature?t.feature:t.element?t.element:void 0}var F9=[],L9=function(t){function e(e){var i=this,n=e||{},r=n;return r.handleDownEvent||(r.handleDownEvent=HB),r.stopDown||(r.stopDown=GB),(i=t.call(this,r)||this).source_=n.source?n.source:null,i.vertex_=void 0===n.vertex||n.vertex,i.edge_=void 0===n.edge||n.edge,i.features_=n.features?n.features:null,i.featuresListenerKeys_=[],i.featureChangeListenerKeys_={},i.indexedFeaturesExtents_={},i.pendingFeatures_={},i.pixelTolerance_=void 0!==n.pixelTolerance?n.pixelTolerance:10,i.rBush_=new Q8,i.SEGMENT_WRITERS_={Point:i.writePointGeometry_.bind(i),LineString:i.writeLineStringGeometry_.bind(i),LinearRing:i.writeLineStringGeometry_.bind(i),Polygon:i.writePolygonGeometry_.bind(i),MultiPoint:i.writeMultiPointGeometry_.bind(i),MultiLineString:i.writeMultiLineStringGeometry_.bind(i),MultiPolygon:i.writeMultiPolygonGeometry_.bind(i),GeometryCollection:i.writeGeometryCollectionGeometry_.bind(i),Circle:i.writeCircleGeometry_.bind(i)},i}return D9(e,t),e.prototype.addFeature=function(t,e){var i=void 0===e||e,n=eN(t),r=t.getGeometry();if(r){var s=this.SEGMENT_WRITERS_[r.getType()];s&&(this.indexedFeaturesExtents_[n]=r.getExtent([1/0,1/0,-1/0,-1/0]),s(t,r))}i&&(this.featureChangeListenerKeys_[n]=rz(t,\"change\",this.handleFeatureChange_,this))},e.prototype.forEachFeatureAdd_=function(t){this.addFeature(t)},e.prototype.forEachFeatureRemove_=function(t){this.removeFeature(t)},e.prototype.getFeatures_=function(){var t;return this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures()),t},e.prototype.handleEvent=function(e){var i=this.snapTo(e.pixel,e.coordinate,e.map);return i.snapped&&(e.coordinate=i.vertex.slice(0,2),e.pixel=i.vertexPixel),t.prototype.handleEvent.call(this,e)},e.prototype.handleFeatureAdd_=function(t){var e=R9(t);this.addFeature(e)},e.prototype.handleFeatureRemove_=function(t){var e=R9(t);this.removeFeature(e)},e.prototype.handleFeatureChange_=function(t){var e=t.target;if(this.handlingDownUpSequence){var i=eN(e);i in this.pendingFeatures_||(this.pendingFeatures_[i]=e)}else this.updateFeature_(e)},e.prototype.handleUpEvent=function(t){var e=ZB(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},e.prototype.removeFeature=function(t,e){var i=void 0===e||e,n=eN(t),r=this.indexedFeaturesExtents_[n];if(r){var s=this.rBush_,o=[];s.forEachInExtent(r,function(e){t===e.feature&&o.push(e)});for(var a=o.length-1;a>=0;--a)s.remove(o[a])}i&&(oz(this.featureChangeListenerKeys_[n]),delete this.featureChangeListenerKeys_[n])},e.prototype.setMap=function(e){var i=this.getMap(),n=this.featuresListenerKeys_,r=this.getFeatures_();i&&(n.forEach(oz),n.length=0,r.forEach(this.forEachFeatureRemove_.bind(this))),t.prototype.setMap.call(this,e),e&&(this.features_?n.push(rz(this.features_,\"add\",this.handleFeatureAdd_,this),rz(this.features_,\"remove\",this.handleFeatureRemove_,this)):this.source_&&n.push(rz(this.source_,\"addfeature\",this.handleFeatureAdd_,this),rz(this.source_,\"removefeature\",this.handleFeatureRemove_,this)),r.forEach(this.forEachFeatureAdd_.bind(this)))},e.prototype.snapTo=function(t,e,i){var n=EN([i.getCoordinateFromPixel([t[0]-this.pixelTolerance_,t[1]+this.pixelTolerance_]),i.getCoordinateFromPixel([t[0]+this.pixelTolerance_,t[1]-this.pixelTolerance_])]),r=this.rBush_.getInExtent(n);this.vertex_&&!this.edge_&&(r=r.filter(function(t){return\"Circle\"!==t.feature.getGeometry().getType()}));var s=!1,o=null,a=null;if(0===r.length)return{snapped:s,vertex:o,vertexPixel:a};for(var l,c=i.getView().getProjection(),h=hV(e),u=1/0,d=0;d<r.length;++d){var p=r[d];F9[0]=hV(p.segment[0]),F9[1]=hV(p.segment[1]);var f=xj(h,F9);f<u&&(l=p,u=f)}var m=l.segment;if(this.vertex_&&!this.edge_){var g=i.getPixelFromCoordinate(m[0]),A=i.getPixelFromCoordinate(m[1]),v=bj(t,g),_=bj(t,A);Math.sqrt(Math.min(v,_))<=this.pixelTolerance_&&(s=!0,a=i.getPixelFromCoordinate(o=v>_?m[1]:m[0]))}else if(this.edge_){var y=\"Circle\"===l.feature.getGeometry().getType();if(y){var b=l.feature.getGeometry(),w=oV();w&&(b=b.clone().transform(w,c)),o=aV(function(t,e){var i=e.getRadius(),n=e.getCenter(),r=n[0],s=n[1],o=t[0]-r,a=t[1]-s;0===o&&0===a&&(o=1);var l=Math.sqrt(o*o+a*a);return[r+i*o/l,s+i*a/l]}(h,b))}else F9[0]=hV(m[0]),F9[1]=hV(m[1]),o=aV(Aj(h,F9));wj(t,a=i.getPixelFromCoordinate(o))<=this.pixelTolerance_&&(s=!0,this.vertex_&&!y)&&(g=i.getPixelFromCoordinate(m[0]),A=i.getPixelFromCoordinate(m[1]),v=bj(a,g),_=bj(a,A),Math.sqrt(Math.min(v,_))<=this.pixelTolerance_&&(a=i.getPixelFromCoordinate(o=v>_?m[1]:m[0])))}return s&&(a=[Math.round(a[0]),Math.round(a[1])]),{snapped:s,vertex:o,vertexPixel:a}},e.prototype.updateFeature_=function(t){this.removeFeature(t,!1),this.addFeature(t,!1)},e.prototype.writeCircleGeometry_=function(t,e){var i=this.getMap().getView().getProjection(),n=e,r=oV();r&&(n=n.clone().transform(r,i));var s=G2(n);r&&s.transform(i,r);for(var o=s.getCoordinates()[0],a=0,l=o.length-1;a<l;++a){var c=o.slice(a,a+2),h={feature:t,segment:c};this.rBush_.insert(EN(c),h)}},e.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var i=e.getGeometriesArray(),n=0;n<i.length;++n){var r=this.SEGMENT_WRITERS_[i[n].getType()];r&&r(t,i[n])}},e.prototype.writeLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length-1;n<r;++n){var s=i.slice(n,n+2),o={feature:t,segment:s};this.rBush_.insert(EN(s),o)}},e.prototype.writeMultiLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n)for(var s=i[n],o=0,a=s.length-1;o<a;++o){var l=s.slice(o,o+2),c={feature:t,segment:l};this.rBush_.insert(EN(l),c)}},e.prototype.writeMultiPointGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n){var s=i[n],o={feature:t,segment:[s,s]};this.rBush_.insert(e.getExtent(),o)}},e.prototype.writeMultiPolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n)for(var s=i[n],o=0,a=s.length;o<a;++o)for(var l=s[o],c=0,h=l.length-1;c<h;++c){var u=l.slice(c,c+2),d={feature:t,segment:u};this.rBush_.insert(EN(u),d)}},e.prototype.writePointGeometry_=function(t,e){var i=e.getCoordinates(),n={feature:t,segment:[i,i]};this.rBush_.insert(e.getExtent(),n)},e.prototype.writePolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),n=0,r=i.length;n<r;++n)for(var s=i[n],o=0,a=s.length-1;o<a;++o){var l=s.slice(o,o+2),c={feature:t,segment:l};this.rBush_.insert(EN(l),c)}},e}(p4),B9=function(){function t(t){var e=t||{};this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=GV(void 0!==e.scale?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.textBaseline_=e.textBaseline,this.fill_=void 0!==e.fill?e.fill:new s7({color:\"#333\"}),this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4,this.placement_=void 0!==e.placement?e.placement:\"point\",this.overflow_=!!e.overflow,this.stroke_=void 0!==e.stroke?e.stroke:null,this.offsetX_=void 0!==e.offsetX?e.offsetX:0,this.offsetY_=void 0!==e.offsetY?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=void 0===e.padding?null:e.padding}return t.prototype.clone=function(){var e=this.getScale();return new t({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()})},t.prototype.getOverflow=function(){return this.overflow_},t.prototype.getFont=function(){return this.font_},t.prototype.getMaxAngle=function(){return this.maxAngle_},t.prototype.getPlacement=function(){return this.placement_},t.prototype.getOffsetX=function(){return this.offsetX_},t.prototype.getOffsetY=function(){return this.offsetY_},t.prototype.getFill=function(){return this.fill_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.getRotation=function(){return this.rotation_},t.prototype.getScale=function(){return this.scale_},t.prototype.getScaleArray=function(){return this.scaleArray_},t.prototype.getStroke=function(){return this.stroke_},t.prototype.getText=function(){return this.text_},t.prototype.getTextAlign=function(){return this.textAlign_},t.prototype.getTextBaseline=function(){return this.textBaseline_},t.prototype.getBackgroundFill=function(){return this.backgroundFill_},t.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},t.prototype.getPadding=function(){return this.padding_},t.prototype.setOverflow=function(t){this.overflow_=t},t.prototype.setFont=function(t){this.font_=t},t.prototype.setMaxAngle=function(t){this.maxAngle_=t},t.prototype.setOffsetX=function(t){this.offsetX_=t},t.prototype.setOffsetY=function(t){this.offsetY_=t},t.prototype.setPlacement=function(t){this.placement_=t},t.prototype.setRotateWithView=function(t){this.rotateWithView_=t},t.prototype.setFill=function(t){this.fill_=t},t.prototype.setRotation=function(t){this.rotation_=t},t.prototype.setScale=function(t){this.scale_=t,this.scaleArray_=GV(void 0!==t?t:1)},t.prototype.setStroke=function(t){this.stroke_=t},t.prototype.setText=function(t){this.text_=t},t.prototype.setTextAlign=function(t){this.textAlign_=t},t.prototype.setTextBaseline=function(t){this.textBaseline_=t},t.prototype.setBackgroundFill=function(t){this.backgroundFill_=t},t.prototype.setBackgroundStroke=function(t){this.backgroundStroke_=t},t.prototype.setPadding=function(t){this.padding_=t},t}();new d7;const N9=new o7({color:\"rgba(0, 0, 0, 0.8)\"}),z9=new s7({color:\"rgba(255, 255, 255, 0.2)\"}),V9=new s7({color:\"#000000\"}),j9=new d7({image:new r7({radius:7,stroke:N9,fill:z9})}),$9=new o7({color:\"rgba(195, 38, 125, 1)\",lineDash:[4,8],width:2}),U9=new d7({image:new r7({radius:13,stroke:$9})}),H9=new d7({stroke:$9}),G9={Point(t){const e=new B9({text:t.name,font:\"12px sans-serif\",placement:\"point\",offsetY:-20,fill:V9}),i=[new d7({text:e,image:new r7({radius:7,stroke:new o7({color:t.color}),fill:new s7({color:`${t.color}9f`})})})];return t.editing&&i.push(U9),i},LineString(t){const e=new B9({text:t.name,font:\"12px sans-serif\",placement:\"line\",textBaseline:\"bottom\",offsetY:-5,overflow:!0,fill:V9}),i=new o7({color:t.color,width:2}),n=[new d7({stroke:i})],r=t.getGeometry();return r.forEachSegment((t,i)=>{n.push(new d7({geometry:new S2([t,i]),text:e}))}),t.editing&&(n.push(H9),r.getCoordinates().forEach(e=>{const r=new M2(e);n.push(new d7({geometry:r,image:new r7({radius:13,stroke:$9})})),n.push(new d7({geometry:r,image:new r7({radius:7,stroke:i,fill:new s7({color:t.color})})}))})),n},Polygon(t){const e=new B9({text:t.name,font:\"12px sans-serif\",placement:\"point\",fill:V9}),i=new o7({color:t.color}),n=[new d7({text:e,stroke:i,fill:new s7({color:`${t.color}3f`})})];return t.editing&&(n.push(H9),t.getGeometry().getCoordinates()[0].forEach(e=>{const r=new M2(e);n.push(new d7({geometry:r,image:new r7({radius:13,stroke:$9})})),n.push(new d7({geometry:r,image:new r7({radius:7,stroke:i,fill:new s7({color:t.color})})}))})),n}};class q9 extends E1{constructor(t){super({geometry:Q2.readGeometry(t.geom)}),this.editing=!1,this.annotation=t,this.color=this.annotation.color,this.name=this.annotation.name,t.geom&&this.setStyle(G9[this.getGeometry().getType()](this))}updateColor(t){this.color=t,this.changed()}updateName(t){this.name=t,this.changed()}setEditingStyle(){this.editing=!0,this.getGeometry()&&this.setStyle(G9[this.getGeometry().getType()])}}let W9=(()=>{class t extends Lq{constructor(t,e,i,n,r,s){super(),this.ngZone=t,this.annotationsService=e,this.interactionsService=i,this.mapService=n,this.mapStateService=r,this.tooltipsService=s,this.modifyCollection=new r4,this.updatingGeomFromLayer=!1}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new A9({features:[]}),this.layer=new d9({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:2}),this.layer.selectable=!0,this.map.addLayer(this.layer),this.subscriptions.push(this.mapStateService.featuresSelectable$.subscribe(t=>{this.layer.selectable=t}),this.annotationsService.annotations$.subscribe(t=>{this.source.clear(!0),this.source.addFeatures(t.map(t=>new q9(t)))}),LT([this.annotationsService.editedAnnotation$.pipe(E(t=>!!t),Cf()),this.annotationsService.editedAnnotationGeomType$]).pipe(cf(16)).subscribe(([t,e])=>{this.ngZone.runOutsideAngular(()=>{this.removeInteractions(),t&&this.createInteractions(e)})}),this.mapStateService.showAnnotationsLayer$.subscribe(t=>{this.layer.setVisible(t)})),this.eventListeners.push(this.map.on(\"click\",t=>{this.ngZone.run(()=>{this.handleClickEvent(t)})})),this.subscriptions.push(this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}createInteractions(t){const e=this.annotationsService.editedAnnotation$.value;let i=this.source.forEachFeature(t=>{if(t.annotation.id===e.id)return t});i||(i=new q9(e),this.source.addFeature(i)),i.setEditingStyle(),this.editedFeature=i,this.modifyCollection.clear(),this.modifyCollection.push(i),this.modifyInteraction=new k9({features:this.modifyCollection,style:j9,condition:S4}),this.map.addInteraction(this.modifyInteraction);const n=new r4;this.drawInteraction=new P9({type:t,features:n,style:j9,condition:S4}),this.map.addInteraction(this.drawInteraction),this.snapInteraction=new L9({features:this.modifyCollection,pixelTolerance:20}),this.map.addInteraction(this.snapInteraction),this.drawInteraction.on(\"drawstart\",t=>{TB({category:\"app\",message:\"annotation: drawstart\"}),this.modifyInteraction.setActive(!1),this.editedFeature.setGeometry(t.feature.getGeometry()),this.editedFeature.setEditingStyle(),this.updateEditedAnnotationGeometry(null)}),this.drawInteraction.on(\"drawend\",t=>{TB({category:\"app\",message:\"annotation: drawend\"}),this.modifyInteraction.setActive(!0),this.updateEditedAnnotationGeometry(t.feature)}),this.drawInteraction.on(\"drawabort\",t=>{this.modifyInteraction.setActive(!0)}),this.modifyInteraction.on(\"modifyend\",t=>{TB({category:\"app\",message:\"annotation: modifyend\"}),this.updateEditedAnnotationGeometry(t.features.pop())}),this.annotationsService.editedAnnotation$.pipe(wf(1),Fg(t=>!!t),E(t=>t.color),Cf()).subscribe(t=>{this.editedFeature.updateColor(t)}),this.annotationsService.editedAnnotation$.pipe(wf(1),Fg(t=>!!t),E(t=>t.name),Cf()).subscribe(t=>{this.editedFeature.updateName(t)}),this.annotationsService.editedAnnotation$.pipe(wf(1),Fg(t=>!!t),E(t=>t.geom),Cf(),pf(()=>!this.updatingGeomFromLayer)).subscribe(t=>{this.editedFeature.setGeometry(Q2.readGeometry(t)),this.editedFeature.setEditingStyle()})}updateEditedAnnotationGeometry(t){this.updatingGeomFromLayer=!0,this.annotationsService.updateEditedAnnotationGeom(t?Q2.writeGeometryObject(t.getGeometry()):null),this.updatingGeomFromLayer=!1}removeInteractions(){this.editedFeature&&(this.editedFeature=null),this.drawInteraction&&this.map.removeInteraction(this.drawInteraction),this.modifyInteraction&&this.map.removeInteraction(this.modifyInteraction),this.snapInteraction&&this.map.removeInteraction(this.snapInteraction)}handleClickEvent(t){this.layer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.interactionsService.clickOnEntity(pH.Annotation,t.annotation),!0),{layerFilter:t=>t===this.layer})}handleMoveEvent(t){this.layer.selectable&&(this.map.forEachFeatureAtPixel(t.pixel,e=>{const[i,n]=Jz(t.coordinate);return e.annotation.lon=i,e.annotation.lat=n,this.tooltipsService.hoverEntity(pH.Annotation,e.annotation),!0},{hitTolerance:3,layerFilter:t=>t===this.layer})||this.tooltipsService.hoverEntity(pH.Annotation,null))}}return t.\\u0275fac=function(e){return new(e||t)(Ta(tu),Ta(fH),Ta(Cq),Ta(T$),Ta(KG),Ta(Sq))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-annotations-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();var Y9=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Z9=function(t){function e(e){var i=t.call(this,e)||this;return i.image_=null,i}return Y9(e,t),e.prototype.getImage=function(){return this.image_?this.image_.getImage():null},e.prototype.prepareFrame=function(t){var e=t.layerStatesArray[t.layerIndex],i=t.pixelRatio,n=t.viewState,r=n.resolution,s=this.getLayer().getSource(),o=t.viewHints,a=t.extent;if(void 0!==e.extent&&(a=QN(a,dV(e.extent))),!o[0]&&!o[1]&&!nz(a))if(s){var l=s.getImage(a,r,i,n.projection);l&&this.loadImage(l)&&(this.image_=l)}else this.image_=null;return!!this.image_},e.prototype.renderFrame=function(t,e){var i=this.image_,n=i.getExtent(),r=i.getResolution(),s=i.getPixelRatio(),o=t.layerStatesArray[t.layerIndex],a=t.pixelRatio,l=t.viewState,c=l.center,h=t.size,u=a*r/(l.resolution*s),d=Math.round(h[0]*a),p=Math.round(h[1]*a),f=l.rotation;if(f){var m=Math.round(Math.sqrt(d*d+p*p));d=m,p=m}D1(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/a,1/a,f,-d/2,-p/2),R1(this.inversePixelTransform,this.pixelTransform);var g=F1(this.pixelTransform);this.useContainer(e,g,o.opacity);var A=this.context,v=A.canvas;v.width!=d||v.height!=p?(v.width=d,v.height=p):this.containerReused||A.clearRect(0,0,d,p);var _=!1,y=!0;if(o.extent){var b=dV(o.extent);(_=(y=iz(b,t.extent))&&!PN(b,t.extent))&&this.clipUnrotated(A,t,b)}var w=i.getImage(),x=D1(this.tempTransform,d/2,p/2,u,u,0,s*(n[0]-c[0])/r,s*(c[1]-n[3])/r);this.renderedResolution=r*a/s;var S=w.width*x[0],C=w.height*x[3];if(WB(A,this.getLayer().getSource().getContextOptions()),this.preRender(A,t),y&&S>=.5&&C>=.5){var k=x[4],E=x[5],M=o.opacity,T=void 0;1!==M&&(T=A.globalAlpha,A.globalAlpha=M),A.drawImage(w,0,0,+w.width,+w.height,Math.round(k),Math.round(E),Math.round(S),Math.round(C)),1!==M&&(A.globalAlpha=T)}return this.postRender(A,t),_&&A.restore(),g!==v.style.transform&&(v.style.transform=g),this.container},e}(g6),X9=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),K9=function(t){function e(e,i,n,r,s){var o=this;return(o=t.call(this,e,i,n,void 0!==s?0:2)||this).loader_=void 0!==s?s:null,o.canvas_=r,o.error_=null,o}return X9(e,t),e.prototype.getError=function(){return this.error_},e.prototype.handleLoad_=function(t){t?(this.error_=t,this.state=3):this.state=2,this.changed()},e.prototype.load=function(){0==this.state&&(this.state=1,this.changed(),this.loader_(this.handleLoad_.bind(this)))},e.prototype.getImage=function(){return this.canvas_},e}(xN),Q9=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),J9=function(t){function e(e){var i=t.call(this,e)||this;return i.vectorRenderer_=new h9(e),i.layerImageRatio_=e.getImageRatio(),i.coordinateToVectorPixelTransform_=[1,0,0,1,0,0],i.renderedPixelToCoordinateTransform_=null,i}return Q9(e,t),e.prototype.disposeInternal=function(){this.vectorRenderer_.dispose(),t.prototype.disposeInternal.call(this)},e.prototype.getFeatures=function(t){if(!this.vectorRenderer_)return new Promise(function(t){return t([])});var e=P1(this.coordinateToVectorPixelTransform_,P1(this.renderedPixelToCoordinateTransform_,t.slice()));return this.vectorRenderer_.getFeatures(e)},e.prototype.handleFontsChanged=function(){this.vectorRenderer_.handleFontsChanged()},e.prototype.prepareFrame=function(t){var e=t.pixelRatio,i=t.viewState,n=i.resolution,r=t.viewHints,s=this.vectorRenderer_,o=t.extent;1!==this.layerImageRatio_&&function(t,e){var i=(t[2]-t[0])/2*(e-1),n=(t[3]-t[1])/2*(e-1);t[0]-=i,t[2]+=i,t[1]-=n,t[3]+=n}(o=o.slice(0),this.layerImageRatio_);var a=ez(o)/n,l=KN(o)/n;if(!r[0]&&!r[1]&&!nz(o)){s.useContainer(null,null,1);var c=s.context,h=WB({},t,{declutterTree:new K8(9),extent:o,size:[a,l],viewState:WB({},t.viewState,{rotation:0})}),u=!0,d=new K9(o,n,e,c.canvas,function(t){s.prepareFrame(h)&&s.replayGroupChanged&&(s.clipping=!1,s.renderFrame(h,null)&&(s.renderDeclutter(h),u=!1),t())});d.addEventListener(\"change\",(function(){if(2===d.getState()){this.image_=u?null:d;var t=d.getResolution(),n=d.getPixelRatio(),r=t*e/n;this.renderedResolution=r,this.coordinateToVectorPixelTransform_=D1(this.coordinateToVectorPixelTransform_,a/2,l/2,1/r,-1/r,0,-i.center[0],-i.center[1])}}).bind(this)),d.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice()),!!this.image_},e.prototype.preRender=function(){},e.prototype.postRender=function(){},e.prototype.renderDeclutter=function(){},e.prototype.forEachFeatureAtCoordinate=function(e,i,n,r,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,i,n,r,s):t.prototype.forEachFeatureAtCoordinate.call(this,e,i,n,r,s)},e}(Z9),ttt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ett=function(t){function e(e){var i=this,n=e||{},r=WB({},n);return delete r.imageRatio,(i=t.call(this,r)||this).imageRatio_=void 0!==n.imageRatio?n.imageRatio:1,i}return ttt(e,t),e.prototype.getImageRatio=function(){return this.imageRatio_},e.prototype.createRenderer=function(){return new J9(this)},e}(f7);const itt=[[8.384360674740835,87.82361750161175],[145.5581976913369,87.3646953231962],[-325.5581976913369,87.82361750161175],[-215.5581976913369,87.82361750161175],[-161.8917180108592,84.22628942426208],[-125.29445893479551,82.48154130920918],[-90.38109747487815,82.85349004122665],[-51.70487751530814,84.93555635380527],[8.384360674740835,87.82361750161175]],ntt=[[-214.4418023086631,87.3646953231962],[-163.45686807900947,76.14556732608256],[-131.70883908792965,69.37134141076518],[-100.821870205822,67.53592431503803],[-66.90449925088507,72.20470505499345],[-34.75841798028466,81.27137179020501],[-214.4418023086631,87.3646953231962]];function rtt(t){let e=ZU(t,!0);return e=\"81033ffffffffff\"===t?itt:\"8003fffffffffff\"===t?ntt:stt(e),new U2([e.map(t=>Qz(t))])}function stt(t){const e=t[0][0],i=t[0][1];return t.map(([t,n])=>(Math.abs(t-e)>180&&(e>0?t+=360:t-=360),Math.abs(n-i)>90&&(i>0?n+=180:n-=180),[t,n]))}function ott(t){const e=stt(iH(t,!0)),i=JU(t),[n]=g$([YU(i).reverse()],e[0]);3===e.length&&e.splice(1,1);let r=e[0],s=e[1];return r=att(r[0],r[1],n[0],n[1],.15),s=att(s[0],s[1],n[0],n[1],.15),e.push(s),e.push(r),e}function att(t,e,i,n,r){return[t+(i-t)*r,e+(n-e)*r]}function ltt(t){if(t.length<2)return!1;for(let e=0;e<t.length;e++)for(let i=e+1;i<t.length;i++){const n=t[i];if(t[e].some(t=>n.some(e=>_$(t,e))))return[e,i]}return!1}class ctt extends E1{constructor(t){super(),this.h3index=t,super.setGeometry(rtt(t))}static New(t){return new ctt(t)}}new d7({stroke:new o7({color:\"#cc0000\",width:1}),fill:new s7({color:\"#ff00001a\"})});const htt=new d7({stroke:new o7({color:\"#ff0000\",width:1}),fill:new s7({color:\"#ff00004a\"})}),utt=[\"#F1C40F\",\"#27AE60\",\"#9B59B6\",\"#3498DB\",\"#E74C3C\",\"#1ABC9C\",\"#E67E22\",\"#16A085\",\"#C0392B\",\"#8E44AD\",\"#2980B9\",\"#F39C12\",\"#2ECC71\",\"#D35400\"],dtt={1:1,2:1,3:1,4:2,5:3,6:3,7:4,8:5,9:5,10:6,11:7,12:7,13:8,14:8,15:9,16:9,17:10,18:11,19:12,20:12,21:12},ptt={1:0,2:0,3:0,4:1,5:2,6:2,7:3,8:4,9:4,10:5,11:6,12:7,13:7,14:8,15:9,16:9,17:10,18:10,19:10,20:10,21:10},ftt=utt.map(t=>new d7({stroke:new o7({color:t,width:1}),fill:new s7({color:\"rgba(0, 0, 255, 0)\"})}));let mtt=(()=>{class t extends Lq{constructor(t,e,i,n,r){super(),this.configService=t,this.drawingService=e,this.mapConfigService=i,this.mapService=n,this.mapStateService=r}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new A9({features:[]}),this.layer=new ett({source:this.source}),this.map.addLayer(this.layer),this.subscriptions.push(this.mapStateService.selectableHexagons$.subscribe(t=>{this.layer.selectable=t,!t&&this.hoveredHexagonFeature&&(this.hoveredHexagonFeature.setStyle(ftt[this.hexagonsResolution()]),this.hoveredHexagonFeature=null)}),this.mapStateService.showHexagonsLayer$.subscribe(t=>{this.layer.setVisible(t)}),LT([this.mapStateService.showHexagonsLayer$,this.mapService.view$]).pipe(wf(1),pf(([t,e])=>t&&!!e),cf(200)).subscribe(([t,e])=>this.refreshFeatures(e)),this.mapService.pointerMove$.pipe(pf(()=>this.layer.selectable)).subscribe(t=>{this.handleMoveEvent(t)})),this.eventListeners.push(this.map.on(\"click\",t=>this.handleClickEvent(t)))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}refreshFeatures(t){this.source.clear(!0);let e=this.hexagonsResolution();const i=l$.fromOLExtent(t.extent).scale(1.2);let n=this.generateFeatures(i,e);n.forEach(t=>{t.setStyle(ftt[e])}),this.source.addFeatures(n),this.mapConfigService.debugH3Trace$.value&&(e-=1,e>=1&&(n=this.generateFeatures(i,e),n.forEach(t=>{t.setStyle(ftt[e])}),this.source.addFeatures(n)),e-=1,e>=1&&(n=this.generateFeatures(i,e),n.forEach(t=>{t.setStyle(ftt[e])}),this.source.addFeatures(n)))}generateFeatures(t,e){return t.getBoundedPolygons().map(t=>KU(t,e,!0)).flat().map(t=>new ctt(t))}hexagonsResolution(){return(this.mapConfigService.highHexagonsResolution$.value?dtt:ptt)[Math.round(this.map.getView().getZoom())]}handleClickEvent(t){this.layer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.configService.devMode&&console.log(\"DEBUG: select hexagon\",t.h3index),this.drawingService.selectHexagon(t.h3index),!0),{layerFilter:t=>t===this.layer})}handleMoveEvent(t){const e=this.map.forEachFeatureAtPixel(t.pixel,t=>t,{layerFilter:t=>t===this.layer});e?e!==this.hoveredHexagonFeature&&(this.hoveredHexagonFeature&&this.hoveredHexagonFeature.setStyle(ftt[this.hexagonsResolution()]),e.setStyle(htt),this.hoveredHexagonFeature=e):this.hoveredHexagonFeature&&(this.hoveredHexagonFeature.setStyle(ftt[this.hexagonsResolution()]),this.hoveredHexagonFeature=null)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(C$),Ta(mH),Ta(k$),Ta(T$),Ta(KG))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-hexagons-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();class gtt extends E1{constructor(t){super(),this.edgeGroup=t,this.setGeometry(new U2(this.edgeGroup.edges.map(t=>ott(t).map(t=>Qz(t))))),this.setStyle(new d7({stroke:new o7({color:this.edgeGroup.color,width:1}),fill:new s7({color:`${this.edgeGroup.color}9f`})}))}}const Att=new o7({color:\"#ff0000aa\",width:4});class vtt extends E1{constructor(t,e){super(),this.h3index=t,this.color=e,this.setId(t),this.setGeometry(new U2([ott(t).map(t=>Qz(t))])),this.resetStyle()}resetStyle(){this.setStyle(this.color?new d7({stroke:new o7({color:this.color,width:1}),fill:new s7({color:`${this.color}9f`})}):ftt[function(t){return parseInt(t.charAt(2),16)}(this.h3index)])}enableHighlightedStyle(){const t=[htt,new d7({stroke:new o7({color:this.color,width:1}),fill:new s7({color:`${this.color}9f`})})],[e,i]=eH(this.h3index),n=new S2([Qz(v$(YU(e))),Qz(v$(YU(i)))]);n.applyTransform(t=>(Object.assign(t,function(t,e){if(4!==t.length)throw new Error(`Invalid line length. Expected 4, got ${t.length}`);const i=(t[2]-t[0])/2,n=(t[3]-t[1])/2,r=t[0]+i,s=t[1]+n;return[r-e*i,s-e*n,r+e*i,s+e*n]}(t,.5)),null)),t.push(new d7({geometry:n,stroke:Att})),n.forEachSegment((e,i)=>{const n=i[0]-e[0],r=i[1]-e[1],s=Math.sqrt(n*n+r*r)/8,o=Math.atan2(r,n),a=new S2([i,[i[0]-1.5*s,i[1]+s]]);a.rotate(o,i);const l=new S2([i,[i[0]-1.5*s,i[1]-s]]);l.rotate(o,i),t.push(new d7({geometry:a,stroke:Att})),t.push(new d7({geometry:l,stroke:Att}))}),this.setStyle(t)}}const _tt=[\"#1e88e5\",\"#5e35b1\",\"#64b5f6\",\"#311b92\",\"#d1c4e9\",\"#9575cd\",\"#1a237e\",\"#1e88e5\",\"#bbdefb\",\"#3949ab\",\"#7986cb\"],ytt=_tt.map(t=>oH(t)),btt=[\"#900C3F\",\"#FF5733\",\"#3D3D6B\",\"#FFC300\",\"#511849\",\"#FF8D1A\",\"#2A7B9B\",\"#C70039\",\"#44be77\",\"#c4b320\",\"#00BAAD\",\"#7a9b38\"],wtt=btt.concat(btt,btt,btt,btt),xtt=Array(wtt.length).fill(!0);function Stt(t){const e=wtt.findIndex(e=>e===t);xtt[e]=!0}class Ctt{constructor(t,e){this.edges=t,this.color=null!=e?e:function(){const t=xtt.findIndex(t=>t);return xtt[t]=!1,wtt[t]}()}contains(t){return this.edges.includes(t)}remove(t){const e=this.edges.indexOf(t);if(-1!==e)return this.edges.splice(e,1);throw new Error(\"group cannot remove missing index\"+t)}shouldSplit(){const t=[new Ctt([this.edges[0]],this.color)];if(this.edges.slice(1).forEach(e=>{t.some(t=>t.addIfLinked(e))||t.push(new Ctt([e]))}),t.length>=2){let e=!1;for(;!e;){const i=ltt(t.map(t=>t.edges.map(t=>iH(t,!0)).flat()));i&&(t[i[0]].merge(t[i[1]]),Stt(t.splice(i[1],1)[0].color)),e=!i}}return t.length>1&&t}addIfLinked(t){const e=iH(t,!0),i=this.edges.map(t=>iH(t,!0)).flat().some(t=>e.some(e=>_$(e,t)));return i&&this.edges.push(t),i}merge(t){this.edges.push(...t.edges)}}let ktt=(()=>{class t{constructor(t){this.workerService=t,this.selectedEdgeGroups$=new Zp([]),this.searchQuery$=new Zp(null),this.searchResult$=new Zp(null)}toggleEdge(t){const e=this.selectedEdgeGroups$.value,i=e.findIndex(e=>e.contains(t));let n=null;if(-1!==i){const r=e[i];if(r.remove(t),0===r.edges.length)n=e.splice(i,1)[0];else if(r.edges.length>=2){const t=r.shouldSplit();t&&e.splice(i,1,...t)}}else if(e.some(e=>e.addIfLinked(t))){const t=ltt(e.map(t=>t.edges.map(t=>iH(t,!0)).flat()));t&&(e[t[0]].merge(e[t[1]]),n=e.splice(t[1],1)[0])}else e.push(new Ctt([t]));n&&Stt(n.color),this.selectedEdgeGroups$.next(e)}resetEdgeGroups(){this.selectedEdgeGroups$.next([])}search(t){return Vp(this,void 0,void 0,function*(){this.searchResult$.next(null),this.searchResult$.next({query:Uj(t),results:yield this.workerService.ships.searchForShipsPassages(this.selectedEdgeGroups$.value,FG(t.interval.start),FG(t.interval.end)+PG)})})}}return t.\\u0275fac=function(e){return new(e||t)(En(iU))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Ett=(()=>{class t extends Lq{constructor(t,e,i,n){super(),this.configService=t,this.mapService=e,this.mapStateService=i,this.movesService=n}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.gridSource=new A9({features:[]}),this.gridLayer=new ett({source:this.gridSource}),this.map.addLayer(this.gridLayer),this.gridLayer.selectable=!0,this.selectionSource=new A9({features:[]}),this.selectionLayer=new ett({source:this.selectionSource}),this.map.addLayer(this.selectionLayer),this.subscriptions.push(this.movesService.selectedEdgeGroups$.subscribe(t=>{this.refreshSelectedEdgeGroupsFeatures(t)}),this.mapStateService.showEdgesLayer$.subscribe(t=>{this.gridLayer.setVisible(t)}),LT([this.mapStateService.showEdgesLayer$,this.mapService.view$]).pipe(wf(1),pf(([t,e])=>t&&!!e),cf(200)).subscribe(([t,e])=>this.refreshGridFeatures(e)),this.mapService.pointerMove$.pipe(pf(()=>this.gridLayer.getVisible())).subscribe(t=>{this.handleMoveEvent(t)})),this.eventListeners.push(this.map.on(\"click\",t=>this.handleClickEvent(t)))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.gridLayer),this.map.removeLayer(this.selectionLayer)}refreshGridFeatures(t){this.gridSource.clear(!0);const e=l$.fromOLExtent(t.extent).scale(t.zoom<=5?1.1:t.zoom<=9?1.5:2);let i=this.edgesResolution();const n=[this.generateFeatures(e,i)];i-=1,i>=1&&n.push(this.generateFeatures(e,i)),i-=1,i>=1&&t.zoom<8&&n.push(this.generateFeatures(e,i)),this.gridSource.addFeatures(n.flat())}refreshSelectedEdgeGroupsFeatures(t){this.selectionSource.clear(!0),this.selectionSource.addFeatures(t.map(t=>new gtt(t)))}generateFeatures(t,e){return t.getBoundedPolygons().map(t=>KU(t,e,!0)).flat().map(t=>function(t){var e=LU(t),i=e[0],n=e[1],r=EU._calloc(6,IU);TU.getH3UnidirectionalEdgesFromHexagon(i,n,r);var s=UU(r,6);return EU._free(r),s}(t)).flat().filter(t=>{const e=QU(t),i=JU(t),n=function(t){var e=LU(t),i=e[0],n=e[1];return TU.h3IsValid(i,n)?TU.h3GetResolution(i,n):-1}(e),r=XU(e,n-1),s=XU(i,n-1);return 2===n||n>2&&r===s}).map(t=>new vtt(t))}edgesResolution(){return Math.min(dtt[Math.round(this.map.getView().getZoom())],6)}handleClickEvent(t){this.gridLayer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.configService.devMode&&console.log(\"DEBUG: select h3 edge\",t.h3index),this.movesService.toggleEdge(t.h3index),!0),{layerFilter:t=>t===this.gridLayer})}handleMoveEvent(t){const e=this.map.forEachFeatureAtPixel(t.pixel,t=>t,{layerFilter:t=>t===this.gridLayer});e?e!==this.hoveredEdgeFeature&&(this.hoveredEdgeFeature&&this.hoveredEdgeFeature.resetStyle(),e.enableHighlightedStyle(),this.hoveredEdgeFeature=e):this.hoveredEdgeFeature&&(this.hoveredEdgeFeature.resetStyle(),this.hoveredEdgeFeature=null)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(C$),Ta(T$),Ta(KG),Ta(ktt))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-edges-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();class Mtt extends E1{constructor(t){super({geometry:new W2(t.h3indexes.map(t=>rtt(t)))}),this.zone=t}}const Ttt=btt.map(t=>new d7({stroke:new o7({color:t,width:1}),fill:new s7({color:`${t}1a`})})),Itt=new d7({text:new B9({font:\"12px Calibri,sans-serif\",fill:new s7({color:\"#000\"}),stroke:new o7({color:\"#fff\",width:3})})});let Ott=(()=>{class t extends Lq{constructor(t){super(),this.zonesLayerService=t}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new A9({features:[]}),this.layer=new d9({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:1}),this.map.addLayer(this.layer),this.subscriptions.push(this.zonesLayerService.zones$.subscribe(t=>{this.source.clear(!0),this.source.addFeatures(t.map((t,e)=>{const i=new Mtt(t);return i.setStyle(function(){return Itt.getText().setText(t.name),[Ttt[e%Ttt.length],Itt]}),i}))}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(kq))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-zones-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();var Ptt=34962,Dtt=34963,Rtt=[\"experimental-webgl\",\"webgl\",\"webkit-3d\",\"moz-webgl\"];function Ftt(t){switch(t){case Ptt:return Float32Array;case Dtt:return Uint32Array;default:return Float32Array}}var Ltt=function(){function t(t,e){this.array=null,this.type=t,kN(t===Ptt||t===Dtt,62),this.usage=void 0!==e?e:35044}return t.prototype.ofSize=function(t){this.array=new(Ftt(this.type))(t)},t.prototype.fromArray=function(t){var e=Ftt(this.type);this.array=e.from?e.from(t):new e(t)},t.prototype.fromArrayBuffer=function(t){this.array=new(Ftt(this.type))(t)},t.prototype.getType=function(){return this.type},t.prototype.getArray=function(){return this.array},t.prototype.getUsage=function(){return this.usage},t.prototype.getSize=function(){return this.array?this.array.length:0},t}(),Btt=function(){function t(t){this.gl_=t.webGlContext;var e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer();var i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,t.vertexShader||\"\\n  precision mediump float;\\n  \\n  attribute vec2 a_position;\\n  varying vec2 v_texCoord;\\n  varying vec2 v_screenCoord;\\n  \\n  uniform vec2 u_screenSize;\\n   \\n  void main() {\\n    v_texCoord = a_position * 0.5 + 0.5;\\n    v_screenCoord = v_texCoord * u_screenSize;\\n    gl_Position = vec4(a_position, 0.0, 1.0);\\n  }\\n\"),e.compileShader(i);var n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,t.fragmentShader||\"\\n  precision mediump float;\\n   \\n  uniform sampler2D u_image;\\n   \\n  varying vec2 v_texCoord;\\n   \\n  void main() {\\n    gl_FragColor = texture2D(u_image, v_texCoord);\\n  }\\n\"),e.compileShader(n),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,i),e.attachShader(this.renderTargetProgram_,n),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,\"a_position\"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,\"u_screenSize\"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,\"u_image\"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach((function(i){this.uniforms_.push({value:t.uniforms[i],location:e.getUniformLocation(this.renderTargetProgram_,i)})}).bind(this))}return t.prototype.getGL=function(){return this.gl_},t.prototype.init=function(t){var e=this.getGL(),i=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.viewport(0,0,i[0],i[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==i[0]||this.renderTargetTextureSize_[1]!==i[1]){this.renderTargetTextureSize_=i;var n=e.RGBA,r=e.RGBA,s=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,0,n,i[0],i[1],0,r,s,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0)}},t.prototype.apply=function(t,e){var i=this.getGL(),n=t.size;i.bindFramebuffer(i.FRAMEBUFFER,e?e.getFrameBuffer():null),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.renderTargetTexture_),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),i.bindBuffer(i.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),i.useProgram(this.renderTargetProgram_),i.enableVertexAttribArray(this.renderTargetAttribLocation_),i.vertexAttribPointer(this.renderTargetAttribLocation_,2,i.FLOAT,!1,0,0),i.uniform2f(this.renderTargetUniformLocation_,n[0],n[1]),i.uniform1i(this.renderTargetTextureLocation_,0),this.applyUniforms(t),i.drawArrays(i.TRIANGLES,0,6)},t.prototype.getFrameBuffer=function(){return this.frameBuffer_},t.prototype.applyUniforms=function(t){var e,i=this.getGL(),n=1;this.uniforms_.forEach(function(r){if((e=\"function\"==typeof r.value?r.value(t):r.value)instanceof HTMLCanvasElement||e instanceof ImageData)r.texture||(r.texture=i.createTexture()),i.activeTexture(i[\"TEXTURE\"+n]),i.bindTexture(i.TEXTURE_2D,r.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),e instanceof ImageData?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,e.width,e.height,0,i.UNSIGNED_BYTE,new Uint8Array(e.data)):i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),i.uniform1i(r.location,n++);else if(Array.isArray(e))switch(e.length){case 2:return void i.uniform2f(r.location,e[0],e[1]);case 3:return void i.uniform3f(r.location,e[0],e[1],e[2]);case 4:return void i.uniform4f(r.location,e[0],e[1],e[2],e[3]);default:return}else\"number\"==typeof e&&i.uniform1f(r.location,e)})},t}();function Ntt(t,e){return t[0]=e[0],t[1]=e[1],t[4]=e[2],t[5]=e[3],t[12]=e[4],t[13]=e[5],t}var ztt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Vtt={UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};function jtt(t){switch(t){case Vtt.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Vtt.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Vtt.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Vtt.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}var $tt=function(t){function e(e){var i=t.call(this)||this,n=e||{};i.boundHandleWebGLContextLost_=i.handleWebGLContextLost.bind(i),i.boundHandleWebGLContextRestored_=i.handleWebGLContextRestored.bind(i),i.canvas_=document.createElement(\"canvas\"),i.canvas_.style.position=\"absolute\",i.canvas_.style.left=\"0\",i.gl_=function(t,e){for(var i=Rtt.length,n=0;n<i;++n)try{var s=t.getContext(Rtt[n],e);if(s)return s}catch(r){}return null}(i.canvas_);var r=i.getGL();if(i.bufferCache_={},i.extensionCache_={},i.currentProgram_=null,i.canvas_.addEventListener(\"webglcontextlost\",i.boundHandleWebGLContextLost_),i.canvas_.addEventListener(\"webglcontextrestored\",i.boundHandleWebGLContextRestored_),i.offsetRotateMatrix_=[1,0,0,1,0,0],i.offsetScaleMatrix_=[1,0,0,1,0,0],i.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i.uniformLocations_={},i.attribLocations_={},i.uniforms_=[],n.uniforms)for(var s in n.uniforms)i.uniforms_.push({name:s,value:n.uniforms[s]});return i.postProcessPasses_=n.postProcesses?n.postProcesses.map(function(t){return new Btt({webGlContext:r,scaleRatio:t.scaleRatio,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms})}):[new Btt({webGlContext:r})],i.shaderCompileErrors_=null,i.startTime_=Date.now(),i}return ztt(e,t),e.prototype.getExtension=function(t){if(t in this.extensionCache_)return this.extensionCache_[t];var e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e},e.prototype.bindBuffer=function(t){var e=this.getGL(),i=eN(t),n=this.bufferCache_[i];if(!n){var r=e.createBuffer();this.bufferCache_[i]=n={buffer:t,webGlBuffer:r}}e.bindBuffer(t.getType(),n.webGlBuffer)},e.prototype.flushBufferData=function(t){var e=this.getGL();this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())},e.prototype.deleteBuffer=function(t){var e=this.getGL(),i=eN(t),n=this.bufferCache_[i];n&&!e.isContextLost()&&e.deleteBuffer(n.webGlBuffer),delete this.bufferCache_[i]},e.prototype.disposeInternal=function(){this.canvas_.removeEventListener(\"webglcontextlost\",this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(\"webglcontextrestored\",this.boundHandleWebGLContextRestored_);var t=this.gl_.getExtension(\"WEBGL_lose_context\");t&&t.loseContext(),delete this.gl_,delete this.canvas_},e.prototype.prepareDraw=function(t,e){var i=this.getGL(),n=this.getCanvas(),r=t.size,s=t.pixelRatio;n.width=r[0]*s,n.height=r[1]*s,n.style.width=r[0]+\"px\",n.style.height=r[1]+\"px\",i.useProgram(this.currentProgram_);for(var o=this.postProcessPasses_.length-1;o>=0;o--)this.postProcessPasses_[o].init(t);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,e?i.ZERO:i.ONE_MINUS_SRC_ALPHA),i.useProgram(this.currentProgram_),this.applyFrameState(t),this.applyUniforms(t)},e.prototype.prepareDrawToRenderTarget=function(t,e,i){var n=this.getGL(),r=e.getSize();n.bindFramebuffer(n.FRAMEBUFFER,e.getFramebuffer()),n.viewport(0,0,r[0],r[1]),n.bindTexture(n.TEXTURE_2D,e.getTexture()),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,i?n.ZERO:n.ONE_MINUS_SRC_ALPHA),n.useProgram(this.currentProgram_),this.applyFrameState(t),this.applyUniforms(t)},e.prototype.drawElements=function(t,e){var i=this.getGL();this.getExtension(\"OES_element_index_uint\"),i.drawElements(i.TRIANGLES,e-t,i.UNSIGNED_INT,4*t)},e.prototype.finalizeDraw=function(t){for(var e=0;e<this.postProcessPasses_.length;e++)this.postProcessPasses_[e].apply(t,this.postProcessPasses_[e+1]||null)},e.prototype.getCanvas=function(){return this.canvas_},e.prototype.getGL=function(){return this.gl_},e.prototype.applyFrameState=function(t){var e=t.size,i=t.viewState.rotation,n=T1(this.offsetScaleMatrix_);!function(t,e,i){I1(t,O1(M1,e,0,0,i,0,0))}(n,2/e[0],2/e[1]);var r=T1(this.offsetRotateMatrix_);0!==i&&function(t,e){var i=Math.cos(e),n=Math.sin(e);I1(t,O1(M1,i,n,-n,i,0,0))}(r,-i),this.setUniformMatrixValue(\"u_offsetScaleMatrix\",Ntt(this.tmpMat4_,n)),this.setUniformMatrixValue(\"u_offsetRotateMatrix\",Ntt(this.tmpMat4_,r)),this.setUniformFloatValue(\"u_time\",.001*(Date.now()-this.startTime_)),this.setUniformFloatValue(\"u_zoom\",t.viewState.zoom),this.setUniformFloatValue(\"u_resolution\",t.viewState.resolution)},e.prototype.applyUniforms=function(t){var e,i=this.getGL(),n=0;this.uniforms_.forEach((function(r){if((e=\"function\"==typeof r.value?r.value(t):r.value)instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof ImageData)r.texture||(r.prevValue=void 0,r.texture=i.createTexture()),i.activeTexture(i[\"TEXTURE\"+n]),i.bindTexture(i.TEXTURE_2D,r.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),(!(e instanceof HTMLImageElement)||e.complete)&&r.prevValue!==e&&(r.prevValue=e,i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e)),i.uniform1i(this.getUniformLocation(r.name),n++);else if(Array.isArray(e)&&6===e.length)this.setUniformMatrixValue(r.name,Ntt(this.tmpMat4_,e));else if(Array.isArray(e)&&e.length<=4)switch(e.length){case 2:return void i.uniform2f(this.getUniformLocation(r.name),e[0],e[1]);case 3:return void i.uniform3f(this.getUniformLocation(r.name),e[0],e[1],e[2]);case 4:return void i.uniform4f(this.getUniformLocation(r.name),e[0],e[1],e[2],e[3]);default:return}else\"number\"==typeof e&&i.uniform1f(this.getUniformLocation(r.name),e)}).bind(this))},e.prototype.useProgram=function(t){return t!=this.currentProgram_&&(this.getGL().useProgram(t),this.currentProgram_=t,this.uniformLocations_={},this.attribLocations_={},!0)},e.prototype.compileShader=function(t,e){var i=this.getGL(),n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n},e.prototype.getProgram=function(t,e){var i=this.getGL(),n=this.compileShader(t,i.FRAGMENT_SHADER),r=this.compileShader(e,i.VERTEX_SHADER),s=i.createProgram();if(i.attachShader(s,n),i.attachShader(s,r),i.linkProgram(s),!i.getShaderParameter(n,i.COMPILE_STATUS)){var o=\"Fragment shader compliation failed: \"+i.getShaderInfoLog(n);throw new Error(o)}if(i.deleteShader(n),!i.getShaderParameter(r,i.COMPILE_STATUS))throw o=\"Vertex shader compilation failed: \"+i.getShaderInfoLog(r),new Error(o);if(i.deleteShader(r),!i.getProgramParameter(s,i.LINK_STATUS))throw o=\"GL program linking failed: \"+i.getShaderInfoLog(r),new Error(o);return s},e.prototype.getUniformLocation=function(t){return void 0===this.uniformLocations_[t]&&(this.uniformLocations_[t]=this.getGL().getUniformLocation(this.currentProgram_,t)),this.uniformLocations_[t]},e.prototype.getAttributeLocation=function(t){return void 0===this.attribLocations_[t]&&(this.attribLocations_[t]=this.getGL().getAttribLocation(this.currentProgram_,t)),this.attribLocations_[t]},e.prototype.makeProjectionTransform=function(t,e){var i=t.size,n=t.viewState.rotation,r=t.viewState.resolution,s=t.viewState.center;return T1(e),D1(e,0,0,2/(r*i[0]),2/(r*i[1]),-n,-s[0],-s[1]),e},e.prototype.setUniformFloatValue=function(t,e){this.getGL().uniform1f(this.getUniformLocation(t),e)},e.prototype.setUniformMatrixValue=function(t,e){this.getGL().uniformMatrix4fv(this.getUniformLocation(t),!1,e)},e.prototype.enableAttributeArray_=function(t,e,i,n,r){var s=this.getAttributeLocation(t);s<0||(this.getGL().enableVertexAttribArray(s),this.getGL().vertexAttribPointer(s,e,i,!1,n,r))},e.prototype.enableAttributes=function(t){for(var e=function(t){for(var e=0,i=0;i<t.length;i++){var n=t[i];e+=n.size*jtt(n.type)}return e}(t),i=0,n=0;n<t.length;n++){var r=t[n];this.enableAttributeArray_(r.name,r.size,r.type||5126,e,i),i+=r.size*jtt(r.type)}},e.prototype.handleWebGLContextLost=function(){YB(this.bufferCache_),this.currentProgram_=null},e.prototype.handleWebGLContextRestored=function(){},e.prototype.createTexture=function(t,e,i){var n=this.getGL(),r=i||n.createTexture(),s=n.RGBA,o=n.RGBA,a=n.UNSIGNED_BYTE;return n.bindTexture(n.TEXTURE_2D,r),e?n.texImage2D(n.TEXTURE_2D,0,s,o,a,e):n.texImage2D(n.TEXTURE_2D,0,s,t[0],t[1],0,o,a,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),r},e}(LB),Utt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function Htt(t,e){var i=e||[],n=256,r=255;return i[0]=Math.floor(t/n/n/n)/r,i[1]=Math.floor(t/n/n)%n/r,i[2]=Math.floor(t/n)%n/r,i[3]=t%n/r,i}var Gtt=function(t){function e(e,i){var n=t.call(this,e)||this,r=i||{};return n.helper=new $tt({postProcesses:r.postProcesses,uniforms:r.uniforms}),void 0!==r.className&&(n.helper.getCanvas().className=r.className),n}return Utt(e,t),e.prototype.disposeInternal=function(){this.helper.dispose(),delete this.helper,t.prototype.disposeInternal.call(this)},e.prototype.dispatchRenderEvent_=function(t,e){var i=this.getLayer();if(i.hasListener(t)){var n=new o6(t,null,e,null);i.dispatchEvent(n)}},e.prototype.preRender=function(t){this.dispatchRenderEvent_(\"prerender\",t)},e.prototype.postRender=function(t){this.dispatchRenderEvent_(\"postrender\",t)},e}(r6),qtt=new Uint8Array(4),Wtt=function(){function t(t,e){this.helper_=t;var i=t.getGL();this.texture_=i.createTexture(),this.framebuffer_=i.createFramebuffer(),this.size_=e||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}return t.prototype.setSize=function(t){UB(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())},t.prototype.getSize=function(){return this.size_},t.prototype.clearCachedData=function(){this.dataCacheDirty_=!0},t.prototype.readAll=function(){if(this.dataCacheDirty_){var t=this.size_,e=this.helper_.getGL();e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.readPixels(0,0,t[0],t[1],e.RGBA,e.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_},t.prototype.readPixel=function(t,e){if(t<0||e<0||t>this.size_[0]||e>=this.size_[1])return qtt[0]=0,qtt[1]=0,qtt[2]=0,qtt[3]=0,qtt;this.readAll();var i=Math.floor(t)+(this.size_[1]-Math.floor(e)-1)*this.size_[0];return qtt[0]=this.data_[4*i],qtt[1]=this.data_[4*i+1],qtt[2]=this.data_[4*i+2],qtt[3]=this.data_[4*i+3],qtt},t.prototype.getTexture=function(){return this.texture_},t.prototype.getFramebuffer=function(){return this.framebuffer_},t.prototype.updateSize_=function(){var t=this.size_,e=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.viewport(0,0,t[0],t[1]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture_,0),this.data_=new Uint8Array(t[0]*t[1]*4)},t}(),Ytt=new Blob(['var e=\"function\"==typeof Object.assign?Object.assign:function(e,n){if(null==e)throw new TypeError(\"Cannot convert undefined or null to object\");for(var t=Object(e),r=1,o=arguments.length;r<o;++r){var i=arguments[r];if(null!=i)for(var f in i)i.hasOwnProperty(f)&&(t[f]=i[f])}return t},n=\"GENERATE_BUFFERS\",t=[],r={vertexPosition:0,indexPosition:0};function o(e,n,t,r,o){e[n+0]=t,e[n+1]=r,e[n+2]=o}function i(e,n,i,f,s,u){var a=3+s,l=e[n+0],v=e[n+1],c=t;c.length=s;for(var g=0;g<c.length;g++)c[g]=e[n+2+g];var b=u?u.vertexPosition:0,h=u?u.indexPosition:0,d=b/a;return o(i,b,l,v,0),c.length&&i.set(c,b+3),o(i,b+=a,l,v,1),c.length&&i.set(c,b+3),o(i,b+=a,l,v,2),c.length&&i.set(c,b+3),o(i,b+=a,l,v,3),c.length&&i.set(c,b+3),b+=a,f[h++]=d,f[h++]=d+1,f[h++]=d+3,f[h++]=d+1,f[h++]=d+2,f[h++]=d+3,r.vertexPosition=b,r.indexPosition=h,r}var f=self;f.onmessage=function(t){var r=t.data;if(r.type===n){for(var o=r.customAttributesCount,s=2+o,u=new Float32Array(r.renderInstructions),a=u.length/s,l=4*a*(o+3),v=new Uint32Array(6*a),c=new Float32Array(l),g=null,b=0;b<u.length;b+=s)g=i(u,b,c,v,o,g);var h=e({vertexBuffer:c.buffer,indexBuffer:v.buffer,renderInstructions:u.buffer},r);f.postMessage(h,[c.buffer,v.buffer,u.buffer])}};'],{type:\"application/javascript\"}),Ztt=URL.createObjectURL(Ytt),Xtt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Ktt=function(t){function e(e,i){var n=this,r=i.uniforms||{},s=[1,0,0,1,0,0];r.u_projectionMatrix=s,(n=t.call(this,e,{className:i.className,uniforms:r,postProcesses:i.postProcesses})||this).sourceRevision_=-1,n.verticesBuffer_=new Ltt(Ptt,35048),n.hitVerticesBuffer_=new Ltt(Ptt,35048),n.indicesBuffer_=new Ltt(Dtt,35048),n.program_=n.helper.getProgram(i.fragmentShader,i.vertexShader),n.hitDetectionEnabled_=!(!i.hitFragmentShader||!i.hitVertexShader),n.hitProgram_=n.hitDetectionEnabled_&&n.helper.getProgram(i.hitFragmentShader,i.hitVertexShader);var o=i.attributes?i.attributes.map(function(t){return{name:\"a_\"+t.name,size:1,type:Vtt.FLOAT}}):[];n.attributes=[{name:\"a_position\",size:2,type:Vtt.FLOAT},{name:\"a_index\",size:1,type:Vtt.FLOAT}].concat(o),n.hitDetectionAttributes=[{name:\"a_position\",size:2,type:Vtt.FLOAT},{name:\"a_index\",size:1,type:Vtt.FLOAT},{name:\"a_hitColor\",size:4,type:Vtt.FLOAT},{name:\"a_featureUid\",size:1,type:Vtt.FLOAT}].concat(o),n.customAttributes=i.attributes?i.attributes:[],n.previousExtent_=[1/0,1/0,-1/0,-1/0],n.currentTransform_=s,n.renderTransform_=[1,0,0,1,0,0],n.invertRenderTransform_=[1,0,0,1,0,0],n.renderInstructions_=new Float32Array(0),n.hitRenderInstructions_=new Float32Array(0),n.hitRenderTarget_=n.hitDetectionEnabled_&&new Wtt(n.helper),n.worker_=new Worker(Ztt),n.worker_.addEventListener(\"message\",(function(t){var e=t.data;if(\"GENERATE_BUFFERS\"===e.type){var i=e.projectionTransform;e.hitDetection?(this.hitVerticesBuffer_.fromArrayBuffer(e.vertexBuffer),this.helper.flushBufferData(this.hitVerticesBuffer_)):(this.verticesBuffer_.fromArrayBuffer(e.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_)),this.indicesBuffer_.fromArrayBuffer(e.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=i,R1(this.invertRenderTransform_,this.renderTransform_),e.hitDetection?this.hitRenderInstructions_=new Float32Array(t.data.renderInstructions):this.renderInstructions_=new Float32Array(t.data.renderInstructions),this.getLayer().changed()}}).bind(n)),n.featureCache_={},n.featureCount_=0;var a=n.getLayer().getSource();return n.sourceListenKeys_=[rz(a,\"addfeature\",n.handleSourceFeatureAdded_,n),rz(a,\"changefeature\",n.handleSourceFeatureChanged_,n),rz(a,\"removefeature\",n.handleSourceFeatureDelete_,n),rz(a,\"clear\",n.handleSourceFeatureClear_,n)],a.forEachFeature((function(t){this.featureCache_[eN(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++}).bind(n)),n}return Xtt(e,t),e.prototype.handleSourceFeatureAdded_=function(t){var e=t.feature;this.featureCache_[eN(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++},e.prototype.handleSourceFeatureChanged_=function(t){var e=t.feature;this.featureCache_[eN(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()}},e.prototype.handleSourceFeatureDelete_=function(t){delete this.featureCache_[eN(t.feature)],this.featureCount_--},e.prototype.handleSourceFeatureClear_=function(){this.featureCache_={},this.featureCount_=0},e.prototype.renderFrame=function(t){this.preRender(t);var e=this.indicesBuffer_.getSize();this.helper.drawElements(0,e),this.helper.finalizeDraw(t);var i=this.helper.getCanvas(),n=t.layerStatesArray[t.layerIndex].opacity;return n!==parseFloat(i.style.opacity)&&(i.style.opacity=String(n)),this.hitDetectionEnabled_&&(this.renderHitDetection(t),this.hitRenderTarget_.clearCachedData()),this.postRender(t),i},e.prototype.prepareFrame=function(t){var e=this.getLayer(),i=e.getSource(),n=t.viewState,r=!t.viewHints[0]&&!t.viewHints[1],s=!zN(this.previousExtent_,t.extent),o=this.sourceRevision_<i.getRevision();if(o&&(this.sourceRevision_=i.getRevision()),r&&(s||o)){var a=n.projection,l=n.resolution,c=e instanceof f7?e.getRenderBuffer():0,h=MN(t.extent,c*l);i.loadFeatures(h,l,a),this.rebuildBuffers_(t),this.previousExtent_=t.extent.slice()}return this.helper.makeProjectionTransform(t,this.currentTransform_),I1(this.currentTransform_,this.invertRenderTransform_),this.helper.useProgram(this.program_),this.helper.prepareDraw(t),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0},e.prototype.rebuildBuffers_=function(t){var e=[1,0,0,1,0,0];this.helper.makeProjectionTransform(t,e);var i=(2+this.customAttributes.length)*this.featureCount_;if((!this.renderInstructions_||this.renderInstructions_.length!==i)&&(this.renderInstructions_=new Float32Array(i)),this.hitDetectionEnabled_){var n=(7+this.customAttributes.length)*this.featureCount_;(!this.hitRenderInstructions_||this.hitRenderInstructions_.length!==n)&&(this.hitRenderInstructions_=new Float32Array(n))}var r,s,o,a=[],l=[],c=0,h=0;for(var u in this.featureCache_)if((s=(r=this.featureCache_[u]).geometry)&&\"Point\"===s.getType()){a[0]=s.getFlatCoordinates()[0],a[1]=s.getFlatCoordinates()[1],P1(e,a),o=Htt(h+6,l),this.renderInstructions_[c++]=a[0],this.renderInstructions_[c++]=a[1],this.hitDetectionEnabled_&&(this.hitRenderInstructions_[h++]=a[0],this.hitRenderInstructions_[h++]=a[1],this.hitRenderInstructions_[h++]=o[0],this.hitRenderInstructions_[h++]=o[1],this.hitRenderInstructions_[h++]=o[2],this.hitRenderInstructions_[h++]=o[3],this.hitRenderInstructions_[h++]=Number(u));for(var d=void 0,p=0;p<this.customAttributes.length;p++)d=this.customAttributes[p].callback(r.feature,r.properties),this.renderInstructions_[c++]=d,this.hitDetectionEnabled_&&(this.hitRenderInstructions_[h++]=d)}var f={type:\"GENERATE_BUFFERS\",renderInstructions:this.renderInstructions_.buffer,customAttributesCount:this.customAttributes.length};if(f.projectionTransform=e,this.worker_.postMessage(f,[this.renderInstructions_.buffer]),this.renderInstructions_=null,this.hitDetectionEnabled_){var m={type:\"GENERATE_BUFFERS\",renderInstructions:this.hitRenderInstructions_.buffer,customAttributesCount:5+this.customAttributes.length};m.projectionTransform=e,m.hitDetection=!0,this.worker_.postMessage(m,[this.hitRenderInstructions_.buffer]),this.hitRenderInstructions_=null}},e.prototype.forEachFeatureAtCoordinate=function(t,e,i,n,r){if(kN(this.hitDetectionEnabled_,66),this.hitRenderInstructions_){var s=P1(e.coordinateToPixelTransform,t.slice()),o=this.hitRenderTarget_.readPixel(s[0]/2,s[1]/2),a=function(t){var e=0,i=256,n=255;return e+=Math.round(t[0]*i*i*i*n),e+=Math.round(t[1]*i*i*n),(e+=Math.round(t[2]*i*n))+Math.round(t[3]*n)}([o[0]/255,o[1]/255,o[2]/255,o[3]/255]),l=Math.floor(this.hitRenderInstructions_[a]).toString(),c=this.getLayer().getSource().getFeatureByUid(l);if(c)return n(c,this.getLayer(),null)}},e.prototype.renderHitDetection=function(t){if(this.hitVerticesBuffer_.getSize()){this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.useProgram(this.hitProgram_),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0),this.helper.bindBuffer(this.hitVerticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.hitDetectionAttributes);var e=this.indicesBuffer_.getSize();this.helper.drawElements(0,e)}},e.prototype.disposeInternal=function(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(t){oz(t)}),this.sourceListenKeys_=null,t.prototype.disposeInternal.call(this)},e}(Gtt),Qtt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function Jtt(t,e){t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)}function tet(t,e,i,n,r){var s,o,a=t.getGL();switch(Jtt(a,e),r){case 1:s=a.LUMINANCE;break;case 2:s=a.LUMINANCE_ALPHA;break;case 3:s=a.RGB;break;case 4:s=a.RGBA;break;default:throw new Error(\"Unsupported number of bands: \"+r)}i instanceof Float32Array?(o=a.FLOAT,t.getExtension(\"OES_texture_float\"),t.getExtension(\"OES_texture_float_linear\")):o=a.UNSIGNED_BYTE,a.texImage2D(a.TEXTURE_2D,0,s,n[0],n[1],0,s,o,i)}var eet=function(t){function e(e,i,n){var r=t.call(this)||this;r.textures=[],r.handleTileChange_=r.handleTileChange_.bind(r),r.size=GV(i.getTileSize(e.tileCoord[0])),r.bandCount=NaN,r.helper_=n;var s=new Ltt(Ptt,35044);return s.fromArray([0,1,1,1,1,0,0,0]),n.flushBufferData(s),r.coords=s,r.setTile(e),r}return Qtt(e,t),e.prototype.setTile=function(t){t!==this.tile&&(this.tile&&this.tile.removeEventListener(\"change\",this.handleTileChange_),this.tile=t,this.textures.length=0,this.loaded=2===t.getState(),this.loaded?this.uploadTile_():t.addEventListener(\"change\",this.handleTileChange_))},e.prototype.uploadTile_=function(){var t=this.helper_,e=t.getGL(),i=this.tile;if(i instanceof hz){var n=e.createTexture();return this.textures.push(n),this.bandCount=4,void function(t,e,i){Jtt(t,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)}(e,n,i.getImage())}var r=i.getData(),s=r instanceof Float32Array,o=this.size[0]*this.size[1];this.bandCount=r.byteLength/(s?4:1)/o;var a=Math.ceil(this.bandCount/4);if(1===a)return n=e.createTexture(),this.textures.push(n),void tet(t,n,r,this.size,this.bandCount);for(var l=s?Float32Array:Uint8Array,c=new Array(a),h=0;h<a;++h)n=e.createTexture(),this.textures.push(n),c[h]=new l(o*(m=h<a-1?4:this.bandCount%4));for(var u=o*this.bandCount,d=0;d<u;++d){var p=d%this.bandCount,f=p%4,m=(h=Math.floor(p/4))<a-1?4:this.bandCount%4,g=Math.floor(d/this.bandCount);c[h][g*m+f]=r[d]}for(h=0;h<a;++h)tet(t,n=this.textures[h],c[h],this.size,m=h<a-1?4:this.bandCount%4)},e.prototype.handleTileChange_=function(){2===this.tile.getState()&&(this.loaded=!0,this.uploadTile_(),this.dispatchEvent(\"change\"))},e.prototype.disposeInternal=function(){var t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(var e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener(\"change\",this.handleTileChange_)},e}(QB),iet=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),net=[{name:\"a_textureCoord\",size:2,type:Vtt.FLOAT}],ret={};function set(t){return 2*(1-1/(t+1))-1}function oet(t,e,i){i in t||(t[i]=[]),t[i].push(e)}function aet(t,e){var i=t.layerStatesArray[t.layerIndex];return i.extent&&(e=QN(e,dV(i.extent))),e}!function(t){function e(e,i){var n=t.call(this,e,{uniforms:i.uniforms,className:i.className})||this;n.tileTransform_=[1,0,0,1,0,0],n.tempMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n.tempTileRange_=new jV(0,0,0,0),n.tempTileCoord_=SV(0,0,0),n.tempSize_=[0,0],n.program_=n.helper.getProgram(i.fragmentShader,i.vertexShader);var r=new Ltt(Dtt,35044);return r.fromArray([0,1,3,1,2,3]),n.helper.flushBufferData(r),n.indices_=r,n.tileTextureCache_=new xV(void 0!==i.cacheSize?i.cacheSize:512),n.renderedOpacity_=NaN,n}iet(e,t),e.prototype.isDrawableTile=function(t){var e=this.getLayer(),i=t.getState(),n=e.getUseInterimTilesOnError();return 2==i||4==i||3==i&&!n},e.prototype.prepareFrame=function(t){if(nz(aet(t,t.extent)))return!1;var e=this.getLayer().getSource();return!!e&&\"ready\"===e.getState()},e.prototype.enqueueTiles=function(t,e,i,n){var r=t.viewState,s=this.getLayer().getSource(),o=s.getTileGridForProjection(r.projection),a=this.tileTextureCache_,l=o.getTileRangeForExtentAndZ(e,i),c=eN(s);c in t.wantedTiles||(t.wantedTiles[c]={});for(var h=t.wantedTiles[c],u=o.getResolution(i),d=l.minX;d<=l.maxX;++d)for(var p=l.minY;p<=l.maxY;++p){var f=SV(i,d,p,this.tempTileCoord_),m=kV(f),g=void 0,A=void 0;a.containsKey(m)&&(A=(g=a.get(m)).tile),(!g||g.tile.key!==s.getKey())&&(A=s.getTile(i,d,p,t.pixelRatio,r.projection),g?g.setTile(this.isDrawableTile(A)?A:A.getInterimTile()):(g=new eet(A,o,this.helper),a.set(m,g))),oet(n,g,i);var v=A.getKey();h[v]=!0,0===A.getState()&&(t.tileQueue.isKeyQueued(v)||t.tileQueue.enqueue([A,c,o.getTileCoordCenter(f),u]))}},e.prototype.renderFrame=function(t){this.preRender(t);var e=t.viewState,i=t.layerStatesArray[t.layerIndex],n=aet(t,t.extent),r=this.getLayer().getSource(),s=r.getTileGridForProjection(e.projection),o=s.getZForResolution(e.resolution,r.zDirection),a={};if(t.nextExtent){var l=s.getZForResolution(e.nextResolution,r.zDirection),c=aet(t,t.nextExtent);this.enqueueTiles(t,c,l,a)}this.enqueueTiles(t,n,o,a);for(var h={},u=eN(this),d=t.time,p=!1,f=a[o],m=0,g=f.length;m<g;++m){var A=(R=($=f[m]).tile).tileCoord;if($.loaded){if(1===(F=R.getAlpha(u,d))){R.endTransition(u);continue}p=!0,h[L=kV(A)]=F}if(!this.findAltTiles_(s,A,o+1,a))for(var v=o-1;v>=s.minZoom&&!this.findAltTiles_(s,A,v,a);--v);}this.helper.useProgram(this.program_),this.helper.prepareDraw(t,!p);for(var _=Object.keys(a).map(Number).sort(NB),y=this.helper.getGL(),b=e.center[0],w=e.center[1],x=0,S=_.length;x<S;++x){var C=_[x],k=s.getResolution(C),E=GV(s.getTileSize(C),this.tempSize_),M=s.getOrigin(C),T=(b-M[0])/(E[0]*k),I=(M[1]-w)/(E[1]*k),O=e.resolution/k,P=set(C),D=a[C];for(m=0,g=D.length;m<g;++m)if(($=D[m]).loaded){var R,F,L=kV(A=(R=$.tile).tileCoord);D1(this.tileTransform_,0,0,2/(t.size[0]*O/E[0]),-2/(t.size[1]*O/E[1]),e.rotation,-(T-A[1]),-(I-A[2])),this.helper.setUniformMatrixValue(\"u_tileTransform\",Ntt(this.tempMat4_,this.tileTransform_)),this.helper.bindBuffer($.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(net);for(var B=0;B<$.textures.length;++B){var N=\"u_tileTexture\"+B;y.activeTexture(y[\"TEXTURE\"+B]),y.bindTexture(y.TEXTURE_2D,$.textures[B]),y.uniform1i(this.helper.getUniformLocation(N),B)}(F=L in h?h[L]:1)<1&&(t.animate=!0),this.helper.setUniformFloatValue(\"u_transitionAlpha\",F),this.helper.setUniformFloatValue(\"u_depth\",P),this.helper.setUniformFloatValue(\"u_texturePixelWidth\",E[0]),this.helper.setUniformFloatValue(\"u_texturePixelHeight\",E[1]),this.helper.setUniformFloatValue(\"u_resolution\",e.resolution),this.helper.setUniformFloatValue(\"u_zoom\",e.zoom),this.helper.drawElements(0,this.indices_.getSize())}}this.helper.finalizeDraw(t);var z=this.helper.getCanvas(),V=i.opacity;this.renderedOpacity_!==V&&(z.style.opacity=String(V),this.renderedOpacity_=V);for(var j=this.tileTextureCache_;j.canExpireCache();){var $;($=j.pop()).dispose()}return t.postRenderFunctions.push(function(t,e){r.expireCache(r.getProjection(),ret)}),this.postRender(t),z},e.prototype.findAltTiles_=function(t,e,i,n){var r=t.getTileRangeForTileCoordAndZ(e,i,this.tempTileRange_);if(!r)return!1;for(var s=!0,o=this.tileTextureCache_,a=r.minX;a<=r.maxX;++a)for(var l=r.minY;l<=r.maxY;++l){var c=CV(i,a,l),h=!1;if(o.containsKey(c)){var u=o.get(c);u.loaded&&(oet(n,u,i),h=!0)}h||(s=!1)}return s},e.prototype.disposeInternal=function(){var e=this.helper,i=e.getGL();e.deleteBuffer(this.indices_),delete this.indices_,i.deleteProgram(this.program_),delete this.program_;var n=this.tileTextureCache_;n.forEach(function(t){t.dispose()}),n.clear(),delete this.tileTextureCache_,t.prototype.disposeInternal.call(this)}}(Gtt);var cet={};function het(t){if(\"number\"==typeof t)return 1;if(\"boolean\"==typeof t)return 8;if(\"string\"==typeof t)return function(t){return w6.test(t)&&(t=S6(t)),b6.test(t)||0===t.indexOf(\"rgba(\")||0===t.indexOf(\"rgb(\")}(t)?6:2;if(!Array.isArray(t))throw new Error(\"Unhandled value type: \"+JSON.stringify(t));var e=t;if(e.every(function(t){return\"number\"==typeof t}))return 3===e.length||4===e.length?20:16;if(\"string\"!=typeof e[0])throw new Error(\"Expected an expression operator but received: \"+JSON.stringify(e));var i=cet[e[0]];if(void 0===i)throw new Error(\"Unrecognized expression operator: \"+JSON.stringify(e));return i.getReturnType(e.slice(1))}function uet(t){var e=t.toString();return-1===e.indexOf(\".\")?e+\".0\":e}function det(t){if(t.length<2||t.length>4)throw new Error(\"`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.\");return\"vec\"+t.length+\"(\"+t.map(uet).join(\", \")+\")\"}function pet(t,e){return void 0===t.stringLiteralsMap[e]&&(t.stringLiteralsMap[e]=Object.keys(t.stringLiteralsMap).length),t.stringLiteralsMap[e]}function fet(t,e,i){if(Array.isArray(e)&&\"string\"==typeof e[0]){var n=cet[e[0]];if(void 0===n)throw new Error(\"Unrecognized expression operator: \"+JSON.stringify(e));return n.toGlsl(t,e.slice(1),i)}var r=het(e);if((1&r)>0)return uet(e);if((8&r)>0)return e.toString();if((2&r)>0&&(void 0===i||2==i))return function(t,e){return uet(pet(t,e))}(t,e.toString());if((4&r)>0&&(void 0===i||4==i))return function(t){var e=M6(t).slice();return e.length<4&&e.push(1),det(e.map(function(t,e){return e<3?t/255:t}))}(e);if((16&r)>0)return det(e);throw new Error(\"Unexpected expression \"+e+\" (expected type \"+i+\")\")}function met(t){if(!(1&het(t)))throw new Error(\"A numeric value was expected, got \"+JSON.stringify(t)+\" instead\")}function get(t){for(var e=0;e<t.length;e++)met(t[e])}function Aet(t){if(!(2&het(t)))throw new Error(\"A string value was expected, got \"+JSON.stringify(t)+\" instead\")}function vet(t){if(!(8&het(t)))throw new Error(\"A boolean value was expected, got \"+JSON.stringify(t)+\" instead\")}function _et(t,e){if(t.length!==e)throw new Error(\"Exactly \"+e+\" arguments were expected, got \"+t.length+\" instead\")}function yet(t,e){if(t.length<e)throw new Error(\"At least \"+e+\" arguments were expected, got \"+t.length+\" instead\")}function bet(t,e){if(t.length>e)throw new Error(\"At most \"+e+\" arguments were expected, got \"+t.length+\" instead\")}function wet(t){if(t.length%2!=0)throw new Error(\"An even amount of arguments was expected, got \"+t+\" instead\")}function xet(t,e){if(!function(t){return Az(t)%1==0}(e))throw new Error(\"Could not infer only one type from the following expression: \"+JSON.stringify(t))}function Cet(t){return\"u_var_\"+t}function ket(t){return{getReturnType:function(t){return 8},toGlsl:function(e,i){_et(i,2);for(var n=31,r=0;r<i.length;r++)n&=het(i[r]);if(0===n)throw new Error(\"All arguments should be of compatible type, got \"+JSON.stringify(i)+\" instead\");return\"(\"+fet(e,i[0],n&=-5)+\" \"+t+\" \"+fet(e,i[1],n)+\")\"}}}function Eet(t){return{getReturnType:function(t){return 8},toGlsl:function(e,i){yet(i,2);for(var n=0;n<i.length;n++)vet(i[n]);return\"(\"+i.map(function(t){return fet(e,t)}).join(\" \"+t+\" \")+\")\"}}}cet.get={getReturnType:function(t){return 31},toGlsl:function(t,e){_et(e,1),Aet(e[0]);var i=e[0].toString();return-1===t.attributes.indexOf(i)&&t.attributes.push(i),(t.inFragmentShader?\"v_\":\"a_\")+i}},cet.var={getReturnType:function(t){return 31},toGlsl:function(t,e){_et(e,1),Aet(e[0]);var i=e[0].toString();return-1===t.variables.indexOf(i)&&t.variables.push(i),Cet(i)}},cet.band={getReturnType:function(t){return 1},toGlsl:function(t,e){yet(e,1),bet(e,3);var i=e[0];if(\"number\"!=typeof i)throw new Error(\"Band index must be a number\");var n=i-1,r=Math.floor(n/4),s=n%4;if(i===t.bandCount&&1===s&&(s=3),1===e.length)return\"color\"+r+\"[\"+s+\"]\";var o=e[1],a=e[2]||0;return met(o),met(a),\"texture2D(u_tileTexture\"+r+\", v_textureCoord + vec2(\"+fet(t,o)+\" / u_texturePixelWidth, \"+fet(t,a)+\" / u_texturePixelHeight))[\"+s+\"]\"}},cet.time={getReturnType:function(t){return 1},toGlsl:function(t,e){return _et(e,0),\"u_time\"}},cet.zoom={getReturnType:function(t){return 1},toGlsl:function(t,e){return _et(e,0),\"u_zoom\"}},cet.resolution={getReturnType:function(t){return 1},toGlsl:function(t,e){return _et(e,0),\"u_resolution\"}},cet[\"*\"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return _et(e,2),get(e),\"(\"+fet(t,e[0])+\" * \"+fet(t,e[1])+\")\"}},cet[\"/\"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return _et(e,2),get(e),\"(\"+fet(t,e[0])+\" / \"+fet(t,e[1])+\")\"}},cet[\"+\"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return _et(e,2),get(e),\"(\"+fet(t,e[0])+\" + \"+fet(t,e[1])+\")\"}},cet[\"-\"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return _et(e,2),get(e),\"(\"+fet(t,e[0])+\" - \"+fet(t,e[1])+\")\"}},cet.clamp={getReturnType:function(t){return 1},toGlsl:function(t,e){_et(e,3),get(e);var i=fet(t,e[1]),n=fet(t,e[2]);return\"clamp(\"+fet(t,e[0])+\", \"+i+\", \"+n+\")\"}},cet[\"%\"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return _et(e,2),get(e),\"mod(\"+fet(t,e[0])+\", \"+fet(t,e[1])+\")\"}},cet[\"^\"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return _et(e,2),get(e),\"pow(\"+fet(t,e[0])+\", \"+fet(t,e[1])+\")\"}},cet.abs={getReturnType:function(t){return 1},toGlsl:function(t,e){return _et(e,1),get(e),\"abs(\"+fet(t,e[0])+\")\"}},cet.sin={getReturnType:function(t){return 1},toGlsl:function(t,e){return _et(e,1),get(e),\"sin(\"+fet(t,e[0])+\")\"}},cet.cos={getReturnType:function(t){return 1},toGlsl:function(t,e){return _et(e,1),get(e),\"cos(\"+fet(t,e[0])+\")\"}},cet.atan={getReturnType:function(t){return 1},toGlsl:function(t,e){return yet(e,1),bet(e,2),get(e),2===e.length?\"atan(\"+fet(t,e[0])+\", \"+fet(t,e[1])+\")\":\"atan(\"+fet(t,e[0])+\")\"}},cet[\">\"]={getReturnType:function(t){return 8},toGlsl:function(t,e){return _et(e,2),get(e),\"(\"+fet(t,e[0])+\" > \"+fet(t,e[1])+\")\"}},cet[\">=\"]={getReturnType:function(t){return 8},toGlsl:function(t,e){return _et(e,2),get(e),\"(\"+fet(t,e[0])+\" >= \"+fet(t,e[1])+\")\"}},cet[\"<\"]={getReturnType:function(t){return 8},toGlsl:function(t,e){return _et(e,2),get(e),\"(\"+fet(t,e[0])+\" < \"+fet(t,e[1])+\")\"}},cet[\"<=\"]={getReturnType:function(t){return 8},toGlsl:function(t,e){return _et(e,2),get(e),\"(\"+fet(t,e[0])+\" <= \"+fet(t,e[1])+\")\"}},cet[\"==\"]=ket(\"==\"),cet[\"!=\"]=ket(\"!=\"),cet[\"!\"]={getReturnType:function(t){return 8},toGlsl:function(t,e){return _et(e,1),vet(e[0]),\"(!\"+fet(t,e[0])+\")\"}},cet.all=Eet(\"&&\"),cet.any=Eet(\"||\"),cet.between={getReturnType:function(t){return 8},toGlsl:function(t,e){_et(e,3),get(e);var i=fet(t,e[1]),n=fet(t,e[2]),r=fet(t,e[0]);return\"(\"+r+\" >= \"+i+\" && \"+r+\" <= \"+n+\")\"}},cet.array={getReturnType:function(t){return 16},toGlsl:function(t,e){yet(e,2),bet(e,4),get(e);var i=e.map(function(e){return fet(t,e,1)});return\"vec\"+e.length+\"(\"+i.join(\", \")+\")\"}},cet.color={getReturnType:function(t){return 4},toGlsl:function(t,e){yet(e,3),bet(e,4),get(e),3===e.length&&e.push(1);var i=e.map(function(e,i){return fet(t,e,1)+(i<3?\" / 255.0\":\"\")});return\"vec\"+e.length+\"(\"+i.join(\", \")+\")\"}},cet.interpolate={getReturnType:function(t){for(var e=5,i=3;i<t.length;i+=2)e&=het(t[i]);return e},toGlsl:function(t,e,i){wet(e),yet(e,6);var n,r=e[0];switch(r[0]){case\"linear\":n=1;break;case\"exponential\":n=r[1];break;default:n=null}if(!n)throw new Error('Invalid interpolation type for \"interpolate\" operator, received: '+JSON.stringify(r));var s=void 0!==i?i:31,o=cet.interpolate.getReturnType(e)&s;xet(e,o);for(var a=fet(t,e[1]),l=uet(n),c=\"\",h=2;h<e.length-2;h+=2){var u=fet(t,e[h]),d=c||fet(t,e[h+1],o),p=fet(t,e[h+2]);c=\"mix(\"+d+\", \"+fet(t,e[h+3],o)+\", pow(clamp((\"+a+\" - \"+u+\") / (\"+p+\" - \"+u+\"), 0.0, 1.0), \"+l+\"))\"}return c}},cet.match={getReturnType:function(t){for(var e=31,i=2;i<t.length;i+=2)e&=het(t[i]);return e&het(t[t.length-1])},toGlsl:function(t,e,i){wet(e),yet(e,4);var n=void 0!==i?i:31,r=cet.match.getReturnType(e)&n;xet(e,r);for(var s=fet(t,e[0]),o=fet(t,e[e.length-1],r),a=null,l=e.length-3;l>=1;l-=2)a=\"(\"+s+\" == \"+fet(t,e[l])+\" ? \"+fet(t,e[l+1],r)+\" : \"+(a||o)+\")\";return a}},cet.case={getReturnType:function(t){for(var e=31,i=1;i<t.length;i+=2)e&=het(t[i]);return e&het(t[t.length-1])},toGlsl:function(t,e,i){(function(t){if(t.length%2==0)throw new Error(\"An odd amount of arguments was expected, got \"+t+\" instead\")})(e),yet(e,3);var n=void 0!==i?i:31,r=cet.case.getReturnType(e)&n;xet(e,r);for(var s=0;s<e.length-1;s+=2)vet(e[s]);var o=fet(t,e[e.length-1],r),a=null;for(s=e.length-3;s>=0;s-=2)a=\"(\"+fet(t,e[s])+\" ? \"+fet(t,e[s+1],r)+\" : \"+(a||o)+\")\";return a}};var Met=function(){function t(){this.uniforms=[],this.attributes=[],this.varyings=[],this.sizeExpression=\"vec2(1.0)\",this.rotationExpression=\"0.0\",this.offsetExpression=\"vec2(0.0)\",this.colorExpression=\"vec4(1.0)\",this.texCoordExpression=\"vec4(0.0, 0.0, 1.0, 1.0)\",this.discardExpression=\"false\",this.rotateWithView=!1}return t.prototype.addUniform=function(t){return this.uniforms.push(t),this},t.prototype.addAttribute=function(t){return this.attributes.push(t),this},t.prototype.addVarying=function(t,e,i){return this.varyings.push({name:t,type:e,expression:i}),this},t.prototype.setSizeExpression=function(t){return this.sizeExpression=t,this},t.prototype.setRotationExpression=function(t){return this.rotationExpression=t,this},t.prototype.setSymbolOffsetExpression=function(t){return this.offsetExpression=t,this},t.prototype.setColorExpression=function(t){return this.colorExpression=t,this},t.prototype.setTextureCoordinateExpression=function(t){return this.texCoordExpression=t,this},t.prototype.setFragmentDiscardExpression=function(t){return this.discardExpression=t,this},t.prototype.setSymbolRotateWithView=function(t){return this.rotateWithView=t,this},t.prototype.getSizeExpression=function(){return this.sizeExpression},t.prototype.getOffsetExpression=function(){return this.offsetExpression},t.prototype.getColorExpression=function(){return this.colorExpression},t.prototype.getTextureCoordinateExpression=function(){return this.texCoordExpression},t.prototype.getFragmentDiscardExpression=function(){return this.discardExpression},t.prototype.getSymbolVertexShader=function(t){var e=this.rotateWithView?\"u_offsetScaleMatrix * u_offsetRotateMatrix\":\"u_offsetScaleMatrix\",i=this.attributes,n=this.varyings;return t&&(i=i.concat(\"vec4 a_hitColor\"),n=n.concat({name:\"v_hitColor\",type:\"vec4\",expression:\"a_hitColor\"})),\"precision mediump float;\\nuniform mat4 u_projectionMatrix;\\nuniform mat4 u_offsetScaleMatrix;\\nuniform mat4 u_offsetRotateMatrix;\\nuniform float u_time;\\nuniform float u_zoom;\\nuniform float u_resolution;\\n\"+this.uniforms.map(function(t){return\"uniform \"+t+\";\"}).join(\"\\n\")+\"\\nattribute vec2 a_position;\\nattribute float a_index;\\n\"+i.map(function(t){return\"attribute \"+t+\";\"}).join(\"\\n\")+\"\\nvarying vec2 v_texCoord;\\nvarying vec2 v_quadCoord;\\n\"+n.map(function(t){return\"varying \"+t.type+\" \"+t.name+\";\"}).join(\"\\n\")+\"\\nvoid main(void) {\\n  mat4 offsetMatrix = \"+e+\";\\n  vec2 halfSize = \"+this.sizeExpression+\" * 0.5;\\n  vec2 offset = \"+this.offsetExpression+\";\\n  float angle = \"+this.rotationExpression+\";\\n  float offsetX;\\n  float offsetY;\\n  if (a_index == 0.0) {\\n    offsetX = (offset.x - halfSize.x) * cos(angle) + (offset.y - halfSize.y) * sin(angle);\\n    offsetY = (offset.y - halfSize.y) * cos(angle) - (offset.x - halfSize.x) * sin(angle);\\n  } else if (a_index == 1.0) {\\n    offsetX = (offset.x + halfSize.x) * cos(angle) + (offset.y - halfSize.y) * sin(angle);\\n    offsetY = (offset.y - halfSize.y) * cos(angle) - (offset.x + halfSize.x) * sin(angle);\\n  } else if (a_index == 2.0) {\\n    offsetX = (offset.x + halfSize.x) * cos(angle) + (offset.y + halfSize.y) * sin(angle);\\n    offsetY = (offset.y + halfSize.y) * cos(angle) - (offset.x + halfSize.x) * sin(angle);\\n  } else {\\n    offsetX = (offset.x - halfSize.x) * cos(angle) + (offset.y + halfSize.y) * sin(angle);\\n    offsetY = (offset.y + halfSize.y) * cos(angle) - (offset.x - halfSize.x) * sin(angle);\\n  }\\n  vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\\n  vec4 texCoord = \"+this.texCoordExpression+\";\\n  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;\\n  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;\\n  v_texCoord = vec2(u, v);\\n  u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;\\n  v = a_index == 2.0 || a_index == 3.0 ? 0.0 : 1.0;\\n  v_quadCoord = vec2(u, v);\\n\"+n.map(function(t){return\"  \"+t.name+\" = \"+t.expression+\";\"}).join(\"\\n\")+\"\\n}\"},t.prototype.getSymbolFragmentShader=function(t){var e=t?\"  if (gl_FragColor.a < 0.1) { discard; } gl_FragColor = v_hitColor;\":\"\",i=this.varyings;return t&&(i=i.concat({name:\"v_hitColor\",type:\"vec4\",expression:\"a_hitColor\"})),\"precision mediump float;\\nuniform float u_time;\\nuniform float u_zoom;\\nuniform float u_resolution;\\n\"+this.uniforms.map(function(t){return\"uniform \"+t+\";\"}).join(\"\\n\")+\"\\nvarying vec2 v_texCoord;\\nvarying vec2 v_quadCoord;\\n\"+i.map(function(t){return\"varying \"+t.type+\" \"+t.name+\";\"}).join(\"\\n\")+\"\\nvoid main(void) {\\n  if (\"+this.discardExpression+\") { discard; }\\n  gl_FragColor = \"+this.colorExpression+\";\\n  gl_FragColor.rgb *= gl_FragColor.a;\\n\"+e+\"\\n}\"},t}(),Tet=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Iet=function(t){function e(e){var i=this,n=WB({},e);return(i=t.call(this,n)||this).parseResult_=function(t){var e=t.symbol,i=void 0!==e.size?e.size:1,n=e.color||\"white\",r=e.textureCoord||[0,0,1,1],s=e.offset||[0,0],o=void 0!==e.opacity?e.opacity:1,a=void 0!==e.rotation?e.rotation:0,l={inFragmentShader:!1,variables:[],attributes:[],stringLiteralsMap:{}},c=fet(l,i,17),h=fet(l,s,16),u=fet(l,r,16),d=fet(l,a,1),p={inFragmentShader:!0,variables:l.variables,attributes:[],stringLiteralsMap:l.stringLiteralsMap},f=fet(p,n,4),m=fet(p,o,1),g=\"1.0\",A=\"vec2(\"+fet(p,i,17)+\").x\";switch(e.symbolType){case\"square\":case\"image\":break;case\"circle\":g=\"(1.0-smoothstep(1.-4./\"+A+\",1.,dot(v_quadCoord-.5,v_quadCoord-.5)*4.))\";break;case\"triangle\":var v=\"(v_quadCoord*2.-1.)\",_=\"(atan(\"+v+\".x,\"+v+\".y))\";g=\"(1.0-smoothstep(.5-3./\"+A+\",.5,cos(floor(.5+\"+_+\"/2.094395102)*2.094395102-\"+_+\")*length(\"+v+\")))\";break;default:throw new Error(\"Unexpected symbol type: \"+e.symbolType)}var y=(new Met).setSizeExpression(\"vec2(\"+c+\")\").setRotationExpression(d).setSymbolOffsetExpression(h).setTextureCoordinateExpression(u).setSymbolRotateWithView(!!e.rotateWithView).setColorExpression(\"vec4(\"+f+\".rgb, \"+f+\".a * \"+m+\" * \"+g+\")\");if(t.filter){var b=fet(p,t.filter,8);y.setFragmentDiscardExpression(\"!\"+b)}var w={};if(p.variables.forEach(function(e){var i=Cet(e);y.addUniform(\"float \"+i),w[i]=function(){if(!t.variables||void 0===t.variables[e])throw new Error(\"The following variable is missing from the style: \"+e);var i=t.variables[e];return\"string\"==typeof i&&(i=pet(l,i)),void 0!==i?i:-9999999}}),\"image\"===e.symbolType&&e.src){var x=new Image;x.src=e.src,y.addUniform(\"sampler2D u_texture\").setColorExpression(y.getColorExpression()+\" * texture2D(u_texture, v_texCoord)\"),w.u_texture=x}return p.attributes.forEach(function(t){-1===l.attributes.indexOf(t)&&l.attributes.push(t),y.addVarying(\"v_\"+t,\"float\",\"a_\"+t)}),l.attributes.forEach(function(t){y.addAttribute(\"float a_\"+t)}),{builder:y,attributes:l.attributes.map(function(t){return{name:t,callback:function(e,i){var n=i[t];return\"string\"==typeof n&&(n=pet(l,n)),void 0!==n?n:-9999999}}}),uniforms:w}}(e.style),i.hitDetectionDisabled_=!!e.disableHitDetection,i}return Tet(e,t),e.prototype.createRenderer=function(){return new Ktt(this,{className:this.getClassName(),vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitVertexShader:!this.hitDetectionDisabled_&&this.parseResult_.builder.getSymbolVertexShader(!0),hitFragmentShader:!this.hitDetectionDisabled_&&this.parseResult_.builder.getSymbolFragmentShader(!0),uniforms:this.parseResult_.uniforms,attributes:this.parseResult_.attributes})},e}(t6);window.ol&&!ol.ext&&(ol.ext={});var Oet=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t};window.ol&&(ol.inherits||(ol.inherits=Oet)),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),window.Element&&!Element.prototype.remove&&(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)});var Pet,Det=Oet,Ret=function(t,e){var i=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(i*i+n*n)},Fet=function(t,e){return t[0]==e[0]&&t[1]==e[1]};!function(){function t(t,e){for(let i=t.length-1;i>0;i--)(t[i][0]>e&&t[i-1][0]<e||t[i][0]<e&&t[i-1][0]>e)&&t.splice(i,0,[e,(e-t[i][0])/(t[i-1][0]-t[i][0])*(t[i-1][1]-t[i][1])+t[i][1]])}function e(t,e){for(let i=t.length-1;i>0;i--)(t[i][1]>e&&t[i-1][1]<e||t[i][1]<e&&t[i-1][1]>e)&&t.splice(i,0,[(e-t[i][1])/(t[i-1][1]-t[i][1])*(t[i-1][0]-t[i][0])+t[i][0],e])}Pet=function(i,n){var r=\"Polygon\"===n.getType();if(!r&&\"MultiPolygon\"!==n.getType())return null;var s=n.getCoordinates();return r&&(s=[s]),s.forEach(function(n){n.forEach(function(n){t(n,i[0]),t(n,i[2]),e(n,i[1]),e(n,i[3])})}),s.forEach(function(t){t.forEach(function(t){t.forEach(function(t){t[0]<i[0]?t[0]=i[0]:t[0]>i[2]&&(t[0]=i[2]),t[1]<i[1]?t[1]=i[1]:t[1]>i[3]&&(t[1]=i[3])})})}),r?new U2(s[0]):new W2(s)}}();var Let=function(t,e,i,n){var r=[];!1!==n&&r.push(t);var s=Ret(t,e);if(s){var o=Math.round(s/i);if(o>1)for(var a=(e[0]-t[0])/o,l=(e[1]-t[1])/o,c=1;c<o;c++)r.push([t[0]+a*c,t[1]+l*c])}return r.push(e),r};U2.prototype.sampleAt=function(t){var e=this.getCoordinates(),i=[];return e.forEach(function(e){for(var n=[],r=1;r<e.length;r++)n=n.concat(Let(e[r-1],e[r],t,1===r));i.push(n)}),new U2(i)},W2.prototype.sampleAt=function(t){var e=this.getCoordinates(),i=[];return e.forEach(function(e){var n=[];i.push(n),e.forEach(function(e){for(var i=[],r=1;r<e.length;r++)i=i.concat(Let(e[r-1],e[r],t,1===r));n.push(i)})}),new W2(i)},M9.prototype.intersection=function(t,e){if(t.sampleAt){var i=MN(this.getCenter().concat(this.getCenter()),this.getRadius());t=(t=Pet(i,t)).simplify(e);var n=this.getCenter(),r=this.getRadius(),s=t.sampleAt(e).getCoordinates();switch(t.getType()){case\"Polygon\":s=[s];case\"MultiPolygon\":var o=!1,a=[];return s.forEach(function(t){var e=[];a.push(e),t.forEach(function(t){var i=[];e.push(i),t.forEach(function(t){var e=Ret(n,t);e>r?(o=!0,i.push([n[0]+r/e*(t[0]-n[0]),n[1]+r/e*(t[1]-n[1])])):i.push(t)})})}),o?\"Polygon\"===t.getType()?new U2(a[0]):new W2(a):t}}else console.warn(\"[ol/geom/Circle~intersection] Unsupported geometry type: \"+t.getType());return t},S2.prototype.splitAt=function(t,e){var i;if(!t)return[this];if(e||(e=1e-10),t.length&&t[0].length){var n=[this];for(i=0;i<t.length;i++){for(var r=[],s=0;s<n.length;s++){var o=n[s].splitAt(t[i],e);r=r.concat(o)}n=r}return n}if(Fet(t,this.getFirstCoordinate())||Fet(t,this.getLastCoordinate()))return[this];var a=this.getCoordinates(),l=[a[0]],c=[];for(i=0;i<a.length-1;i++)if(!Fet(a[i],a[i+1])){if(Fet(t,a[i+1]))l.push(a[i+1]),c.push(new S2(l)),l=[];else if(!Fet(t,a[i])){var h,u=!1;a[i][0]==a[i+1][0]?(h=(a[i][1]-t[1])/(a[i][1]-a[i+1][1]),u=a[i][0]==t[0]&&0<h&&h<=1):a[i][1]==a[i+1][1]?(h=(a[i][0]-t[0])/(a[i][0]-a[i+1][0]),u=a[i][1]==t[1]&&0<h&&h<=1):(h=(a[i][0]-t[0])/(a[i][0]-a[i+1][0]),u=Math.abs(h-(a[i][1]-t[1])/(a[i][1]-a[i+1][1]))<=e&&0<h&&h<=1),u&&(l.push(t),c.push(new S2(l)),l=[t])}l.push(a[i+1])}return l.length>1&&c.push(new S2(l)),c.length?c:[this]};var Bet=function(t){t||(t={}),d7.call(this,{renderer:this._render.bind(this),stroke:t.stroke,text:t.text,zIndex:t.zIndex,geometry:t.geometry}),this._visible=!1!==t.visible,\"function\"==typeof t.width?this._widthFn=t.width:this.setWidth(t.width),this.setWidth2(t.width2),\"function\"==typeof t.color?this._colorFn=t.color:this.setColor(t.color),this.setColor2(t.color2),this.setLineCap(t.lineCap),this.setArrow(t.arrow),this.setArrowSize(t.arrowSize),this.setArrowColor(t.arrowColor),this._offset=[0,0],this.setOffset(t.offset0,0),this.setOffset(t.offset1,1),this._noOverlap=t.noOverlap};Det(Bet,d7),Bet.prototype.setWidth=function(t){this._width=t||0},Bet.prototype.setWidth2=function(t){this._width2=t},Bet.prototype.getOffset=function(t){return this._offset[t]},Bet.prototype.setOffset=function(t,e){switch(t=Math.max(0,parseFloat(t)),e){case 0:this._offset[0]=t;break;case 1:this._offset[1]=t}},Bet.prototype.setLineCap=function(t){this._lineCap=\"round\"===t?\"round\":\"butt\"},Bet.prototype.getWidth=function(t,e){return this._widthFn?this._widthFn(t,e):this._width+((\"number\"==typeof this._width2?this._width2:this._width)-this._width)*e},Bet.prototype.setColor=function(t){try{this._color=M6(t)}catch(C6){this._color=[0,0,0,1]}},Bet.prototype.setColor2=function(t){try{this._color2=M6(t)}catch(C6){this._color2=null}},Bet.prototype.setArrowColor=function(t){try{this._acolor=x6(t)}catch(C6){this._acolor=null}},Bet.prototype.getColor=function(t,e){if(this._colorFn)return x6(this._colorFn(t,e));var i=this._color,n=this._color2||this._color;return\"rgba(\"+ +Math.round(i[0]+(n[0]-i[0])*e)+\",\"+Math.round(i[1]+(n[1]-i[1])*e)+\",\"+Math.round(i[2]+(n[2]-i[2])*e)+\",\"+(i[3]+(n[3]-i[3])*e)+\")\"},Bet.prototype.getArrow=function(){return this._arrow},Bet.prototype.setArrow=function(t){this._arrow=parseInt(t),(this._arrow<-1||this._arrow>2)&&(this._arrow=0)},Bet.prototype.getArrowSize=function(){return this._arrowSize||[16,16]},Bet.prototype.setArrowSize=function(t){Array.isArray(t)?this._arrowSize=t:\"number\"==typeof t&&(this._arrowSize=[t,t])},Bet.prototype.drawArrow=function(t,e,i,n,r){var s=this.getArrowSize()[0]*r,o=Ret(e,i),a=(e[0]-i[0])/o,l=(e[1]-i[1])/o;n=Math.max(this.getArrowSize()[1]/2,n/2)*r,t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(e[0]-s*a+n*l,e[1]-s*l-n*a),t.lineTo(e[0]-s*a-n*l,e[1]-s*l+n*a),t.lineTo(e[0],e[1]),t.fill()},Bet.prototype._render=function(t,e){if(\"LineString\"===e.geometry.getType()){var i,n,r,s=e.context;if(!this._visible){var o=e.pixelRatio/e.resolution,a=Math.cos(e.rotation),l=Math.sin(e.rotation);n=e.geometry.getCoordinates();var c=t[0][0]-n[0][0]*o*a-n[0][1]*o*l,h=t[0][1]-n[0][0]*o*l+n[0][1]*o*a;for(t=[],i=0;r=n[i];i++)t[i]=[c+r[0]*o*a+r[1]*o*l,h+r[0]*o*l-r[1]*o*a,r[2]]}var u=this.getArrowSize()[0]*e.pixelRatio;s.save(),this.getOffset(0)&&this._splitAsize(t,this.getOffset(0)*e.pixelRatio),this.getOffset(1)&&this._splitAsize(t,this.getOffset(1)*e.pixelRatio,!0),t.length>1&&(-1===this.getArrow()||2===this.getArrow())&&(r=this._splitAsize(t,u),s.fillStyle=this._acolor?this._acolor:this.getColor(e.feature,0),this.drawArrow(s,r[0],r[1],this.getWidth(e.feature,0),e.pixelRatio)),t.length>1&&this.getArrow()>0&&(r=this._splitAsize(t,u,!0),s.fillStyle=this._acolor?this._acolor:this.getColor(e.feature,1),this.drawArrow(s,r[0],r[1],this.getWidth(e.feature,1),e.pixelRatio));var d=this._splitInto(t,255,2),p=0,f=d.length;if(s.lineJoin=\"round\",s.lineCap=this._lineCap||\"butt\",d.length>1)for(p=0;p<d.length;p++){var m=p/f;for(n=d[p],s.lineWidth=this.getWidth(e.feature,m)*e.pixelRatio,s.strokeStyle=this.getColor(e.feature,m),s.beginPath(),s.moveTo(n[0][0],n[0][1]),i=1;r=n[i];i++)s.lineTo(r[0],r[1]);s.stroke()}s.restore()}},Bet.prototype._splitAsize=function(t,e,i){var n,r,s,o,a=0;for(n=s=i?t.pop():t.shift();t.length;){if(r=i?t.pop():t.shift(),a+(o=Ret(n,r))>e){o=Ret(n=[n[0]+(r[0]-n[0])*(e-a)/o,n[1]+(r[1]-n[1])*(e-a)/o],s),i?(t.push(r),t.push(n),t.push([n[0]+(s[0]-n[0])/o,n[1]+(s[1]-n[1])/o])):(t.unshift(r),t.unshift(n),t.unshift([n[0]+(s[0]-n[0])/o,n[1]+(s[1]-n[1])/o]));break}a+=o,n=r}return[s,n]},Bet.prototype._splitInto=function(t,e,i){var n,r,s,o=this._noOverlap?1:.9,a=[],l=0;for(n=1;r=t[n];n++)l+=Ret(t[n-1],r);var c=Math.max(i||2,l/(e||255)),h=t[0];l=0;var u=[h];for(n=1,r=t[1];n<t.length;){var d=r[0]-h[0],p=r[1]-h[1];if(l+(s=Math.sqrt(d*d+p*p))>c){var f=(c-l)/s;u.push([h[0]+d*f,h[1]+p*f]),a.push(u),u=[h=[h[0]+d*f*o,h[1]+p*f*o]],l=0}else l+=s,u.push(h=r),r=t[++n]}return a.push(u),a};var Net=Bet;const zet=[13e3,12500,12e3,11500,11e3,10500,1e4,9500,9e3,8500,8500,7500,7e3,6500,6e3,5500,5e3,4500,4e3,3500,3e3,2500,2e3,1500,1200,1e3,800,600,400,300,200,100],Vet=[\"#ff0000\",\"#ff00e4\",\"#d800ff\",\"#ae00ff\",\"#9600ff\",\"#7800ff\",\"#6000ff\",\"#4e00ff\",\"#3600ff\",\"#2400ff\",\"#1200ff\",\"#0000ff\",\"#001eff\",\"#0030ff\",\"#0054ff\",\"#0078ff\",\"#0096ff\",\"#00a8ff\",\"#00c0ff\",\"#00eaff\",\"#00ffe4\",\"#00ffd2\",\"#00ff9c\",\"#00ff72\",\"#00ff36\",\"#00ff0c\",\"#1eff00\",\"#42ff00\",\"#ccff00\",\"#f0ff00\",\"#ffea00\",\"#ffe062\"],jet=Vet.map(t=>oH(t));function $et(t){return(t*=.3048)<=100?\"#ffffff\":Vet[zet.findIndex(e=>e<t)]}class Uet extends E1{constructor(t,e,i,n){super({geometry:new S2([Qz(t),Qz(e)])}),super.setStyle(new Net({color:$et(i),color2:$et(n),width:2}))}}class Het extends E1{constructor(t){super({geometry:new M2(Qz([t.lon,t.lat]))}),this.position=t;const[e,i,n]=function(t){return(t*=.3048)<=100?[255,255,255]:jet[zet.findIndex(e=>e<t)]}(t.altitude);this.set(\"red\",e,!0),this.set(\"green\",i,!0),this.set(\"blue\",n,!0)}}class Get extends E1{constructor(t,e){super({geometry:new M2(Qz([t.lon,t.lat]))}),this.position=t;const i=ytt[e];this.set(\"red\",i[0],!0),this.set(\"green\",i[1],!0),this.set(\"blue\",i[2],!0)}}const qet=_tt.map(t=>new d7({stroke:new o7({color:t,width:2})})),Wet=_tt.map(t=>new d7({stroke:new o7({color:t,lineDash:[5,15],width:2})}));class Yet extends E1{constructor(t,e,i){super({geometry:new S2([Qz(t),Qz(e)])}),super.setStyle(i)}}let Zet=(()=>{class t{constructor(t,e,i){this.eventsService=t,this.fleetsService=e,this.selectionService=i,this.trails$=new Zp([]),LT([this.eventsService.transhipmentTrail$,this.fleetsService.fleetTrails$,this.selectionService.trails$]).subscribe(([t,e,i])=>{this.trails$.next([t,...e,...i].filter(t=>!!t))})}clear(){this.trails$.next([])}}return t.\\u0275fac=function(e){return new(e||t)(En(Eq),En(Tq),En(bq))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Xet=(()=>{class t extends Lq{constructor(t,e,i,n,r,s){super(),this.interactionsService=t,this.mapConfigService=e,this.mapService=i,this.mapStateService=n,this.tooltipsService=r,this.trailsLayerService=s,this.pointerMoveSubscription=new u,this.show=!1}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.positionsSource=new A9({features:[]}),this.positionsLayer=new Iet({source:this.positionsSource,style:{symbol:{symbolType:\"circle\",size:9,color:[\"color\",[\"get\",\"red\"],[\"get\",\"green\"],[\"get\",\"blue\"]],offset:[0,0]}}}),this.positionsLayer.selectable=!0,this.map.addLayer(this.positionsLayer),this.trailSource=new A9({features:[],wrapX:!1}),this.trailsLayer=new d9({source:this.trailSource,updateWhileAnimating:!0,updateWhileInteracting:!0}),this.map.addLayer(this.trailsLayer),this.subscriptions.push(this.mapStateService.featuresSelectable$.subscribe(t=>{this.positionsLayer.selectable=t})),this.subscriptions.push(this.mapStateService.showTrailsLayer$.subscribe(t=>{this.show=t,this.updatePositionsLayerVisibility(),this.trailsLayer.setVisible(this.show),this.show?this.pointerMoveSubscription=this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)}):this.pointerMoveSubscription.unsubscribe()})),this.subscriptions.push(this.trailsLayerService.trails$.pipe(Cf((t,e)=>function(t,e){return t.length===e.length&&t.every((t,i)=>t===e[i])}(t,e))).subscribe(t=>{const e=[],i=[];t.filter(t=>{var e;return!!(null===(e=t[0])||void 0===e?void 0:e.ship)}).forEach((t,n)=>{e.push(...t.map(t=>new Get(t,n%_tt.length))),i.push(...function(t,e){if(t.length<2)return[];const i=[];for(let n=1;n<t.length;n++){const r=t[n-1],s=t[n];i.push(new Yet([r.lon,r.lat],[s.lon,s.lat],(t[n-1].gap?Wet:qet)[e%_tt.length]))}return i}(t,n))}),t.filter(t=>{var e;return!!(null===(e=t[0])||void 0===e?void 0:e.aircraft)}).forEach((t,n)=>{e.push(...t.map(t=>new Het(t))),i.push(...function(t,e){if(t.length<2)return[];const i=[];for(let n=1;n<t.length;n++){const e=t[n-1],r=t[n];i.push(new Uet([e.lon,e.lat],[r.lon,r.lat],e.altitude,r.altitude))}return i}(t))}),this.trailSource.clear(!0),this.positionsSource.clear(!0),this.trailSource.addFeatures(i),this.positionsSource.addFeatures(e)})),this.subscriptions.push(this.mapService.view$.subscribe(()=>{this.updatePositionsLayerVisibility()})),this.eventListeners.push(this.map.on(\"click\",t=>this.handleClickEvent(t)))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.positionsLayer),this.map.removeLayer(this.trailsLayer),this.pointerMoveSubscription.unsubscribe()}handleClickEvent(t){this.positionsLayer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(t.position.ship?this.interactionsService.clickOnEntity(pH.ShipPosition,t.position):t.position.aircraft&&this.interactionsService.clickOnEntity(pH.AircraftPosition,t.position),!0),{hitTolerance:3,layerFilter:t=>t===this.positionsLayer})}handleMoveEvent(t){if(this.positionsLayer.selectable){let e=!1,i=!1;this.map.forEachFeatureAtPixel(t.pixel,t=>(t.position.ship?(e=!0,this.tooltipsService.hoverEntity(pH.ShipPosition,t.position)):t.position.aircraft&&(i=!0,this.tooltipsService.hoverEntity(pH.AircraftPosition,t.position)),!0),{hitTolerance:3,layerFilter:t=>t===this.positionsLayer}),e||this.tooltipsService.hoverEntity(pH.ShipPosition,null),i||this.tooltipsService.hoverEntity(pH.AircraftPosition,null)}}updatePositionsLayerVisibility(){const t=this.mapService.view$.value;this.positionsLayer.setVisible(this.show&&t&&(!this.mapConfigService.hidePositionsInLowZooms$.value||t.zoom>=8))}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Cq),Ta(k$),Ta(T$),Ta(KG),Ta(Sq),Ta(Zet))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-trails-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();class Ket{constructor(t){if(this.hexCode={0:\"0000\",1:\"0001\",2:\"0010\",3:\"0011\",4:\"0100\",5:\"0101\",6:\"0110\",7:\"0111\",8:\"1000\",9:\"1001\",a:\"1010\",b:\"1011\",c:\"1100\",d:\"1101\",e:\"1110\",f:\"1111\"},this.bits=\"\",null!=t){15===t.length&&(this.bits+=\"0000\");for(let e=0;e<t.length;e++)this.bits+=this.hexCode[t[e]]}}getLiteral(){const t=this.getLiteralArr();let e=`${t[0]}`;for(let i=1;i<t.length;i++)(i-1)%3==0&&(e+=\"-\"),e+=`${t[i]}`;return e}getLiteralEdge(t){const e=this.getLiteralArr(),i=t.getLiteralArr();let n=`${e[0]}`;for(let r=1;r<e.length-1;r++)(r-1)%3==0&&(n+=\"-\"),n+=`${e[r]}`;return n+=` / ${e[e.length-1]}-${i[i.length-1]}`,n}getLiteralArr(){const t=[];t.push(this.getFaceNb());for(let e=1;e<=15;e++){const i=this.getCellNb(e);7!==i&&t.push(i)}return t}getFaceNb(){let t=\"\";for(let e=12;e<19;e++)t=this.bits[e]+t;return t=this.reverse(t),parseInt(t,2)}getCellNb(t){let e=\"\";const i=16+3*t;for(let n=i;n<i+3;n++)e=this.bits[n]+e;return e=this.reverse(e),parseInt(e,2)}reverse(t){return t.split(\"\").reverse().join(\"\")}}function Qet(t){const e=t.getGeometry(),i=new o7({color:utt[t.element.edge?t.element.res:t.element.res+1],lineCap:\"square\",width:4}),n=[new d7({stroke:i})];return t.element.edge&&e.forEachSegment((e,r)=>{const s=Math.atan2(r[1]-e[1],r[0]-e[0]),o=5+10*Math.pow(12-t.element.res,2),a=new S2([r,[r[0]-o,r[1]+o]]);a.rotate(s,r);const l=new S2([r,[r[0]-o,r[1]-o]]);l.rotate(s,r),n.push(new d7({geometry:a,stroke:i})),n.push(new d7({geometry:l,stroke:i}))}),n}class Jet extends E1{constructor(t,e){super({geometry:2===e.length?new S2(e):new U2(e)}),this.element=t,super.setStyle(Qet)}static New(t){return new Jet(t,Jet.PointsArr(t))}static PointsArr(t){let e=[];if(tH(t.h3index)){const i=QU(t.h3index),n=JU(t.h3index),r=YU(i),s=YU(n);t.edge=!0,t.lat=s[0],t.lon=s[1];const o=new Ket(i),a=new Ket(n);t.literal=o.getLiteralEdge(a),e.push(Qz([r[1],r[0]])),e.push(Qz([s[1],s[0]])),t.shift&&Jet.shift(e,15-t.res)}else{const i=YU(t.h3index);t.edge=!1,t.lat=i[0],t.lon=i[1];const n=new Ket(t.h3index);t.literal=n.getLiteral(),e=[ZU(t.h3index,!0).map(t=>Qz(t))]}return e}static shift(t,e){const i=t[0],n=t[1],r=Math.atan2(n[1]-i[1],n[0]-i[0]),s=4*e,o=[Math.sin(r)*s+i[0],-Math.cos(r)*s+i[1]],a=[Math.sin(r)*s+n[0],-Math.cos(r)*s+n[1]];t[0]=o,t[1]=a}}class tit{static reversedEdge(t){const e=eH(t);return function(t,e){var i=LU(t),n=i[0],r=i[1],s=LU(e);return jU(TU.getH3UnidirectionalEdge(n,r,s[0],s[1]))}(e[1],e[0])}}let eit=(()=>{class t extends Lq{constructor(t,e,i,n,r,s){super(),this.h3TracesLayerService=t,this.interactionsService=e,this.tooltipsService=i,this.mapConfigService=n,this.mapService=r,this.mapStateService=s}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.h3ElementsSource=new A9({features:[]}),this.h3ElementsLayer=new d9({source:this.h3ElementsSource,updateWhileAnimating:!0,updateWhileInteracting:!0}),this.h3ElementsLayer.selectable=!0,this.map.addLayer(this.h3ElementsLayer),this.subscriptions.push(this.mapStateService.featuresSelectable$.subscribe(t=>{this.h3ElementsLayer.selectable=t})),this.subscriptions.push(this.mapService.view$.subscribe(t=>{t&&this.h3ElementsLayer.setVisible(!this.mapConfigService.hidePositionsInLowZooms$.value||t.zoom>=8)})),this.subscriptions.push(this.h3TracesLayerService.trails$.subscribe(t=>{this.h3ElementsSource.clear(!0),this.mapConfigService.debugH3Trace$.value&&this.h3ElementsSource.addFeatures(t.map(iit).flat())})),this.eventListeners.push(this.map.on(\"click\",t=>{this.handleClickEvent(t)})),this.subscriptions.push(this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.h3ElementsLayer)}handleClickEvent(t){this.h3ElementsLayer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.interactionsService.clickOnEntity(pH.H3Element,t.element),!0),{hitTolerance:3,layerFilter:t=>t===this.h3ElementsLayer})}handleMoveEvent(t){this.h3ElementsLayer.selectable&&(this.map.forEachFeatureAtPixel(t.pixel,t=>(this.tooltipsService.hoverEntity(pH.H3Element,t.element),!0),{hitTolerance:3,layerFilter:t=>t===this.h3ElementsLayer})||this.tooltipsService.hoverEntity(pH.H3Element,null))}}return t.\\u0275fac=function(e){return new(e||t)(Ta(IH),Ta(Cq),Ta(Sq),Ta(k$),Ta(T$),Ta(KG))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-h3traces-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();function iit(t){const e=t.elements,i=[],n={};for(let r=1;r<e.length;r++){const t=e[r];tH(t.h3index)&&(n[t.h3index]=1,n[tit.reversedEdge(t.h3index)]&&(t.shift=!0)),i.push(Jet.New(t))}return i}class nit extends Ktt{constructor(t,e){super(t,e)}prepareFrame(t){const e=this.getLayer(),i=e.getSource(),n=t.viewState,r=!t.viewHints[0]&&!t.viewHints[1],s=!zN(this.previousExtent_,t.extent),o=this.sourceRevision_<i.getRevision();return o&&(this.sourceRevision_=i.getRevision()),(r&&s||o)&&(clearTimeout(this.pendingBufferRefresh),this.pendingBufferRefresh=setTimeout(()=>{const r=n.projection,s=n.resolution,o=e instanceof f7?e.getRenderBuffer():0,a=MN(t.extent,o*s);i.loadFeatures(a,s,r),this.rebuildBuffers_(t),this.previousExtent_=t.extent.slice()},300)),this.helper.makeProjectionTransform(t,this.currentTransform_),I1(this.currentTransform_,this.invertRenderTransform_),this.helper.useProgram(this.program_),this.helper.prepareDraw(t),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}}var rit=(()=>(function(t){t[t.Ship=0]=\"Ship\",t[t.Point=1]=\"Point\"}(rit||(rit={})),rit))();const sit={aircraft:\"/assets/images/aircraft.png\",ship:\"/assets/images/ship.png\",point:\"/assets/images/point.png\"},oit={};let ait=(()=>{class t{init(){return Vp(this,void 0,void 0,function*(){yield Promise.all(Object.entries(sit).map(([t,e])=>Vp(this,void 0,void 0,function*(){oit[t]=yield function(t){return Vp(this,void 0,void 0,function*(){return new Promise(e=>{const i=new Image;i.src=t,i.onload=()=>{e(i)}})})}(e)})))})}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();class lit extends d9{constructor(t){super(t)}createRenderer(){const t=new nit(this,{attributes:[{name:\"angle\",callback:t=>t.ship.course},{name:\"red\",callback:t=>t.iconColor[0]},{name:\"green\",callback:t=>t.iconColor[1]},{name:\"blue\",callback:t=>t.iconColor[2]},{name:\"alpha\",callback:t=>t.ship.visible?t.ship.transparent?.5:1:0},{name:\"iconKey\",callback:t=>t.iconKey}],uniforms:{u_texture_point:oit.point,u_texture_ship:oit.ship,u_iconSize:12},vertexShader:\"\\nprecision mediump float;\\n\\nuniform mat4 u_projectionMatrix;\\nuniform mat4 u_offsetScaleMatrix;\\nuniform mat4 u_offsetRotateMatrix;\\nuniform float u_iconSize;\\n\\nattribute vec2 a_position;\\nattribute float a_index;\\nattribute float a_angle;\\nattribute float a_red;\\nattribute float a_green;\\nattribute float a_blue;\\nattribute float a_alpha;\\nattribute float a_iconKey;\\n\\nvarying vec2 v_texCoord;\\nvarying vec4 v_color;\\nvarying float v_iconKey;\\nvarying float v_alpha;\\n\\nvoid main(void) {\\n  vec2 size = vec2(u_iconSize);\\n  mat4 offsetMatrix = u_offsetScaleMatrix;\\n  vec2 offset = vec2(0.0);\\n  float offsetX = a_index == 0.0 || a_index == 3.0 ? offset.x - size.x / 2.0 : offset.x + size.x / 2.0;\\n  float offsetY = a_index == 0.0 || a_index == 1.0 ? offset.y - size.y / 2.0 : offset.y + size.y / 2.0;\\n  vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\\n\\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\\n\\n  vec4 texCoord = vec4(0.0, 0.0, 1.0, 1.0);\\n  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.q;\\n  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.p;\\n  v_texCoord = vec2(u, v);\\n\\n  if (a_iconKey == 0.0) {\\n    vec2 rotationVector = vec2(sin(a_angle), cos(a_angle));\\n    vec2 centeredTexCoord = v_texCoord - 0.5;\\n    vec2 rotatedPosition = vec2(\\n      centeredTexCoord.x * rotationVector.y + centeredTexCoord.y * rotationVector.x,\\n      centeredTexCoord.y * rotationVector.y - centeredTexCoord.x * rotationVector.x\\n    ) + 0.5;\\n    v_texCoord = rotatedPosition;\\n  }\\n\\n  v_color = vec4(a_red, a_green, a_blue, a_alpha);\\n  v_iconKey = a_iconKey;\\n  v_alpha = a_alpha;\\n}\\n\",fragmentShader:\"\\nprecision mediump float;\\n\\nuniform sampler2D u_texture_ship;\\nuniform sampler2D u_texture_point;\\n\\nvarying vec2 v_texCoord;\\nvarying vec4 v_color;\\nvarying float v_iconKey;\\nvarying float v_alpha;\\n\\nvoid main(void) {\\n  if (v_alpha == 0.0) {\\n    discard;\\n  }\\n  vec4 textureColor;\\n  if (v_iconKey == 0.0) {\\n    textureColor = texture2D(u_texture_ship, v_texCoord);\\n  } else if (v_iconKey == 1.0) {\\n    textureColor = texture2D(u_texture_point, v_texCoord);\\n  } else {\\n    // error\\n  }\\n  gl_FragColor = v_color * textureColor;\\n  gl_FragColor.rgb *= gl_FragColor.a;\\n}\\n\",hitVertexShader:\"\\nprecision mediump float;\\n\\nuniform mat4 u_projectionMatrix;\\nuniform mat4 u_offsetScaleMatrix;\\nuniform mat4 u_offsetRotateMatrix;\\nuniform float u_iconSize;\\n\\nattribute vec2 a_position;\\nattribute float a_index;\\nattribute vec4 a_hitColor;\\nattribute float a_angle;\\nattribute float a_iconKey;\\nattribute float a_alpha;\\n\\nvarying vec2 v_texCoord;\\nvarying vec4 v_hitColor;\\nvarying float v_iconKey;\\nvarying float v_alpha;\\n\\nvoid main(void) {\\n  float size = u_iconSize;\\n  mat4 offsetMatrix = u_offsetScaleMatrix;\\n  float offsetX = a_index == 0.0 || a_index == 3.0 ? -size / 2.0 : size / 2.0;\\n  float offsetY = a_index == 0.0 || a_index == 1.0 ? -size / 2.0 : size / 2.0;\\n  vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\\n\\n  vec4 texCoord = vec4(0.0, 0.0, 1.0, 1.0);\\n  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.q;\\n  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.p;\\n  v_texCoord = vec2(u, v);\\n\\n  if (a_iconKey == 0.0) {\\n    vec2 rotationVector = vec2(sin(a_angle), cos(a_angle));\\n    vec2 centeredTexCoord = vec2(u, v) - 0.5;\\n    vec2 rotatedPosition = vec2(\\n      centeredTexCoord.x * rotationVector.y + centeredTexCoord.y * rotationVector.x,\\n      centeredTexCoord.y * rotationVector.y - centeredTexCoord.x * rotationVector.x\\n    ) + 0.5;\\n    v_texCoord = rotatedPosition;\\n  }\\n\\n  v_hitColor = a_hitColor;\\n  v_iconKey = a_iconKey;\\n  v_alpha = a_alpha;\\n}\\n\",hitFragmentShader:\"\\nprecision mediump float;\\n\\nuniform sampler2D u_texture_ship;\\nuniform sampler2D u_texture_point;\\n\\nvarying vec2 v_texCoord;\\nvarying vec4 v_hitColor;\\nvarying float v_iconKey;\\nvarying float v_alpha;\\n\\nvoid main(void) {\\n  if (v_alpha == 0.0) {\\n    discard;\\n  }\\n  vec4 textureColor;\\n  if (v_iconKey == 0.0) {\\n    textureColor = texture2D(u_texture_ship, v_texCoord);\\n  } else if (v_iconKey == 1.0) {\\n    textureColor = texture2D(u_texture_point, v_texCoord);\\n  } else {\\n    // error\\n  }\\n  if (textureColor.a < 0.1) {\\n    discard;\\n  }\\n\\n  gl_FragColor = v_hitColor;\\n}\\n\"});return t.renderDeclutter=function(){},t}disposeInternal(){this.renderer_.dispose(),super.disposeInternal()}}const cit=sH(\"#000000\"),hit=sH(\"#f31717\"),uit=sH(\"#fddb21\"),dit=sH(\"#3fd830\");class pit extends E1{constructor(t,e){super({geometry:new M2(Qz(e>0?fit(t,e):[t.lon,t.lat]))}),this.ship=t}updateStyle(t){this.ship.visible?(this.iconColor=t.colorModeShipType?this.ship.shipType.rgbColor:this.ship.colorResultTimestamp>=t.absoluteImportantTimestamp?hit:this.ship.colorResultTimestamp>=t.absoluteMinimumTimestamp?uit:dit,this.iconKey=this.ship.stationary?rit.Point:rit.Ship):this.iconColor=cit}updateShip(t,e){e>0?this.extrapolatePosition(e):this.ship.lon!==t.lon&&this.ship.lat!==t.lat&&super.getGeometry().setCoordinates(Qz([t.lon,t.lat])),this.ship=t}extrapolatePosition(t){t>0&&super.getGeometry().setCoordinates(Qz(fit(this.ship,t)))}}function fit(t,e){const{lon:i,lat:n,course:r,numberSog:s,timestamp:o}=t,a=e-o;return a>0?function([t,e],i,n){const r=6378137;let s=e*Math.PI/180,o=t*Math.PI/180;return s=Math.asin(Math.sin(s)*Math.cos(i/r)+Math.cos(s)*Math.sin(i/r)*Math.cos(n)),o+=Math.atan2(Math.sin(n)*Math.sin(i/r)*Math.cos(s),Math.cos(i/r)-Math.sin(s)*Math.sin(s)),[180*o/Math.PI,180*s/Math.PI]}([i,n],a*s/1.944,r):[i,n]}let mit=(()=>{class t{constructor(t,e,i){this.fleetsService=t,this.mapConfigService=e,this.selectionService=i,this.selectedShips$=new Zp([]),LT([this.fleetsService.selectedFleet$.pipe(E(t=>t?t.ships:[])),this.selectionService.entities$.pipe(E(t=>t.filter(t=>!!t.entity&&t.type===pH.Ship).map(t=>t.entity)))]).subscribe(([t,e])=>{const i=function(t){const e={};for(const i of t)e[i.mmsi]=i;return Object.values(e)}([].concat(...t,...e));this.mapConfigService.updateSelectedShipsFilter(i.map(t=>t.mmsi)),this.selectedShips$.next(i)})}}return t.\\u0275fac=function(e){return new(e||t)(En(Tq),En(k$),En(bq))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),git=(()=>{class t extends Lq{constructor(t,e,i,n,r,s,o,a,l,c,h,u,d){super(),this.ngZone=t,this.configService=e,this.exportService=i,this.historyService=n,this.interactionsService=r,this.mapConfigService=s,this.mapService=o,this.mapStateService=a,this.offlineService=l,this.selectedShipsService=c,this.shipsService=h,this.workerService=u,this.tooltipsService=d,this.shipFeaturesByArea=new Map,this.timestampByArea=new Map,this.oldTimestamp=-1,this.viewedAreas=[],this.chunkedFeedUpdateByArea=new Map,this.selectedShipsFeaturesByMMSI=new Map}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new A9({features:[]}),this.layer=new lit({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0}),this.layer.selectable=!0,this.map.addLayer(this.layer),this.layer.getRenderer().helper.getCanvas().addEventListener(\"webglcontextlost\",t=>{throw new Error(\"Le contexte WebGL a \\xe9t\\xe9 perdu (les navires et avions ne sont plus affichables). Veuillez rafraichir l'onglet ou fermer puis r\\xe9ouvrir votre navigateur.\")},{once:!0});const t=this.layer.getRenderer().helper.uniforms_.find(t=>\"u_iconSize\"===t.name);this.subscriptions.push(this.mapService.view$.subscribe(e=>{if(!e)return;const i=Math.min(Math.round((e.zoom-4)/12*16+12),28);i!==t.value&&(t.value=i,this.layer.changed()),this.viewedAreas=DB(l$.fromOLExtent(this.mapService.view$.value.extent).toLatLonExtent()).map(t=>t.id)}),this.mapStateService.showShipsLayer$.subscribe(t=>{t||(this.shipFeaturesByArea.clear(),this.timestampByArea.clear(),this.source.clear(!0)),setTimeout(()=>{this.layer.setVisible(t)})}),this.mapStateService.showShipsLayer$.pipe(wf(1),pf(t=>t)).subscribe(()=>{this.source.addFeatures([...this.selectedShipsFeaturesByMMSI.values()])}),this.offlineService.isOffline$.pipe(ag(),pf(([t,e])=>t!==e)).subscribe(()=>{this.shipFeaturesByArea.clear(),this.timestampByArea.clear(),this.source.clear(!0)}),this.mapConfigService.manualMapFetch$.subscribe(()=>{this.shipFeaturesByArea.clear(),this.timestampByArea.clear(),this.source.clear(!0)}),this.mapStateService.featuresSelectable$.subscribe(t=>{this.layer.selectable=t}),this.mapConfigService.shipFilter$.subscribe(t=>{this.configService.devMode&&console.time(`ships-layer: update ${this.shipsService.shipsCount$.value} ship states`),this.source.forEachFeature(e=>{HG(e.ship,t),e.updateStyle(t)}),this.configService.devMode&&console.timeEnd(`ships-layer: update ${this.shipsService.shipsCount$.value} ship states`),this.shipFilter=t,this.source.changed()}),this.mapConfigService.enableHistoryModeExtrapolation$.subscribe(t=>{if(t&&this.historyService.timestamp$.value>0){const t=this.historyService.timestamp$.value;this.source.forEachFeature(e=>{e.ship.stationary||e.extrapolatePosition(t)})}else this.source.forEachFeature(t=>{const{lon:e,lat:i}=t.ship;t.setGeometry(new M2(Qz([e,i])))});this.source.changed()}),this.historyService.timestamp$.subscribe(t=>{(0===t&&this.oldTimestamp>0||t>0&&0===this.oldTimestamp)&&(this.shipFeaturesByArea.clear(),this.timestampByArea.clear(),this.source.clear(!0),0===t&&this.oldTimestamp>0&&this.source.addFeatures([...this.selectedShipsFeaturesByMMSI.values()])),this.oldTimestamp=t}),this.mapConfigService.restrictedAreaLonLat$.subscribe(()=>{this.shipFeaturesByArea.clear(),this.timestampByArea.clear(),this.source.clear(!0)}),this.workerService.areaShipsFeeds$.subscribe(t=>{if(!t.chunked||t.start){const e=(this.shipFeaturesByArea.get(t.area.id)||[]).reduce((t,e)=>(t[e.ship.mmsi]=e,t),{});this.chunkedFeedUpdateByArea.set(t.area.id,{featuresByMMSI:e,additions:[],updates:[]})}const e=this.chunkedFeedUpdateByArea.get(t.area.id);let i=t.data;const n=!this.mapConfigService.manualMapFetch$.value&&this.mapConfigService.restrictedAreaLonLat$.value;if(n){const[t,e,r,s]=n;i=i.filter(i=>t<=i.lon&&i.lon<=r&&e<=i.lat&&i.lat<=s)}const r=this.mapConfigService.enableHistoryModeExtrapolation$.value&&this.historyService.timestamp$.value>0?this.historyService.timestamp$.value:0,s=[];i.filter(t=>t.lon).forEach(t=>{HG(t,this.shipFilter);let i=e.featuresByMMSI[t.mmsi];i?(i.updateShip(t,r),e.updates.push(i)):(i=new pit(t,r),s.push(i)),i.updateStyle(this.shipFilter),delete e.featuresByMMSI[t.mmsi]}),this.source.addFeatures(s),e.additions=e.additions.concat(s),(!t.chunked||t.end)&&(Object.values(e.featuresByMMSI).forEach(t=>{this.source.hasFeature(t)&&this.source.removeFeature(t)}),this.shipFeaturesByArea.set(t.area.id,e.updates.concat(e.additions)),this.timestampByArea.set(t.area.id,Date.now()),this.chunkedFeedUpdateByArea.delete(t.area.id),this.refreshTotalShipsCount())}),this.selectedShipsService.selectedShips$.subscribe(t=>{const e=this.historyService.timestamp$.value;if(e>0)return;const i=[],n=[],r=new Map;t.forEach(t=>{HG(t,this.shipFilter);let s=this.selectedShipsFeaturesByMMSI.get(t.mmsi);s?(s.updateShip(t,e),n.push(s)):(s=new pit(t,e),i.push(s)),r.set(t.mmsi,s),s.updateStyle(this.shipFilter),this.selectedShipsFeaturesByMMSI.delete(t.mmsi)}),[...this.selectedShipsFeaturesByMMSI.values()].forEach(t=>{this.source.hasFeature(t)&&this.source.removeFeature(t)}),this.source.addFeatures(i),this.selectedShipsFeaturesByMMSI=r})),this.eventListeners.push(this.map.on(\"click\",t=>{this.ngZone.run(()=>{this.handleClickEvent(t)})})),this.subscriptions.push(LT([this.mapService.view$.pipe(wf(1),_M(500,af,{leading:!1,trailing:!0})),this.mapConfigService.shipFilter$,this.workerService.areaShipsFeeds$.pipe(cf(300,qm))]).subscribe(([t])=>{const e=this.source.getFeaturesInExtent(t.extent).filter(t=>t.ship.visible).map(t=>t.ship);if(e.length<200){const t=e.sort((t,e)=>t.mmsi<e.mmsi?-1:1);this.shipsService.shipsInView$.next(t)}else this.shipsService.shipsInView$.next([]);this.shipsService.shipsInViewCount$.next(e.length)}),this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)}),mq(6e4).pipe(pf(()=>!this.mapConfigService.manualMapFetch$.value&&!this.historyService.timestamp$.value&&!this.offlineService.isOffline$.value)).subscribe(()=>{const t=Date.now();for(const[e,i]of this.timestampByArea.entries())this.viewedAreas.includes(e)||i<t-18e4&&((this.shipFeaturesByArea.get(e)||[]).forEach(t=>{this.source.hasFeature(t)&&this.source.removeFeature(t)}),this.shipFeaturesByArea.delete(e),this.timestampByArea.delete(e))})),this.exportService.registerVisibleShipsCallback(t=>this.source.getFeaturesInExtent(null!=t?t:this.map.getView().calculateExtent()).map(t=>t.ship).filter(t=>t.visible))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}handleClickEvent(t){this.layer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.configService.devMode&&console.log(\"DEBUG: select ship\",t.ship),this.interactionsService.clickOnEntity(pH.Ship,t.ship),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})}handleMoveEvent(t){this.layer.selectable&&(this.map.forEachFeatureAtPixel(t.pixel,t=>(this.tooltipsService.hoverEntity(pH.Ship,t.ship),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})||this.tooltipsService.hoverEntity(pH.Ship,null))}refreshTotalShipsCount(){let t=0;for(const e of this.shipFeaturesByArea.values())t+=e.length;this.shipsService.shipsCount$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(tu),Ta(C$),Ta(uq),Ta(R$),Ta(Cq),Ta(k$),Ta(T$),Ta(KG),Ta(fq),Ta(mit),Ta(yq),Ta(iU),Ta(Sq))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-ships-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();class Ait extends E1{constructor(t){super({geometry:new M2(Qz([t.lon,t.lat])),rotation:t.radiansTrack}),this.aircraft=t}updateAircraft(t){this.aircraft.lon!==t.lon&&this.aircraft.lat!==t.lat&&(super.getGeometry().setCoordinates(Qz([t.lon,t.lat])),super.set(\"rotation\",t.radiansTrack)),this.aircraft=t}}let vit=(()=>{class t{constructor(){this.aircraftsInView$=new Zp([])}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),_it=(()=>{class t extends Lq{constructor(t,e,i,n,r,s,o,a,l,c,h,u){super(),this.changeDetectorRef=t,this.ngZone=e,this.aircraftsService=i,this.configService=n,this.exportService=r,this.historyService=s,this.interactionsService=o,this.mapService=a,this.mapConfigService=l,this.mapStateService=c,this.tooltipsService=h,this.workerService=u,this.aircraftsFeaturesByArea=new Map,this.oldTimestamp=-1}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.changeDetectorRef.detach(),this.source=new A9({features:[]}),this.layer=new Iet({source:this.source,style:{symbol:{symbolType:\"image\",src:\"assets/images/aircraft.png\",size:[\"interpolate\",[\"linear\"],[\"zoom\"],4,12,10,30],rotation:[\"get\",\"rotation\"],offset:[0,0]}}}),this.layer.selectable=!0,this.map.addLayer(this.layer),this.subscriptions.push(this.mapStateService.showAircraftsLayer$.subscribe(t=>{t||(this.aircraftsFeaturesByArea.clear(),this.source.clear(!0)),setTimeout(()=>{this.layer.setVisible(t)})}),this.mapConfigService.manualMapFetch$.subscribe(()=>{this.aircraftsFeaturesByArea.clear(),this.source.clear(!0)}),this.mapStateService.featuresSelectable$.subscribe(t=>{this.layer.selectable=t}),this.historyService.timestamp$.subscribe(t=>{(0===t&&this.oldTimestamp>0||t>0&&0===this.oldTimestamp)&&(this.aircraftsFeaturesByArea.clear(),this.source.clear(!0)),this.oldTimestamp=t}),this.mapConfigService.restrictedAreaLonLat$.subscribe(()=>{this.aircraftsFeaturesByArea.clear(),this.source.clear(!0)}),this.workerService.areaAircraftsFeeds$.subscribe(t=>{const e=(this.aircraftsFeaturesByArea.get(t.area.id)||[]).reduce((t,e)=>(t[e.aircraft.icao]=e,t),{}),i=[],n=[];let r=t.data;const s=!this.mapConfigService.manualMapFetch$.value&&this.mapConfigService.restrictedAreaLonLat$.value;if(s){const[t,e,i,n]=s;r=r.filter(r=>t<=r.lon&&r.lon<=i&&e<=r.lat&&r.lat<=n)}r.forEach(t=>{let r=e[t.icao];r?(r.updateAircraft(t),n.push(r)):(r=new Ait(t),i.push(r)),delete e[t.icao]}),Object.values(e).forEach(t=>{this.source.hasFeature(t)&&this.source.removeFeature(t)}),this.source.addFeatures(i),this.aircraftsFeaturesByArea.set(t.area.id,n.concat(i)),this.source.changed()})),this.eventListeners.push(this.map.on(\"click\",t=>{this.ngZone.run(()=>{this.handleClickEvent(t)})})),this.subscriptions.push(LT([this.mapService.view$.pipe(wf(1),_M(500,af,{leading:!1,trailing:!0})),this.workerService.areaAircraftsFeeds$.pipe(cf(16))]).subscribe(([t])=>{const e=this.source.getFeaturesInExtent(t.extent).filter(t=>t.aircraft.visible).map(t=>t.aircraft);if(e.length<200){const t=e.sort((t,e)=>t.icao<e.icao?-1:1);this.aircraftsService.aircraftsInView$.next(t)}else this.aircraftsService.aircraftsInView$.next([])}),this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)})),this.exportService.registerVisibleAircraftsCallback(t=>this.source.getFeaturesInExtent(null!=t?t:this.map.getView().calculateExtent()).map(t=>t.aircraft).filter(t=>t.visible))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}handleClickEvent(t){this.layer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.configService.devMode&&console.log(\"DEBUG: select aircraft\",JSON.stringify(t.aircraft,null,2)),this.interactionsService.clickOnEntity(pH.Aircraft,t.aircraft),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})}handleMoveEvent(t){this.layer.selectable&&(this.map.forEachFeatureAtPixel(t.pixel,t=>(this.tooltipsService.hoverEntity(pH.Aircraft,t.aircraft),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})||this.tooltipsService.hoverEntity(pH.Aircraft,null))}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Cc),Ta(tu),Ta(vit),Ta(C$),Ta(uq),Ta(R$),Ta(Cq),Ta(T$),Ta(k$),Ta(KG),Ta(Sq),Ta(iU))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-aircrafts-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})();class yit extends E1{constructor(t){super({geometry:new M2(Qz([t.lon,t.lat]))}),this.alert=t,this.set(\"red\",t.rgbVecColor[0],!0),this.set(\"green\",t.rgbVecColor[1],!0),this.set(\"blue\",t.rgbVecColor[2],!0)}}let bit=(()=>{class t{constructor(t,e,i){this.alertsService=t,this.fleetsService=e,this.selectionService=i,this.alerts$=new Zp([]),LT([this.alertsService.alerts$,this.fleetsService.fleetAlerts$,this.selectionService.alerts$]).subscribe(([t,e,i])=>{this.alerts$.next([...t,...e,...i])})}}return t.\\u0275fac=function(e){return new(e||t)(En(uH),En(Tq),En(bq))},t.\\u0275prov=ft({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),wit=(()=>{class t extends Lq{constructor(t,e,i,n,r,s){super(),this.ngZone=t,this.alertsLayerService=e,this.interactionsService=i,this.mapService=n,this.mapStateService=r,this.tooltipsService=s}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new A9({features:[]}),this.layer=new Iet({source:this.source,style:{symbol:{symbolType:\"triangle\",size:18,color:[\"color\",[\"get\",\"red\"],[\"get\",\"green\"],[\"get\",\"blue\"]],offset:[0,0]}}}),this.layer.selectable=!0,this.map.addLayer(this.layer),this.subscriptions.push(this.mapStateService.featuresSelectable$.subscribe(t=>{this.layer.selectable=t})),this.subscriptions.push(this.alertsLayerService.alerts$.subscribe(t=>{const e=t.map(t=>new yit(t));this.source.clear(!0),this.source.addFeatures(e)}),this.mapStateService.showAlertsLayer$.subscribe(t=>{this.layer.setVisible(t)})),this.eventListeners.push(this.map.on(\"click\",t=>{this.ngZone.run(()=>{this.handleClickEvent(t)})})),this.subscriptions.push(this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}handleClickEvent(t){this.layer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.interactionsService.clickOnEntity(pH.Alert,t.alert),!0),{layerFilter:t=>t===this.layer})}handleMoveEvent(t){this.layer.selectable&&(this.map.forEachFeatureAtPixel(t.pixel,t=>(this.tooltipsService.hoverEntity(pH.Alert,t.alert),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})||this.tooltipsService.hoverEntity(pH.Alert,null))}}return t.\\u0275fac=function(e){return new(e||t)(Ta(tu),Ta(bit),Ta(Cq),Ta(T$),Ta(KG),Ta(Sq))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-alerts-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();const xit=AH.reduce((t,e)=>(t[e.key]=oH(e.color),t),{}),Sit=oH(\"grey\");class Cit extends E1{constructor(t){super({geometry:new M2(Qz([t.lon,t.lat]))}),this.event=t;const e=xit[t.type]||Sit;this.set(\"red\",e[0],!0),this.set(\"green\",e[1],!0),this.set(\"blue\",e[2],!0)}static New(t){return new Cit(t)}}let kit=(()=>{class t extends Lq{constructor(t,e,i,n,r,s){super(),this.ngZone=t,this.eventsLayerService=e,this.interactionsService=i,this.mapService=n,this.mapStateService=r,this.tooltipsService=s}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new A9({features:[]}),this.layer=new Iet({source:this.source,style:{symbol:{symbolType:\"circle\",size:9,color:[\"color\",[\"get\",\"red\"],[\"get\",\"green\"],[\"get\",\"blue\"]],offset:[0,0]}}}),this.layer.selectable=!0,this.map.addLayer(this.layer),this.subscriptions.push(this.mapStateService.featuresSelectable$.subscribe(t=>{this.layer.selectable=t})),this.subscriptions.push(this.eventsLayerService.events$.subscribe(t=>{const e=t.map(Cit.New);this.source.clear(!0),this.source.addFeatures(e)}),this.mapStateService.showEventsLayer$.subscribe(t=>{this.layer.setVisible(t)})),this.eventListeners.push(this.map.on(\"click\",t=>{this.ngZone.run(()=>{this.handleClickEvent(t)})})),this.subscriptions.push(this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}handleClickEvent(t){this.layer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.interactionsService.clickOnEntity(pH.Event,t.event),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})}handleMoveEvent(t){this.layer.selectable&&(this.map.forEachFeatureAtPixel(t.pixel,t=>(this.tooltipsService.hoverEntity(pH.Event,t.event),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})||this.tooltipsService.hoverEntity(pH.Event,null))}}return t.\\u0275fac=function(e){return new(e||t)(Ta(tu),Ta(TH),Ta(Cq),Ta(T$),Ta(KG),Ta(Sq))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-events-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();const Eit=btt.map(t=>new d7({stroke:new o7({color:t,width:1}),fill:new s7({color:`${t}1a`})})),Mit=new d7({text:new B9({font:\"11px Calibri,sans-serif\",fill:new s7({color:\"#000\"}),stroke:new o7({color:\"#fff\",width:3})})});let Tit=(()=>{class t extends Lq{constructor(t,e,i){super(),this.mapService=t,this.mapStateService=e,this.portsService=i,this.portsZones=[]}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new A9({features:[]}),this.layer=new d9({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:1,visible:!1}),this.map.addLayer(this.layer),this.subscriptions.push(LT([this.mapStateService.showPortsLayer$,this.mapService.view$]).pipe(E(([t,e])=>t&&e&&e.zoom>=11),Cf()).subscribe(t=>{this.layer.setVisible(t)}),this.portsService.ports$.subscribe(t=>{this.portsZones=t.map(t=>({name:`${t.label} - ${t.iso3}\\n${t.sourcesLabels}`,h3indexes:t.h3indexes})),this.source.clear(!0),this.source.addFeatures(this.portsZones.map((t,e)=>{const i=new Mtt(t);return i.setStyle(function(){return Mit.getText().setText(t.name),[Eit[e%Eit.length],Mit]}),i}))}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(T$),Ta(KG),Ta(Oq))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-ports-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();var Iit=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Oit=function(t){function e(e){var i=t.call(this)||this;i.options=e,i.id=e.id,i.insertFirst=void 0===e.insertFirst||e.insertFirst,i.stopEvent=void 0===e.stopEvent||e.stopEvent,i.element=document.createElement(\"div\"),i.element.className=void 0!==e.className?e.className:\"ol-overlay-container ol-selectable\",i.element.style.position=\"absolute\",i.element.style.pointerEvents=\"auto\";var n=e.autoPan;return n&&\"object\"!=typeof n&&(n={animation:e.autoPanAnimation,margin:e.autoPanMargin}),i.autoPan=n||!1,i.rendered={transform_:\"\",visible:!0},i.mapPostrenderListenerKey=null,i.addChangeListener(\"element\",i.handleElementChanged),i.addChangeListener(\"map\",i.handleMapChanged),i.addChangeListener(\"offset\",i.handleOffsetChanged),i.addChangeListener(\"position\",i.handlePositionChanged),i.addChangeListener(\"positioning\",i.handlePositioningChanged),void 0!==e.element&&i.setElement(e.element),i.setOffset(void 0!==e.offset?e.offset:[0,0]),i.setPositioning(void 0!==e.positioning?e.positioning:\"top-left\"),void 0!==e.position&&i.setPosition(e.position),i}return Iit(e,t),e.prototype.getElement=function(){return this.get(\"element\")},e.prototype.getId=function(){return this.id},e.prototype.getMap=function(){return this.get(\"map\")},e.prototype.getOffset=function(){return this.get(\"offset\")},e.prototype.getPosition=function(){return this.get(\"position\")},e.prototype.getPositioning=function(){return this.get(\"positioning\")},e.prototype.handleElementChanged=function(){bN(this.element);var t=this.getElement();t&&this.element.appendChild(t)},e.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(yN(this.element),oz(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);var t=this.getMap();if(t){this.mapPostrenderListenerKey=rz(t,\"postrender\",this.render,this),this.updatePixelPosition();var e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}},e.prototype.render=function(){this.updatePixelPosition()},e.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},e.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.performAutoPan()},e.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},e.prototype.setElement=function(t){this.set(\"element\",t)},e.prototype.setMap=function(t){this.set(\"map\",t)},e.prototype.setOffset=function(t){this.set(\"offset\",t)},e.prototype.setPosition=function(t){this.set(\"position\",t)},e.prototype.performAutoPan=function(){this.autoPan&&this.panIntoView(this.autoPan)},e.prototype.panIntoView=function(t){var e=this.getMap();if(e&&e.getTargetElement()&&this.get(\"position\")){var i=this.getRect(e.getTargetElement(),e.getSize()),n=this.getElement(),r=this.getRect(n,[AN(n),vN(n)]),s=t||{},o=void 0===s.margin?20:s.margin;if(!PN(i,r)){var a=r[0]-i[0],l=i[2]-r[2],c=r[1]-i[1],h=i[3]-r[3],u=[0,0];if(a<0?u[0]=a-o:l<0&&(u[0]=Math.abs(l)+o),c<0?u[1]=c-o:h<0&&(u[1]=Math.abs(h)+o),0!==u[0]||0!==u[1]){var d=e.getView().getCenterInternal(),p=e.getPixelFromCoordinateInternal(d);if(!p)return;var f=[p[0]+u[0],p[1]+u[1]],m=s.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(f),duration:m.duration,easing:m.easing})}}}},e.prototype.getRect=function(t,e){var i=t.getBoundingClientRect(),n=i.left+window.pageXOffset,r=i.top+window.pageYOffset;return[n,r,n+e[0],r+e[1]]},e.prototype.setPositioning=function(t){this.set(\"positioning\",t)},e.prototype.setVisible=function(t){this.rendered.visible!==t&&(this.element.style.display=t?\"\":\"none\",this.rendered.visible=t)},e.prototype.updatePixelPosition=function(){var t=this.getMap(),e=this.getPosition();if(t&&t.isRendered()&&e){var i=t.getPixelFromCoordinate(e),n=t.getSize();this.updateRenderedPosition(i,n)}else this.setVisible(!1)},e.prototype.updateRenderedPosition=function(t,e){var i=this.element.style,n=this.getOffset(),r=this.getPositioning();this.setVisible(!0);var s=\"0%\",o=\"0%\";\"bottom-right\"==r||\"center-right\"==r||\"top-right\"==r?s=\"-100%\":(\"bottom-center\"==r||\"center-center\"==r||\"top-center\"==r)&&(s=\"-50%\"),\"bottom-left\"==r||\"bottom-center\"==r||\"bottom-right\"==r?o=\"-100%\":(\"center-left\"==r||\"center-center\"==r||\"center-right\"==r)&&(o=\"-50%\");var a=\"translate(\"+s+\", \"+o+\") translate(\"+(Math.round(t[0]+n[0])+\"px\")+\", \"+(Math.round(t[1]+n[1])+\"px\")+\")\";this.rendered.transform_!=a&&(this.rendered.transform_=a,i.transform=a,i.msTransform=a)},e.prototype.getOptions=function(){return this.options},e}(FV);class Pit extends E1{constructor(t){super({id:t.mmsi,geometry:new M2(Qz(t.position))}),this.positionIndex=0,this.ship=t,this.setStyle(new d7({image:new e9({src:\"/assets/images/ship.png\",rotation:t.course,opacity:t.visible?1:0,color:t.shipType.color})}))}}const Dit=[\"root\"],Rit=[\"*\"];function Fit(t,e){const i=t.getBoundingClientRect(),n=i.left+window.pageXOffset,r=i.top+window.pageYOffset;return[n,r,n+e[0],r+e[1]]}const Lit=[0,-20];let Bit=(()=>{class t{constructor(){this.positioning=\"bottom-center\",this.className=\"\",this.offset=Lit,this.stopEvent=!0,this.autoPositioning=!1,this.opacity=1}ngOnInit(){this.overlay=new Oit({element:this.rootElement.nativeElement,positioning:this.positioning,offset:this.offset,stopEvent:this.stopEvent,insertFirst:!1,className:`ol-overlay-container ol-selectable ${this.className} ${this.autoPositioning?\"overlay-hidden\":\"overlay-positioning-bottom-center\"}`,position:Qz([this.longitude,this.latitude])}),this.map.addOverlay(this.overlay),this.autoPositioning&&setTimeout(()=>{this.updatePositioning(),this.overlay.getElement().parentElement.classList.remove(\"overlay-hidden\")})}ngOnChanges(t){this.overlay&&(t.positioning&&this.overlay.setPositioning(this.positioning),t.offset&&this.overlay.setOffset(this.offset),(t.latitude||t.longitude)&&(this.overlay.setPosition(Qz([this.longitude,this.latitude])),this.autoPositioning&&this.updatePositioning()))}ngOnDestroy(){this.map.removeOverlay(this.overlay)}updatePositioning(){if(!this.map||!this.map.getTargetElement())return;const t=Fit(this.map.getTargetElement(),this.map.getSize()),e=this.overlay.getElement(),i=Fit(e,[AN(e),vN(e)]);if(e.parentElement.className=e.parentElement.className.replace(/ ?overlay-positioning-\\S+/g,\"\"),PN(t,i))this.overlay.setPositioning(\"bottom-center\"),this.overlay.setOffset(Lit),e.parentElement.classList.add(\"overlay-positioning-bottom-center\");else{const n=i[0]-t[0],r=t[2]-i[2],s=i[1]-t[1],o=t[3]-i[3],a=[0,0];n<0?a[0]=n-20:r<0&&(a[0]=Math.abs(r)+20),s<0?a[1]=s-20:o<0&&(a[1]=Math.abs(o)+20);let l=\"bottom\",c=\"center\",h=0,u=0;if(0!==a[0]){if(l=\"center\",0===a[1]){const e=i[3]-i[1];i[3]+e/2+20>=t[3]&&(a[1]=e/2)}a[0]>0?(c=\"right\",u=-20):(c=\"left\",u=20)}0!==a[1]&&(a[1]>0?(l=\"bottom\",h=-20):(l=\"top\",h=20));const d=`${l}-${c}`;this.overlay.setPositioning(d),this.overlay.setOffset([u,h]),e.parentElement.classList.add(`overlay-positioning-${d}`)}}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-map-tooltip\"]],viewQuery:function(t,e){if(1&t&&kh(Dit,7),2&t){let t;Ch(t=Mh())&&(e.rootElement=t.first)}},inputs:{map:\"map\",latitude:\"latitude\",longitude:\"longitude\",positioning:\"positioning\",className:\"className\",offset:\"offset\",stopEvent:\"stopEvent\",autoPositioning:\"autoPositioning\",opacity:\"opacity\"},features:[ce],ngContentSelectors:Rit,decls:3,vars:2,consts:[[\"root\",\"\"]],template:function(t,e){1&t&&(Za(),Pa(0,\"div\",null,0),Xa(2),Da()),2&t&&al(\"opacity\",e.opacity)},styles:[\".overlay-hidden{opacity:0}\\n\"],encapsulation:2,changeDetection:0}),t})();const Nit=function(t){return{transform:t}};let zit=(()=>{class t extends Lq{constructor(t,e){super(),this.mapConfigService=t,this.mapStateService=e,this.hdms=\"\"}ngOnInit(){this.ensureMandatoryInputParams(\"ship\",\"animationTimestamp\")}ngOnChanges(t){this.hdms=this.mapStateService.coordinateSystem$.value.format(this.ship.position)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(k$),Ta(KG))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-playback-ship-tooltip\"]],inputs:{ship:\"ship\",animationTimestamp:\"animationTimestamp\"},features:[Vo,ce],decls:48,vars:20,consts:[[1,\"ship-tooltip\"],[1,\"ship-tooltip__header\"],[1,\"ship-tooltip__flag\",3,\"flag\"],[1,\"ship-tooltip__title\"],[1,\"ship-tooltip__name\"],[1,\"ship-tooltip__type\"],[1,\"ship-tooltip__row\"],[1,\"ship-tooltip__info-cell\"],[1,\"ship-tooltip__info-label\"],[3,\"vertical\"],[1,\"d-flex-center\"],[1,\"ship-tooltip__course-icon\",3,\"ngStyle\"],[1,\"ship-tooltip__footer\"],[1,\"ship-tooltip__signal-label\"],[1,\"u-flex\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0),Pa(1,\"div\",1),Ra(2,\"app-flag\",2),Pa(3,\"div\",3),Pa(4,\"strong\",4),bl(5),Da(),Pa(6,\"small\",5),bl(7),Da(),Da(),Da(),Pa(8,\"div\",6),Pa(9,\"div\",7),Pa(10,\"div\",8),bl(11,\"MMSI\"),Da(),Pa(12,\"strong\"),bl(13),Da(),Da(),Ra(14,\"mat-divider\",9),Pa(15,\"div\",7),Pa(16,\"div\",8),bl(17,\"IMO\"),Da(),Pa(18,\"strong\"),bl(19),Da(),Da(),Ra(20,\"mat-divider\",9),Pa(21,\"div\",7),Pa(22,\"div\",8),bl(23,\"Callsign\"),Da(),Pa(24,\"strong\"),bl(25),Da(),Da(),Da(),Ra(26,\"mat-divider\"),Pa(27,\"div\",6),Pa(28,\"div\",7),Pa(29,\"div\",8),bl(30,\"Vitesse / Cap\"),Da(),Pa(31,\"strong\",10),bl(32),Pa(33,\"mat-icon\",11),bl(34,\"arrow_right_alt\"),Da(),Da(),Da(),Ra(35,\"mat-divider\",9),Pa(36,\"div\",7),Pa(37,\"div\",8),bl(38,\"Position\"),Da(),Pa(39,\"strong\"),bl(40),Da(),Da(),Da(),Pa(41,\"div\",12),Pa(42,\"span\",13),bl(43,\"R\\xe9ception (estim\\xe9e) :\\xa0\"),Da(),Pa(44,\"strong\",14),Pa(45,\"span\"),bl(46),oh(47,\"date\"),Da(),Da(),Da(),Da()),2&t&&(Ss(2),Ia(\"flag\",e.ship.country.flag),Ss(3),wl(e.ship.name||\"?\"),Ss(2),wl(e.ship.shipType.label),Ss(6),wl(e.ship.mmsi),Ss(1),Ia(\"vertical\",!0),Ss(5),wl(e.ship.imo||\"?\"),Ss(1),Ia(\"vertical\",!0),Ss(5),wl(e.ship.callsign||\"?\"),Ss(7),Sl(\" \",e.ship.speed,\" kt / \",(180*e.ship.course/3.14159).toFixed(0),\"\\xb0 \"),Ss(1),Ia(\"ngStyle\",Jc(18,Nit,\"rotate(\"+(e.ship.course-1.570795)+\"rad)\")),Ss(2),Ia(\"vertical\",!0),Ss(5),wl(e.hdms),Ss(6),wl(ch(47,14,1e3*e.animationTimestamp,\"yyyy-MM-dd HH:mm:ss z\",e.mapConfigService.useUTCDates$.value&&\"+00\")))},directives:[TZ,Hq,Yk,Hd],pipes:[Qd],styles:['.ship-tooltip[_ngcontent-%COMP%]{min-width:320px;background-color:#e7ecf0;box-shadow:0 1px 3px rgba(0,0,0,.102),0 1px 2px rgba(0,0,0,.2);border-radius:2px}.ship-tooltip[_ngcontent-%COMP%]:after{content:\" \";position:absolute;border-width:12px;border-style:solid;border-color:transparent;pointer-events:none}.ship-tooltip__header[_ngcontent-%COMP%]{background-color:#cdd1d4;display:flex}.ship-tooltip__move-icon[_ngcontent-%COMP%]{cursor:move}.ship-tooltip__link[_ngcontent-%COMP%]{flex:1;padding:0;line-height:inherit;text-align:inherit;font-size:inherit;font-weight:inherit}.ship-tooltip__link[_ngcontent-%COMP%]     .mat-button-wrapper{display:flex}.ship-tooltip__flag[_ngcontent-%COMP%]{margin:5px}.ship-tooltip__title[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:5px 0;flex:1}.ship-tooltip__name[_ngcontent-%COMP%]{font-size:1.2em}.ship-tooltip__type[_ngcontent-%COMP%]{font-size:.9em;color:#555}.ship-tooltip__row[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly;font-size:.9em}.ship-tooltip__info-cell[_ngcontent-%COMP%]{padding:.4em;text-align:center}.ship-tooltip__info-label[_ngcontent-%COMP%]{color:gray;font-weight:500;padding-bottom:.2em}.ship-tooltip__course-icon[_ngcontent-%COMP%]{line-height:.7em;height:.7em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.ship-tooltip__footer[_ngcontent-%COMP%]{background-color:#cdd1d4;padding-left:.4em;display:flex;align-items:center;font-size:.85em;line-height:36px}.ship-tooltip__signal-label[_ngcontent-%COMP%]{font-weight:500;color:#595959}  .overlay-positioning-center-right .ship-tooltip:after{top:50%;left:100%;margin-top:-12px;border-left-color:#cdd1d4}  .overlay-positioning-center-left .ship-tooltip:after{top:50%;right:100%;margin-top:-12px;border-right-color:#cdd1d4}  .overlay-positioning-bottom-center .ship-tooltip:after{top:100%;left:50%;margin-left:-12px;border-top-color:#cdd1d4}  .overlay-positioning-top-center .ship-tooltip:after{bottom:100%;left:50%;margin-left:-12px;border-bottom-color:#cdd1d4}'],changeDetection:0}),t})();function Vit(t,e){if(1&t&&(Pa(0,\"app-map-tooltip\",1),Ra(1,\"app-playback-ship-tooltip\",2),Da()),2&t){const t=Wa();Ia(\"map\",t.map)(\"latitude\",t.hoveredPosition[1])(\"longitude\",t.hoveredPosition[0])(\"stopEvent\",!1)(\"autoPositioning\",!0),Ss(1),Ia(\"ship\",t.hoveredShip)(\"animationTimestamp\",t.animationTimestamp)}}let jit=(()=>{class t extends Lq{constructor(t,e,i,n){super(),this.ngZone=t,this.elementRef=e,this.mapService=i,this.playbackService=n,this.hoveredShip=null,this.animationTimestamp=-1,this.hoveredPosition=null,this.featuresByMMSI={},this.layerRenderListener=null}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new A9({features:[],useSpatialIndex:!1}),this.layer=new d9({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0}),this.map.addLayer(this.layer),this.overlay=new Oit({element:this.elementRef.nativeElement,positioning:\"bottom-center\",offset:[0,-20],stopEvent:!0,insertFirst:!1,className:\"ol-overlay-container ol-selectable hover-tooltip mat-elevation-z16 overlay-positioning-bottom-center\"}),this.map.addOverlay(this.overlay),this.subscriptions.push(LT([this.playbackService.active$,this.playbackService.shipsByMMSI$.pipe(E(t=>!!t))]).pipe(cf(16),E(([t,e])=>t&&!e),Cf()).subscribe(t=>{t?(this.bboxFeature=new E1(new k2([])),this.updateBboxFeatureGeometry(),this.source.addFeature(this.bboxFeature),this.layerRenderListener=this.layer.on(\"prerender\",()=>{this.updateBboxFeatureGeometry()})):this.bboxFeature&&(this.source.removeFeature(this.bboxFeature),this.bboxFeature=null,OV(this.layerRenderListener))}),this.playbackService.shipsByMMSI$.subscribe(t=>Vp(this,void 0,void 0,function*(){if(!t)return this.featuresByMMSI={},this.source.clear(!0),this.bboxFeature=null,void OV(this.layerRenderListener);this.bboxFeature&&(this.source.removeFeature(this.bboxFeature),this.bboxFeature=null,OV(this.layerRenderListener));const e=Object.values(t).filter(t=>!this.featuresByMMSI[t.mmsi]).map(t=>this.featuresByMMSI[t.mmsi]=new Pit(t));this.source.addFeatures(e)})),this.playbackService.animationTimestamp$.subscribe(t=>{this.animationTimestamp=t,this.source.forEachFeature(t=>{t.getGeometry().setCoordinates(Qz(t.ship.position)),t.getStyle().getImage().setRotation(t.ship.course),t.getStyle().getImage().setOpacity(t.ship.visible?1:0)}),this.source.changed(),this.hoveredShip&&(this.hoveredPosition=this.hoveredShip.position)}),this.mapService.pointerMove$.subscribe(t=>{this.ngZone.run(()=>{this.handleMoveEvent(t)})}))}ngOnDestroy(){super.ngOnDestroy(),this.hoveredShip=null,this.map.removeOverlay(this.overlay),this.map.removeLayer(this.layer),OV(this.layerRenderListener)}handleMoveEvent(t){this.map.forEachFeatureAtPixel(t.pixel,t=>(this.hoveredShip=t.ship,this.hoveredPosition=Jz(t.getGeometry().getCoordinates()),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})||(this.hoveredShip=null)}updateBboxFeatureGeometry(){const t=this.getRestrictedBoundingBox(),e=stt(t.getPolygon()).map(t=>Qz(t));w$(this.bboxFeature.getGeometry().getCoordinates()[0]||[],e)||(this.bboxFeature.getGeometry().setCoordinates([e]),this.playbackService.updateViewBox(t.toLatLonExtent()))}getRestrictedBoundingBox(){const t=L8.fromOLView(this.map.getView()),e=Math.min(t.extent[2]-t.extent[0],Qz([20,0])[0])/2,i=t.center[0]-e,n=t.center[0]+e,r=Math.min(t.extent[3]-t.extent[1],function(t){const[,e]=Jz(t.center),[,i]=Qz([0,e+7.5]),[,n]=Qz([0,e-7.5]);return i-n}(t))/2;return l$.fromOLExtent([i,t.center[1]-r,n,t.center[1]+r]).scale(.8)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(tu),Ta(Jl),Ta(T$),Ta(YG))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-playback-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:1,vars:1,consts:[[\"className\",\"mat-elevation-z16\",3,\"map\",\"latitude\",\"longitude\",\"stopEvent\",\"autoPositioning\",4,\"ngIf\"],[\"className\",\"mat-elevation-z16\",3,\"map\",\"latitude\",\"longitude\",\"stopEvent\",\"autoPositioning\"],[3,\"ship\",\"animationTimestamp\"]],template:function(t,e){1&t&&na(0,Vit,2,7,\"app-map-tooltip\",0),2&t&&Ia(\"ngIf\",e.hoveredShip)},directives:[Bd,Bit,zit],encapsulation:2}),t})(),$it=(()=>{class t extends Lq{constructor(t){super(),this.offlineService=t,this.layerRenderListener=null}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new A9({features:[],useSpatialIndex:!1}),this.layer=new d9({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0}),this.map.addLayer(this.layer),this.subscriptions.push(this.offlineService.setupActive$.pipe(cf(16),E(t=>t),Cf()).subscribe(t=>{t?(this.bboxFeature=new E1(new k2([])),this.updateBboxFeatureGeometry(),this.source.addFeature(this.bboxFeature),this.layerRenderListener=this.layer.on(\"prerender\",()=>{this.updateBboxFeatureGeometry()})):this.bboxFeature&&(this.source.removeFeature(this.bboxFeature),this.bboxFeature=null,OV(this.layerRenderListener))}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer),OV(this.layerRenderListener)}updateBboxFeatureGeometry(){const t=this.getRestrictedBoundingBox(),e=stt(t.getPolygon()).map(t=>Qz(t));w$(this.bboxFeature.getGeometry().getCoordinates()[0]||[],e)||(this.bboxFeature.getGeometry().setCoordinates([e]),this.offlineService.updateViewBox(t.toLatLonExtent()))}getRestrictedBoundingBox(){const t=L8.fromOLView(this.map.getView()),e=Math.min(t.extent[2]-t.extent[0],Qz([20,0])[0])/2,i=t.center[0]-e,n=t.center[0]+e,r=Math.min(t.extent[3]-t.extent[1],function(t){const[,e]=Jz(t.center),[,i]=Qz([0,e+7.5]),[,n]=Qz([0,e-7.5]);return i-n}(t))/2;return l$.fromOLExtent([i,t.center[1]-r,n,t.center[1]+r]).scale(.8)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(fq))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-interaction-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();const Uit=Math.floor(10),Hit=new d7({image:new i7({stroke:new o7({color:\"#010a40\",lineDash:[Uit+4,16,2*Uit+4+1,18,2*Uit+4+1,16,2*Uit+4+1,18],width:4}),points:4,radius:30,angle:Math.PI/4})});class Git extends E1{constructor(t){super({geometry:new M2(Qz([t.lon,t.lat]))}),super.setStyle(Hit)}}let qit=(()=>{class t extends Lq{constructor(t,e,i){super(),this.fleetsService=t,this.mapStateConfig=e,this.selectionService=i}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new A9({features:[]}),this.layer=new d9({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:2}),this.map.addLayer(this.layer),this.subscriptions.push(LT([this.fleetsService.selectedFleet$,this.selectionService.entities$.pipe(E(t=>t.map(t=>t.entity).filter(t=>!!t)))]).subscribe(([t,e])=>{this.layer.getSource().clear(!0);const i=[];t&&i.push(...t.ships.filter(t=>Zj(t.lon)&&Zj(t.lat)).map(t=>new a$(t.lon,t.lat))),e.length&&i.push(...e.filter(t=>Zj(t.lon)&&Zj(t.lat)).map(t=>new a$(t.lon,t.lat))),this.layer.getSource().addFeatures(i.map(t=>new Git(t)))}),this.mapStateConfig.showSelectionMarkers$.subscribe(t=>{this.layer.setVisible(t)}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Tq),Ta(KG),Ta(bq))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-selection-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();const Wit=new d7({image:new r7});let Yit=(()=>{class t extends Lq{constructor(t){super(),this.mapService=t}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new A9({features:[],useSpatialIndex:!1}),this.layer=new d9({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:3}),this.map.addLayer(this.layer),this.subscriptions.push(this.mapService.pingLocation$.subscribe(t=>Vp(this,void 0,void 0,function*(){yield this.animatePing(t)})))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}animatePing(t){return Vp(this,void 0,void 0,function*(){const e=new E1(new M2(Qz(t)));e.setStyle(Wit),this.source.addFeature(e),this.flash(e),yield $j(3500),this.source.removeFeature(e)})}flash(t){const e=(new Date).getTime();let i=null;const n=n=>{const r=n.frameState.time-e,s=r/3e3;if(r>3e3)return void OV(i);const o=150-145*nN(s),a=2*nN(1-s),l=2*Math.PI*o/8,c=new d7({image:new r7({radius:o,stroke:new o7({color:`rgba(255, 0, 0, ${a})`,lineDash:[1*l/3,2*l/3],lineDashOffset:6*s*o,width:1+a})})}),h=function(t){var e,i=t.inversePixelTransform[0],n=t.frameState,r=I1(t.inversePixelTransform.slice(),n.coordinateToPixelTransform),s=s9(n.viewState.resolution,i),o=oV();return o&&(e=eV(o,n.viewState.projection)),new X7(t.context,i,n.extent,r,n.viewState.rotation,s,e)}(n);h.setStyle(c),h.drawGeometry(t.getGeometry().clone()),this.map.render()};i=this.layer.on(\"postrender\",t=>{n(t)})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(T$))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-ping-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})(),Zit=(()=>{class t extends Lq{constructor(t,e){super(),this.mapService=t,this.measureService=e,this.pointerMoveSubscription=new u,this.createdTooltips=[]}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new A9({features:[],wrapX:!1}),this.layer=new d9({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:2}),this.map.addLayer(this.layer),this.subscriptions.push(this.measureService.active$.subscribe(t=>{t?(this.drawInteraction=this.createInteraction(),this.map.addInteraction(this.drawInteraction)):this.stopInteraction()}))}ngOnDestroy(){super.ngOnDestroy(),this.clear()}clear(){this.source.clear(!0),this.stopInteraction(),this.createdTooltips.forEach(t=>{this.map.removeOverlay(t)})}stopInteraction(){this.map.getViewport().removeEventListener(\"mouseout\",this.mouseOutListener),this.pointerMoveSubscription.unsubscribe(),OV(this.drawChangeListener),this.map.removeInteraction(this.drawInteraction),this.map.removeOverlay(this.helpTooltipOverlay),this.map.removeOverlay(this.measureTooltipOverlay)}createInteraction(){return this.drawInteraction=new P9({source:this.source,type:\"LineString\",style:j9,condition:S4}),this.createMeasureTooltip(),this.createHelpTooltip(),this.drawInteraction.on(\"drawstart\",t=>{TB({category:\"app\",message:\"measure: drawstart\"}),this.sketchFeature=t.feature,this.sketchFeature.setStyle(this.getSketchFeatureStyle),this.drawChangeListener=this.sketchFeature.getGeometry().on(\"change\",t=>{const e=t.target;this.measureTooltipElement.innerHTML=m5(e),this.measureTooltipOverlay.setPosition(e.getLastCoordinate())})}),this.drawInteraction.on(\"drawend\",()=>{TB({category:\"app\",message:\"measure: drawend\"});const t=this.measureTooltipOverlay,e=this.sketchFeature;this.measureTooltipOverlay.setOffset([0,-7]),this.sketchFeature.setStyle(this.getSketchFeatureStyle(this.sketchFeature)),this.sketchFeature=null;const i=function(){const t=document.createElement(\"button\");return t.className=\"material-icons mat-icon\",t.innerText=\"close\",t.title=\"Supprimer la mesure\",t.style.padding=\"0\",t.style.marginRight=\"-8px\",t.style.marginTop=\"-4px\",t.style.marginBottom=\"-4px\",t.style.borderTopRightRadius=\"4px\",t.style.borderBottomRightRadius=\"4px\",t.style.fontSize=\"1.5em\",t.style.marginLeft=\"4px\",t.style.color=\"inherit\",t.style.backgroundColor=\"rgba(0, 0, 0, 0)\",t.addEventListener(\"mouseover\",()=>{t.style.backgroundColor=\"rgba(0, 0, 0, 0.3)\"}),t.addEventListener(\"mouseout\",()=>{t.style.backgroundColor=\"rgba(0, 0, 0, 0)\"}),t}();i.addEventListener(\"click\",()=>{this.map.removeOverlay(t),this.source.removeFeature(e)}),this.measureTooltipElement.appendChild(i),this.createdTooltips.push(this.measureTooltipOverlay),this.measureTooltipElement=null,this.createMeasureTooltip(),OV(this.drawChangeListener)}),this.pointerMoveSubscription=this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)}),this.mouseOutListener=()=>{this.helpTooltipElement.classList.add(\"measure-layer__tooltip--hidden\")},this.map.getViewport().addEventListener(\"mouseout\",this.mouseOutListener),this.drawInteraction}createHelpTooltip(){this.helpTooltipElement&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltipElement=document.createElement(\"div\"),this.helpTooltipElement.className=\"measure-layer__tooltip\",this.helpTooltipOverlay=new Oit({element:this.helpTooltipElement,className:\"measure-layer__unselectable\",offset:[15,0],positioning:\"center-left\"}),this.map.addOverlay(this.helpTooltipOverlay)}createMeasureTooltip(){this.measureTooltipElement&&this.measureTooltipElement.parentNode.removeChild(this.measureTooltipElement),this.measureTooltipElement=document.createElement(\"div\"),this.measureTooltipElement.className=\"measure-layer__tooltip measure-layer__tooltip--measure\",this.measureTooltipOverlay=new Oit({element:this.measureTooltipElement,offset:[0,-15],positioning:\"bottom-center\",stopEvent:!0}),this.map.addOverlay(this.measureTooltipOverlay)}handleMoveEvent(t){if(t.dragging)return;let e=\"Cliquer pour d\\xe9marrer la mesure\";this.sketchFeature&&(e=this.drawInteraction.atFinish_(t)?\"Cliquer pour terminer la mesure\":\"Cliquer pour ajouter un point\"),this.helpTooltipElement.innerHTML=e,this.helpTooltipOverlay.setPosition(t.coordinate),this.helpTooltipElement.classList.remove(\"measure-layer__tooltip--hidden\")}getSketchFeatureStyle(t){const e=t.getGeometry(),i=[new d7({stroke:new o7({color:\"rgba(0, 0, 0, 0.8)\",lineDash:[10,10],width:2})})];return e.forEachSegment((t,e)=>{i.push(new d7({geometry:new S2([t,e]),text:new B9({text:A5(t,e),font:\"12px sans-serif\",placement:\"line\",textBaseline:\"bottom\",overflow:!0,fill:new s7({color:\"#000000\"})})}))}),i}}return t.\\u0275fac=function(e){return new(e||t)(Ta(T$),Ta(OH))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-measure-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},styles:['.measure-layer__tooltip{position:relative;background:rgba(0,0,0,.7);border-radius:4px;color:#fff;padding:4px 8px;opacity:.8;white-space:nowrap;font-size:12px}.measure-layer__tooltip--measure{display:flex;align-items:center}.measure-layer__tooltip--measure:before{border-top:6px solid rgba(0,0,0,.7);border-right:6px solid transparent;border-left:6px solid transparent;content:\"\";position:absolute;bottom:-6px;margin-left:-7px;left:50%}.measure-layer__tooltip--hidden{display:none}.measure-layer__unselectable{pointer-events:none;touch-action:none}\\n'],encapsulation:2,changeDetection:0}),t})();var Xit=class extends k9{handleFeatureChange_(){}};class Kit extends L9{handleEvent(t){const e=[...t.pixel],i=super.handleEvent(t);return(t.pixel[0]!==e[0]||t.pixel[1]!==e[1])&&(t.snapped=!0),i}}const Qit=new o7({color:\"rgba(0, 0, 0, 0.8)\",lineDash:[10,10],width:2}),Jit=new d7({stroke:Qit}),tnt=[\"root\"];let ent=(()=>{class t extends Lq{constructor(){super(...arguments),this.remove=new ph}ngOnDestroy(){super.ngOnDestroy(),this.map.removeOverlay(this.overlay)}ngOnChanges(t){if(t.tooltip){t.tooltip.firstChange&&(this.overlay=new Oit({element:this.rootElement.nativeElement,offset:[0,-15],positioning:\"bottom-center\",stopEvent:!0}),this.map.addOverlay(this.overlay));const e=t.tooltip.previousValue,i=t.tooltip.currentValue;(!e||i.coordinates[0]!==e.coordinates[0]||i.coordinates[1]!==e.coordinates[1])&&this.overlay.setPosition(this.tooltip.coordinates)}}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"app-waypoint-tooltip\"]],viewQuery:function(t,e){if(1&t&&kh(tnt,7),2&t){let t;Ch(t=Mh())&&(e.rootElement=t.first)}},inputs:{map:\"map\",tooltip:\"tooltip\"},outputs:{remove:\"remove\"},features:[Vo,ce],decls:5,vars:1,consts:[[1,\"waypoint-tooltip\"],[\"root\",\"\"],[1,\"waypoint-tooltip__remove-btn\",\"material-icons\",\"mat-icon\",3,\"click\"]],template:function(t,e){1&t&&(Pa(0,\"div\",0,1),bl(2),Pa(3,\"button\",2),$a(\"click\",function(){return e.remove.next()}),bl(4,\"close\"),Da(),Da()),2&t&&(Ss(2),xl(\" \",e.tooltip.label,\" \"))},styles:['.waypoint-tooltip{position:relative;background:rgba(0,0,0,.7);border-radius:4px;color:#fff;padding:4px 8px;opacity:.8;white-space:nowrap;font-size:12px;display:flex;align-items:center}  .waypoint-tooltip:before{border-top:6px solid rgba(0,0,0,.7);border-right:6px solid transparent;border-left:6px solid transparent;content:\"\";position:absolute;bottom:-6px;margin-left:-7px;left:50%}  .waypoint-tooltip__remove-btn{padding:0;border-top-right-radius:4px;border-bottom-right-radius:4px;font-size:1.5em;margin:-4px -8px -4px 4px;color:inherit;background-color:rgba(0,0,0,0)}  .waypoint-tooltip__remove-btn:hover{background-color:rgba(0,0,0,.302)}'],changeDetection:0}),t})();function int(t,e){if(1&t){const t=Na();Pa(0,\"app-waypoint-tooltip\",1),$a(\"remove\",function(){const e=Fe(t).index;return Wa().emitRemoveEvent(e)}),Da()}if(2&t){const t=e.$implicit;Ia(\"map\",Wa().map)(\"tooltip\",t)}}let nnt=(()=>{class t extends Lq{constructor(){super(...arguments),this.remove=new ph,this.waypointTooltips=[]}ngOnDestroy(){super.ngOnDestroy()}ngOnChanges(t){t.pim&&this.buildWaypointTooltipsAndSegmentsLabels()}buildWaypointTooltipsAndSegmentsLabels(){const t=this.pim.feature.getGeometry().getCoordinates();if(t.length<2)throw new Error(\"PIM invalide (2 points n\\xe9cessaires)\");const e=this.pim.waypoints;if(e.length<1)throw new Error(\"PIM invalide (1 \\xe9tape n\\xe9cessaire)\");let i=this.pim.waypoints[0].timestamp;this.waypointTooltips=[{coordinates:t[0],label:rnt(i)}];const n=[];for(let r=1;r<t.length;r++){const s=t[r-1],o=t[r],a=e[r-1],l=g5(s,o),c=Math.round(i+l/a.speed*3600),h=RG(c-i);i=c,this.waypointTooltips.push({coordinates:o,label:`ETA: ${rnt(i)}`}),n.push(`${a.speed} kt - ${h}\\n${A5(s,o)}`)}this.pim.feature.setStyle(function(t,e){const i=[Jit];let n=0;return t.forEachSegment((t,r)=>{const[s,o]=e[n].split(\"\\n\");i.push(new d7({geometry:new S2([t,r]),text:new B9({text:` ${s}\\n`,font:\"12px sans-serif\",placement:\"line\",textBaseline:\"bottom\",overflow:!0,fill:V9})})),i.push(new d7({geometry:new S2([t,r]),text:new B9({text:o,font:\"12px sans-serif\",placement:\"line\",textBaseline:\"bottom\",overflow:!0,fill:V9})}));const a=r[0]-t[0],l=r[1]-t[1];if(0!==a||0!==l){const t=Math.atan2(l,a);i.push(new d7({geometry:new M2(r),image:new e9({src:\"assets/images/arrow-chevron.png\",anchor:[.6,.5],rotateWithView:!0,rotation:-t})}))}n++}),i}(this.pim.feature.getGeometry(),n))}trackByIndex(t){return t}emitRemoveEvent(t){this.remove.next({pim:this.pim,index:t})}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Gi(t)))(i||t)}}(),t.\\u0275cmp=Ht({type:t,selectors:[[\"app-pim\"]],inputs:{map:\"map\",pim:\"pim\"},outputs:{remove:\"remove\"},features:[Vo,ce],decls:1,vars:2,consts:[[3,\"map\",\"tooltip\",\"remove\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[3,\"map\",\"tooltip\",\"remove\"]],template:function(t,e){1&t&&na(0,int,1,2,\"app-waypoint-tooltip\",0),2&t&&Ia(\"ngForOf\",e.waypointTooltips)(\"ngForTrackBy\",e.trackByIndex)},directives:[Fd,ent],styles:[\"\"],changeDetection:0}),t})();function rnt(t){return IG(1e3*t,\"yyyy-MM-dd HH:mm\")}function snt(t,e){if(1&t){const t=Na();Pa(0,\"app-pim\",1),$a(\"remove\",function(e){return Fe(t),Wa().handleRemoveEvent(e)}),Da()}if(2&t){const t=e.$implicit;Ia(\"map\",Wa().map)(\"pim\",t)}}var ont=(()=>(function(t){t.Idle=\"idle\",t.Draw=\"draw\",t.Modify=\"modify\"}(ont||(ont={})),ont))();let ant=(()=>{class t extends Lq{constructor(t,e){super(),this.changeDetectorRef=t,this.pimService=e,this.pims=[],this.pointerMoveSubscription=new u,this.currentMode=ont.Idle,this.lastFeatureSegmentsCount=1,this.isUpdatingPIMGeometry=!1,this.updatedPIMOriginalGeometryCoordinates=null,this.mouseOutListener=()=>{this.helpTooltipOverlay.setPosition(null)}}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new A9({features:[],wrapX:!1}),this.layer=new d9({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:2}),this.map.addLayer(this.layer),this.subscriptions.push(this.pimService.active$.subscribe(t=>{t?this.createInteractions():this.removeInteractions()}),this.pimService.nextStartDate$.subscribe(t=>{if(this.currentMode===ont.Draw){const e=this.pims[this.pims.length-1];e.waypoints[0].timestamp=t,this.updatePIMReference(e)}}),this.pimService.nextSpeed$.subscribe(t=>{if(this.currentMode===ont.Draw){const e=this.pims[this.pims.length-1],i=e.waypoints;i[i.length-1].speed=t,this.updatePIMReference(e)}}))}ngOnDestroy(){super.ngOnDestroy(),this.clear()}clear(){this.source.clear(!0),this.removeInteractions()}createInteractions(){this.createModifyInteraction(),this.createDrawInteraction(),this.snapInteraction=new Kit({source:this.source,pixelTolerance:20}),this.map.addInteraction(this.snapInteraction),this.createHelpTooltip(),this.map.getViewport().addEventListener(\"mouseout\",this.mouseOutListener)}removeInteractions(){this.map.getViewport().removeEventListener(\"mouseout\",this.mouseOutListener),this.pointerMoveSubscription.unsubscribe(),OV(this.featureGeomChangeListener),this.map.removeInteraction(this.drawInteraction),this.map.removeInteraction(this.modifyInteraction),this.map.removeInteraction(this.snapInteraction),this.map.removeOverlay(this.helpTooltipOverlay)}createDrawInteraction(){this.drawInteraction=new P9({type:\"LineString\",source:this.source,style:j9,condition:S4}),this.map.addInteraction(this.drawInteraction),this.drawInteraction.on(\"drawstart\",t=>{TB({category:\"app\",message:\"pim: drawstart\"}),this.currentMode=ont.Draw,this.map.removeInteraction(this.snapInteraction),this.modifyInteraction.setActive(!1);const e=t.feature,i={feature:e,waypoints:[{timestamp:this.pimService.nextStartDate$.value,speed:this.pimService.nextSpeed$.value}]};e.pim=i,this.pims.push(i),this.listenForDrawedGeometryChanges(e)}),this.drawInteraction.on(\"drawend\",()=>{TB({category:\"app\",message:\"pim: drawend\"}),this.currentMode=ont.Idle,this.map.addInteraction(this.snapInteraction),this.modifyInteraction.setActive(!0),OV(this.featureGeomChangeListener)}),this.drawInteraction.on(\"drawabort\",()=>{TB({category:\"app\",message:\"pim: drawabort\"}),this.currentMode=ont.Idle,this.map.addInteraction(this.snapInteraction),this.modifyInteraction.setActive(!0),OV(this.featureGeomChangeListener),this.pims.splice(this.pims.length-1,1)}),this.pointerMoveSubscription=Hm(this.map,\"pointermove\").pipe(Jp(t=>{this.helpTooltipOverlay.setPosition(t.coordinate)}),I$(0)).subscribe(t=>{this.handleMoveEvent(t),this.changeDetectorRef.detectChanges()})}createModifyInteraction(){this.modifyInteraction=new Xit({source:this.source,style:j9,condition:S4}),this.map.addInteraction(this.modifyInteraction),this.modifyInteraction.on(\"modifystart\",t=>{TB({category:\"app\",message:\"pim: modifystart\"}),this.currentMode=ont.Modify,this.map.removeInteraction(this.snapInteraction);const e=t.features.item(0);this.listenForGeometryChanges(e)}),this.modifyInteraction.on(\"modifyend\",t=>{TB({category:\"app\",message:\"pim: modifyend\"}),this.currentMode=ont.Idle,this.map.addInteraction(this.snapInteraction),OV(this.featureGeomChangeListener)})}listenForGeometryChanges(t){this.updatedPIMOriginalGeometryCoordinates=t.getGeometry().getCoordinates(),this.lastFeatureSegmentsCount=this.updatedPIMOriginalGeometryCoordinates.length-1,this.featureGeomChangeListener=t.getGeometry().on(\"change\",()=>{const e=t.pim,i=t.getGeometry().getCoordinates(),n=i.length-1;if(n===this.lastFeatureSegmentsCount+1){for(let t=1;t<n;t++){const[n,r]=i[t],[s,o]=this.updatedPIMOriginalGeometryCoordinates[t];if(n!==s||r!==o){e.waypoints.splice(t,0,{speed:this.pimService.nextSpeed$.value});break}}this.lastFeatureSegmentsCount=n,this.handleMoveEvent(this.lastMoveEvent)}this.updatePIMReference(e)})}listenForDrawedGeometryChanges(t){this.updatedPIMOriginalGeometryCoordinates=t.getGeometry().getCoordinates(),this.lastFeatureSegmentsCount=this.updatedPIMOriginalGeometryCoordinates.length-1,this.featureGeomChangeListener=t.getGeometry().on(\"change\",()=>{const e=t.pim,i=t.getGeometry().getCoordinates().length-1;i!==this.lastFeatureSegmentsCount&&(this.isUpdatingPIMGeometry||(i>this.lastFeatureSegmentsCount?(e.waypoints.push({speed:this.pimService.nextSpeed$.value}),TB({category:\"app\",message:\"pim: add waypoint\"})):(e.waypoints.splice(e.waypoints.length-1,1),TB({category:\"app\",message:\"pim: remove waypoint\"}))),this.lastFeatureSegmentsCount=i,this.handleMoveEvent(this.lastMoveEvent)),this.isUpdatingPIMGeometry||this.updatePIMReference(e)})}createHelpTooltip(){this.helpTooltipElement&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltipElement=document.createElement(\"div\"),this.helpTooltipElement.className=\"help-tooltip\",this.helpTooltipOverlay=new Oit({element:this.helpTooltipElement,offset:[15,0],className:\"help-tooltip__overlay\",stopEvent:!1,positioning:\"center-left\"}),this.map.addOverlay(this.helpTooltipOverlay)}handleMoveEvent(t){this.lastMoveEvent=t;let e=\"\";if(this.currentMode===ont.Modify&&t.dragging)e=\"D\\xe9placer pour modifier l'\\xe9tape\";else if(t.snapped)switch(this.currentMode===ont.Idle&&this.drawInteraction.getActive()&&this.drawInteraction.setActive(!1),this.currentMode){case ont.Idle:e=\"Cliquer et maintenir pour ajouter une \\xe9tape\";break;case ont.Modify:e=\"D\\xe9placer pour modifier l'\\xe9tape\"}else switch(this.currentMode===ont.Idle&&!this.drawInteraction.getActive()&&this.drawInteraction.setActive(!0),this.currentMode){case ont.Idle:e=\"Cliquer pour d\\xe9marrer un PIM\";break;case ont.Draw:e=this.drawInteraction.atFinish_(t.pixel)?\"Cliquer pour terminer le PIM\":\"Cliquer pour ajouter une \\xe9tape\"}this.helpTooltipElement.innerHTML=e}trackByIndex(t){return t}removePIM(t){this.source.hasFeature(t.feature)?this.source.removeFeature(t.feature):this.drawInteraction.abortDrawing();const e=this.pims.findIndex(e=>e===t);this.pims.splice(e,1)}handleRemoveEvent(t){const e=t.pim,i=t.index;if(0===i||1===e.waypoints.length)return this.removePIM(e),void TB({category:\"app\",message:\"pim: remove pim\"});if(this.currentMode===ont.Draw&&this.pims[this.pims.length-1]===e&&i===e.waypoints.length)return;TB({category:\"app\",message:\"pim: remove waypoint\"}),e.waypoints.splice(i===e.waypoints.length?i-1:i,1);const n=e.feature.getGeometry(),r=n.getCoordinates();r.splice(i,1),this.isUpdatingPIMGeometry=!0,n.setCoordinates(r),this.isUpdatingPIMGeometry=!1,this.pims[this.pims.length-1]===e&&this.currentMode===ont.Draw&&(this.drawInteraction.sketchCoords_=r,this.drawInteraction.finishCoordinate_=r[i-1]),this.updatePIMReference(e),this.pimService.active$.value&&(this.map.removeInteraction(this.modifyInteraction),this.createModifyInteraction())}updatePIMReference(t){const e=this.pims.findIndex(e=>e===t);if(-1===e)throw console.warn(\"PIM non trouv\\xe9\",t,this.pims),new Error(\"PIM non trouv\\xe9\");const i=Object.assign({},t);t.feature.pim=i,this.pims[e]=i}}return t.\\u0275fac=function(e){return new(e||t)(Ta(Cc),Ta(NG))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-pim-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:1,vars:2,consts:[[3,\"map\",\"pim\",\"remove\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[3,\"map\",\"pim\",\"remove\"]],template:function(t,e){1&t&&na(0,snt,1,2,\"app-pim\",0),2&t&&Ia(\"ngForOf\",e.pims)(\"ngForTrackBy\",e.trackByIndex)},directives:[Fd,nnt],styles:[\".help-tooltip{position:relative;background:rgba(0,0,0,.7);border-radius:4px;color:#fff;padding:4px 8px;opacity:.8;white-space:nowrap;font-size:12px}  .help-tooltip__overlay{pointer-events:none!important;touch-action:none}\"]}),t})();function lnt(t,e){var i=[];Object.keys(e).forEach(function(t){null!=e[t]&&i.push(t+\"=\"+encodeURIComponent(e[t]))});var n=i.join(\"&\");return(t=-1===(t=t.replace(/[?&]$/,\"\")).indexOf(\"?\")?t+\"?\":t+\"&\")+n}var cnt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if(\"function\"!=typeof i&&null!==i)throw new TypeError(\"Class extends value \"+String(i)+\" is not a constructor or null\");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),hnt=function(t){function e(e){var i=this,n=e||{},r=n.params||{};return(i=t.call(this,{attributions:n.attributions,attributionsCollapsible:n.attributionsCollapsible,cacheSize:n.cacheSize,crossOrigin:n.crossOrigin,imageSmoothing:n.imageSmoothing,opaque:!(!(\"TRANSPARENT\"in r)||r.TRANSPARENT),projection:n.projection,reprojectionErrorThreshold:n.reprojectionErrorThreshold,tileClass:n.tileClass,tileGrid:n.tileGrid,tileLoadFunction:n.tileLoadFunction,url:n.url,urls:n.urls,wrapX:void 0===n.wrapX||n.wrapX,transition:n.transition,zDirection:n.zDirection})||this).gutter_=void 0!==n.gutter?n.gutter:0,i.params_=r,i.v13_=!0,i.serverType_=n.serverType,i.hidpi_=void 0===n.hidpi||n.hidpi,i.tmpExtent_=[1/0,1/0,-1/0,-1/0],i.updateV13_(),i.setKey(i.getKeyForParams_()),i}return cnt(e,t),e.prototype.getFeatureInfoUrl=function(t,e,i,n){var r=Yz(i),s=this.getProjection(),o=this.getTileGrid();o||(o=this.getTileGridForProjection(r));var a=o.getZForResolution(e,this.zDirection),l=o.getTileCoordForCoordAndZ(t,a);if(!(o.getResolutions().length<=l[0])){var c=o.getResolution(l[0]),h=o.getTileCoordExtent(l,this.tmpExtent_),u=GV(o.getTileSize(l[0]),this.tmpSize),d=this.gutter_;0!==d&&(u=$V(u,d,this.tmpSize),h=MN(h,c*d,h)),s&&s!==r&&(c=yV(s,r,t,c),h=rV(h,r,s),t=nV(t,r,s));var p={SERVICE:\"WMS\",VERSION:gV,REQUEST:\"GetFeatureInfo\",FORMAT:\"image/png\",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};WB(p,this.params_,n);var f=Math.floor((t[0]-h[0])/c),m=Math.floor((h[3]-t[1])/c);return p[this.v13_?\"I\":\"X\"]=f,p[this.v13_?\"J\":\"Y\"]=m,this.getRequestUrl_(l,u,h,1,s||r,p)}},e.prototype.getLegendUrl=function(t,e){if(void 0!==this.urls[0]){var i={SERVICE:\"WMS\",VERSION:gV,REQUEST:\"GetLegendGraphic\",FORMAT:\"image/png\"};if(void 0===e||void 0===e.LAYER){var n=this.params_.LAYERS;if(Array.isArray(n)&&1!==n.length)return;i.LAYER=n}if(void 0!==t){var r=this.getProjection()?this.getProjection().getMetersPerUnit():1;i.SCALE=t*r/28e-5}return WB(i,e),lnt(this.urls[0],i)}},e.prototype.getGutter=function(){return this.gutter_},e.prototype.getParams=function(){return this.params_},e.prototype.getRequestUrl_=function(t,e,i,n,r,s){var o=this.urls;if(o){if(s.WIDTH=e[0],s.HEIGHT=e[1],s[this.v13_?\"CRS\":\"SRS\"]=r.getCode(),\"STYLES\"in this.params_||(s.STYLES=\"\"),1!=n)switch(this.serverType_){case\"geoserver\":var a=90*n+.5|0;\"FORMAT_OPTIONS\"in s?s.FORMAT_OPTIONS+=\";dpi:\"+a:s.FORMAT_OPTIONS=\"dpi:\"+a;break;case\"mapserver\":s.MAP_RESOLUTION=90*n;break;case\"carmentaserver\":case\"qgis\":s.DPI=90*n;break;default:kN(!1,52)}var l=r.getAxisOrientation(),c=i;if(this.v13_&&\"ne\"==l.substr(0,2)){var h=void 0;h=i[0],c[0]=i[1],c[1]=h,h=i[2],c[2]=i[3],c[3]=h}return s.BBOX=c.join(\",\"),lnt(1==o.length?o[0]:o[wz(EV(t),o.length)],s)}},e.prototype.getTilePixelRatio=function(t){return this.hidpi_&&void 0!==this.serverType_?t:1},e.prototype.getKeyForParams_=function(){var t=0,e=[];for(var i in this.params_)e[t++]=i+\"-\"+this.params_[i];return e.join(\"/\")},e.prototype.updateParams=function(t){WB(this.params_,t),this.updateV13_(),this.setKey(this.getKeyForParams_())},e.prototype.updateV13_=function(){this.v13_=function(t,e){for(var i=(\"\"+t).split(\".\"),n=\"1.3\".split(\".\"),r=0;r<Math.max(i.length,n.length);r++){var s=parseInt(i[r]||\"0\",10),o=parseInt(n[r]||\"0\",10);if(s>o)return 1;if(o>s)return-1}return 0}(this.params_.VERSION||gV)>=0},e.prototype.tileUrlFunction=function(t,e,i){var n=this.getTileGrid();if(n||(n=this.getTileGridForProjection(i)),!(n.getResolutions().length<=t[0])){1!=e&&(!this.hidpi_||void 0===this.serverType_)&&(e=1);var r=n.getResolution(t[0]),s=n.getTileCoordExtent(t,this.tmpExtent_),o=GV(n.getTileSize(t[0]),this.tmpSize),a=this.gutter_;0!==a&&(o=$V(o,a,this.tmpSize),s=MN(s,r*a,s)),1!=e&&(o=HV(o,e,this.tmpSize));var l={SERVICE:\"WMS\",VERSION:gV,REQUEST:\"GetMap\",FORMAT:\"image/png\",TRANSPARENT:!0};return WB(l,this.params_),this.getRequestUrl_(t,o,s,e,i,l)}},e}(aj);function unt(t){var e;return Vp(this,void 0,void 0,function*(){const i=yield fetch(t);if(\"ANAIS-UI\"!==(null===(e=i.headers)||void 0===e?void 0:e.get(\"x-server\"))){const t=i.headers.get(\"content-type\");throw new Error(`Le serveur n'a pas bien r\\xe9pondu${\"application/json\"!==t?` (re\\xe7u: ${t}, attendu: application/json)`:\"\"}. Votre acc\\xe8s \\xe0 internet est-il bloqu\\xe9 par un proxy ?`)}try{return yield i.json()}catch(n){throw new Error(`Donn\\xe9es corrompues pour le fichier ${t}. JSON probablement malform\\xe9 (${n.message})`)}})}const dnt=[{url:\"assets/geo/UK_6M_Limit.geojson\",style:new d7({stroke:new o7({width:2,color:\"#7a7a7a\"})})},{url:\"assets/geo/UK_12M_Limit.geojson\",style:new d7({stroke:new o7({width:2,color:\"#579f6f\"})})}],pnt={limits36Nq:{assets:[{url:\"assets/geo/Limite_3milles_peche_WGS84_EPSG4326.geojson\",style:new d7({stroke:new o7({width:2,color:\"#ed791a\"})})},{url:\"assets/geo/Limite_6milles_bande_cotiere_peche_WGS84_EPSG4326.geojson\",style:new d7({stroke:new o7({width:2,color:\"#7a7a7a\"})})}],transformFeature:t=>{t.title=t.get(\"nature\"),t.hoverable=!0}},ukLimits612Nq:{assets:dnt,transformFeature:t=>{t.title=t.get(\"nature_of_\")?\"Limite 6 nautiques UK\":\"Limite 12 nautiques UK\",t.hoverable=!0}},maritimeBoundaries:{assets:[{url:\"assets/geo/Delim_accord_WGS84.geojson\",style:new d7({stroke:new o7({width:2,color:\"#090df6\"})})},{url:\"assets/geo/Lignes_base_droites_WGS84.geojson\",style:new d7({stroke:new o7({width:2,color:\"#000000\"})})},{url:\"assets/geo/Lim_ext_MT_WGS84.geojson\",style:new d7({stroke:new o7({width:2,color:\"#e31a1c\"})})},{url:\"assets/geo/Lim_ext_PC_WGS84.geojson\",style:new d7({stroke:new o7({width:2,color:\"#732d2f\"})})},{url:\"assets/geo/Lim_ext_ZC_WGS84.geojson\",style:new d7({stroke:new o7({width:2,color:\"#c36812\"})})},{url:\"assets/geo/Lim_ext_ZEE_WGS84.geojson\",style:new d7({stroke:new o7({width:2,color:\"#d60af5\"})})},{url:\"assets/geo/Lim_sans_accord_WGS84.geojson\",style:new d7({stroke:new o7({lineDash:[2,5],width:2,color:\"#000000\"})})}],transformFeature:t=>{t.title=t.get(\"nature\"),t.hoverable=!0}},mrcc:{assets:[{url:\"assets/geo/mrcc_2020-08-03.geojson\",style:new d7({image:new e9({src:\"/assets/images/lifeline.png\"})})}],transformFeature:t=>{t.title=t.get(\"name\"),t.hoverable=!0}},searchAndRescue:{assets:[{url:\"assets/geo/sar_2020-08-03.geojson\",style:new d7({stroke:new o7({width:2,color:\"#d9161e\"})})}],transformFeature:t=>{t.title=t.get(\"name\"),t.hoverable=!0}},searchAndRescueRegions:{assets:[{url:\"assets/geo/french-srr.geojson\",style:new d7({stroke:new o7({width:2,color:\"#d95716\"})})}],transformFeature:t=>{t.title=t.get(\"name\"),t.hoverable=!0}},shootingAreas:{assets:[{url:\"assets/geo/zonex.atlan.tirs.2021.corrected.geojson\",style:new d7({stroke:new o7({width:2,color:\"#6500b7\"}),fill:new s7({color:\"#6500b710\"})})}],transformFeature:t=>{t.title=t.get(\"zonex\"),t.hoverable=!1;const e=t.getStyle().clone();e.setText(new B9({text:t.title,font:\"12px sans-serif\",placement:\"point\",fill:V9})),t.setStyle(e)}}};let fnt=(()=>{class t extends Lq{constructor(t,e,i){super(),this.mapConfigService=t,this.mapService=e,this.zonexService=i,this.featuresLoaded$=new S,this.assetsFeaturesByType={},this.previousHoveredFeatures=[]}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.geoJSONReader=new K2({featureProjection:this.map.getView().getProjection().getCode()}),this.pointsSource=new A9({features:[]}),this.pointsLayer=new d9({source:this.pointsSource,updateWhileAnimating:!0,updateWhileInteracting:!0}),this.map.addLayer(this.pointsLayer),this.linesSource=new A9({features:[]}),this.linesLayer=new ett({source:this.linesSource}),this.map.addLayer(this.linesLayer),this.eezLayer=new y6({source:new hnt({url:\"https://geo.vliz.be/geoserver/gwc/service/wms\",params:{SRS:\"EPSG:3857\",LAYERS:\"MarineRegions:eez_boundaries\"}}),visible:!1}),this.map.addLayer(this.eezLayer),this.subscriptions.push(LT([this.mapConfigService.showMaritimeBoundariesLayer$,this.mapConfigService.show36NqLimitsLayer$,this.mapConfigService.showUK612NqLimitsLayer$,this.mapConfigService.showMRCCLayer$,this.mapConfigService.showSARLayer$,this.mapConfigService.showSRRLayer$,this.mapConfigService.showShootingAreasLayer$]).pipe(pf(([t,e,i,n,r,s,o])=>t||e||i||n||r||s||o),_P()).subscribe(()=>Vp(this,void 0,void 0,function*(){yield this.fetchFeatures()})),this.featuresLoaded$.pipe(_P()).subscribe(()=>{this.subscriptions.push(LT([this.mapConfigService.showMaritimeBoundariesLayer$,this.mapConfigService.show36NqLimitsLayer$,this.mapConfigService.showUK612NqLimitsLayer$,this.mapConfigService.showMRCCLayer$,this.mapConfigService.showSARLayer$,this.mapConfigService.showSRRLayer$,this.mapConfigService.showShootingAreasLayer$]).subscribe(([t,e,i,n,r,s,o])=>{this.pointsSource.clear(!0),this.linesSource.clear(!0),t&&this.linesSource.addFeatures(this.assetsFeaturesByType.maritimeBoundaries),e&&this.linesSource.addFeatures(this.assetsFeaturesByType.limits36Nq),i&&this.linesSource.addFeatures(this.assetsFeaturesByType.ukLimits612Nq),n&&this.pointsSource.addFeatures(this.assetsFeaturesByType.mrcc),r&&this.linesSource.addFeatures(this.assetsFeaturesByType.searchAndRescue),s&&this.linesSource.addFeatures(this.assetsFeaturesByType.searchAndRescueRegions),o&&this.linesSource.addFeatures(this.assetsFeaturesByType.shootingAreas)}))}),this.mapConfigService.showEEZLayer$.subscribe(t=>{this.eezLayer.setVisible(t)}),this.mapService.pointerMove$.subscribe(t=>{(this.pointsSource.getFeatures().length||this.linesSource.getFeatures().length)&&this.handleMoveEvent(t)}),this.zonexService.isConfiguringZonex$.subscribe(t=>{this.pointsLayer.setVisible(!t),this.linesLayer.setVisible(!t),this.eezLayer.setVisible(!t&&this.mapConfigService.showEEZLayer$.value)})),this.createTooltip()}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.pointsLayer),this.map.removeLayer(this.linesLayer),this.map.removeLayer(this.eezLayer),this.map.removeOverlay(this.tooltipOverlay)}createTooltip(){this.tooltipElement&&this.tooltipElement.parentNode.removeChild(this.tooltipElement),this.tooltipElement=document.createElement(\"div\"),this.tooltipElement.className=\"additional-features-layer__tooltip\",this.tooltipOverlay=new Oit({element:this.tooltipElement,offset:[0,-10],positioning:\"bottom-center\"}),this.map.addOverlay(this.tooltipOverlay)}handleMoveEvent(t){const e=[];this.map.forEachFeatureAtPixel(t.pixel,t=>(t.hoverable&&e.push(t),!1),{hitTolerance:3,layerFilter:t=>t===this.pointsLayer||t===this.linesLayer});const i=e.filter(t=>!this.previousHoveredFeatures.includes(t)),n=this.previousHoveredFeatures.filter(t=>!e.includes(t));if(i.length>0||n.length>0){const t=e.map(t=>t.title);this.tooltipElement.innerHTML=t.join('<hr class=\"additional-features-layer__separator\">'),this.previousHoveredFeatures=e}e.length>0?(this.tooltipOverlay.setPosition(t.coordinate),this.tooltipElement.classList.remove(\"additional-features-layer__tooltip--hidden\")):this.tooltipElement.classList.add(\"additional-features-layer__tooltip--hidden\")}fetchFeatures(){return Vp(this,void 0,void 0,function*(){yield Promise.all(Object.entries(pnt).map(([t,e])=>Vp(this,void 0,void 0,function*(){const i=yield Promise.all(e.assets.map(t=>Vp(this,void 0,void 0,function*(){return{collection:yield unt(t.url),style:t.style}})));this.assetsFeaturesByType[t]=i.flatMap(t=>{const i=this.geoJSONReader.readFeatures(t.collection);return i.forEach(i=>{i.setStyle(t.style),e.transformFeature(i)}),i})}))),this.featuresLoaded$.next(!0)})}}return t.\\u0275fac=function(e){return new(e||t)(Ta(k$),Ta(T$),Ta(XG))},t.\\u0275cmp=Ht({type:t,selectors:[[\"app-additional-features-layer\"]],inputs:{map:\"map\"},features:[Vo],decls:0,vars:0,template:function(t,e){},styles:['.additional-features-layer__tooltip{position:relative;background:rgba(0,0,0,.7);border-radius:4px;color:#fff;padding:4px 8px;opacity:.8;white-space:nowrap;font-size:12px;pointer-events:none;touch-action:none}.additional-features-layer__tooltip:before{border-top:6px solid rgba(0,0,0,.7);border-right:6px solid transparent;border-left:6px solid transparent;content:\"\";position:absolute;bottom:-6px;margin-left:-7px;left:50%}.additional-features-layer__tooltip--hidden{display:none}.additional-features-layer__separator{background-color:#fff}\\n'],encapsulation:2,changeDetection:0}),t})();const mnt={openSeaMap:new cj({url:dj.openSeaMapURL,crossOrigin:\"anonymous\",attributions:'\\xa9 "
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.178ada624ff15567c9ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "<a>"
						},
						{
							"uri": "https://anais.beta.gouv.fr/robots.txt",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "<noscript><link rel=\"stylesheet\" href=\"styles.3961828bc95154b9a268.css\"></noscript>"
						},
						{
							"uri": "https://anais.beta.gouv.fr/sitemap.xml",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "<noscript><link rel=\"stylesheet\" href=\"styles.3961828bc95154b9a268.css\"></noscript>"
						}
					],
					"count": "5",
					"solution": "<p>This is an informational alert and so no changes are required.</p>",
					"otherinfo": "<p>A noScript tag has been found, which is an indication that the application works differently with JavaScript enabled compared to when it is not.</p>",
					"reference": "",
					"cweid": "-1",
					"wascid": "-1",
					"sourceid": "1"
				},
				{
					"pluginid": "10049",
					"alertRef": "10049",
					"alert": "Non-Storable Content",
					"name": "Non-Storable Content",
					"riskcode": "0",
					"confidence": "2",
					"riskdesc": "Informational (Medium)",
					"desc": "<p>The response contents are not storable by caching components such as proxy servers. If the response does not contain sensitive, personal or user-specific information, it may benefit from being stored and cached, to improve performance.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "no-store"
						},
						{
							"uri": "https://anais.beta.gouv.fr/robots.txt",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "no-store"
						},
						{
							"uri": "https://anais.beta.gouv.fr/sitemap.xml",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "no-store"
						}
					],
					"count": "3",
					"solution": "<p>The content may be marked as storable by ensuring that the following conditions are satisfied:</p><p>The request method must be understood by the cache and defined as being cacheable (\"GET\", \"HEAD\", and \"POST\" are currently defined as cacheable)</p><p>The response status code must be understood by the cache (one of the 1XX, 2XX, 3XX, 4XX, or 5XX response classes are generally understood)</p><p>The \"no-store\" cache directive must not appear in the request or response header fields</p><p>For caching by \"shared\" caches such as \"proxy\" caches, the \"private\" response directive must not appear in the response</p><p>For caching by \"shared\" caches such as \"proxy\" caches, the \"Authorization\" header field must not appear in the request, unless the response explicitly allows it (using one of the \"must-revalidate\", \"public\", or \"s-maxage\" Cache-Control response directives)</p><p>In addition to the conditions above, at least one of the following conditions must also be satisfied by the response:</p><p>It must contain an \"Expires\" header field</p><p>It must contain a \"max-age\" response directive</p><p>For \"shared\" caches such as \"proxy\" caches, it must contain a \"s-maxage\" response directive</p><p>It must contain a \"Cache Control Extension\" that allows it to be cached</p><p>It must have a status code that is defined as cacheable by default (200, 203, 204, 206, 300, 301, 404, 405, 410, 414, 501).   </p>",
					"otherinfo": "",
					"reference": "<p>https://tools.ietf.org/html/rfc7234</p><p>https://tools.ietf.org/html/rfc7231</p><p>http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html (obsoleted by rfc7234)</p>",
					"cweid": "524",
					"wascid": "13",
					"sourceid": "1"
				},
				{
					"pluginid": "10049",
					"alertRef": "10049",
					"alert": "Storable and Cacheable Content",
					"name": "Storable and Cacheable Content",
					"riskcode": "0",
					"confidence": "2",
					"riskdesc": "Informational (Medium)",
					"desc": "<p>The response contents are storable by caching components such as proxy servers, and may be retrieved directly from the cache, rather than from the origin server by the caching servers, in response to similar requests from other users.  If the response data is sensitive, personal or user-specific, this may result in sensitive information being leaked. In some cases, this may even result in a user gaining complete control of the session of another user, depending on the configuration of the caching components in use in their environment. This is primarily an issue where \"shared\" caching servers such as \"proxy\" caches are configured on the local network. This configuration is typically found in corporate or educational environments, for instance.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr/assets/images/favicon_anais.png",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "max-age=7200"
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.207c5ca289596e0532fc923572aa0378208702a1.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "max-age=2592000"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es2015.f49bb84470ae61f45146.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "max-age=2592000"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.178ada624ff15567c9ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "max-age=2592000"
						},
						{
							"uri": "https://anais.beta.gouv.fr/runtime-es2015.b49b89920789fed5e542.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "max-age=2592000"
						},
						{
							"uri": "https://anais.beta.gouv.fr/runtime-es5.b49b89920789fed5e542.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "max-age=2592000"
						},
						{
							"uri": "https://anais.beta.gouv.fr/styles.3961828bc95154b9a268.css",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "max-age=2592000"
						}
					],
					"count": "7",
					"solution": "<p>Validate that the response does not contain sensitive, personal or user-specific information.  If it does, consider the use of the following HTTP response headers, to limit, or prevent the content being stored and retrieved from the cache by another user:</p><p>Cache-Control: no-cache, no-store, must-revalidate, private</p><p>Pragma: no-cache</p><p>Expires: 0</p><p>This configuration directs both HTTP 1.0 and HTTP 1.1 compliant caching servers to not store the response, and to not retrieve the response (without validation) from the cache, in response to a similar request. </p>",
					"otherinfo": "",
					"reference": "<p>https://tools.ietf.org/html/rfc7234</p><p>https://tools.ietf.org/html/rfc7231</p><p>http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html (obsoleted by rfc7234)</p>",
					"cweid": "524",
					"wascid": "13",
					"sourceid": "17"
				}
			]
		}
	]
}
